<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;zh-CN&quot;,&quot;default&quot;]"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Npc"><meta name="copyright" content="Npc"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>re4bÈòÖËØªÁ¨îËÆ∞ | Npc | Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/my_blog_prism@1.0.5/prism.css"><script src="https://cdn.jsdelivr.net/npm/my_blog_prism@1.0.5/prism.js"></script><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script type="module">import { renderKatex } from '/js/utils.js'
document.addEventListener("DOMContentLoaded", () => {
  renderKatex({
    ...{},
    ...true?.options,
  });
});</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"npc0vo.github.io","root":"/","title":"NpcÂ∞èÁ´ô","version":"1.10.11","mode":"light","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"waline":{"config":{"enable":true,"serverURL":"https://waline-onelastchicks-projects.vercel.app/","comment":false,"el":"#waline","lang":["en","zh-CN","default"]},"cdn":"https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.js","dark":"html.dark"},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-1LL0D86CY9"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1LL0D86CY9');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="Part.1 ÂâçË®Ä ÂØπ‰∫éÈÄÜÂêëÂ∑•Á®ãÊùÉÂ®ÅÊåáÂçóÂÖ≥ÈîÆÈÉ®ÂàÜÁöÑÊëòÂΩï,Êï¥ÁêÜ‰ª•Âèä‰∏™‰∫∫ÁöÑÁêÜËß£ ÈÄÜÂêëÂ∑•Á®ãÊùÉÂ®ÅÊåáÂçóÊòØÂÖ•Èó®ÈÄÜÂêëÂøÖËØªÁöÑ‰∏ÄÊú¨‰π¶Á±ç Áî±‰∫éÊàëÊòØÂàùÂ≠¶ËÄÖÔºåÊâÄ‰ª•ÊàëÁõÆÂâçÂè™Â≠¶‰π†re4b x86Ê±áÁºñÈÉ®ÂàÜÔºåÂØπ‰∫éARM‰ª•ÂèäMIPSÊû∂ÊûÑÂæÖ‰ª•ÂêéËøõÈò∂ÂêéÂÜçËøõË°åÂ≠¶‰π†  Part.2 Êåá‰ª§ËÆ≤Ëß£  Chapter1 CPU **Êåá‰ª§Á†ÅÔºöCPUÂèóÁêÜÁöÑÂ∫ïÂ±ÇÂëΩ‰ª§„ÄÇÂÖ∏ÂûãÁöÑÂ∫ïÂ±ÇÂëΩ‰ª§ÊúâÔºöÂ∞ÜÊï∞ÊçÆÂú®ÂØÑÂ≠òÂô®Èó¥ËΩ¨Áßª„ÄÅÊìç‰ΩúÂÜÖÂ≠ò„ÄÅËÆ°ÁÆóËøêÁÆóÁ≠âÊåá‰ª§„ÄÇÊØèÁ±ªCPUÈÉΩÊúâËá™Â∑±">
<meta property="og:type" content="article">
<meta property="og:title" content="re4bÈòÖËØªÁ¨îËÆ∞">
<meta property="og:url" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Npc | Blog">
<meta property="og:description" content="Part.1 ÂâçË®Ä ÂØπ‰∫éÈÄÜÂêëÂ∑•Á®ãÊùÉÂ®ÅÊåáÂçóÂÖ≥ÈîÆÈÉ®ÂàÜÁöÑÊëòÂΩï,Êï¥ÁêÜ‰ª•Âèä‰∏™‰∫∫ÁöÑÁêÜËß£ ÈÄÜÂêëÂ∑•Á®ãÊùÉÂ®ÅÊåáÂçóÊòØÂÖ•Èó®ÈÄÜÂêëÂøÖËØªÁöÑ‰∏ÄÊú¨‰π¶Á±ç Áî±‰∫éÊàëÊòØÂàùÂ≠¶ËÄÖÔºåÊâÄ‰ª•ÊàëÁõÆÂâçÂè™Â≠¶‰π†re4b x86Ê±áÁºñÈÉ®ÂàÜÔºåÂØπ‰∫éARM‰ª•ÂèäMIPSÊû∂ÊûÑÂæÖ‰ª•ÂêéËøõÈò∂ÂêéÂÜçËøõË°åÂ≠¶‰π†  Part.2 Êåá‰ª§ËÆ≤Ëß£  Chapter1 CPU **Êåá‰ª§Á†ÅÔºöCPUÂèóÁêÜÁöÑÂ∫ïÂ±ÇÂëΩ‰ª§„ÄÇÂÖ∏ÂûãÁöÑÂ∫ïÂ±ÇÂëΩ‰ª§ÊúâÔºöÂ∞ÜÊï∞ÊçÆÂú®ÂØÑÂ≠òÂô®Èó¥ËΩ¨Áßª„ÄÅÊìç‰ΩúÂÜÖÂ≠ò„ÄÅËÆ°ÁÆóËøêÁÆóÁ≠âÊåá‰ª§„ÄÇÊØèÁ±ªCPUÈÉΩÊúâËá™Â∑±">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240609142026432.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240609153017613.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240609202329684.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240610211849193.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240610144056548.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240610144124263.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240612161235490.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240612161445800.png">
<meta property="article:published_time" content="2024-05-23T08:25:47.000Z">
<meta property="article:modified_time" content="2025-01-13T11:50:45.421Z">
<meta property="article:author" content="Npc">
<meta property="article:tag" content="Â≠¶‰π†Á¨îËÆ∞">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240609142026432.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Npc"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Npc"><span class="site-author-status">üò≠</span></a><div class="site-author-name"><a href="/about/">Npc</a></div><span class="site-name">Npc | Blog</span><sub class="site-subtitle">ÂèàÊ¥ª‰∫Ü‰∏ÄÂ§©</sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">81</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">17</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="ÁïôË®ÄÊùø"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:clipboard-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/npc0vo" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@1930278836@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.yuque.com/npc0vo" title="Yuque" target="_blank" style="color:#a0c69d"><span class="icon iconify" data-icon="ri:yuque-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="ÊàëÁöÑÂ∞è‰ºô‰º¥‰ª¨" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#part1-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text"> Part.1 ÂâçË®Ä</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#part2-%E6%8C%87%E4%BB%A4%E8%AE%B2%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text"> Part.2 Êåá‰ª§ËÆ≤Ëß£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chapter1-cpu"><span class="toc-number">2.1.</span> <span class="toc-text"> Chapter1 CPU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap2-%E6%9C%80%E7%AE%80%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text"> Chap2 ÊúÄÁÆÄÂáΩÊï∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap3-helloworld"><span class="toc-number">2.3.</span> <span class="toc-text"> Chap3 Hello,World!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#msvs"><span class="toc-number">2.3.1.</span> <span class="toc-text"> msvs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc"><span class="toc-number">2.3.2.</span> <span class="toc-text"> gcc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#msvs-x86-64"><span class="toc-number">2.3.3.</span> <span class="toc-text"> msvs x86-64</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc-x86-64"><span class="toc-number">2.3.4.</span> <span class="toc-text"> gcc x86-64</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#problems"><span class="toc-number">2.3.5.</span> <span class="toc-text"> Problems</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap4-%E5%87%BD%E6%95%B0%E5%BA%8F%E8%A8%80%E5%92%8C%E5%87%BD%E6%95%B0%E5%B0%BE%E5%A3%B0"><span class="toc-number">2.4.</span> <span class="toc-text"> Chap4 ÂáΩÊï∞Â∫èË®ÄÂíåÂáΩÊï∞Â∞æÂ£∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap5-%E6%A0%88"><span class="toc-number">2.5.</span> <span class="toc-text"> Chap5 Ê†à</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%88%E7%9A%84%E7%94%A8%E9%80%94"><span class="toc-number">2.5.1.</span> <span class="toc-text"> Ê†àÁöÑÁî®ÈÄî</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%88%E7%9A%84%E5%99%AA%E9%9F%B3"><span class="toc-number">2.5.2.</span> <span class="toc-text"> Ê†àÁöÑÂô™Èü≥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#problems-2"><span class="toc-number">2.5.3.</span> <span class="toc-text"> Problems</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#51"><span class="toc-number">2.5.3.1.</span> <span class="toc-text"> 5.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#52"><span class="toc-number">2.5.3.2.</span> <span class="toc-text"> 5.2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap6-printf%E5%87%BD%E6%95%B0%E4%B8%8E%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="toc-number">2.6.</span> <span class="toc-text"> Chap6 printf()ÂáΩÊï∞‰∏éÂèÇÊï∞‰º†ÈÄí</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#x86"><span class="toc-number">2.6.1.</span> <span class="toc-text"> x86</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap7-scanf"><span class="toc-number">2.7.</span> <span class="toc-text"> Chap7 scanf()</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#x86-2"><span class="toc-number">2.7.1.</span> <span class="toc-text"> x86</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">2.7.2.</span> <span class="toc-text"> ÂÖ®Â±ÄÂèòÈáè</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#problem"><span class="toc-number">2.7.3.</span> <span class="toc-text"> Problem</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap8-%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96"><span class="toc-number">2.8.</span> <span class="toc-text"> Chap8 ÂèÇÊï∞Ëé∑Âèñ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap9-%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">2.9.</span> <span class="toc-text"> Chap9 ËøîÂõûÂÄº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#void%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">2.9.1.</span> <span class="toc-text"> voidÁ±ªÂûãÁöÑËøîÂõûÂÄº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E4%B8%BA%E7%BB%93%E6%9E%84%E4%BD%93%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">2.9.2.</span> <span class="toc-text"> ËøîÂõûÂÄº‰∏∫ÁªìÊûÑ‰ΩìÂûãÊï∞ÊçÆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap10-%E6%8C%87%E9%92%88"><span class="toc-number">2.10.</span> <span class="toc-text"> Chap10 ÊåáÈíà</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap12-%E6%9D%A1%E4%BB%B6%E8%BD%AC%E7%A7%BB"><span class="toc-number">2.11.</span> <span class="toc-text"> Chap12 Êù°‰ª∂ËΩ¨Áßª</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%AF%94%E8%BE%83"><span class="toc-number">2.11.1.</span> <span class="toc-text"> Êï∞ÂÄºÊØîËæÉ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%BB%9D%E5%AF%B9%E5%80%BC"><span class="toc-number">2.11.2.</span> <span class="toc-text"> ËÆ°ÁÆóÁªùÂØπÂÄº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.11.3.</span> <span class="toc-text"> Êù°‰ª∂ËøêÁÆóÁ¨¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E5%A4%A7%E5%B0%8F"><span class="toc-number">2.11.4.</span> <span class="toc-text"> ÊØîËæÉÂ§ßÂ∞è</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap13-switch"><span class="toc-number">2.12.</span> <span class="toc-text"> Chap13 Switch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#case%E8%BE%83%E5%B0%91%E7%9A%84%E6%83%85%E5%BD%A2"><span class="toc-number">2.12.1.</span> <span class="toc-text"> caseËæÉÂ∞ëÁöÑÊÉÖÂΩ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case%E8%BE%83%E5%A4%9A%E7%9A%84%E6%83%85%E5%BD%A2"><span class="toc-number">2.12.2.</span> <span class="toc-text"> caseËæÉÂ§öÁöÑÊÉÖÂΩ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case%E4%BB%8E%E5%8F%A5%E5%A4%9A%E5%AF%B9%E4%B8%80"><span class="toc-number">2.12.3.</span> <span class="toc-text"> case‰ªéÂè•Â§öÂØπ‰∏Ä</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fall-through"><span class="toc-number">2.12.4.</span> <span class="toc-text"> fall-through</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap14-%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.13.</span> <span class="toc-text"> Chap14 Âæ™ÁéØ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#for"><span class="toc-number">2.13.1.</span> <span class="toc-text"> for</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%9D%97%E5%A4%8D%E5%88%B6"><span class="toc-number">2.13.2.</span> <span class="toc-text"> ÂÜÖÂ≠òÂùóÂ§çÂà∂</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.13.3.</span> <span class="toc-text"> ÊÄªÁªì</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-2"><span class="toc-number">2.13.4.</span> <span class="toc-text"> Problem</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap15-c%E8%AF%AD%E8%A8%80%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">2.14.</span> <span class="toc-text"> Chap15 CËØ≠Ë®ÄÂ≠óÁ¨¶‰∏≤ÁöÑÂáΩÊï∞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#strlen"><span class="toc-number">2.14.1.</span> <span class="toc-text"> strlen()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap16-%E6%95%B0%E5%AD%A6%E8%AE%A1%E7%AE%97%E6%8C%87%E4%BB%A4%E7%9A%84%E6%9B%BF%E6%8D%A2"><span class="toc-number">2.15.</span> <span class="toc-text"> Chap16 Êï∞Â≠¶ËÆ°ÁÆóÊåá‰ª§ÁöÑÊõøÊç¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%98%E6%B3%95"><span class="toc-number">2.15.1.</span> <span class="toc-text"> ‰πòÊ≥ï</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E4%B8%BA%E5%8A%A0%E6%B3%95%E8%BF%90%E7%AE%97"><span class="toc-number">2.15.1.1.</span> <span class="toc-text"> ÊõøÊç¢‰∏∫Âä†Ê≥ïËøêÁÆó</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E4%B8%BA%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="toc-number">2.15.1.2.</span> <span class="toc-text"> ÊõøÊç¢‰∏∫Áßª‰ΩçËøêÁÆó</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E4%B8%BA%E7%A7%BB%E4%BD%8D%E5%8A%A0%E5%87%8F%E6%B3%95%E7%9A%84%E6%B7%B7%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">2.15.1.3.</span> <span class="toc-text"> ÊõøÊç¢‰∏∫Áßª‰Ωç,Âä†ÂáèÊ≥ïÁöÑÊ∑∑ÂêàËøêÁÆó</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%99%A4%E6%B3%95%E8%BF%90%E7%AE%97"><span class="toc-number">2.15.2.</span> <span class="toc-text"> Èô§Ê≥ïËøêÁÆó</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E4%B8%BA%E4%BD%8D%E7%A7%BB%E8%BF%90%E7%AE%97"><span class="toc-number">2.15.2.1.</span> <span class="toc-text"> ÊõøÊç¢‰∏∫‰ΩçÁßªËøêÁÆó</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-3"><span class="toc-number">2.15.3.</span> <span class="toc-text"> Problem</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap17-fpu"><span class="toc-number">2.16.</span> <span class="toc-text"> Chap17 FPU</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E6%B5%AE%E7%82%B9%E5%9E%8B"><span class="toc-number">2.16.1.</span> <span class="toc-text"> Âà©Áî®ÂèÇÊï∞‰º†ÈÄíÊµÆÁÇπÂûã</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%AF%B4%E6%98%8E"><span class="toc-number">2.16.2.</span> <span class="toc-text"> ÊØîËæÉËØ¥Êòé</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap18-%E6%95%B0%E7%BB%84"><span class="toc-number">2.17.</span> <span class="toc-text"> Chap18 Êï∞ÁªÑ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA"><span class="toc-number">2.17.1.</span> <span class="toc-text"> ÁºìÂÜ≤Âå∫Ê∫¢Âá∫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">2.17.2.</span> <span class="toc-text"> ÂÖ∂‰ªñ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8C%87%E9%92%88"><span class="toc-number">2.17.3.</span> <span class="toc-text"> Â≠óÁ¨¶‰∏≤ÊåáÈíà</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84"><span class="toc-number">2.17.4.</span> <span class="toc-text"> Â§öÁª¥Êï∞ÁªÑ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E7%BB%84%E7%9A%84%E5%B0%81%E8%A3%85%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.17.5.</span> <span class="toc-text"> ‰∫åÁª¥Â≠óÁ¨¶‰∏≤Êï∞ÁªÑÁöÑÂ∞ÅË£ÖÊ†ºÂºè</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-4"><span class="toc-number">2.17.6.</span> <span class="toc-text"> Problem</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap19-%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="toc-number">2.18.</span> <span class="toc-text"> Chap19 ‰ΩçËøêÁÆó</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%AE%9A%E4%BD%8D"><span class="toc-number">2.18.1.</span> <span class="toc-text"> ÁâπÂÆö‰Ωç</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x86-3"><span class="toc-number">2.18.1.1.</span> <span class="toc-text"> x86</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E4%BD%8D"><span class="toc-number">2.18.2.</span> <span class="toc-text"> Ê∏ÖÈô§‰Ωç</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E7%A7%BB"><span class="toc-number">2.18.3.</span> <span class="toc-text"> ‰ΩçÁßª</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8fpu%E4%B8%8A%E8%AE%BE%E7%BD%AE%E7%89%B9%E5%AE%9A%E4%BD%8D"><span class="toc-number">2.18.4.</span> <span class="toc-text"> Âú®FPU‰∏äËÆæÁΩÆÁâπÂÆö‰Ωç</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%8D%E6%A0%A1%E9%AA%8C"><span class="toc-number">2.18.4.1.</span> <span class="toc-text"> ‰ΩçÊ†°È™å</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#promblem"><span class="toc-number">2.18.5.</span> <span class="toc-text"> Promblem</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap20-%E7%BA%BF%E6%80%A7%E5%90%8C%E4%BD%99%E6%B3%95%E4%B8%8E%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">2.19.</span> <span class="toc-text"> Chap20 Á∫øÊÄßÂêå‰ΩôÊ≥ï‰∏é‰º™ÈöèÊú∫Êï∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap21-%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.20.</span> <span class="toc-text"> Chap21 ÁªìÊûÑ‰Ωì</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#systemtime"><span class="toc-number">2.20.1.</span> <span class="toc-text"> systemtime</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A5%E6%95%B0%E7%BB%84%E6%9B%BF%E4%BB%A3%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.20.1.1.</span> <span class="toc-text"> ‰ª•Êï∞ÁªÑÊõø‰ª£ÁªìÊûÑ‰Ωì</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#malloc"><span class="toc-number">2.20.2.</span> <span class="toc-text"> malloc()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unix-struct-tm"><span class="toc-number">2.20.3.</span> <span class="toc-text"> UNIX: struct tm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E5%AD%97%E6%AE%B5%E5%B0%81%E8%A3%85"><span class="toc-number">2.20.4.</span> <span class="toc-text"> ÁªìÊûÑ‰ΩìÁöÑÂ≠óÊÆµÂ∞ÅË£Ö</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E5%B5%8C%E5%A5%97"><span class="toc-number">2.20.5.</span> <span class="toc-text"> ÁªìÊûÑ‰ΩìÁöÑÂµåÂ•ó</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E4%BD%8D%E6%93%8D%E4%BD%9C"><span class="toc-number">2.20.6.</span> <span class="toc-text"> ÁªìÊûÑ‰ΩìÁöÑ‰ΩçÊìç‰Ωú</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap22-union%E5%85%B1%E7%94%A8%E4%BD%93"><span class="toc-number">2.21.</span> <span class="toc-text"> Chap22 UnionÂÖ±Áî®‰Ωì</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90"><span class="toc-number">2.21.1.</span> <span class="toc-text"> ‰º™ÈöèÊú∫Êï∞ÁîüÊàê</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%99%A8%E7%B2%BE%E5%BA%A6"><span class="toc-number">2.21.2.</span> <span class="toc-text"> ËÆ°ÁÆóÊú∫Âô®Á≤æÂ∫¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%B9%B3%E6%96%B9%E6%A0%B9%E8%AE%A1%E7%AE%97"><span class="toc-number">2.21.3.</span> <span class="toc-text"> Âø´ÈÄüÂπ≥ÊñπÊ†πËÆ°ÁÆó</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap23-%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88"><span class="toc-number">2.22.</span> <span class="toc-text"> Chap23 ÂáΩÊï∞ÊåáÈíà</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap24-32%E4%BD%8D%E7%B3%BB%E7%BB%9F%E5%A4%84%E7%90%8664%E4%BD%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">2.23.</span> <span class="toc-text"> Chap24 32‰ΩçÁ≥ªÁªüÂ§ÑÁêÜ64‰ΩçÊï∞ÊçÆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E5%8F%8A%E5%8A%A0%E5%87%8F%E8%BF%90%E7%AE%97"><span class="toc-number">2.23.1.</span> <span class="toc-text"> ÂèÇÊï∞‰º†ÈÄíÂèäÂä†ÂáèËøêÁÆó</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%98%E6%B3%95%E5%92%8C%E9%99%A4%E6%B3%95%E8%BF%90%E7%AE%97"><span class="toc-number">2.23.2.</span> <span class="toc-text"> ‰πòÊ≥ïÂíåÈô§Ê≥ïËøêÁÆó</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%B3%E7%A7%BB"><span class="toc-number">2.23.3.</span> <span class="toc-text"> Âè≥Áßª</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32%E4%BD%8D%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E4%B8%BA64%E4%BD%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">2.23.4.</span> <span class="toc-text"> 32‰ΩçÊï∞ÊçÆËΩ¨Êç¢‰∏∫64‰ΩçÊï∞ÊçÆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap25-simd"><span class="toc-number">2.24.</span> <span class="toc-text"> *Chap25 SIMD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%A2%E9%87%8F%E5%8C%96"><span class="toc-number">2.24.1.</span> <span class="toc-text"> Áü¢ÈáèÂåñ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#simd%E5%AE%9E%E7%8E%B0strlen"><span class="toc-number">2.24.2.</span> <span class="toc-text"> SIMDÂÆûÁé∞strlen()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap26-64%E4%BD%8D%E5%B9%B3%E5%8F%B0"><span class="toc-number">2.25.</span> <span class="toc-text"> Chap26 64‰ΩçÂπ≥Âè∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap27-simd%E4%B8%8E%E6%B5%AE%E7%82%B9%E6%95%B0%E7%9A%84%E5%B9%B6%E8%A1%8C%E8%BF%90%E7%AE%97"><span class="toc-number">2.26.</span> <span class="toc-text"> *Chap27 SIMD‰∏éÊµÆÁÇπÊï∞ÁöÑÂπ∂Ë°åËøêÁÆó</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap28-arm%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.27.</span> <span class="toc-text"> *Chap28 ARMÊåá‰ª§ËØ¶Ëß£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap29-mips%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.28.</span> <span class="toc-text"> *Chap29 MIPSÁöÑÁâπÁÇπ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#part3-%E7%A1%AC%E4%BB%B6%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text"> Part.3 Á°¨‰ª∂Âü∫Á°Ä</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chap30-%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%95%B0%E7%9A%84%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text"> Chap30 ÊúâÁ¨¶Âè∑Êï∞ÁöÑË°®Á§∫ÊñπÊ≥ï</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap31-%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-number">3.2.</span> <span class="toc-text"> Chap31 Â≠óËäÇÂ∫è</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E7%AB%AF%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-number">3.2.1.</span> <span class="toc-text"> Â§ßÁ´ØÂ≠óËäÇÂ∫è</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%AB%AF%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-number">3.2.2.</span> <span class="toc-text"> Â∞èÁ´ØÂ≠óËäÇÂ∫è</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E6%A8%A1%E4%BA%8C%E5%85%83%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.2.3.</span> <span class="toc-text"> ÂèåÊ®°‰∫åÂÖÉÊï∞ÊçÆÊ†ºÂºè</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-number">3.2.4.</span> <span class="toc-text"> ËΩ¨Êç¢Â≠óËäÇÂ∫è</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap32-%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-number">3.3.</span> <span class="toc-text"> Chap32 ÂÜÖÂ≠òÂ∏ÉÂ±Ä</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap33-cpu"><span class="toc-number">3.4.</span> <span class="toc-text"> Chap33 CPU</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B"><span class="toc-number">3.4.1.</span> <span class="toc-text"> ÂàÜÊîØÈ¢ÑÊµã</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3%E6%80%A7"><span class="toc-number">3.4.2.</span> <span class="toc-text"> Êï∞ÊçÆÁõ∏ÂÖ≥ÊÄß</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap34-hash"><span class="toc-number">3.5.</span> <span class="toc-text"> Chap34 hash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#part4-%E4%B8%80%E4%BA%9B%E9%AB%98%E7%BA%A7%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">4.</span> <span class="toc-text"> Part.4 ‰∏Ä‰∫õÈ´òÁ∫ßÁöÑ‰æãÂ≠ê</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chap35-%E6%B8%A9%E5%BA%A6%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.1.</span> <span class="toc-text"> Chap35 Ê∏©Â∫¶ËΩ¨Êç¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap36-%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97"><span class="toc-number">4.2.</span> <span class="toc-text"> Chap36 ÊñêÊ≥¢ÈÇ£Â•ëÊï∞Âàó</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap37-crc32"><span class="toc-number">4.3.</span> <span class="toc-text"> Chap37 CRC32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap38-%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%AE%A1%E7%AE%97"><span class="toc-number">4.4.</span> <span class="toc-text"> Chap38 ÁΩëÁªúÂú∞ÂùÄËÆ°ÁÆó</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap39-%E5%BE%AA%E7%8E%AF%E5%87%A0%E4%B8%AA%E8%BF%AD%E4%BB%A3"><span class="toc-number">4.5.</span> <span class="toc-text"> Chap39 Âæ™ÁéØÔºöÂá†‰∏™Ëø≠‰ª£Ôºü</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap40-%E8%BE%BE%E5%A4%AB%E8%A3%85%E7%BD%AE"><span class="toc-number">4.6.</span> <span class="toc-text"> Chap40 ËææÂ§´Ë£ÖÁΩÆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap41-%E9%99%A4%E4%BB%A59"><span class="toc-number">4.7.</span> <span class="toc-text"> Chap41 Èô§‰ª•9</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.7.1.</span> <span class="toc-text"> ÂÆû‰æã</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">4.7.2.</span> <span class="toc-text"> ÂéüÁêÜ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#more"><span class="toc-number">4.7.3.</span> <span class="toc-text"> More</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap42-str2numatoi%E5%87%BD%E6%95%B0"><span class="toc-number">4.8.</span> <span class="toc-text"> Chap42 str2numÔºåatoi()ÂáΩÊï∞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exmaple1"><span class="toc-number">4.8.1.</span> <span class="toc-text"> exmaple1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#example2"><span class="toc-number">4.8.2.</span> <span class="toc-text"> example2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap43-%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0"><span class="toc-number">4.9.</span> <span class="toc-text"> Chap43 ÂÜÖËÅîÂáΩÊï∞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#strcmp"><span class="toc-number">4.9.1.</span> <span class="toc-text"> strcmp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strlen-2"><span class="toc-number">4.9.2.</span> <span class="toc-text"> strlen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strcpy"><span class="toc-number">4.9.3.</span> <span class="toc-text"> strcpy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#memset"><span class="toc-number">4.9.4.</span> <span class="toc-text"> memset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#memcpy"><span class="toc-number">4.9.5.</span> <span class="toc-text"> memcpy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#memcmp"><span class="toc-number">4.9.6.</span> <span class="toc-text"> memcmp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap44-c99%E6%A0%87%E5%87%86%E7%9A%84%E5%8F%97%E9%99%90%E6%8C%87%E9%92%88"><span class="toc-number">4.10.</span> <span class="toc-text"> Chap44 C99Ê†áÂáÜÁöÑÂèóÈôêÊåáÈíà</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap45-%E6%89%93%E9%80%A0%E6%97%A0%E5%88%86%E6%94%AF%E7%9A%84abs%E5%87%BD%E6%95%B0"><span class="toc-number">4.11.</span> <span class="toc-text"> Chap45 ÊâìÈÄ†Êó†ÂàÜÊîØÁöÑabs()ÂáΩÊï∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap46-%E5%8F%98%E9%95%BF%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0"><span class="toc-number">4.12.</span> <span class="toc-text"> Chap46 ÂèòÈïøÂèÇÊï∞ÂáΩÊï∞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AE%97%E6%9C%AF%E5%B9%B3%E5%9D%87%E5%80%BC"><span class="toc-number">4.12.1.</span> <span class="toc-text"> ËÆ°ÁÆóÁÆóÊúØÂπ≥ÂùáÂÄº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vprintf"><span class="toc-number">4.12.2.</span> <span class="toc-text"> vprintf()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap47-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%89%AA%E5%88%87"><span class="toc-number">4.13.</span> <span class="toc-text"> Chap47 Â≠óÁ¨¶‰∏≤Ââ™Âàá</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap48-toupper"><span class="toc-number">4.14.</span> <span class="toc-text"> Chap48 toupper()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap49-%E4%B8%8D%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%8F%8D%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81"><span class="toc-number">4.15.</span> <span class="toc-text"> Chap49 ‰∏çÊ≠£Á°ÆÁöÑÂèçÊ±áÁºñ‰ª£Á†Å</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#x86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E4%BB%8E%E4%B8%80%E5%BC%80%E5%A7%8B%E5%B0%B1%E9%94%99%E8%AF%AF%E7%9A%84%E5%8F%8D%E6%B1%87%E7%BC%96"><span class="toc-number">4.15.1.</span> <span class="toc-text"> x86ÁéØÂ¢É‰∏ãÁöÑ‰ªé‰∏ÄÂºÄÂßãÂ∞±ÈîôËØØÁöÑÂèçÊ±áÁºñ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap50-%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF"><span class="toc-number">4.16.</span> <span class="toc-text"> Chap50 Ê∑∑Ê∑ÜÊäÄÊúØ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%98%E6%8D%A2"><span class="toc-number">4.16.1.</span> <span class="toc-text"> Â≠óÁ¨¶‰∏≤ÂèòÊç¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">4.16.2.</span> <span class="toc-text"> ÂèØÊâßË°å‰ª£Á†Å</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%9E%83%E5%9C%BE%E4%BB%A3%E7%A0%81"><span class="toc-number">4.16.2.1.</span> <span class="toc-text"> ÊèíÂÖ•ÂûÉÂúæ‰ª£Á†Å</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%A8%E5%A4%9A%E4%B8%AA%E6%8C%87%E4%BB%A4%E7%BB%84%E5%90%88%E4%BB%A3%E6%9B%BF%E5%8E%9F%E6%9D%A5%E7%9A%84%E4%B8%80%E4%B8%AA%E6%8C%87%E4%BB%A4"><span class="toc-number">4.16.2.2.</span> <span class="toc-text"> Áî®Â§ö‰∏™Êåá‰ª§ÁªÑÂêà‰ª£ÊõøÂéüÊù•ÁöÑ‰∏Ä‰∏™Êåá‰ª§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%8B%E7%BB%88%E6%89%A7%E8%A1%8C%E6%88%96%E4%BB%8E%E6%9D%A5%E4%B8%8D%E4%BC%9A%E6%89%A7%E8%A1%8C%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">4.16.2.3.</span> <span class="toc-text"> ÂßãÁªàÊâßË°åÊàñ‰ªéÊù•‰∏ç‰ºöÊâßË°åÁöÑ‰ª£Á†Å</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E4%B9%B1%E6%8C%87%E4%BB%A4%E5%BA%8F%E5%88%97"><span class="toc-number">4.16.2.4.</span> <span class="toc-text"> Êâì‰π±Êåá‰ª§Â∫èÂàó</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%97%B4%E6%8E%A5%E6%8C%87%E9%92%88"><span class="toc-number">4.16.2.5.</span> <span class="toc-text"> ‰ΩøÁî®Èó¥Êé•ÊåáÈíà</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E4%BC%AA%E4%BB%A3%E7%A0%81"><span class="toc-number">4.16.3.</span> <span class="toc-text"> ËôöÊãüÊú∫‰ª•Âèä‰º™‰ª£Á†Å</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap51-c"><span class="toc-number">4.17.</span> <span class="toc-text"> Chap51* C++</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">4.17.1.</span> <span class="toc-text"> Á±ª</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">4.17.1.1.</span> <span class="toc-text"> ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E7%BB%A7%E6%89%BF"><span class="toc-number">4.17.1.2.</span> <span class="toc-text"> Á±ªÁªßÊâø</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">4.17.1.3.</span> <span class="toc-text"> Â∞ÅË£Ö</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-number">4.17.1.4.</span> <span class="toc-text"> Â§öÈáçÁªßÊâø</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%96%B9%E6%B3%95"><span class="toc-number">4.17.1.5.</span> <span class="toc-text"> ËôöÊãüÊñπÊ≥ï</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ostream%E8%BE%93%E5%87%BA%E6%B5%81"><span class="toc-number">4.17.2.</span> <span class="toc-text"> ostreamËæìÂá∫ÊµÅ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">4.17.3.</span> <span class="toc-text"> ÂºïÁî®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stlstandard-template-library"><span class="toc-number">4.17.4.</span> <span class="toc-text"> *stl(standard template library)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#stdstring%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.17.4.1.</span> <span class="toc-text"> std::string(Â≠óÁ¨¶‰∏≤)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap52-%E6%95%B0%E7%BB%84%E4%B8%8E%E8%B4%9F%E6%95%B0%E7%B4%A2%E5%BC%95"><span class="toc-number">4.18.</span> <span class="toc-text"> Chap52 Êï∞ÁªÑ‰∏éË¥üÊï∞Á¥¢Âºï</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap53-16%E4%BD%8Dwindows%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.19.</span> <span class="toc-text"> Chap53 16‰ΩçwindowsÁ®ãÂ∫è</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap54-java"><span class="toc-number">4.20.</span> <span class="toc-text"> Chap54* Java</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#part5-%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%8F%91%E7%8E%B0%E6%9C%89%E8%B6%A3%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">5.</span> <span class="toc-text"> Part.5 Âú®‰ª£Á†Å‰∏≠ÂèëÁé∞ÊúâË∂£ÁöÑÂÜÖÂÆπ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chap55%E7%BC%96%E8%AF%91%E5%99%A8%E4%BA%A7%E7%94%9F%E7%9A%84%E6%96%87%E4%BB%B6%E7%89%B9%E5%BE%81"><span class="toc-number">5.1.</span> <span class="toc-text"> Chap55ÁºñËØëÂô®‰∫ßÁîüÁöÑÊñá‰ª∂ÁâπÂæÅ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#microsoft-visual-c"><span class="toc-number">5.1.1.</span> <span class="toc-text"> Microsoft Visual C++</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc-2"><span class="toc-number">5.1.2.</span> <span class="toc-text"> gcc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#intel-fortran"><span class="toc-number">5.1.3.</span> <span class="toc-text"> intel fortran</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#watcom%E5%92%8Copenwatcom"><span class="toc-number">5.1.4.</span> <span class="toc-text"> watcomÂíåopenwatcom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#borland"><span class="toc-number">5.1.5.</span> <span class="toc-text"> borland</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delphi"><span class="toc-number">5.1.6.</span> <span class="toc-text"> delphi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%9A%84dll"><span class="toc-number">5.1.7.</span> <span class="toc-text"> ÂÖ∂‰ªñÁöÑdll</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap56win32%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%A4%96%E9%83%A8%E9%80%9A%E4%BF%A1"><span class="toc-number">5.2.</span> <span class="toc-text"> Chap56Win32ÁéØÂ¢É‰∏éÂ§ñÈÉ®ÈÄö‰ø°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8windowsapi"><span class="toc-number">5.2.1.</span> <span class="toc-text"> Â∏∏Áî®WindowsAPI</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap57%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">5.3.</span> <span class="toc-text"> Chap57Â≠óÁ¨¶‰∏≤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap58-assert"><span class="toc-number">5.4.</span> <span class="toc-text"> Chap58 assert()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap59-%E5%B8%B8%E6%95%B0"><span class="toc-number">5.5.</span> <span class="toc-text"> Chap59 Â∏∏Êï∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap60%E6%A3%80%E7%B4%A2%E5%85%B3%E9%94%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">5.6.</span> <span class="toc-text"> Chap60Ê£ÄÁ¥¢ÂÖ≥ÈîÆÊåá‰ª§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap61%E5%8F%AF%E7%96%91%E4%BB%A3%E7%A0%81%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.7.</span> <span class="toc-text"> Chap61ÂèØÁñë‰ª£Á†ÅÊ®°Âûã</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap62-%E9%AD%94%E6%95%B0%E5%AD%97%E4%B8%8E%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95"><span class="toc-number">5.8.</span> <span class="toc-text"> Chap62 È≠îÊï∞Â≠ó‰∏éÁ®ãÂ∫èË∞ÉËØï</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap63-otherthing"><span class="toc-number">5.9.</span> <span class="toc-text"> Chap63 Otherthing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#part6-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3"><span class="toc-number">6.</span> <span class="toc-text"> Part.6 Êìç‰ΩúÁ≥ªÁªüÁõ∏ÂÖ≥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chap64%E5%8F%82%E6%95%B0%E7%9A%84%E4%BC%A0%E9%80%92%E6%96%B9%E6%B3%95"><span class="toc-number">6.1.</span> <span class="toc-text"> Chap64.ÂèÇÊï∞ÁöÑ‰º†ÈÄíÊñπÊ≥ï</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cdecl"><span class="toc-number">6.1.1.</span> <span class="toc-text"> cdecl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stdcall"><span class="toc-number">6.1.2.</span> <span class="toc-text"> stdcall</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fastcall"><span class="toc-number">6.1.3.</span> <span class="toc-text"> fastcall</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#thiscall"><span class="toc-number">6.1.4.</span> <span class="toc-text"> thiscall</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#64%E4%BD%8D%E4%B8%8B%E7%9A%84x86"><span class="toc-number">6.1.5.</span> <span class="toc-text"> 64‰Ωç‰∏ãÁöÑx86</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#64%E4%BD%8D%E4%B8%8Blinux"><span class="toc-number">6.1.6.</span> <span class="toc-text"> 64‰Ωç‰∏ãLinux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%8F%8C%E7%B2%BE%E5%BA%A6%E5%9E%8B%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">6.1.7.</span> <span class="toc-text"> ÂçïÂèåÁ≤æÂ∫¶ÂûãËøîÂõûÂÄº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0"><span class="toc-number">6.1.8.</span> <span class="toc-text"> ‰øÆÊîπÂèÇÊï∞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E9%92%88%E5%9E%8B%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="toc-number">6.1.9.</span> <span class="toc-text"> ÊåáÈíàÂûãÂáΩÊï∞ÂèÇÊï∞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap65-%E7%BA%BF%E7%A8%8B%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8tls"><span class="toc-number">6.2.</span> <span class="toc-text"> Chap65 Á∫øÁ®ãÊú¨Âú∞Â≠òÂÇ®TLS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tls%E5%9B%9E%E8%B0%83"><span class="toc-number">6.2.1.</span> <span class="toc-text"> TLSÂõûË∞É</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap66%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-number">6.3.</span> <span class="toc-text"> Chap66Á≥ªÁªüË∞ÉÁî®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#linux"><span class="toc-number">6.3.1.</span> <span class="toc-text"> linux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#windows"><span class="toc-number">6.3.2.</span> <span class="toc-text"> windows</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap67-linux"><span class="toc-number">6.4.</span> <span class="toc-text"> Chap67 Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E6%97%A0%E5%85%B3%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">6.4.1.</span> <span class="toc-text"> ‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑ‰ª£Á†Å</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ld_preload"><span class="toc-number">6.4.2.</span> <span class="toc-text"> LD_PRELOAD</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chap68-windowsnt"><span class="toc-number">6.5.</span> <span class="toc-text"> chap68 WindowsNT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#crt"><span class="toc-number">6.5.1.</span> <span class="toc-text"> CRT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pe"><span class="toc-number">6.5.2.</span> <span class="toc-text"> PE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%AF%E8%AF%AD"><span class="toc-number">6.5.2.1.</span> <span class="toc-text"> ÊúØËØ≠</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E5%9C%B0%E5%9D%80"><span class="toc-number">6.5.2.2.</span> <span class="toc-text"> Âü∫Âú∞ÂùÄ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">6.5.2.3.</span> <span class="toc-text"> Â≠êÁ≥ªÁªü</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AE%B5"><span class="toc-number">6.5.2.4.</span> <span class="toc-text"> ÊÆµ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tls"><span class="toc-number">6.5.2.5.</span> <span class="toc-text"> TLS</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#seh"><span class="toc-number">6.5.3.</span> <span class="toc-text"> SEH</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://npc0vo.github.io/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Npc"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Npc | Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">re4bÈòÖËØªÁ¨îËÆ∞</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="Created: 2024-05-23 16:25:47" itemprop="dateCreated datePublished" datetime="2024-05-23T16:25:47+08:00">2024-05-23</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="Modified: 2025-01-13 19:50:45" itemprop="dateModified" datetime="2025-01-13T19:50:45+08:00">2025-01-13</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="Word count in article">79.9k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="Reading time">357m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/Reverse/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Reverse</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">Â≠¶‰π†Á¨îËÆ∞</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="part1-ÂâçË®Ä"><a class="markdownIt-Anchor" href="#part1-ÂâçË®Ä"></a> Part.1 ÂâçË®Ä</h2>
<p>ÂØπ‰∫éÈÄÜÂêëÂ∑•Á®ãÊùÉÂ®ÅÊåáÂçóÂÖ≥ÈîÆÈÉ®ÂàÜÁöÑÊëòÂΩï,Êï¥ÁêÜ‰ª•Âèä‰∏™‰∫∫ÁöÑÁêÜËß£</p>
<p>ÈÄÜÂêëÂ∑•Á®ãÊùÉÂ®ÅÊåáÂçóÊòØÂÖ•Èó®ÈÄÜÂêëÂøÖËØªÁöÑ‰∏ÄÊú¨‰π¶Á±ç</p>
<p>Áî±‰∫éÊàëÊòØÂàùÂ≠¶ËÄÖÔºåÊâÄ‰ª•ÊàëÁõÆÂâçÂè™Â≠¶‰π†re4b x86Ê±áÁºñÈÉ®ÂàÜÔºåÂØπ‰∫éARM‰ª•ÂèäMIPSÊû∂ÊûÑÂæÖ‰ª•ÂêéËøõÈò∂ÂêéÂÜçËøõË°åÂ≠¶‰π†</p>
<h2 id="part2-Êåá‰ª§ËÆ≤Ëß£"><a class="markdownIt-Anchor" href="#part2-Êåá‰ª§ËÆ≤Ëß£"></a> Part.2 Êåá‰ª§ËÆ≤Ëß£</h2>
<h3 id="chapter1-cpu"><a class="markdownIt-Anchor" href="#chapter1-cpu"></a> Chapter1 CPU</h3>
<p>**Êåá‰ª§Á†ÅÔºöCPUÂèóÁêÜÁöÑÂ∫ïÂ±ÇÂëΩ‰ª§„ÄÇÂÖ∏ÂûãÁöÑÂ∫ïÂ±ÇÂëΩ‰ª§ÊúâÔºöÂ∞ÜÊï∞ÊçÆÂú®ÂØÑÂ≠òÂô®Èó¥ËΩ¨Áßª„ÄÅÊìç‰ΩúÂÜÖÂ≠ò„ÄÅËÆ°ÁÆóËøêÁÆóÁ≠âÊåá‰ª§„ÄÇÊØèÁ±ªCPUÈÉΩÊúâËá™Â∑±ÁöÑÊåá‰ª§ÈõÜÊû∂ÊûÑÔºàInstruction Set ArchitectureÔºåISAÔºâ„ÄÇ</p>
<p>**Êú∫Âô®Á†ÅÔºöÂèëÈÄÅÁªôCPUÁöÑÁ®ãÂ∫è‰ª£Á†Å„ÄÇ‰∏ÄÊù°Êåá‰ª§ÈÄöÂ∏∏Ë¢´Â∞ÅË£Ö‰∏∫Ëã•Âπ≤Â≠óËäÇ„ÄÇ</p>
<p>**Ê±áÁºñËØ≠Ë®ÄÔºö‰∏∫‰∫ÜËÆ©Á®ãÂ∫èÂëòÂ∞ëÈïøÁôΩÂ§¥ÂèëËÄåÂàõÈÄ†Âá∫Êù•ÁöÑ„ÄÅÊòìËØªÊòìËÆ∞ÁöÑ‰ª£Á†ÅÔºåÂÆÉÊúâÂæàÂ§öÁ±ª‰ººÂÆèÁöÑÊâ©Â±ïÂäüËÉΩ„ÄÇ</p>
<p>**CPUÂØÑÂ≠òÂô®ÔºöÊØèÁßçCPUÈÉΩÊúâÂÖ∂Âõ∫ÂÆöÁöÑÈÄöÁî®ÂØÑÂ≠òÂô®ÔºàGPRÔºâ„ÄÇx86 CPUÈáå‰∏ÄËà¨Êúâ8‰∏™GPRÔºåx64ÈáåÂæÄÂæÄÊúâ16‰∏™GPRÔºåËÄåARMÈáåÂàôÈÄöÂ∏∏Êúâ16‰∏™GPR„ÄÇÊÇ®ÂèØ‰ª•ËÆ§‰∏∫CPUÂØÑÂ≠òÂô®ÊòØ‰∏ÄÁßçÂ≠òÂÇ®ÂçïÂÖÉÔºåÂÆÉËÉΩÂ§üÊó†Â∑ÆÂà´Âú∞Â≠òÂÇ®ÊâÄÊúâÁ±ªÂûãÁöÑ‰∏¥Êó∂ÂèòÈáè„ÄÇÂÅáÂ¶ÇÊÇ®‰ΩøÁî®‰∏ÄÁßçÈ´òÁ∫ßÁöÑÁºñÁ®ãËØ≠Ë®ÄÔºå‰∏î‰ªÖ‰ºö‰ΩøÁî®Âà∞8‰∏™32‰ΩçÂèòÈáèÔºåÈÇ£‰πàÂÖâCPUËá™Â∏¶ÁöÑÂØÑÂ≠òÂô®Â∞±ËÉΩÂÆåÊàê‰∏çÂ∞ë‰ªªÂä°‰∫ÜÔºÅ</p>
<p><strong>Êåá‰ª§ÈõÜÊû∂ÊûÑ</strong></p>
<p>ÊúÄÂ∏∏ËßÅÁöÑ‰∏âÁßç</p>
<ul>
<li>
<p>ARMÊåá‰ª§ÈõÜÂàÜ‰∏∫3Á±ªÔºöARMÊ®°ÂºèÊåá‰ª§ÈõÜ„ÄÅThumbÊ®°ÂºèÊåá‰ª§ÈõÜÔºàÂåÖÊã¨Thumb-2ÔºâÂíåARM64ÁöÑÊåá‰ª§ÈõÜ„ÄÇÈúÄË¶ÅÂº∫Ë∞ÉÁöÑÊòØÔºö‰∏çÂêåÁöÑÊåá‰ª§ÈõÜÂàÜÂà´</p>
<p>Â±û‰∫é‰∏çÂêåÁöÑÊåá‰ª§ÈõÜÊû∂ÊûÑÔºõ‰∏Ä‰∏™Êåá‰ª§ÈõÜÁªùÈùûÂè¶‰∏Ä‰∏™Êåá‰ª§ÈõÜÁöÑÂèòÁßç„ÄÇ</p>
</li>
<li>
<p>x86Êåá‰ª§ÈõÜ ÂêÑopcodeÔºàÊ±áÁºñÊåá‰ª§ÂØπÂ∫îÁöÑÊú∫Âô®Á†ÅÔºâÁöÑÈïøÂ∫¶‰∏çÂ∞ΩÁõ∏Âêå</p>
</li>
<li>
<p>MIPSÊåá‰ª§ÈõÜ Â§öÊï∞ÈÉΩ‰ΩøÁî®‰∫ÜÂõ∫ÂÆöÈïøÂ∫¶ÁöÑ32‰Ωçopcode</p>
</li>
</ul>
<p><strong>Ê±áÁºñËØ≠Ë®Ä</strong>Â≠òÂú®‰∏§Áßç‰∏ªÊµÅËØ≠‰ΩìÔºåÂç≥<strong>IntelËØ≠‰Ωì</strong>Âíå<strong>AT&amp;TËØ≠‰Ωì</strong></p>
<h3 id="chap2-ÊúÄÁÆÄÂáΩÊï∞"><a class="markdownIt-Anchor" href="#chap2-ÊúÄÁÆÄÂáΩÊï∞"></a> Chap2 ÊúÄÁÆÄÂáΩÊï∞</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">f:</span>
	mov <span class="token register variable">eax</span>,<span class="token number">123</span>
	ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Ëøô‰∏™ÂáΩÊï∞‰ªÖÁî±‰∏§Êù°Êåá‰ª§ÊûÑÊàêÔºöÁ¨¨‰∏ÄÊù°Êåá‰ª§ÊääÊï∞ÂÄº123Â≠òÊîæÂú®EAXÂØÑÂ≠òÂô®ÈáåÔºõÊ†πÊçÆÂáΩÊï∞Ë∞ÉÁî®Á∫¶ÂÆö,ÂêéÈù¢‰∏ÄÊù°Êåá‰ª§‰ºöÊääEAXÁöÑÂÄºÂΩì‰ΩúËøîÂõûÂÄº‰º†ÈÄíÁªôË∞ÉÁî®ËÄÖÂáΩÊï∞ÔºåËÄåË∞ÉÁî®ËÄÖÂáΩÊï∞ÔºàcallerÔºâ‰ºö‰ªéEAXÂØÑÂ≠òÂô®ÈáåÂèñÂÄºÔºåÊääÂÆÉÂΩì‰ΩúËøîÂõûÁªìÊûú„ÄÇ</p>
<h3 id="chap3-helloworld"><a class="markdownIt-Anchor" href="#chap3-helloworld"></a> Chap3 Hello,World!</h3>
<h4 id="msvs"><a class="markdownIt-Anchor" href="#msvs"></a> msvs</h4>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello,world!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Áî®MSVS<code>cl 1.cpp /Fa1.asm</code>ÁîüÊàê<code>1.asm</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">CONST   SEGMENT
<span class="token operator">$</span>SG3830 DB       <span class="token string">'hello, world'</span>, <span class="token number">0AH</span>, <span class="token number">00H</span>
CONST   ENDS
PUBLIC  _main
EXTRN   _printf:PROC
<span class="token comment">; Function compile flags: /Odtp</span>
_TEXT   SEGMENT
_main   PROC
        push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        push    OFFSET <span class="token operator">$</span>SG3830
        call    _printf
        add     <span class="token register variable">esp</span>, <span class="token number">4</span>
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_main   ENDP
_TEXT   ENDS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÁîüÊàê<code>1.asm</code>ÂêéÔºåÁºñËØëÂô®‰ºöÁîüÊàê<code>1.obj</code>ÁÑ∂ÂêéÂÜçÈìæÊé•‰∏∫<code>1.exe</code></p>
<p>ÂØπËøôÊÆµÊ±áÁºñÁöÑËß£ËØª</p>
<ul>
<li>
<p>Êñá‰ª∂ÂàÜ‰∏∫‰∏§‰∏™‰ª£Á†ÅÊÆµÔºåÂç≥CONSTÂíå_TEXTÊÆµÔºåÂÆÉ‰ª¨ÂàÜÂà´‰ª£Ë°®Êï∞ÊçÆÊÆµÂíå‰ª£Á†ÅÊÆµ„ÄÇ</p>
</li>
<li>
<p>Â≠óÁ¨¶‰∏≤Â∏∏Èáè‚ÄúhelloÔºåworld‚ÄùÂàÜÈÖç‰∫Ü‰∏Ä‰∏™ÊåáÈíàÔºàconst char[]ÔºâÔºåÂè™ÊòØÂú®‰ª£Á†Å‰∏≠Ëøô‰∏™ÊåáÈíàÁöÑÂêçÁß∞Âπ∂‰∏çÊòéÊòæ</p>
</li>
<li>
<p>ÁºñËØëÂô®ËøõË°å‰∫ÜËá™Â∑±ÁöÑÂ§ÑÁêÜÔºåÂπ∂Âú®ÂÜÖÈÉ®ÊääÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÂëΩÂêç‰∏∫$SG3830,<code>0AH</code>ÊòØÊç¢Ë°åÁ¨¶</p>
<p>ÂèØ‰ª•ÂèëÁé∞Âú®Â≠óÁ¨¶‰∏≤Â∏∏ÈáèÂ∞æÈÉ®Ê∑ªÂä†‰∫Ü<code>00H</code>Ëøô‰∏™ÊòØÂ≠óÁ¨¶‰∏≤Â∏∏ÈáèÁöÑÁªìÊùüÊ†áÂøó,ÁºñËØëÂô®Ê∑ªÂä†ÁöÑ</p>
</li>
<li>
<p>Âú®‰ª£Á†ÅÊÆµ<code>_TEXT</code>Âè™Êúâ‰∏Ä‰∏™ÂáΩÊï∞ÔºåÂç≥<code>main()</code>,ÂÖ∂‰∏≠<code>PROC</code>ÊòØ<code>Procdure</code>ÁöÑÁº©ÂÜôÔºåË°®Á§∫Á®ãÂ∫èÁöÑÂºÄÂßã,‰∏é<code>ENDP</code>ÈÖçÂØπ‰ΩøÁî®</p>
</li>
<li>
<p>‰∏ªÂáΩÊï∞ÁöÑÂáΩÊï∞‰ΩìÊúâÊ†áÂøóÊÄßÁöÑÂáΩÊï∞Â∫èË®ÄÔºàfunction prologueÔºâ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push <span class="token register variable">ebp</span>        <span class="token comment">; ‰øùÂ≠òË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ßÊåáÈíà</span>
mov <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>    <span class="token comment">; Âª∫Á´ãÂΩìÂâçÂáΩÊï∞ÁöÑÊ†àÂ∏ßÊåáÈíà</span>
sub <span class="token register variable">esp</span>, N      <span class="token comment">; ‰∏∫Â±ÄÈÉ®ÂèòÈáèÂàÜÈÖçÁ©∫Èó¥ÔºàN ÊòØÈúÄË¶ÅÂàÜÈÖçÁöÑÂ≠óËäÇÊï∞Ôºâ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>‰ª•ÂèäÂáΩÊï∞Â∞æÂ£∞Ôºàfunction epilogueÔºâ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">mov <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>    <span class="token comment">; ÊÅ¢Â§çÊ†àÊåáÈíà</span>
pop <span class="token register variable">ebp</span>         <span class="token comment">; ÊÅ¢Â§çË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ßÊåáÈíà</span>
ret             <span class="token comment">; ËøîÂõûÂà∞Ë∞ÉÁî®ËÄÖ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ÂÆûÈôÖ‰∏äÊâÄÊúâÁöÑÂáΩÊï∞ÈÉΩÊúâËøôÊ†∑ÁöÑÂ∫èË®ÄÂíåÂ∞æÂ£∞„ÄÇ</p>
</li>
<li>
<p>Âú®ÂáΩÊï∞Â∫èË®Ä‰πãÂêéÔºåÁúãÂà∞Ë∞ÉÁî®<code>printf()</code>ÁöÑÊåá‰ª§<code>CALL _printf</code></p>
<p>ÈÄöËøá<code>PUSH</code>Êåá‰ª§ÔºåÁ®ãÂ∫èÊääÂ≠óÁ¨¶‰∏≤ÁöÑÊåáÈíàÊé®ÈÄÅÂÖ•Ê†à„ÄÇËøôÊ†∑Ôºå<code>printf()</code>ÂáΩÊï∞Â∞±ÂèØ‰ª•Ë∞ÉÁî®Ê†àÈáåÁöÑÊåáÈíàÔºåÂç≥Â≠óÁ¨¶‰∏≤<code>‚Äúhello, world!‚Äù</code>ÁöÑÂú∞ÂùÄ„ÄÇ</p>
</li>
<li>
<p>Âú®<code>printf()</code>ÂáΩÊï∞ÁªìÊùü‰ª•ÂêéÔºåÁ®ãÂ∫èÁöÑÊéßÂà∂ÊµÅ‰ºöËøîÂõûÂà∞<code>main()</code>ÂáΩÊï∞‰πã‰∏≠„ÄÇÊ≠§Êó∂ÔºåÂ≠óÁ¨¶‰∏≤Âú∞ÂùÄÔºàÂç≥ÊåáÈíàÔºâ‰ªçÊÆãÁïôÂú®Êï∞ÊçÆÊ†à‰πã‰∏≠„ÄÇËøô‰∏™Êó∂ÂÄôÂ∞±ÈúÄË¶ÅË∞ÉÊï¥Ê†àÊåáÈíàÔºàESPÂØÑÂ≠òÂô®ÈáåÁöÑÂÄºÔºâÊù•ÈáäÊîæËøô‰∏™ÊåáÈíà„ÄÇ</p>
</li>
<li>
<p>‰∏ã‰∏ÄÊù°ËØ≠Âè•ÊòØ<code>‚Äúadd ESPÔºå4‚Äù</code>ÔºåÊääESPÂØÑÂ≠òÂô®ÔºàÊ†àÊåáÈíà/Stack PointerÔºâÈáåÁöÑÊï∞ÂÄºÂä†4„ÄÇ(Âú®32‰ΩçÁ≥ªÁªü‰∏≠ÔºåÊåáÈíàÁöÑÂ§ßÂ∞èÂç†4Â≠óËäÇÔºåÂêåÁêÜÂú®64‰Ωç‰∏≠ÔºåÂ∞±Ë¶Å+8)</p>
<p>ËøôÊù°Êåá‰ª§ÂèØ‰ª•ÁêÜËß£‰∏∫‚ÄúPOPÊüêÂØÑÂ≠òÂô®‚Äù„ÄÇÂè™ÊòØÊú¨‰æãÁöÑÊåá‰ª§Áõ¥Êé•ËàçÂºÉ‰∫ÜÊ†àÈáåÁöÑÊï∞ÊçÆËÄåPOPÊåá‰ª§ËøòË¶ÅÊääÂØÑÂ≠òÂô®ÈáåÁöÑÂÄºÂ≠òÂÇ®Âà∞Êó¢ÂÆöÂØÑÂ≠òÂô®</p>
<p>Êüê‰∫õÁºñËØëÂô®ÔºàÂ¶ÇIntel C<ins>ÁºñËæëÂô®Ôºâ‰∏ç‰ºö‰ΩøÁî®ADDÊåá‰ª§Êù•ÈáäÊîæÊï∞ÊçÆÊ†àÔºå<strong>ÂÆÉ‰ª¨ÂèØËÉΩ‰ºöÁî®POP ECXÊåá‰ª§</strong>„ÄÇ‰æãÂ¶ÇÔºåOracle RDBMSÔºàÁî±Intel C</ins>ÁºñËØëÂô®ÁºñËØëÔºâÂ∞±‰ºöÁî®POP ECXÊåá‰ª§ÔºåËÄå‰∏ç‰ºöÁî®ADDÊåá‰ª§„ÄÇËôΩÁÑ∂POP ECXÂëΩ‰ª§Á°ÆÂÆû‰ºö‰øÆÊîπECXÂØÑÂ≠òÂô®ÁöÑÂÄºÔºå‰ΩÜÊòØÂÆÉ‰πüÂêåÊ†∑ÈáäÊîæ‰∫ÜÊ†àÁ©∫Èó¥„ÄÇ</p>
<p>Intel C++ÁºñËØëÂô®‰ΩøÁî®POP ECXÊåá‰ª§ÁöÑÂè¶Â§ñ‰∏Ä‰∏™ÁêÜÁî±Â∞±ÊòØÔºå<strong>POP ECXÂØπÂ∫îÁöÑOPCODEÔºà1Â≠óËäÇÔºâÊØîADD ESPÁöÑOPCODEÔºà3Â≠óËäÇÔºâË¶ÅÁü≠„ÄÇ</strong></p>
</li>
<li>
<p>Âú®‰∏äËø∞Á®ãÂ∫è‰∏≠printf()ÂáΩÊï∞ÁªìÊùü‰πãÂêéÔºåmain()ÂáΩÊï∞‰ºöËøîÂõû0ÔºàÂáΩÊï∞Ê≠£Â∏∏ÈÄÄÂá∫ÁöÑËøîÂõûÁ†ÅÔºâ„ÄÇÂç≥main()ÂáΩÊï∞ÁöÑËøêÁÆóÁªìÊûúÊòØ0„ÄÇËøô‰∏™ËøîÂõûÂÄºÊòØÁî±<strong>Êåá‰ª§<code>‚ÄúXOR EAX, EAX‚Äù</code>ËÆ°ÁÆóÂá∫Êù•ÁöÑ</strong>„ÄÇÁºñËØëÂô®ÈÄöÂ∏∏ÈááÁî®ÂºÇÊàñËøêÁÆóÊåá‰ª§ÔºåËÄå‰∏ç‰ºö‰ΩøÁî®‚ÄúMOV EAXÔºå0‚ÄùÊåá‰ª§„ÄÇ‰∏ªË¶ÅÊòØÂõ†‰∏∫<strong>ÂºÇÊàñËøêÁÆóÁöÑopcodeËæÉÁü≠</strong>Ôºà2Â≠óËäÇ:5Â≠óËäÇÔºâ</p>
</li>
<li>
<p>Ê±áÁºñÂàóË°®‰∏≠ÊúÄÂêéÁöÑÊìç‰ΩúÊåá‰ª§ÊòØRETÔºåÂ∞ÜÊéßÂà∂ÊùÉ‰∫§ÁªôË∞ÉÁî®Á®ãÂ∫è„ÄÇÈÄöÂ∏∏ÂÆÉËµ∑Âà∞ÁöÑ‰ΩúÁî®Â∞±ÊòØÂ∞ÜÊéßÂà∂ÊùÉ‰∫§ÁªôÊìç‰ΩúÁ≥ªÁªüÔºåËøôÈÉ®ÂàÜÂäüËÉΩÁî±C/C++ÁöÑ<code>CRT</code>ÂÆûÁé∞„ÄÇÔºàC RUNTIME LIBRARY)</p>
</li>
</ul>
<h4 id="gcc"><a class="markdownIt-Anchor" href="#gcc"></a> gcc</h4>
<p>Âà©Áî®<code>gcc</code>ÁºñËØëÂô®ÁºñËØë<code>gcc 1.c -o 1</code>ÈááÁî®<code>-S -masm=intel</code>ÁîüÊàêintelËØ≠Ê≥ïÁöÑÊ±áÁºñÂàóË°®Êñá‰ª∂</p>
<p>ÁîüÊàêÂêéÁî®IDAÊâìÂºÄ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">Main         proc near
var_10       <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">10h</span>

             push    <span class="token register variable">ebp</span>
             mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
             and     <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span>
             sub     <span class="token register variable">esp</span>, <span class="token number">10h</span>
             mov     <span class="token register variable">eax</span>, offset aHelloWorld <span class="token comment">; "hello, world\n"</span>
             mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token register variable">eax</span>
             call    _printf
             mov     <span class="token register variable">eax</span>, <span class="token number">0</span>
             leave
             retn
main         endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê±áÁºñËß£ËØª</p>
<ul>
<li>‰∏éMSVCÁîüÊàêÁöÑÁªìÊûúÂü∫Êú¨Áõ∏Âêå„ÄÇÂÆÉÈ¶ñÂÖàÊää‚Äúhello, world‚ÄùÂ≠óÁ¨¶‰∏≤Âú®Êï∞ÊçÆÊÆµÁöÑÂú∞ÂùÄÔºàÊåáÈíàÔºâÂ≠òÂÇ®Âà∞EAXÂØÑÂ≠òÂô®ÈáåÔºåÁÑ∂ÂêéÂÜçÊääÂÆÉÂ≠òÂÇ®Âú®Êï∞ÊçÆÊ†àÈáå„ÄÇ</li>
<li>ÂºÄÂ§¥ÁöÑ<code>and esp,0FFFFFFF0h</code>Âêë16Â≠óËäÇËæπÁïåÂØπÈΩêÔºàÊàê‰∏∫16ÁöÑÊï¥Êï∞ÂÄçÔºâÔºåÂ±û‰∫éÂàùÂßãÂåñÁöÑÊåá‰ª§„ÄÇÂ¶ÇÊûúÂú∞ÂùÄ‰ΩçÊ≤°ÊúâÂØπÈΩêÔºåÈÇ£‰πàCPUÂèØËÉΩÈúÄË¶ÅËÆøÈóÆ‰∏§Ê¨°ÂÜÖÂ≠òÊâçËÉΩËé∑ÂæóÊ†àÂÜÖÊï∞ÊçÆ„ÄÇËôΩÁÑ∂Âú®8Â≠óËäÇËæπÁïåÂ§ÑÂØπÈΩêÂ∞±ÂèØ‰ª•Êª°Ë∂≥32‰Ωçx86 CPUÂíå64‰Ωçx64 CPUÁöÑË¶ÅÊ±ÇÔºå‰ΩÜÊòØ‰∏ªÊµÅÁºñËØëÂô®ÁöÑÁºñËØëËßÑÂàôËßÑÂÆö‚ÄúÁ®ãÂ∫èËÆøÈóÆÁöÑÂú∞ÂùÄÂøÖÈ°ªÂêë16Â≠óËäÇÂØπÈΩêÔºàË¢´16Êï¥Èô§Ôºâ,ÁõÆÁöÑÊòØ‰∏∫‰∫ÜÊèêÈ´òÊïàÁéá</li>
<li><code>‚ÄúSUB ESPÔºå10h‚Äù</code>Â∞ÜÂú®Ê†à‰∏≠ÂàÜÈÖç0x10 bytesÔºåÂç≥16Â≠óËäÇ„ÄÇÊàë‰ª¨Âú®ÂêéÊñáÁúãÂà∞ÔºåÁ®ãÂ∫èÂè™‰ºöÁî®Âà∞4Â≠óËäÇÁ©∫Èó¥„ÄÇ‰ΩÜÊòØÂõ†‰∏∫ÁºñËØëÂô®ÂØπÊ†àÂú∞ÂùÄÔºàESPÔºâËøõË°å‰∫Ü16Â≠óËäÇÂØπÈΩêÔºåÊâÄ‰ª•ÊØèÊ¨°ÈÉΩ‰ºöÂàÜÈÖç16Â≠óËäÇÁöÑÁ©∫Èó¥„ÄÇ</li>
<li>ËÄåÂêéÔºåÁ®ãÂ∫èÂ∞ÜÂ≠óÁ¨¶‰∏≤Âú∞ÂùÄÔºàÊåáÈíàÁöÑÂÄºÔºâÁõ¥Êé•ÂÜôÂÖ•Âà∞Êï∞ÊçÆÊ†à„ÄÇÊ≠§Â§ÑÔºåGCC‰ΩøÁî®ÁöÑÊòØMOVÊåá‰ª§ÔºõËÄåMSVCÁîüÊàêÁöÑÊòØPUSHÊåá‰ª§„ÄÇÂÖ∂‰∏≠var_10ÊòØÂ±ÄÈÉ®ÂèòÈáèÔºåÁî®Êù•ÂêëÂêéÈù¢ÁöÑprintf()ÂáΩÊï∞‰º†ÈÄíÂèÇÊï∞„ÄÇ</li>
<li>GCCÂíåMSVC‰∏çÂêåÔºåÈô§Èùû‰∫∫Â∑•ÊåáÂÆö‰ºòÂåñÈÄâÈ°πÔºåÂê¶ÂàôÂÆÉ‰ºöÁîüÊàê‰∏éÊ∫ê‰ª£Á†ÅÁõ¥Êé•ÂØπÂ∫îÁöÑ‚ÄúMOV EAX, 0‚ÄùÊåá‰ª§„ÄÇ‰ΩÜÊòØÔºåÊàë‰ª¨Â∑≤ÁªèÁü•ÈÅìMOVÊåá‰ª§ÁöÑopcodeËÇØÂÆöË¶ÅÊØîXORÊåá‰ª§ÁöÑopcodeÈïø„ÄÇ</li>
<li>LEAVEÊåá‰ª§ÔºåÁÆÄÂåñÂáΩÊï∞Â∞æÂ£∞ÔºåÁ≠âÊïà‰∫é<code>‚ÄúMOV ESP, EBP‚Äù</code>Âíå‚Äú<code>POP EBP‚Äù</code>‰∏§Êù°Êåá‰ª§„ÄÇÂèØËßÅÔºåËøô‰∏™Êåá‰ª§Ë∞ÉÊï¥‰∫ÜÊï∞ÊçÆÊ†àÊåáÈíàESPÔºåÂπ∂Â∞ÜEBPÁöÑÊï∞ÂÄºÊÅ¢Â§çÂà∞Ë∞ÉÁî®Ëøô‰∏™ÂáΩÊï∞‰πãÂâçÁöÑÂàùÂßãÁä∂ÊÄÅ„ÄÇ</li>
</ul>
<h4 id="msvs-x86-64"><a class="markdownIt-Anchor" href="#msvs-x86-64"></a> msvs x86-64</h4>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG2989  DB      <span class="token string">'hello, world'</span>, <span class="token number">0AH</span> <span class="token number">00H</span>

main     PROC
         sub     <span class="token register variable">rsp</span>, <span class="token number">40</span>
         lea     <span class="token register variable">rcx</span>, OFFSET FLAT:<span class="token operator">$</span>SG2989
         call    printf
         xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
         add     <span class="token register variable">rsp</span>, <span class="token number">40</span>
         ret     <span class="token number">0</span>
main     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®x86-64Ê°ÜÊû∂ÁöÑCPUÈáåÔºåÊâÄÊúâÁöÑÁâ©ÁêÜÂØÑÂ≠òÂô®ÈÉΩË¢´Êâ©Â±ï‰∏∫64‰ΩçÂØÑÂ≠òÂô®„ÄÇÂØÑÂ≠òÂô®Âèò‰∏∫rÂ≠óÂºÄÂ§¥</p>
<p>‰∏∫‰∫ÜÂ∞ΩÂèØËÉΩÂÖÖÂàÜÂú∞Âà©Áî®ÂØÑÂ≠òÂô®„ÄÅÂáèÂ∞ëËÆøÈóÆÂÜÖÂ≠òÊï∞ÊçÆÁöÑÊ¨°Êï∞ÔºåÁºñËØëÂô®‰ºöÂÖÖÂàÜÂà©Áî®ÂØÑÂ≠òÂô®‰º†ÈÄíÂáΩÊï∞ÂèÇÊï∞ÔºàËØ∑ÂèÇËßÅ64.3ËäÇÁöÑfastcallÁ∫¶ÂÆöÔºâ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÁºñËØëÂô®‰ºö‰ºòÂÖà‰ΩøÁî®ÂØÑÂ≠òÂô®‰º†ÈÄíÈÉ®ÂàÜÂèÇÊï∞ÔºåÂÜçÂà©Áî®ÂÜÖÂ≠òÔºàÊï∞ÊçÆÊ†àÔºâ‰º†ÈÄíÂÖ∂‰ΩôÁöÑÂèÇÊï∞„ÄÇ<code>Win64ÁöÑÁ®ãÂ∫è</code>Ëøò‰ºö‰ΩøÁî®<code>RCX„ÄÅRDX„ÄÅR8„ÄÅR9</code>Ëøô4‰∏™ÂØÑÂ≠òÂô®Êù•Â≠òÊîæÂáΩÊï∞ÂèÇÊï∞„ÄÇÊàë‰ª¨Á®çÂêéÂ∞±‰ºöÁúãÂà∞ËøôÁßçÊÉÖÂÜµÔºöprintf()‰ΩøÁî®RCXÂØÑÂ≠òÂô®‰º†ÈÄíÂèÇÊï∞ÔºåËÄåÊ≤°ÊúâÂÉè32‰ΩçÁ®ãÂ∫èÈÇ£Ê†∑‰ΩøÁî®Ê†à‰º†ÈÄíÊï∞ÊçÆ„ÄÇ</p>
<p>main()ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÊòØÊï¥Êï∞Á±ªÂûãÁöÑÈõ∂Ôºå‰ΩÜÊòØÂá∫‰∫éÂÖºÂÆπÊÄßÂíåÂèØÁßªÊ§çÊÄßÁöÑËÄÉËôëÔºåCËØ≠Ë®ÄÁöÑÁºñËØëÂô®‰ªçÂ∞Ü‰ΩøÁî®<code>32‰ΩçÁöÑÈõ∂</code>„ÄÇÊç¢ËÄåË®Ä‰πãÔºåÂç≥‰ΩøÊòØ64‰ΩçÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÂú®Á®ãÂ∫èÁªìÊùüÊó∂EAXÁöÑÂÄºÊòØÈõ∂ÔºåËÄåR<code>AXÁöÑÂÄº‰∏ç‰∏ÄÂÆö‰ºöÊòØÈõ∂„ÄÇ</code></p>
<p>Êï∞ÊçÆÊ†àÁöÑÂØπÂ∫îÁ©∫Èó¥Èáå‰ªçÁïôÊúâ40Â≠óËäÇÁöÑÊï∞ÊçÆ„ÄÇËøôÈÉ®ÂàÜÊï∞ÊçÆÁ©∫Èó¥Êúâ‰∏™‰∏ìÁî®ÁöÑÂêçËØçÔºåÂç≥<code>Èò¥ÂΩ±Á©∫Èó¥</code>Ôºàshadow spaceÔºâ</p>
<h4 id="gcc-x86-64"><a class="markdownIt-Anchor" href="#gcc-x86-64"></a> gcc x86-64</h4>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">.string <span class="token string">"hello, world\n"</span>
<span class="token label function">main:</span>
         sub      <span class="token register variable">rsp</span>, <span class="token number">8</span>
         mov      <span class="token register variable">edi</span>, OFFSET FLAT:.LC0 <span class="token comment">; "hello, world"</span>
         xor      <span class="token register variable">eax</span>, <span class="token register variable">eax</span>  <span class="token comment">; number of vector registers passed</span>
         call     printf
         xor      <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
         add      <span class="token register variable">rsp</span>, <span class="token number">8</span>
         ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Linux„ÄÅBSDÂíåMac OS XÁ≥ªÁªü‰∏≠ÁöÑÂ∫îÁî®Á®ãÂ∫è</strong>Ôºå‰ºö‰ºòÂÖà‰ΩøÁî®<code>RDI„ÄÅRSI„ÄÅRDX„ÄÅRCX„ÄÅR8„ÄÅR9Ëøô6‰∏™ÂØÑÂ≠òÂô®‰º†ÈÄíÂáΩÊï∞ÊâÄÈúÄÁöÑÂ§¥6‰∏™ÂèÇÊï∞</code>ÔºåÁÑ∂Âêé‰ΩøÁî®Êï∞ÊçÆÊ†à‰º†ÈÄíÂÖ∂‰ΩôÁöÑÂèÇÊï∞„ÄÇ</p>
<p>‰ΩøÁî®‰∫Ü<code>EDI</code>ÂØÑÂ≠òÂô®Êù•‰º†ÈÄíÂ≠óÁ¨¶‰∏≤ÊåáÈíàÔºå‰∏∫‰ªÄ‰πà‰∏çÁî®<code>RDI</code></p>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºå64‰ΩçÊ±áÁºñÊåá‰ª§MOVÂú®ÂÜôÂÖ•R-ÂØÑÂ≠òÂô®ÁöÑ‰Ωé32‰ΩçÂú∞ÂùÄ‰ΩçÁöÑÊó∂ÂÄôÔºåÂç≥ÂØπE-ÂØÑÂ≠òÂô®ËøõË°åÂÜôÊìç‰ΩúÁöÑÊó∂ÂÄôÔºå‰ºöÂêåÊó∂Ê∏ÖÈô§R-ÂØÑÂ≠òÂô®‰∏≠ÁöÑÈ´ò32‰ΩçÂú∞ÂùÄ‰Ωç„ÄÇÊâÄ‰ª•, ‚ÄúMOV EAX, 011223344h‚ÄùËÉΩÂ§üÂØπRAXÂØÑÂ≠òÂô®ËøõË°åÊ≠£Á°ÆÁöÑËµãÂÄºÊìç‰ΩúÔºåÂõ†‰∏∫ËØ•Êåá‰ª§‰ºöÊ∏ÖÈô§ÔºàÁΩÆÈõ∂ÔºâÈ´òÂú∞ÂùÄ‰ΩçÁöÑÂÜÖÂÆπ„ÄÇ</p>
<p>‰ΩøÁî®<code>EDI</code>ÊòØÂõ†‰∏∫ÂèØ‰ª•‰Ωø<code>opcode</code>Áî±7‰∏™Â≠óËäÇÂáèÂ∞ëÂà∞5‰∏™Â≠óËäÇ,gcc‰ºòÂåñ</p>
<p><code>gcc</code>ÁöÑ‰ºòÂåñÊúâÂæàÂ§öÁâπÊÄßÔºå‰æãÂ¶Ç:ÂÆÉÂèØËÉΩ‰ºöÊääÂ≠óÁ¨¶‰∏≤ÊãÜÂá∫Êù•ÂçïÁã¨‰ΩøÁî®„ÄÇ‰ª•ËäÇÁúÅÂÜÖÂ≠ò</p>
<h4 id="problems"><a class="markdownIt-Anchor" href="#problems"></a> Problems</h4>
<p>1.Á≠î:Ë∞ÉÁî®‰∫Ü<code>MessagBeep</code>Ëøô‰∏™ÂáΩÊï∞ÔºåÂèÇÊï∞‰∏∫0xFFFFFFFF</p>
<h3 id="chap4-ÂáΩÊï∞Â∫èË®ÄÂíåÂáΩÊï∞Â∞æÂ£∞"><a class="markdownIt-Anchor" href="#chap4-ÂáΩÊï∞Â∫èË®ÄÂíåÂáΩÊï∞Â∞æÂ£∞"></a> Chap4 ÂáΩÊï∞Â∫èË®ÄÂíåÂáΩÊï∞Â∞æÂ£∞</h3>
<p>Áï•</p>
<h3 id="chap5-Ê†à"><a class="markdownIt-Anchor" href="#chap5-Ê†à"></a> Chap5 Ê†à</h3>
<ul>
<li>
<p>Ê†àÂ∞±ÊòØCPUÂØÑÂ≠òÂô®ÈáåÁöÑÊüê‰∏™ÊåáÈíàÊâÄÊåáÂêëÁöÑ‰∏ÄÁâáÂÜÖÂ≠òÂå∫Âüü„ÄÇËøôÈáåÊâÄËØ¥ÁöÑ‚ÄúÊüê‰∏™ÊåáÈíà‚ÄùÈÄöÂ∏∏‰Ωç‰∫éx86/x64Âπ≥Âè∞ÁöÑESPÂØÑÂ≠òÂô®/RSPÂØÑÂ≠òÂô®Ôºå‰ª•ÂèäARMÂπ≥Âè∞ÁöÑSPÂØÑÂ≠òÂô®„ÄÇ</p>
</li>
<li>
<p>Êìç‰ΩúÊ†àÁöÑÊúÄÂ∏∏ËßÅÁöÑÊåá‰ª§ÊòØPUSHÂíåPOPÔºå<code>PUSH</code>Êåá‰ª§‰ºöÂØπESP/RSP/SPÂØÑÂ≠òÂô®ÁöÑÂÄºËøõË°åÂáèÊ≥ïËøêÁÆóÔºå‰Ωø‰πãÂáèÂéª4Ôºà32‰ΩçÔºâÊàñ8Ôºà64‰ΩçÔºâÔºåÁÑ∂ÂêéÂ∞ÜÊìç‰ΩúÊï∞ÂÜôÂà∞‰∏äËø∞ÂØÑÂ≠òÂô®ÈáåÁöÑÊåáÈíàÊâÄÊåáÂêëÁöÑÂÜÖÂ≠ò‰∏≠„ÄÇ<code>POP</code>Êåá‰ª§ÊòØPUSHÊåá‰ª§ÁöÑÈÄÜÊìç‰ΩúÔºöÂÆÉÂÖà‰ªéÊ†àÊåáÈíàÔºàStack PointerÔºå‰∏äÈù¢‰∏â‰∏™ÂØÑÂ≠òÂô®‰πã‰∏ÄÔºâÊåáÂêëÁöÑÂÜÖÂ≠ò‰∏≠ËØªÂèñÊï∞ÊçÆÔºåÁî®‰ª•Â§áÁî®ÔºàÈÄöÂ∏∏ÊòØÂÜôÂà∞ÂÖ∂‰ªñÂØÑÂ≠òÂô®ÈáåÔºâÔºåÁÑ∂ÂêéÂÜçÂ∞ÜÊ†àÊåáÈíàÁöÑÊï∞ÂÄºÂä†‰∏ä4Êàñ8„ÄÇ</p>
</li>
<li>
<p>Ê†àÊòØÈÄÜÂ¢ûÈïøÁöÑÔºåÂç≥‰ªéÈ´òÂú∞ÂùÄÂêë‰ΩéÂú∞ÂùÄÂ¢ûÈïø</p>
</li>
</ul>
<hr />
<h4 id="Ê†àÁöÑÁî®ÈÄî"><a class="markdownIt-Anchor" href="#Ê†àÁöÑÁî®ÈÄî"></a> Ê†àÁöÑÁî®ÈÄî</h4>
<ul>
<li>
<p>‰øùÂ≠òÂáΩÊï∞ÁöÑËøîÂõûÂú∞ÂùÄ</p>
<p><code>call</code>Êåá‰ª§Á≠â‰ª∑‰∫é<code>push ËøîÂõûÂú∞ÂùÄ</code>‰∏é<code>jmp ÂáΩÊï∞Âú∞ÂùÄ</code></p>
<p><code>ret</code>Êåá‰ª§‰ªéÊ†à‰∏≠ËØªÂèñËøîÂõûÂú∞ÂùÄÔºåÁÑ∂ÂêéË∑≥ËΩ¨Âà∞Ëøô‰∏™Âú∞ÂùÄÔºåÁ≠â‰ª∑‰∫é<code>pop ËøîÂõûÂú∞ÂùÄ</code>‰∏é<code>jmp ËøîÂõûÂú∞ÂùÄ</code></p>
<p>Áî±Ê≠§ÂèØÂÆûÁé∞ÂáΩÊï∞ÁöÑÈÄíÂΩíË∞ÉÁî®</p>
</li>
<li>
<p>ÂèÇÊï∞‰º†ÈÄí</p>
<p>ÊúÄÂ∏∏Áî®ÁöÑÂèÇÊï∞‰º†ÈÄíÁ∫¶ÂÆöÊòØ<code>cdecl</code></p>
<p>‰ª•‰∏ã‰∏∫ÂÖ∂‰∏ªË¶ÅËßÑÂàô</p>
<ol>
<li><strong>ÂèÇÊï∞‰ªéÂè≥Âà∞Â∑¶ÂéãÂÖ•Ê†à</strong></li>
<li><strong>Ë∞ÉÁî®ËÄÖË¥üË¥£Ê∏ÖÁêÜÊ†à</strong>ÔºöÂáΩÊï∞Ë∞ÉÁî®ÁªìÊùüÂêéÔºåË∞ÉÁî®ËÄÖÈúÄË¶ÅË¥üË¥£‰ªéÊ†à‰∏≠ÂºπÂá∫‰º†ÈÄíÁªôÂáΩÊï∞ÁöÑÊâÄÊúâÂèÇÊï∞„ÄÇËøôÊÑèÂë≥ÁùÄÁºñËØëÂô®‰ºöÂú®Ë∞ÉÁî®ÂáΩÊï∞‰πãÂêéÁîüÊàêÁõ∏Â∫îÁöÑ‰ª£Á†ÅÊù•Ë∞ÉÊï¥Â†ÜÊ†àÊåáÈíàÔºåÊÅ¢Â§çË∞ÉÁî®ÂâçÁöÑÁä∂ÊÄÅ„ÄÇ</li>
<li><strong>ÂèØÂèòÂèÇÊï∞ÂàóË°®ÊîØÊåÅ</strong>Ôºöcdecl ÊîØÊåÅÂáΩÊï∞ÂÖ∑ÊúâÂèØÂèòÊï∞ÈáèÁöÑÂèÇÊï∞ÔºàÂ¶Ç printf ÂáΩÊï∞ÔºâÔºåËøôÊòØÈÄöËøáÂú®ÂèÇÊï∞ÂàóË°®‰∏≠‰ΩøÁî®ÁúÅÁï•Âè∑Ôºà‚Ä¶ÔºâÊù•Ë°®Á§∫ÁöÑ„ÄÇ</li>
<li><strong>ËøîÂõûÂÄºÈÄöÂ∏∏Âú®EAXÂØÑÂ≠òÂô®‰∏≠</strong>ÔºàÂØπ‰∫éx86Êû∂ÊûÑÔºâÔºöÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÂáΩÊï∞ÁöÑËøîÂõûÂÄºÂ¶ÇÊûúÂ§ßÂ∞èÈÄÇÂΩìÔºàÊØîÂ¶ÇÊï¥Êï∞„ÄÅÊåáÈíàÔºâÔºå‰ºöÈÄöËøáEAXÂØÑÂ≠òÂô®ËøîÂõû„ÄÇÂØπ‰∫éÊõ¥Â§ßÁöÑËøîÂõûÁ±ªÂûãÔºåÂèØËÉΩ‰ºöÈÄöËøáÂÖ∂‰ªñÊñπÂºèÔºåÂ¶ÇÈÄöËøáÊåáÈíà‰º†ÈÄí„ÄÇ</li>
</ol>
<p>‰æãÂ¶Ç</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push arg3
push arg2
push arg1
call f
add <span class="token register variable">esp</span>.<span class="token number">12</span><span class="token comment">;4*3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ë¢´Ë∞ÉÁî®ÁöÑÂáΩÊï∞ÂèØ‰ª•ÈÄöËøáÊ†àÊåáÈíàËé∑ÂèñÊâÄÈúÄÂèÇÊï∞</p>
<table>
<thead>
<tr>
<th>ESP</th>
<th>ËøîÂõûÂú∞ÂùÄ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ESP+4</td>
<td>arg1, ÂÆÉÂú®IDAÈáåËÆ∞‰∏∫arg_0</td>
</tr>
<tr>
<td>ESP+8</td>
<td>arg2, ÂÆÉÂú®IDAÈáåËÆ∞‰∏∫arg_4</td>
</tr>
<tr>
<td>ESP+0xC</td>
<td>arg3, ÂÆÉÂú®IDAÈáåËÆ∞‰∏∫arg_8</td>
</tr>
</tbody>
</table>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÁ®ãÂ∫èÂëòÂèØ‰ª•‰ΩøÁî®Ê†àÊù•‰º†ÈÄíÂèÇÊï∞Ôºå‰πüÂèØ‰ª•‰∏ç‰ΩøÁî®Ê†à‰º†ÈÄíÂèÇÊï∞„ÄÇÂèÇÊï∞Â§ÑÁêÜÊñπÈù¢Âπ∂Ê≤°ÊúâÁõ∏ÂÖ≥ÁöÑÁ°¨ÊÄßËßÑÂÆö„ÄÇ‰æãÂ¶Ç‰πüÂèØ‰ª•Áî®ÂØÑÂ≠òÂô®ÊàñËÄÖÂ†Ü‰∏äÂºÄËæüÂÜÖÂ≠òËøõË°å‰º†ÂèÇÔºå‰∏çËøáÂú®x86ËøôÁßçÁ∫¶ÂÆöÂ∑≤ÊòØ‰π†ÊÉØ</p>
<p>Â¶ÇÊûúÂáΩÊï∞ÂèØÂ§ÑÁêÜÁöÑÂèÇÊï∞Êï∞ÈáèÂèØÂèòÔºåÂ∞±ÈúÄË¶ÅÁî®ËØ¥ÊòéÁ¨¶Â¶Ç%dËøõË°åÊ†ºÂºèÂåñËØ¥ÊòéÔºåÊòéÁ°ÆÂèÇÊï∞‰ø°ÊÅØ</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d %d"</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Ëøô‰∏™ÂëΩ‰ª§‰∏ç‰ªÖ‰ºöËÆ©printf()ÊòæÁ§∫1234ÔºåËÄå‰∏îËøò‰ºöËÆ©ÂÆÉÊòæÁ§∫Êï∞ÊçÆÊ†àÂÜÖ1234‰πãÂêéÁöÑ‰∏§‰∏™Âú∞ÂùÄÁöÑÈöèÊú∫Êï∞„ÄÇ</p>
<p>Áî±Ê≠§ÂèØÁü•ÔºåÂ£∞Êòémain()ÂáΩÊï∞ÁöÑÊñπÊ≥ïÂπ∂‰∏çÊòØÈÇ£‰πàÈáçË¶Å„ÄÇÊàë‰ª¨ÂèØ‰ª•Â∞Ü‰πãÂ£∞Êòé‰∏∫<code>main(),main(int argc, char *argv[])Êàñmain(int argc, char *argv[], char *envp[])</code>,CRT‰∏≠Ë∞ÉÁî®<code>main()</code>Êåá‰ª§Â¶Ç‰∏ã:</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push envp
push argv
push argc
call main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>Â≠òÂÇ®Â±ÄÈÉ®ÂèòÈáè</p>
</li>
<li>
<p>x86.alloca()ÂáΩÊï∞</p>
<p><code>malloc()</code>ÊòØÂú®Â†Ü‰∏äÂàÜÈÖçÂÜÖÂ≠òÔºåËÄå<code>alloc()</code>Áõ¥Êé•‰ΩøÁî®Ê†àÊù•ÂàÜÈÖçÂÜÖÂ≠ò</p>
<p>Áî±‰∫éÂáΩÊï∞Â∞æÂ£∞ÁöÑ‰ª£Á†Å‰ºöËøòÂéü<code>ESP</code>ÁöÑÂÄºÔºå‰∏çÈúÄË¶ÅÁâπÂú∞‰ΩøÁî®<code>free()</code>Êù•ÈáäÊîæÂÜÖÂ≠ò</p>
</li>
<li>
<p>(Win)SEHÁªìÊûÑÂåñÂºÇÂ∏∏Â§ÑÁêÜ</p>
<p>Â¶ÇÊûúÁ®ãÂ∫èÈáåÂ≠òÂú®<code>SEH</code>ËÆ∞ÂΩïÔºåÈÇ£‰πàËÆ∞ÂΩï‰ºö‰øùÂ≠òÂú®Ê†à‰∏≠</p>
</li>
<li>
<p>ÁºìÂÜ≤Âå∫Ê∫¢Âá∫‰øùÊä§</p>
</li>
<li>
<p>ÂÖ∏ÂûãÁöÑÊ†àÁöÑÂÜÖÂ≠òÂ≠òÂÇ®Ê†ºÂºè</p>
<p>Âú®32‰ΩçÁ≥ªÁªü‰∏≠ÔºåÂú®Á®ãÂ∫èË∞ÉÁî®ÂáΩÊï∞‰πãÂêé„ÄÅÊâßË°åÂÆÉÁöÑÁ¨¨‰∏ÄÊù°Êåá‰ª§‰πãÂâçÔºåÊ†àÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂ≠òÂÇ®Ê†ºÂºè‰∏ÄËà¨Â¶Ç‰∏ãË°®ÊâÄÁ§∫„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">|</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token operator">|</span> <span class="token comment">//È´ò‰Ωç</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> ÂèÇÊï∞      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> ËøîÂõûÂú∞ÂùÄ  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>  <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token function">esp</span> <span class="token punctuation">(</span>Ë∞ÉÁî®Âêé<span class="token punctuation">)</span>
<span class="token operator">|</span> Ë∞ÉÁî®ËÄÖÁöÑebp <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> Â±ÄÈÉ®ÂèòÈáè  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>  <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token function">esp</span> <span class="token punctuation">(</span>ËÆæÁΩÆÂÆåÂ±ÄÈÉ®ÂèòÈáèÂêé<span class="token punctuation">)</span><span class="token comment">//‰Ωé‰Ωç</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<table>
<thead>
<tr>
<th>‚Ä¶</th>
<th>‚Ä¶‚Ä¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>ESP-0xC</td>
<td>Á¨¨2‰∏™Â±ÄÈÉ®ÂèòÈáèÔºåÂú®IDAÈáåËÆ∞‰∏∫var_8</td>
</tr>
<tr>
<td>ESP-8</td>
<td>Á¨¨1‰∏™Â±ÄÈÉ®ÂèòÈáèÔºåÂú®IDAÈáåËÆ∞‰∏∫var_4</td>
</tr>
<tr>
<td>ESP-4</td>
<td>‰øùÂ≠òÁöÑEBPÂÄº</td>
</tr>
<tr>
<td>ESP</td>
<td>ËøîÂõûÂú∞ÂùÄ</td>
</tr>
<tr>
<td>ESP+4</td>
<td>arg1, Âú®IDAÈáåËÆ∞‰∏∫arg_0</td>
</tr>
<tr>
<td>ESP+8</td>
<td>arg2, Âú®IDAÈáåËÆ∞‰∏∫arg_4</td>
</tr>
<tr>
<td>ESP+0xC</td>
<td>arg3, Âú®IDAÈáåËÆ∞‰∏∫arg_8</td>
</tr>
<tr>
<td>‚Ä¶</td>
<td>‚Ä¶‚Ä¶</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr />
<h4 id="Ê†àÁöÑÂô™Èü≥"><a class="markdownIt-Anchor" href="#Ê†àÁöÑÂô™Èü≥"></a> Ê†àÁöÑÂô™Èü≥</h4>
<p>ÂáΩÊï∞ÈÄÄÂá∫‰ª•Âêé,ÂéüÊúâÊ†àÁöÑÁ©∫Èó¥ÈáåÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏ç‰ºöË¢´Ëá™Âä®Ê∏ÖÈô§Ôºå‰ªçÁÑ∂‰øùÁïôÂ∞±Êàê‰∫ÜÊ†à‰∏≠ÁöÑËÑèÊï∞ÊçÆ</p>
<p>‰æãÂ¶Ç</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d, %d, %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êàë‰ª¨‰ºöÂèëÁé∞ÔºåÊ≤°ÊúâÂØπf2ÁöÑÂèòÈáèÂàùÂßãÂåñÔºå‰ªçÁÑ∂ÊâìÂç∞ÁöÑÊòØ 1 2 3</p>
<p>ÂèØ‰ª•Á†îÁ©∂‰∏Ä‰∏ãÊ±áÁºñ‰ª£Á†Å,Âà©Áî®MSVSÁºñËØëÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ã</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG2752 DB      <span class="token string">'%d, %d, %d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

_c<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">12</span>       <span class="token comment">; size = 4</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span>        <span class="token comment">; size = 4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>        <span class="token comment">; size = 4</span>
_f1    PROC
       push     <span class="token register variable">ebp</span>
       mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
       sub      <span class="token register variable">esp</span>, <span class="token number">12</span>
       mov      DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">1</span>
       mov      DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">2</span>
       mov      DWORD PTR _c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">3</span>
       mov      <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
       pop      <span class="token register variable">ebp</span>
       ret      <span class="token number">0</span>
_f1    ENDP

_c<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">12</span>       <span class="token comment">; size = 4</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span>        <span class="token comment">; size = 4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>        <span class="token comment">; size = 4</span>
_f2    PROC
       push     <span class="token register variable">ebp</span>
       mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
       sub      <span class="token register variable">esp</span>, <span class="token number">12</span>
       mov      <span class="token register variable">eax</span>, DWORD PTR _c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
       push     <span class="token register variable">eax</span>
       mov      <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
       push     <span class="token register variable">ecx</span>
       mov      <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
       push     <span class="token register variable">edx</span>
       push     OFFSET <span class="token operator">$</span>SG2752 <span class="token comment">; ‚Äô%d, %d, %d‚Äô</span>
       call     DWORD PTR __imp__printf
       add      <span class="token register variable">esp</span>, <span class="token number">16</span>
       mov      <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
       pop      <span class="token register variable">ebp</span>
       ret      <span class="token number">0</span>
_f2    ENDP

main   PROC
       push     <span class="token register variable">ebp</span>
       mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
       call     _f1
       call     _f2
       xor      <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
       pop      <span class="token register variable">ebp</span>
       ret      <span class="token number">0</span>
_main  ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®Ëøô‰∏™Áâπ‰æãÈáåÔºåÁ¨¨‰∫å‰∏™ÂáΩÊï∞Âú®Á¨¨‰∏Ä‰∏™ÂáΩÊï∞‰πãÂêéÊâßË°åÔºåËÄåÁ¨¨‰∫å‰∏™ÂáΩÊï∞ÂèòÈáèÁöÑÂú∞ÂùÄÂíåSPÁöÑÂÄºÂèà‰∏éÁ¨¨‰∏Ä‰∏™ÂáΩÊï∞ÁöÑÊÉÖÂÜµÁõ∏Âêå„ÄÇÊâÄ‰ª•ÔºåÁõ∏ÂêåÂú∞ÂùÄÁöÑÂèòÈáèËé∑ÂæóÁöÑÂÄºÁõ∏Âêå„ÄÇ</p>
<p>ÊÄªËÄåË®Ä‰πãÔºåÂú®ËøêË°åÁ¨¨‰∫å‰∏™ÂáΩÊï∞Êó∂ÔºåÊ†à‰∏≠ÁöÑÊâÄÊúâÂÄºÔºàÂç≥ÂÜÖÂ≠ò‰∏≠ÁöÑÂçïÂÖÉÔºâÂèóÂâç‰∏Ä‰∏™ÂáΩÊï∞ÁöÑÂΩ±ÂìçÔºåËÄåËé∑Âæó‰∫ÜÂâç‰∏Ä‰∏™ÂáΩÊï∞ÁöÑÂèòÈáèÁöÑÂÄº„ÄÇ‰∏•Ê†ºÂú∞ËØ¥ÔºåËøô‰∫õÂú∞ÂùÄÁöÑÂÄº‰∏çÊòØÈöèÊú∫ÂÄºÔºåËÄåÊòØÂèØÈ¢ÑÊµãÁöÑ‰º™ÈöèÊú∫ÂÄº„ÄÇ</p>
<h4 id="problems-2"><a class="markdownIt-Anchor" href="#problems-2"></a> Problems</h4>
<h5 id="51"><a class="markdownIt-Anchor" href="#51"></a> 5.1</h5>
<p>Â¶ÇÊûú‰ΩøÁî®MSVCÁºñËØë„ÄÅËøêË°å‰∏ãÂàóÁ®ãÂ∫èÔºåÂ∞Ü‰ºöÊâìÂç∞Âá∫3‰∏™Êï¥Êï∞„ÄÇËøô‰∫õÊï∞ÂÄºÊù•Ëá™Âì™ÈáåÔºüÂ¶ÇÊûú‰ΩøÁî®MSVCÁöÑ‰ºòÂåñÈÄâÈ°π‚Äú/Ox‚ÄùÔºåÁ®ãÂ∫èÂèà‰ºöÂú®Â±èÂπï‰∏äËæìÂá∫‰ªÄ‰πàÔºü‰∏∫‰ªÄ‰πàGCCÁöÑÊÉÖÂÜµÂÆåÂÖ®‰∏çÂêåÔºü</p>
<pre class="line-numbers language-none"><code class="language-none">#include &lt;stdio.h&gt;

int main() 
&#123;
         printf (&quot;%d, %d, %d\n&quot;);

         return 0;
&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Â¶ÇÊûúÊú™ÂêØÁî®MSVCÁöÑ‰ºòÂåñÁºñËØëÂäüËÉΩÔºåÁ®ãÂ∫èÊòæÁ§∫ÁöÑÊï∞Â≠óÂàÜÂà´ÊòØEBPÁöÑÂÄº„ÄÅRAÂíåargc„ÄÇÂú®ÂëΩ‰ª§Ë°å‰∏≠ÊâßË°åÁõ∏Â∫îÁöÑÁ®ãÂ∫èÂç≥ÂèØËøõË°åÈ™åËØÅ„ÄÇ</p>
<p>Â¶ÇÊûúÂêØÁî®‰∫ÜMSVCÁöÑ‰ºòÂåñÁºñËØëÂäüËÉΩÔºåÁ®ãÂ∫èÊòæÁ§∫ÁöÑÊï∞Â≠óÂàÜÂà´Êù•Ëá™ÔºöËøîÂõûÂú∞ÂùÄRA„ÄÅargcÂíåÊï∞ÁªÑargvÔºªÔºΩ„ÄÇ</p>
<p>GCC‰ºöÁªômain() ÂáΩÊï∞ÁöÑÂÖ•Âè£ÂàÜÈÖç16Â≠óËäÇÁöÑÂú∞ÂùÄÁ©∫Èó¥ÔºåÊâÄ‰ª•ËæìÂá∫ÂÜÖÂÆπ‰ºöÊúâ‰∏çÂêå„ÄÇ</p>
<h5 id="52"><a class="markdownIt-Anchor" href="#52"></a> 5.2</h5>
<p>Á≠îÔºöÊâìÂç∞Êó∂Èó¥</p>
<h3 id="chap6-printfÂáΩÊï∞‰∏éÂèÇÊï∞‰º†ÈÄí"><a class="markdownIt-Anchor" href="#chap6-printfÂáΩÊï∞‰∏éÂèÇÊï∞‰º†ÈÄí"></a> Chap6 printf()ÂáΩÊï∞‰∏éÂèÇÊï∞‰º†ÈÄí</h3>
<p>ÊºîÁ§∫Á®ãÂ∫è</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a=%d,b=%d,c=%d"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Áî®<code> g++ -m32 -o 1 1.c</code>ËøõË°åÁºñËØëÊàñËÄÖ‰ΩøÁî®<code>MSVS</code>Â∑•ÂÖ∑ÈìæËøõË°åÁºñËØëÔºåË∑üÈöèÊú¨‰π¶ÁöÑËäÇÂ•èÔºåÈÖçÁΩÆ‰∏Ä‰∏ã<code>MSVS</code>ÁöÑÁéØÂ¢É</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/build/building-on-the-command-line?view=msvc-170#download-and-install-the-tools">ÈÄöËøáÂëΩ‰ª§Ë°å‰ΩøÁî® Microsoft C++ Â∑•ÂÖ∑ÈõÜ | Microsoft Learn</a></p>
<p>È¶ñÂÖàÂ∞Ü<code>Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build</code>Âä†ÂÖ•ÁéØÂ¢ÉÂèòÈáè</p>
<p>ÂëΩ‰ª§Ë°åËæìÂÖ•<code>vcvarsall.bat x86</code></p>
<p>ÁÑ∂Âêé<code>cl 1.cpp</code></p>
<hr />
<p>MSVSÂ∑•ÂÖ∑Èìæ‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÊåá‰ª§</p>
<p><code>cl /Fa 1.c</code>ÁîüÊàê‰∏çÂ∏¶Ê≥®ÈáäÁöÑÊ±áÁºñ‰ª£Á†Å</p>
<p><code>cl /FAs 1.c</code>ÁîüÊàêÂ∏¶Ê≥®ÈáäÁöÑÊ±áÁºñ‰ª£Á†Å,ÁîüÊàê1.asm</p>
<p><code>dumpbin /all example.obj</code>ÊòæÁ§∫ÁõÆÊ†áÊñá‰ª∂‰∏≠ÁöÑÊâÄÊúâ‰ø°ÊÅØÔºåÂåÖÊã¨ÊÆµÂÜÖÂÆπ„ÄÅÁ¨¶Âè∑Ë°®ÂíåÈáçÂÆö‰Ωç‰ø°ÊÅØ„ÄÇ</p>
<p>/c ‰ª£Ë°®Âè™ÁºñËØë‰∏çÈìæÊé•„ÄÇ</p>
<p>/I ÊåáÂÆöÂ§¥Êñá‰ª∂ÁöÑÁõÆÂΩï</p>
<p>/C Âú®ÁºñËØëÊúüÈó¥‰øùÁïô‰ª£Á†ÅÊ≥®ÈáäÔºåËøôÈáåÂíå/IËøûÂú®‰∏ÄËµ∑‰ΩøÁî®Ôºå/IC</p>
<p>È¶ñÂÖà‰ªãÁªç‰∏Ä‰∏™Ê¶ÇÂøµÔºåVC‰∏≠Êúâ‰∏™PDBÊñá‰ª∂ÔºåÂÖ®Áß∞ÊòØProgram DatabaseÔºåÁî®Êù•Â≠òÊîæÁ®ãÂ∫è‰ø°ÊÅØÁöÑÂ∞èÁöÑ<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/14">Êï∞ÊçÆÂ∫ì</a>Êñá‰ª∂„ÄÇ</p>
<p>ÁºñËØëDebugÁâàÊú¨Êó∂ÔºåË∞ÉËØï‰ø°ÊÅØÈúÄË¶Å‰øùÁïôÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄâÊã©Áõ¥Êé•Â∞ÜË∞ÉËØï‰ø°ÊÅØÂÜôÂà∞.objÊñá‰ª∂‰∏≠ÔºåÊàñËÄÖÂ≠òÂà∞.pdbÊñá‰ª∂‰∏≠„ÄÇ</p>
<p>/Z7 ‰∏ç‰∫ßÁîü.pdbÊñá‰ª∂ÔºåÂ∞ÜÊâÄÊúâË∞ÉËØï‰ø°ÊÅØÂ≠òÂÖ•.objÊñá‰ª∂‰∏≠</p>
<p>/ZiÂíå/ZI ÈÉΩ‰∫ßÁîü.pdbÊñá‰ª∂Ôºå‰∏çËøá/ZIÊîØÊåÅ&quot;ÁºñËæëÁªßÁª≠Ë∞ÉËØï&quot;ÂäüËÉΩ, (the edit and continue feature), Áúã‰∏äÂéªÊõ¥ÈÖ∑Ôºå‰ΩÜÊòØÊàë‰ªéÊù•Ê≤°ÊúâÁî®ËøáËøô‰∏™ÂäüËÉΩ„ÄÇ</p>
<p>/ZIÊúâ‰∏Ä‰∫õËæπÈôÖÊïàÂ∫îÔºå‰ºöÁ¶ÅÊ≠¢#pragma optmize Êåá‰ª§Ôºå‰πü‰∏çËÉΩÂíå/clr‰∏ÄËµ∑Áî®„ÄÇ</p>
<p>/nologo- Â∑≤ÁªèÊó†ÊïàÔºåËá™Â∑±ÁîüÊàêÂëΩ‰ª§Ë°åÁöÑÊó∂ÂÄôÔºåÊ≤°ÂøÖË¶ÅÁî®‰∫Ü„ÄÇ</p>
<p>/W3 ‰πü‰∏≠Ë≠¶ÂëäÁ∫ßÂà´ÔºåVCÊèê‰æõ‰∫ÜÂæàÂ§öË≠¶ÂëäÁ∫ßÂà´ÔºåÂèÇËÄÉ<a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/vstudio/thxezb7y.aspx">http://msdn.microsoft.com/en-us/library/vstudio/thxezb7y.aspx</a></p>
<p>Ëá™Â∑±ÁºñËØëÁöÑËØùÔºåÁõ¥Êé•Áî®/WallÊúÄÂ•Ω„ÄÇ</p>
<p>/WX- ‰∏çÂ§™ÊòéÁôΩ‰∏∫‰ªÄ‰πàÊúâ - Âè∑ÔºåÔºà‰º∞ËÆ°ÊòØÂíå:NOÁöÑÊÑèÊÄùÁõ∏ÂêåÔºå‰πüÂ∞±ÊòØ‰∏çÂêØÁî®ËØ•ÂäüËÉΩÔºâÔºå /WXÁöÑÊÑèÊÄùÊòØÂ∞ÜwarningËΩ¨ÂèòÊàêerrorÔºåËøôÊ†∑Âº∫Ëø´Ê∂àÈô§ÊâÄÊúâÁöÑwarningÔºåÂ¶ÇÊûúÂíå/Wall‰∏ÄËµ∑‰ΩøÁî®ÔºåÈÇ£ÊòØÊúÄÂ•ΩÁöÑ„ÄÇ</p>
<p>/sdl ÊòØÂØπ‰ª£Á†ÅËøõË°åÂÆâÂÖ®Ê£ÄÊü•ÔºåÂ¶ÇÊûúÂèëÁé∞Áõ∏ÂÖ≥Ë≠¶ÂëäÔºåËΩ¨ÂèòÊàêÈîôËØØËæìÂá∫</p>
<p>/Od Á¶ÅÊ≠¢‰ºòÂåñ</p>
<p>/Oy- Á¶ÅÊ≠¢ËØ•ÈÄâÈ°πÔºåËØ•ÈÄâÈ°πÂ¶ÇÊûúÊ≤°Êúâ - Âè∑ÔºåÂàô‰ºöÂú®x86‰∏äÁºñËØëÊó∂ÂøΩÁï•frame-pointerÔºåËµ∑Âà∞Âä†ÈÄüÁ®ãÂ∫èÁöÑ‰ΩúÁî®„ÄÇ frame-pointerÔºåÊàëÊöÇÊó∂‰∏çÁü•ÈÅìÊòØÂï•„ÄÇ</p>
<p>/D È¢ÑÂ§ÑÁêÜÂÆö‰πâÔºåÂêéÈù¢ÂèØ‰ª•Ë∑ü‰∏çÂêåÁöÑÂèÇÊï∞ÈÉΩÊòØÂÆèÂïäÔºåÊØîÂ¶Ç<br />
/Gm ÂêØÁî®ÊúÄÂ∞èÂåñÈáçÊñ∞ÁºñËØë, VCÁî®.idb‰øùÁïô‰∫Ü‰∏äÊ¨°ÁºñËØëÁöÑÁºìÂ≠ò‰ø°ÊÅØÔºåÂåÖÊã¨Êñá‰ª∂‰æùËµñÂÖ≥Á≥ª„ÄÇ‰∏ãÊ¨°ÁºñËØëÊó∂ÂèØ‰ª•‰ΩøÁî®.idbÊñá‰ª∂Áî®Êù•Ê£ÄÊü•ÔºåË∑≥Ëøá‰∏çÈúÄË¶ÅÈáçÊñ∞ÁºñËØëÁöÑÊñá‰ª∂„ÄÇ</p>
<p>ÂÖ∑‰ΩìÂèÇËßÅ:</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/cpp/build/reference/compiler-options?view=msvc-170&amp;redirectedfrom=MSDN">MSVC Compiler Options | Microsoft Learn</a></p>
<h4 id="x86"><a class="markdownIt-Anchor" href="#x86"></a> x86</h4>
<p>MSVSÁºñËØëÂæóÂà∞ÁöÑÊ±áÁºñÊåá‰ª§Â¶Ç‰∏ã</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_TEXT	SEGMENT
_main	PROC

<span class="token comment">; 3    : &#123;</span>

	push	<span class="token register variable">ebp</span>
	mov	<span class="token register variable">ebp</span>, <span class="token register variable">esp</span>

<span class="token comment">; 4    :     printf("a=%d,b=%d,c=%d",1,2,3);</span>

	push	<span class="token number">3</span>
	push	<span class="token number">2</span>
	push	<span class="token number">1</span>
	push	OFFSET <span class="token operator">$</span>SG9695
	call	_printf
	add	<span class="token register variable">esp</span>, <span class="token number">16</span>					<span class="token comment">; 00000010H</span>

<span class="token comment">; 5    :     return 0; </span>

	xor	<span class="token register variable">eax</span>, <span class="token register variable">eax</span>

<span class="token comment">; 6    : &#125;</span>

	pop	<span class="token register variable">ebp</span>
	ret	<span class="token number">0</span>
_main	ENDP
_TEXT	ENDS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂèØ‰ª•ÁúãÂà∞<code>printf()</code>ÂáΩÊï∞ÁöÑÂèÇÊï∞ÊòØÈÄÜÂ∫èÂ≠òÂÖ•Ê†à‰∏≠ÔºåÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞Âú®ÊúÄÂêéÂÖ•Ê†à</p>
<p>Âú®<code>32</code>‰Ωç‰∏ãÔºå32‰ΩçÂú∞ÂùÄÊåáÈíàÂíåintÁ±ªÂûãÊï∞ÊçÆÈÉΩÂç†ÊçÆ<code>32‰Ωç</code>Âç≥<code>4Â≠óËäÇ</code>ÁöÑÁ©∫Èó¥ÔºåÂõ†Ê≠§4‰∏™ÂèÇÊï∞ÊÄªÂÖ±Âç†Áî®<code>16</code>Â≠óËäÇÁöÑÂ≠òÂÇ®Á©∫Èó¥</p>
<p>Âõ†Ê≠§Âú®Ë∞ÉÁî®ÂáΩÊï∞‰πãÂêéÔºå‚ÄúADD ESP, X‚ÄùÊåá‰ª§‰øÆÊ≠£ESPÂØÑÂ≠òÂô®‰∏≠ÁöÑÊ†àÊåáÈíà„ÄÇÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøácall‰πãÂêéÁöÑËøôÊù°Êåá‰ª§Âà§Êñ≠ÂèÇÊï∞ÁöÑÊï∞ÈáèÔºö<code>ÂèòÈáèÊÄªÊï∞Ôºù*X*√∑4„ÄÇ</code>(‰ªÖÈÄÇÁî®‰∫éË∞ÉÁî®Á∫¶ÂÆö‰∏∫<code>cdecl</code>ÁöÑÁ®ãÂ∫è)</p>
<p>Â¶ÇÊûúÊüê‰∏™Á®ãÂ∫èËøûÁª≠Âú∞Ë∞ÉÁî®Â§ö‰∏™ÂáΩÊï∞Ôºå‰∏îË∞ÉÁî®ÂáΩÊï∞ÁöÑÊåá‰ª§‰πãÈó¥‰∏çÂ§πÊùÇÂÖ∂‰ªñÊåá‰ª§ÔºåÈÇ£‰πàÁºñËØëÂô®ÂèØËÉΩÊääÈáäÊîæÂèÇÊï∞Â≠òÂÇ®Á©∫Èó¥ÁöÑ‚ÄúADD ESP,X‚ÄùÊåá‰ª§ËøõË°åÂêàÂπ∂Ôºå‰∏ÄÊ¨°ÊÄßÂú∞ÈáäÊîæÊâÄÊúâÁ©∫Èó¥</p>
<hr />
<p>‰ΩìÈ™åÁî®<code>onlydbg</code>Âä†ËΩΩËøô‰∏™Á®ãÂ∫è</p>
<p>ËøôÈáåÈúÄË¶ÅÁî®Âà∞debugÁâàÊú¨ÁöÑÁºñËØëÂëΩ‰ª§</p>
<p><code>cl /Z7 /EHsc 1.exe 1.c</code>‰æø‰∫éË∑üË∏™Á®ãÂ∫è</p>
<p>ÊâæÂà∞<code>main</code>ÂáΩÊï∞ÁöÑÊñπÊ≥ï:ÊñπÊ≥ïÂæàÂ§öÔºå‰∏çÁªÜËØ¥‰∫Ü</p>
<p>ÂÖ∑‰ΩìÊìç‰ΩúÊåâ‰π¶‰∏äÊù•</p>
<h3 id="chap7-scanf"><a class="markdownIt-Anchor" href="#chap7-scanf"></a> Chap7 scanf()</h3>
<p>ÊºîÁ§∫Á®ãÂ∫è</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter X:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You Entered: %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="x86-2"><a class="markdownIt-Anchor" href="#x86-2"></a> x86</h4>
<p><code>cl /FAs /Z7 2 2.c</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_DATA	SEGMENT
<span class="token operator">$</span>SG9696	DB	<span class="token string">'Enter X:'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
	ORG <span class="token operator">$</span><span class="token operator">+</span><span class="token number">2</span>
<span class="token operator">$</span>SG9697	DB	<span class="token string">'%d'</span>, <span class="token number">00H</span>
	ORG <span class="token operator">$</span><span class="token operator">+</span><span class="token number">1</span>
<span class="token operator">$</span>SG9698	DB	<span class="token string">'You Entered: %d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
_DATA	ENDS
_TEXT	SEGMENT
_x<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>						<span class="token comment">; size = 4</span>
_main	PROC

<span class="token comment">; 3    : &#123;</span>

	push	<span class="token register variable">ebp</span>
	mov	<span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
	push	<span class="token register variable">ecx</span>

<span class="token comment">; 4    :     int x;</span>
<span class="token comment">; 5    :     printf("Enter X:\n");</span>

	push	OFFSET <span class="token operator">$</span>SG9696
	call	_printf
	add	<span class="token register variable">esp</span>, <span class="token number">4</span>

<span class="token comment">; 6    :     scanf("%d", &amp;x);</span>

	lea	<span class="token register variable">eax</span>, DWORD PTR _x<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
	push	<span class="token register variable">eax</span>
	push	OFFSET <span class="token operator">$</span>SG9697
	call	_scanf
	add	<span class="token register variable">esp</span>, <span class="token number">8</span>

<span class="token comment">; 7    : </span>
<span class="token comment">; 8    :     printf("You Entered: %d\n", x);</span>

	mov	<span class="token register variable">ecx</span>, DWORD PTR _x<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
	push	<span class="token register variable">ecx</span>
	push	OFFSET <span class="token operator">$</span>SG9698
	call	_printf
	add	<span class="token register variable">esp</span>, <span class="token number">8</span>

<span class="token comment">; 9    :     return 0;</span>

	xor	<span class="token register variable">eax</span>, <span class="token register variable">eax</span>

<span class="token comment">; 10   : &#125;</span>

	mov	<span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
	pop	<span class="token register variable">ebp</span>
	ret	<span class="token number">0</span>
_main	ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê±áÁºñËß£ËØª:</p>
<ul>
<li>
<p>ÂèØ‰ª•ÁúãÂà∞Ôºå<code>scanf()</code>‰º†ÈÄíÁöÑÁ¨¨‰∫å‰∏™ÂèÇÊï∞(eax)ÊòØ‰∏Ä‰∏™ÊåáÂêëÊ†à‰∏≠ÁöÑÊåáÈíàÔºåxÊòØÂ±ÄÈÉ®ÂèòÈáèÔºåÂ≠òÂÇ®Âú®Ê†à‰∏≠„ÄÇÂú®Ê†à‰∏≠ÂàÜÈÖç‰∫Ü4Â≠óËäÇÁ©∫Èó¥ÔºåÂ≠òÂÇ®Â±ÄÈÉ®ÂèòÈáèx</p>
</li>
<li>
<p>**Ê±áÁºñÂÆè_x$ ÔºàÂÖ∂ÂÄº‰∏∫‚àí4Ôºâ**Áî®‰∫éËÆøÈóÆÂ±ÄÈÉ®ÂèòÈáè<em>x</em>ÔºåËÄåEBPÂØÑÂ≠òÂô®Áî®Êù•Â≠òÂÇ®Ê†àÂΩìÂâçÂ∏ßÁöÑÊåáÈíà„ÄÇ</p>
<p>Âú®ÂáΩÊï∞ËøêË°åÁöÑÊúüÈó¥ÔºåEBP‰∏ÄÁõ¥ÊåáÂêëÂΩìÂâçÁöÑÊ†àÂ∏ßÔºàstack frameÔºâ„ÄÇËøôÊ†∑ÔºåÂáΩÊï∞Âç≥ÂèØÈÄöËøá<strong>EBP+offsetÁöÑÊñπÂºèËÆøÈóÆÊú¨Âú∞ÂèòÈáè„ÄÅ‰ª•ÂèäÂ§ñÈÉ®‰º†ÂÖ•ÁöÑÂáΩÊï∞ÂèÇÊï∞</strong>„ÄÇ</p>
<p>ESP‰πüÂèØ‰ª•Áî®Êù•ËÆøÈóÆÊú¨Âú∞ÂèòÈáèÔºåËé∑ÂèñÂáΩÊï∞ÊâÄÈúÄÁöÑËøêË°åÂèÇÊï∞„ÄÇ‰∏çËøá<strong>ESPÁöÑÂÄºÁªèÂ∏∏ÂèëÁîüÂèòÂåñÔºåÁî®Ëµ∑Êù•Âπ∂‰∏çÊñπ‰æø</strong>„ÄÇÂáΩÊï∞Âú®ÂêØÂä®‰πãÂàùÂ∞±‰ºöÂà©Áî®EBPÂØÑÂ≠òÂô®‰øùÂ≠òESPÂØÑÂ≠òÂô®ÁöÑÂÄº„ÄÇËøôÂ∞±ÊòØ‰∏∫‰∫ÜÁ°Æ‰øùÂú®ÂáΩÊï∞ËøêË°åÊúüÈó¥‰øùËØÅEBPÂØÑÂ≠òÂô®Â≠òÂÇ®ÁöÑÂéüÂßãESPÂÄºÂõ∫ÂÆö‰∏çÂèò„ÄÇ</p>
<p>Âú®32‰ΩçÁ≥ªÁªüÈáåÔºåÂÖ∏ÂûãÁöÑÊ†àÂ∏ßÔºàstack frameÔºâÁªìÊûÑÂ¶Ç‰∏ãË°®ÊâÄÁ§∫„ÄÇ</p>
<table>
<thead>
<tr>
<th>‚Ä¶‚Ä¶</th>
<th>‚Ä¶‚Ä¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>EBP-8</td>
<td>Â±ÄÈÉ®ÂèòÈáèÔºÉ2ÔºåIDAÊ†áËÆ∞‰∏∫var_8</td>
</tr>
<tr>
<td>EBP-4</td>
<td>Â±ÄÈÉ®ÂèòÈáèÔºÉ1ÔºåIDAÊ†áËÆ∞‰∏∫var_4</td>
</tr>
<tr>
<td>EBP</td>
<td>EBPÁöÑÂÄº</td>
</tr>
<tr>
<td>EBP+4</td>
<td>ËøîÂõûÂú∞ÂùÄReturn address</td>
</tr>
<tr>
<td>EBP+8</td>
<td>ÂáΩÊï∞ÂèÇÊï∞ÔºÉ1ÔºåIDAÊ†áËÆ∞‰∏∫arg_0</td>
</tr>
<tr>
<td>EBP+0xC</td>
<td>ÂáΩÊï∞ÂèÇÊï∞ÔºÉ2ÔºåIDAÊ†áËÆ∞‰∏∫arg_4</td>
</tr>
<tr>
<td>EBP+0x10</td>
<td>ÂáΩÊï∞ÂèÇÊï∞ÔºÉ3ÔºåIDAÊ†áËÆ∞‰∏∫arg_8</td>
</tr>
<tr>
<td>‚Ä¶‚Ä¶</td>
<td>‚Ä¶‚Ä¶</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>scanf()</code>Âú®Ê≠§‰æã‰∏≠Êúâ‰∏§‰∏™ÂèÇÊï∞,Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØ‰∏Ä‰∏™ÊåáÈíàÔºåÊåáÂêëÂê´Êúâ&quot;%d&quot;ÁöÑÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÔºåÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÊòØÂ±ÄÈÉ®ÂèòÈáè<code>x</code>ÁöÑÂú∞ÂùÄ</p>
<p>‚Äúlea eax, DWORD PTR _x$[ebp]‚ÄùÊåá‰ª§Â∞ÜÂèòÈáè<em>x</em>ÁöÑÂú∞ÂùÄÊîæÂÖ•EAXÂØÑÂ≠òÂô®„ÄÇ</p>
<p>Âú®Ê≠§Â§Ñ<code>LEA</code>‰ºöÂ∞Ü<code>EBP</code>ÂØÑÂ≠òÂô®ÂÄº‰∏éÂÆè_x$Ê±ÇÂíå,ÁÑ∂ÂêéÂ∞ÜËøô‰∏™ÁªìÊûúÂ≠òÂÇ®Âà∞<code>EAX</code>ÔºåÁÑ∂ÂêéÊää<code>EAX</code>ÂØÑÂ≠òÂô®ÁöÑÂÄºÈÄÅÂÖ•Ê†à‰∏≠(Â∞±ÊòØÊääxÁöÑÂú∞ÂùÄÈÄÅÂÖ•EAXÂØÑÂ≠òÂô®)</p>
</li>
<li>
<p>ËÄåÂêéË∞ÉÁî®<code>printf()</code>ÂáΩÊï∞ÔºåÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞Âç≥Ê†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÁöÑÊåáÈíà</p>
<p>Á¨¨‰∫å‰∏™ÂèÇÊï∞ÊòØ<code>mov ecx,[ebp-4]</code>Èó¥Êé•ÂèñÂÄºÔºå‰º†ÈÄíÁªôecxÁöÑÂÄºÊòØ<code>ebp-4</code>ÊåáÂêëÁöÑÂú∞ÂùÄÁöÑÂÄºÔºåÂç≥ÂèòÈáèxÁöÑÂÄº</p>
</li>
</ul>
<hr />
<p>Áî®<code>onlydbg</code>Âä®ÊÄÅË∑üË∏™Ëøô‰∏™ËøáÁ®ãÔºåÂÖ∑‰Ωì‰π¶‰∏äÊúâ</p>
<ul>
<li>Ë∞ÉËØïÂèØ‰ª•ÂèëÁé∞ÔºåÊâßË°åÂÆå<code>scanf()</code>ÂáΩÊï∞,<code>EAX</code>Â≠òÂÇ®ÊúâÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºåÂÖ∂ÂÄºÊòØ<code>scanf()</code>ËØªÂèñÂèÇÊï∞ÁöÑ‰∏™Êï∞</li>
<li>Êàë‰ª¨ÂèØ‰ª•Âú®Ê†à‰∏≠ÊâæÂà∞Â±ÄÈÉ®ÂèòÈáèÁöÑÂú∞ÂùÄÔºåËøõËÄåË∑üË∏™ÂÖ∂ÂÄº</li>
</ul>
<h4 id="ÂÖ®Â±ÄÂèòÈáè"><a class="markdownIt-Anchor" href="#ÂÖ®Â±ÄÂèòÈáè"></a> ÂÖ®Â±ÄÂèòÈáè</h4>
<p>Â¶ÇÊûú‰∏äÊñáÁöÑ<code>x</code>ÊòØÂÖ®Â±ÄÂèòÈáè,‰ºöÊúâ‰ªÄ‰πàÊ†∑ÁöÑÂèòÂåñ</p>
<p>Â∞Ü<code>x</code>ÊîπÊàêÂÖ®Â±ÄÂèòÈáè</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_DATA	SEGMENT
<span class="token operator">$</span>SG9696	DB	<span class="token string">'Enter X:'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
	ORG <span class="token operator">$</span><span class="token operator">+</span><span class="token number">2</span>
<span class="token operator">$</span>SG9697	DB	<span class="token string">'%d'</span>, <span class="token number">00H</span>
	ORG <span class="token operator">$</span><span class="token operator">+</span><span class="token number">1</span>
<span class="token operator">$</span>SG9698	DB	<span class="token string">'You Entered: %d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
_DATA	ENDS
_TEXT	SEGMENT
_main	PROC

<span class="token comment">; 4    : &#123;</span>

	push	<span class="token register variable">ebp</span>
	mov	<span class="token register variable">ebp</span>, <span class="token register variable">esp</span>

<span class="token comment">; 5    :    </span>
<span class="token comment">; 6    :     printf("Enter X:\n");</span>

	push	OFFSET <span class="token operator">$</span>SG9696
	call	_printf
	add	<span class="token register variable">esp</span>, <span class="token number">4</span>

<span class="token comment">; 7    :     scanf("%d", &amp;x);</span>

	push	OFFSET _x
	push	OFFSET <span class="token operator">$</span>SG9697
	call	_scanf
	add	<span class="token register variable">esp</span>, <span class="token number">8</span>

<span class="token comment">; 8    : </span>
<span class="token comment">; 9    :     printf("You Entered: %d\n", x);</span>

	mov	<span class="token register variable">eax</span>, DWORD PTR _x
	push	<span class="token register variable">eax</span>
	push	OFFSET <span class="token operator">$</span>SG9698
	call	_printf
	add	<span class="token register variable">esp</span>, <span class="token number">8</span>

<span class="token comment">; 10   :     return 0;</span>

	xor	<span class="token register variable">eax</span>, <span class="token register variable">eax</span>

<span class="token comment">; 11   : &#125;</span>

	pop	<span class="token register variable">ebp</span>
	ret	<span class="token number">0</span>
_main	ENDP
_TEXT	ENDS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ÂèØ‰ª•ÂèëÁé∞<code>x</code>ÁöÑÂ≠òÂÇ®Á©∫Èó¥‰∏çÂÜçÁî±Ê†à‰∏≠Â≠òÂÇ®,ËÄåÊòØÂú®Êï∞ÊçÆÊÆµ(Áî±‰∫éÊ≤°ÁªôxËµãÂÄºÔºåÁºñËØëÂô®Ëá™Âä®‰ºòÂåñ‰∏∫bssÊÆµ(‰∏çÂç†ÊçÆÁ©∫Èó¥))</p>
</li>
<li>
<p>Â¶ÇÊûúÂØπ‰∏äËø∞Ê∫ê‰ª£Á†ÅÁ®çÂÅöÊîπÂä®ÔºåÂä†‰∏äÂèòÈáèÂàùÂßãÂåñÁöÑÊåá‰ª§Ôºö</p>
<pre class="line-numbers language-none"><code class="language-none">int x&#x3D;10; &#x2F;&#x2F;ËÆæÁΩÆÈªòËÆ§ÂÄº<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ÈÇ£‰πàÂØπÂ∫îÁöÑ‰ª£Á†Å‰ºöÂèò‰∏∫Ôºö</p>
<pre class="line-numbers language-none"><code class="language-none">_DATA   SEGMENT
_x      DD      0aH
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>‰∏äËø∞Êåá‰ª§Â∞ÜÂàùÂßãÂåñx„ÄÇÂÖ∂‰∏≠DD‰ª£Ë°®DWORDÔºåË°®Á§∫<em>x</em>ÊòØ32‰ΩçÁöÑÊï∞ÊçÆ„ÄÇ</p>
<p>Ëã•Âú®IDAÈáåÊâìÂºÄÂØπxËøõË°åÂàùÂßãÂåñÁöÑÂèØÊâßË°åÊñá‰ª∂ÔºåÊàë‰ª¨Â∞Ü‰ºöÁúãÂà∞Âú®Êï∞ÊçÆÊÆµÁöÑÂºÄÂ§¥ÈÉ®ÂàÜÁúãÂà∞ÂàùÂßãÂåñÂèòÈáè<em>x</em>„ÄÇÁ¥ßÈöèÂÖ∂ÂêéÁöÑÁ©∫Èó¥Áî®‰∫éÂ≠òÂÇ®Êú¨‰æã‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇ</p>
<p>Áî®IDAÊâìÂºÄ7.2ËäÇÈáåÈÇ£‰∏™‰∏çÂàùÂßãÂåñÂèòÈáè<em>x</em>ÁöÑ‰æãÂ≠êÔºåÈÇ£‰πàÂ∞Ü‰ºöÁúã</p>
<p>ÊúâÂæàÂ§öÂ∏¶‚ÄúÔºü‚ÄùÊ†áËÆ∞ÁöÑÂèòÈáèÔºåËøôÊòØÊú™ÂàùÂßãÂåñÁöÑ<em>x</em>ÂèòÈáèÁöÑÊ†áËÆ∞„ÄÇËøôÊÑèÂë≥ÁùÄÂú®Á®ãÂ∫èÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰πãÂêéÔºåÊìç‰ΩúÁ≥ªÁªüÂ∞Ü‰∏∫Ëøô‰∫õÂèòÈáèÂàÜÈÖçÁ©∫Èó¥„ÄÅÂπ∂Â°´ÂÖ•Êï∞Â≠óÈõ∂„ÄÇ‰ΩÜÊòØÂú®ÂèØÊâßË°åÊñá‰ª∂ÈáåÔºåËøô‰∫õÊú™ÂàùÂßãÂåñÁöÑÂèòÈáè‰∏çÂç†Áî®ÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ‰∏∫‰∫ÜÊñπ‰æø‰ΩøÁî®Â∑®ÂûãÊï∞ÁªÑ‰πãÁ±ªÁöÑÂ§ßÂûãÊï∞ÊçÆÔºå‰∫∫‰ª¨ÂàªÊÑèÂÅö‰∫ÜËøôÁßçËÆæÂÆö„ÄÇ</p>
</li>
</ul>
<h4 id="problem"><a class="markdownIt-Anchor" href="#problem"></a> Problem</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">alter_string</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token function">strcpy</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"Goodbye!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Result: %s\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token function">alter_string</span> <span class="token punctuation">(</span><span class="token string">"Hello, world!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®<code>win</code>ÂèØËøêË°åÔºåÂõ†‰∏∫sÊòØÂú®dataÊÆµ</p>
<p>ËÄåÂú®<code>linux</code>‰∏çÂèØËøêË°åÔºåsÂ≠òÂÇ®Âú®<code>rodata</code>ÊÆµÔºå‰∏çÂèØÂÜô</p>
<h3 id="chap8-ÂèÇÊï∞Ëé∑Âèñ"><a class="markdownIt-Anchor" href="#chap8-ÂèÇÊï∞Ëé∑Âèñ"></a> Chap8 ÂèÇÊï∞Ëé∑Âèñ</h3>
<p>main()ÂáΩÊï∞Êää3‰∏™Êï∞Â≠óÊé®ÈÄÅÂÖ•Ê†àÔºåÁÑ∂ÂêéË∞ÉÁî®‰∫Üf(int, int, int)„ÄÇË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞f()ÈÄöËøá_a<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>8</mn><mtext>‰∏ÄÁ±ªÁöÑÊ±áÁºñÂÆèËÆøÈóÆÊâÄÈúÄÂèÇÊï∞‰ª•ÂèäÂáΩÊï∞Ëá™ÂÆö‰πâÁöÑÂ±ÄÈÉ®ÂèòÈáè„ÄÇÂè™‰∏çËøá‰ªéË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÁöÑÊï∞ÊçÆÊ†àÁöÑËßíÂ∫¶Êù•ÁúãÔºåÂ§ñÈÉ®ÂèÇËÄÉÁöÑÂÅèÁßªÈáèÊòØÊ≠£ÂÄºÔºåËÄåÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÅèÁßªÈáèÊòØË¥üÂÄº„ÄÇÂèØËßÅÔºåÂΩìÈúÄË¶ÅËÆøÈóÆÊ†àÂ∏ßÔºà</mtext><mi>s</mi><mi>t</mi><mi>a</mi><mi>c</mi><mi>k</mi><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>Ôºâ‰ª•Â§ñÁöÑÊï∞ÊçÆÊó∂ÔºåË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÂèØÊääÊ±áÁºñÂÆèÔºà‰æã</mtext><msub><mtext>Â¶Ç</mtext><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">=8‰∏ÄÁ±ªÁöÑÊ±áÁºñÂÆèËÆøÈóÆÊâÄÈúÄÂèÇÊï∞‰ª•ÂèäÂáΩÊï∞Ëá™ÂÆö‰πâÁöÑÂ±ÄÈÉ®ÂèòÈáè„ÄÇÂè™‰∏çËøá‰ªéË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÁöÑÊï∞ÊçÆÊ†àÁöÑËßíÂ∫¶Êù•ÁúãÔºåÂ§ñÈÉ®ÂèÇËÄÉÁöÑÂÅèÁßªÈáèÊòØÊ≠£ÂÄºÔºåËÄåÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÅèÁßªÈáèÊòØË¥üÂÄº„ÄÇÂèØËßÅÔºåÂΩìÈúÄË¶ÅËÆøÈóÆÊ†àÂ∏ßÔºàstack frameÔºâ‰ª•Â§ñÁöÑÊï∞ÊçÆÊó∂ÔºåË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÂèØÊääÊ±áÁºñÂÆèÔºà‰æãÂ¶Ç_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">8</span><span class="mord cjk_fallback">‰∏Ä</span><span class="mord cjk_fallback">Á±ª</span><span class="mord cjk_fallback">ÁöÑ</span><span class="mord cjk_fallback">Ê±á</span><span class="mord cjk_fallback">Áºñ</span><span class="mord cjk_fallback">ÂÆè</span><span class="mord cjk_fallback">ËÆø</span><span class="mord cjk_fallback">ÈóÆ</span><span class="mord cjk_fallback">ÊâÄ</span><span class="mord cjk_fallback">ÈúÄ</span><span class="mord cjk_fallback">ÂèÇ</span><span class="mord cjk_fallback">Êï∞</span><span class="mord cjk_fallback">‰ª•</span><span class="mord cjk_fallback">Âèä</span><span class="mord cjk_fallback">ÂáΩ</span><span class="mord cjk_fallback">Êï∞</span><span class="mord cjk_fallback">Ëá™</span><span class="mord cjk_fallback">ÂÆö</span><span class="mord cjk_fallback">‰πâ</span><span class="mord cjk_fallback">ÁöÑ</span><span class="mord cjk_fallback">Â±Ä</span><span class="mord cjk_fallback">ÈÉ®</span><span class="mord cjk_fallback">Âèò</span><span class="mord cjk_fallback">Èáè</span><span class="mord cjk_fallback">„ÄÇ</span><span class="mord cjk_fallback">Âè™</span><span class="mord cjk_fallback">‰∏ç</span><span class="mord cjk_fallback">Ëøá</span><span class="mord cjk_fallback">‰ªé</span><span class="mord cjk_fallback">Ë¢´</span><span class="mord cjk_fallback">Ë∞É</span><span class="mord cjk_fallback">Áî®</span><span class="mord cjk_fallback">Êñπ</span><span class="mord cjk_fallback">ÂáΩ</span><span class="mord cjk_fallback">Êï∞</span><span class="mord cjk_fallback">ÁöÑ</span><span class="mord cjk_fallback">Êï∞</span><span class="mord cjk_fallback">ÊçÆ</span><span class="mord cjk_fallback">Ê†à</span><span class="mord cjk_fallback">ÁöÑ</span><span class="mord cjk_fallback">Ëßí</span><span class="mord cjk_fallback">Â∫¶</span><span class="mord cjk_fallback">Êù•</span><span class="mord cjk_fallback">Áúã</span><span class="mord cjk_fallback">Ôºå</span><span class="mord cjk_fallback">Â§ñ</span><span class="mord cjk_fallback">ÈÉ®</span><span class="mord cjk_fallback">ÂèÇ</span><span class="mord cjk_fallback">ËÄÉ</span><span class="mord cjk_fallback">ÁöÑ</span><span class="mord cjk_fallback">ÂÅè</span><span class="mord cjk_fallback">Áßª</span><span class="mord cjk_fallback">Èáè</span><span class="mord cjk_fallback">ÊòØ</span><span class="mord cjk_fallback">Ê≠£</span><span class="mord cjk_fallback">ÂÄº</span><span class="mord cjk_fallback">Ôºå</span><span class="mord cjk_fallback">ËÄå</span><span class="mord cjk_fallback">Â±Ä</span><span class="mord cjk_fallback">ÈÉ®</span><span class="mord cjk_fallback">Âèò</span><span class="mord cjk_fallback">Èáè</span><span class="mord cjk_fallback">ÁöÑ</span><span class="mord cjk_fallback">ÂÅè</span><span class="mord cjk_fallback">Áßª</span><span class="mord cjk_fallback">Èáè</span><span class="mord cjk_fallback">ÊòØ</span><span class="mord cjk_fallback">Ë¥ü</span><span class="mord cjk_fallback">ÂÄº</span><span class="mord cjk_fallback">„ÄÇ</span><span class="mord cjk_fallback">ÂèØ</span><span class="mord cjk_fallback">ËßÅ</span><span class="mord cjk_fallback">Ôºå</span><span class="mord cjk_fallback">ÂΩì</span><span class="mord cjk_fallback">ÈúÄ</span><span class="mord cjk_fallback">Ë¶Å</span><span class="mord cjk_fallback">ËÆø</span><span class="mord cjk_fallback">ÈóÆ</span><span class="mord cjk_fallback">Ê†à</span><span class="mord cjk_fallback">Â∏ß</span><span class="mord cjk_fallback">Ôºà</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">Ôºâ</span><span class="mord cjk_fallback">‰ª•</span><span class="mord cjk_fallback">Â§ñ</span><span class="mord cjk_fallback">ÁöÑ</span><span class="mord cjk_fallback">Êï∞</span><span class="mord cjk_fallback">ÊçÆ</span><span class="mord cjk_fallback">Êó∂</span><span class="mord cjk_fallback">Ôºå</span><span class="mord cjk_fallback">Ë¢´</span><span class="mord cjk_fallback">Ë∞É</span><span class="mord cjk_fallback">Áî®</span><span class="mord cjk_fallback">Êñπ</span><span class="mord cjk_fallback">ÂáΩ</span><span class="mord cjk_fallback">Êï∞</span><span class="mord cjk_fallback">ÂèØ</span><span class="mord cjk_fallback">Êää</span><span class="mord cjk_fallback">Ê±á</span><span class="mord cjk_fallback">Áºñ</span><span class="mord cjk_fallback">ÂÆè</span><span class="mord cjk_fallback">Ôºà</span><span class="mord cjk_fallback">‰æã</span><span class="mord"><span class="mord cjk_fallback">Â¶Ç</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>Ôºâ‰∏éEBPÂØÑÂ≠òÂô®ÁöÑÂÄºÁõ∏Âä†Ôºå‰ªéËÄåÊ±ÇÂæóÊâÄÈúÄÂú∞ÂùÄ„ÄÇ</p>
<p>ÂΩìÂèòÈáè<em>a</em>ÁöÑÂÄºÂ≠òÂÖ•EAXÂØÑÂ≠òÂô®‰πãÂêéÔºåf()ÂáΩÊï∞ÈÄöËøáÂêÑÂèÇÊï∞ÁöÑÂú∞ÂùÄ‰æùÊ¨°ËøõË°å‰πòÊ≥ïÂíåÂä†Ê≥ïËøêÁÆóÔºåËøêÁÆóÁªìÊûú‰∏ÄÁõ¥Â≠òÂÇ®‰∫éEAXÂØÑÂ≠òÂô®„ÄÇÊ≠§ÂêéEAXÁöÑÂÄºÂ∞±ÂèØ‰ª•Áõ¥Êé•‰Ωú‰∏∫ËøîÂõûÂÄº‰º†ÈÄíÁªôË∞ÉÁî®ÊñπÂáΩÊï∞„ÄÇË∞ÉÁî®ÊñπÂáΩÊï∞main()ÂÜçÊääEAXÁöÑÂÄºÂΩì‰ΩúÂèÇÊï∞‰º†ÈÄíÁªôprintf()ÂáΩÊï∞„ÄÇ</p>
<h3 id="chap9-ËøîÂõûÂÄº"><a class="markdownIt-Anchor" href="#chap9-ËøîÂõûÂÄº"></a> Chap9 ËøîÂõûÂÄº</h3>
<p>Âú®<strong>x86Á≥ª</strong>ÁªüÈáåÔºåË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÈÄöÂ∏∏ÈÄöËøáEA<strong>XÂØÑÂ≠òÂô®ËøîÂõûËøêÁÆóÁªìÊûú</strong>„ÄÇËã•ËøîÂõûÂÄºÂ±û‰∫ébyteÊàñcharÁ±ªÂûãÊï∞ÊçÆÔºåËøîÂõûÂÄºÂ∞Ü<strong>Â≠òÂÇ®‰∫éEAXÂØÑÂ≠òÂô®ÁöÑ‰Ωé8‰Ωç‚Äî‚ÄîALÂØÑÂ≠òÂô®Â≠òÂÇ®ËøîÂõûÂÄº</strong>„ÄÇÂ¶ÇÊûú<strong>ËøîÂõûÂÄºÊòØÊµÆÁÇπfloatÂûãÊï∞ÊçÆÔºåÈÇ£‰πàËøîÂõûÂÄºÂ∞ÜÂ≠òÂÇ®Âú®FPUÁöÑST(0)ÂØÑÂ≠òÂô®</strong>Èáå„ÄÇARMÁ≥ªÁªüÁöÑÊÉÖÂÜµÁõ∏ÂØπÁÆÄÂçï‰∏Ä‰∫õÔºåÂÆÉÈÄöÂ∏∏‰ΩøÁî®R0ÂØÑÂ≠òÂô®Âõû‰º†ËøîÂõûÂÄº„ÄÇ</p>
<h4 id="voidÁ±ªÂûãÁöÑËøîÂõûÂÄº"><a class="markdownIt-Anchor" href="#voidÁ±ªÂûãÁöÑËøîÂõûÂÄº"></a> voidÁ±ªÂûãÁöÑËøîÂõûÂÄº</h4>
<p>Ë∞ÉÁî®<code>main</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push envp
push argv
push argc
call main
push <span class="token register variable">eax</span>
call exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰πüÂ∞±ÊòØ<code>exit(main(argc,argv,envp));</code></p>
<p>Â¶ÇÊûúÂ£∞Êòémain()ÁöÑÊï∞ÊçÆÁ±ªÂûãÊòØvoidÔºåÂàômain()ÂáΩÊï∞‰∏ç‰ºöÊòéÁ°ÆËøîÂõû‰ªª‰ΩïÂÄºÔºàÊ≤°ÊúâreturnÊåá‰ª§Ôºâ„ÄÇ‰∏çËøáÂú®main()ÂáΩÊï∞ÈÄÄÂá∫Êó∂ÔºåEAXÂØÑÂ≠òÂô®Ëøò‰ºöÂ≠òÊúâÊï∞ÊçÆÔºåEAXÂØÑÂ≠òÂô®‰øùÂ≠òÁöÑÊï∞ÊçÆ‰ºöË¢´‰º†ÈÄíÁªôexit()ÂáΩÊï∞„ÄÅÊàê‰∏∫ÂêéËÄÖÁöÑËæìÂÖ•ÂèÇÊï∞„ÄÇÈÄöÂ∏∏EAXÂØÑÂ≠òÂô®ÁöÑÂÄº‰ºöÊòØË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÊÆãÁïôÁöÑÁ°ÆÂÆöÊï∞ÊçÆÔºåÊâÄ‰ª•voidÁ±ªÂûãÂáΩÊï∞ÁöÑËøîÂõûÂÄº„ÄÅ‰πüÂ∞±ÊòØ‰∏ªÂáΩÊï∞ÈÄÄÂá∫‰ª£Á†ÅÂæÄÂæÄÂ±û‰∫é‰º™ÈöèÊú∫Êï∞ÔºàpseudorandomÔºâ</p>
<h4 id="ËøîÂõûÂÄº‰∏∫ÁªìÊûÑ‰ΩìÂûãÊï∞ÊçÆ"><a class="markdownIt-Anchor" href="#ËøîÂõûÂÄº‰∏∫ÁªìÊûÑ‰ΩìÂûãÊï∞ÊçÆ"></a> ËøîÂõûÂÄº‰∏∫ÁªìÊûÑ‰ΩìÂûãÊï∞ÊçÆ</h4>
<p>Ë∞ÉÁî®ÊñπÂáΩÊï∞ÔºàcallerÔºâÂàõÂª∫‰∫ÜÊï∞ÊçÆÁªìÊûÑ„ÄÅÂàÜÈÖç‰∫ÜÊï∞ÊçÆÁ©∫Èó¥ÔºåË¢´Ë∞ÉÁî®ÁöÑÂáΩÊï∞‰ªÖÂêëÁªìÊûÑ‰ΩìÂ°´ÂÖÖÊï∞ÊçÆ„ÄÇÂÖ∂ÊïàÊûúÁ≠âÂêå‰∫éËøîÂõûÁªìÊûÑ‰Ωì„ÄÇ</p>
<h3 id="chap10-ÊåáÈíà"><a class="markdownIt-Anchor" href="#chap10-ÊåáÈíà"></a> Chap10 ÊåáÈíà</h3>
<p>ÊåáÈíàÈÄöÂ∏∏Áî®Êù•Â∏ÆÂä©ÂáΩÊï∞Â§ÑÁêÜËøîÂõûÂÄº„ÄÇÂΩìÂáΩÊï∞ÈúÄË¶ÅËøîÂõûÂ§ö‰∏™ÂÄºÊó∂ÔºåÂÆÉÈÄöÂ∏∏ÈÉΩÊòØÈÄöËøáÊåáÈíà‰º†ÈÄíËøîÂõûÂÄºÁöÑ„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f1</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>sum<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>product<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token operator">*</span>sum<span class="token operator">=</span>x<span class="token operator">+</span>y<span class="token punctuation">;</span>
         <span class="token operator">*</span>product<span class="token operator">=</span>x<span class="token operator">*</span>y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> sum<span class="token punctuation">,</span> product<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token function">f1</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">456</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>sum<span class="token punctuation">,</span> <span class="token operator">&amp;</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"sum=%d, product=%d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">,</span> product<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">COMM     _product:DWORD
COMM     _sum:DWORD
<span class="token comment">; ÂÆö‰πâÂ≠óÁ¨¶‰∏≤Â∏∏Èáè $SG2803ÔºåË°®Á§∫Ê†ºÂºèÂåñËæìÂá∫ÁöÑÂ≠óÁ¨¶‰∏≤ "sum=%d, product=%d\n"</span>
<span class="token operator">$</span>SG2803 DB     <span class="token string">'sum=%d, product=%d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token comment">; ÂÆö‰πâÂèÇÊï∞Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÈáè</span>
_x<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>             <span class="token comment">; ÂèÇÊï∞ _x Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÈáèÔºåÂ§ßÂ∞è‰∏∫ 4 Â≠óËäÇ</span>
_y<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>            <span class="token comment">; ÂèÇÊï∞ _y Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÈáèÔºåÂ§ßÂ∞è‰∏∫ 4 Â≠óËäÇ</span>
_sum<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>          <span class="token comment">; _sum Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÈáèÔºåÂ§ßÂ∞è‰∏∫ 4 Â≠óËäÇ</span>
_product<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">20</span>      <span class="token comment">; _product Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÈáèÔºåÂ§ßÂ∞è‰∏∫ 4 Â≠óËäÇ</span>
<span class="token comment">; ÂÆö‰πâ _f1 ÂáΩÊï∞</span>
_f1   PROC
      <span class="token comment">; Â∞ÜÂèÇÊï∞ _y ÁöÑÂÄºÂä†ËΩΩÂà∞ ecx ÂØÑÂ≠òÂô®</span>
      mov  <span class="token register variable">ecx</span>, DWORD PTR _y<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
      <span class="token comment">; Â∞ÜÂèÇÊï∞ _x ÁöÑÂÄºÂä†ËΩΩÂà∞ eax ÂØÑÂ≠òÂô®</span>
      mov  <span class="token register variable">eax</span>, DWORD PTR _x<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
      <span class="token comment">; ËÆ°ÁÆó _x Âíå _y ÁöÑÂíåÔºåÁªìÊûúÂ≠òÂÇ®Âà∞ edx ÂØÑÂ≠òÂô®</span>
      lea  <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">]</span>
      <span class="token comment">; ËÆ°ÁÆó _x Âíå _y ÁöÑ‰πòÁßØÔºåÁªìÊûúÂ≠òÂÇ®Âà∞ eax ÂØÑÂ≠òÂô®</span>
      imul <span class="token register variable">eax</span>, <span class="token register variable">ecx</span><span class="token comment">;eax=eax*ecx</span>
      <span class="token comment">; Â∞Ü _product ÁöÑÂú∞ÂùÄÂä†ËΩΩÂà∞ ecx ÂØÑÂ≠òÂô®</span>
      mov  <span class="token register variable">ecx</span>, DWORD PTR _product<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
      <span class="token comment">; ‰øùÂ≠ò esi ÂØÑÂ≠òÂô®ÁöÑÂÄºÔºå‰∏∫ÂêéÁª≠Êìç‰ΩúÂÅöÂáÜÂ§á</span>
      push <span class="token register variable">esi</span>
      <span class="token comment">; Â∞Ü _sum ÁöÑÂú∞ÂùÄÂä†ËΩΩÂà∞ esi ÂØÑÂ≠òÂô®</span>
      mov  <span class="token register variable">esi</span>, DWORD PTR _sum<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
      <span class="token comment">; Â∞ÜÂíåÁöÑÁªìÊûúÂ≠òÂÇ®Âà∞ _sum ÊåáÂêëÁöÑ‰ΩçÁΩÆ</span>
      mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
      <span class="token comment">; Â∞ÜÁßØÁöÑÁªìÊûúÂ≠òÂÇ®Âà∞ _product ÊåáÂêëÁöÑ‰ΩçÁΩÆ</span>
      mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
      <span class="token comment">; ÊÅ¢Â§ç esi ÂØÑÂ≠òÂô®ÁöÑÂÄº</span>
      pop  <span class="token register variable">esi</span>
      <span class="token comment">; ËøîÂõûÂà∞Ë∞ÉÁî®ËÄÖ</span>
      ret  <span class="token number">0</span>
_f1   ENDP

<span class="token comment">; ÂÆö‰πâ _main ÂáΩÊï∞</span>
_main PROC
      <span class="token comment">; Â∞Ü _product ÁöÑÂú∞ÂùÄÂéãÂÖ•Ê†à‰∏≠</span>
      push OFFSET _product
      <span class="token comment">; Â∞Ü _sum ÁöÑÂú∞ÂùÄÂéãÂÖ•Ê†à‰∏≠</span>
      push OFFSET _sum
      <span class="token comment">; Â∞ÜÂèÇÊï∞ 456 ÂéãÂÖ•Ê†à‰∏≠</span>
      push <span class="token number">456</span>          <span class="token comment">; 456 ÁöÑÂçÅÂÖ≠ËøõÂà∂Ë°®Á§∫‰∏∫ 0x1c8</span>
      <span class="token comment">; Â∞ÜÂèÇÊï∞ 123 ÂéãÂÖ•Ê†à‰∏≠</span>
      push <span class="token number">123</span>          <span class="token comment">; 123 ÁöÑÂçÅÂÖ≠ËøõÂà∂Ë°®Á§∫‰∏∫ 0x7b</span>
      <span class="token comment">; Ë∞ÉÁî® _f1 ÂáΩÊï∞</span>
      call _f1
      <span class="token comment">; Â∞Ü _product ÁöÑÂÄºÂä†ËΩΩÂà∞ eax ÂØÑÂ≠òÂô®</span>
      mov  <span class="token register variable">eax</span>, DWORD PTR _product
      <span class="token comment">; Â∞Ü _sum ÁöÑÂÄºÂä†ËΩΩÂà∞ ecx ÂØÑÂ≠òÂô®</span>
      mov  <span class="token register variable">ecx</span>, DWORD PTR _sum
      <span class="token comment">; Â∞Ü _product Âíå _sum ÁöÑÂÄº‰Ωú‰∏∫ÂèÇÊï∞ÔºåË∞ÉÁî® printf ÂáΩÊï∞</span>
      push <span class="token register variable">eax</span>
      push <span class="token register variable">ecx</span>
      push OFFSET <span class="token operator">$</span>SG2803
      call DWORD PTR __imp__printf
      <span class="token comment">; Ë∞ÉÊï¥Ê†àÊåáÈíàÔºåÊ∏ÖÁêÜÂèÇÊï∞</span>
      add  <span class="token register variable">esp</span>, <span class="token number">28</span>    
      xor  <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
      <span class="token comment">; ËøîÂõûÂà∞Ë∞ÉÁî®ËÄÖ</span>
      ret  <span class="token number">0</span>
_main ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap12-Êù°‰ª∂ËΩ¨Áßª"><a class="markdownIt-Anchor" href="#chap12-Êù°‰ª∂ËΩ¨Áßª"></a> Chap12 Êù°‰ª∂ËΩ¨Áßª</h3>
<h4 id="Êï∞ÂÄºÊØîËæÉ"><a class="markdownIt-Anchor" href="#Êï∞ÂÄºÊØîËæÉ"></a> Êï∞ÂÄºÊØîËæÉ</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f_signed</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">></span>b<span class="token punctuation">)</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a>b\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">==</span>b<span class="token punctuation">)</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a==b\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">&lt;</span>b<span class="token punctuation">)</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a&lt;b\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f_unsigned</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">></span>b<span class="token punctuation">)</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a>b\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">==</span>b<span class="token punctuation">)</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a==b\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">&lt;</span>b<span class="token punctuation">)</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a&lt;b\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token function">f_signed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">f_unsigned</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span>  <span class="token number">8</span>  <span class="token comment">; size  = 4 </span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>  <span class="token comment">; size  = 4 </span>
_f_unsigned PROC
    push   <span class="token register variable">ebp</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    cmp    <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    jbe    SHORT <span class="token operator">$</span>LN3@f_unsigned
    push   OFFSET <span class="token operator">$</span>SG2761    <span class="token comment">; 'a>b'</span>
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
<span class="token label function">$LN3@f_unsigned:</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    cmp    <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    jne    SHORT <span class="token operator">$</span>LN2@f_unsigned
    push   OFFSET <span class="token operator">$</span>SG2763    <span class="token comment">; 'a==b'</span>
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
<span class="token label function">$LN2@f_unsigned:</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    cmp    <span class="token register variable">edx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    jae    SHORT <span class="token operator">$</span>LN4@f_unsigned
    push   OFFSET <span class="token operator">$</span>SG2765    <span class="token comment">; 'a&lt;b'</span>
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
<span class="token label function">LN4@f_unsigned:</span>
    Pop   <span class="token register variable">ebp</span>
    Ret   <span class="token number">0</span>
_f_unsigned ENDP
_main   PROC
        push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        push    <span class="token number">2</span>
        push    <span class="token number">1</span>
        call    _f_signed
        add     <span class="token register variable">esp</span>, <span class="token number">8</span>
        push    <span class="token number">2</span>
        push    <span class="token number">1</span>
        call    _f_unsigned
        add     <span class="token register variable">esp</span>, <span class="token number">8</span>
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_main   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>JLEÔºåÂç≥‚ÄúJump if Less or Equal‚Äù„ÄÇÂ¶ÇÊûú‰∏ä‰∏ÄÊù°CMPÊåá‰ª§ÁöÑÁ¨¨‰∏Ä‰∏™Êìç‰ΩúË°®ËææÂºèÂ∞è‰∫éÊàñÁ≠â‰∫éÔºà‰∏çÂ§ß‰∫éÔºâÁ¨¨‰∫å‰∏™Ë°®ËææÂºèÔºåJLEÂ∞ÜË∑≥ËΩ¨Âà∞Êåá‰ª§ÊâÄÊ†áÊòéÁöÑÂú∞ÂùÄÔºõÂ¶ÇÊûú‰∏çÊª°Ë∂≥‰∏äËø∞Êù°‰ª∂ÔºåÂàôËøêË°å‰∏ã‰∏ÄÊù°Êåá‰ª§ÔºåÂ∞±Êú¨‰æãËÄåË®ÄÁ®ãÂ∫èÂ∞Ü‰ºöË∞ÉÁî®printf()ÂáΩÊï∞„ÄÇÁ¨¨‰∫å‰∏™Êù°‰ª∂ËΩ¨ÁßªÊåá‰ª§ÊòØJNEÔºå‚ÄúJump if Not Equal‚ÄùÔºåÂ¶ÇÊûú‰∏ä‰∏ÄÊù°CMPÁöÑ‰∏§‰∏™Êìç‰ΩúÁ¨¶‰∏çÁõ∏Á≠âÔºåÂàôËøõË°åÁõ∏Â∫îË∑≥ËΩ¨„ÄÇ</li>
<li>JGEÔºåÂç≥‚ÄúJump if Greater or Equal‚Äù„ÄÇÂ¶ÇÊûúCMPÁöÑÁ¨¨‰∏Ä‰∏™Ë°®ËææÂºèÂ§ß‰∫éÊàñÁ≠â‰∫éÁ¨¨‰∫å‰∏™Ë°®ËææÂºèÔºà‰∏çÂ∞è‰∫éÔºâÔºåÂàôËøõË°åË∑≥ËΩ¨„ÄÇËøôÊÆµÁ®ãÂ∫èÈáåÔºåÂ¶ÇÊûú‰∏â‰∏™Ë∑≥ËΩ¨ÁöÑÂà§Êñ≠Êù°‰ª∂ÈÉΩ‰∏çÊª°Ë∂≥ÔºåÂ∞Ü‰∏ç‰ºöË∞ÉÁî®printf()ÂáΩÊï∞Ôºõ‰∏çËøáÔºåÈô§ÈùûËøõË°åÁâπÊÆäÂπ≤È¢ÑÔºåÂê¶ÂàôËøôÁßçÊÉÖÂÜµÂ∫îËØ•‰∏ç‰ºöÂèëÁîü</li>
<li>ÁªèGCCÁºñËØëÂêéÔºåf_unsigned()ÂáΩÊï∞‰ΩøÁî®ÁöÑÊù°‰ª∂ËΩ¨ÁßªÊåá‰ª§ÊòØJBEÔºàJump if Below or EqualÔºåÁõ∏ÂΩì‰∫éJLEÔºâÂíåJAEÔºàJump if Above or EqualÔºåÁõ∏ÂΩì‰∫éJGEÔºâ„ÄÇ==JA/JAE/JB/JBE‰∏éJG/JGE/JL/JLEÁöÑÂå∫Âà´ÔºåÂú®‰∫éÂÆÉ‰ª¨Ê£ÄÊü•ÁöÑÊ†áÂøó‰Ωç‰∏çÂêåÔºöÂâçËÄÖÊ£ÄÊü•ÂÄü/Ëøõ‰ΩçÊ†áÂøó‰ΩçCFÔºà1ÊÑèÂë≥ÁùÄÂ∞è‰∫éÔºâÂíåÈõ∂Ê†áÂøó‰ΩçZFÔºà1ÊÑèÂë≥ÁùÄÁõ∏Á≠âÔºâÔºåÂêéËÄÖÊ£ÄÊü•‚ÄúSF XOR OF‚ÄùÔºà1ÊÑèÂë≥ÁùÄÂºÇÂè∑ÔºâÂíåZF„ÄÇ==‰ªéÊåá‰ª§ÂèÇÊï∞ÁöÑËßíÂ∫¶ÁúãÔºå<mark>ÂâçËÄÖÈÄÇÁî®‰∫éunsignedÔºàÊó†Á¨¶Âè∑ÔºâÁ±ªÂûãÊï∞ÊçÆÁöÑÔºàCMPÔºâËøêÁÆóÔºåËÄåÂêéËÄÖÁöÑÈÄÇÁî®‰∫ésignedÔºàÊúâÁ¨¶Âè∑ÔºâÁ±ªÂûãÊï∞ÊçÆÁöÑËøêÁÆó„ÄÇ</mark></li>
</ul>
<h4 id="ËÆ°ÁÆóÁªùÂØπÂÄº"><a class="markdownIt-Anchor" href="#ËÆ°ÁÆóÁªùÂØπÂÄº"></a> ËÆ°ÁÆóÁªùÂØπÂÄº</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">my_abs</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                 <span class="token keyword">return</span> <span class="token operator">-</span>i<span class="token punctuation">;</span>
         <span class="token keyword">else</span>
                 <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>

my_abs   PROC
<span class="token comment">; ECX = ËæìÂÖ•ÂÄº</span>
         test    <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>          <span class="token comment">; ÊâßË°å ECX ÂíåËá™Ë∫´ÁöÑÊåâ‰Ωç‰∏éÊìç‰Ωú‰ª•ËÆæÁΩÆÊ†áÂøó</span>
<span class="token comment">; Ê£ÄÊü•ËæìÂÖ•ÂÄºÁöÑÁ¨¶Âè∑</span>
<span class="token comment">; Â¶ÇÊûúÁ¨¶Âè∑‰∏∫Ê≠£ÂàôË∑≥Ëøá NEG Êåá‰ª§</span>
         jns     SHORT <span class="token operator">$</span>LN2@my_abs <span class="token comment">; Â¶ÇÊûú ECX ‰∏∫ÈùûË¥üÊï∞ÔºåÂàôË∑≥ËΩ¨Âà∞ $LN2@my_abs</span>
<span class="token comment">; ÂèñÂèçÂÄº</span>
         neg     <span class="token register variable">ecx</span>               <span class="token comment">; Â¶ÇÊûú ECX ‰∏∫Ë¥üÊï∞ÔºåÂèñÂèç ECX (ECX = -ECX)</span>
<span class="token label function">$LN2@my_abs:</span>
<span class="token comment">; Â∞ÜÁªìÊûúÂáÜÂ§áÂà∞ EAX:</span>
       mov    <span class="token register variable">eax</span>,   <span class="token register variable">ecx</span>    <span class="token comment">; Â∞Ü ECX ÁöÑÂÄºÂ§çÂà∂Âà∞ EAX</span>
        ret     <span class="token number">0</span>                   <span class="token comment">; ‰ªéËøáÁ®ãËøîÂõûÔºà‰∏çÊ∏ÖÈô§‰ªª‰ΩïÂèÇÊï∞Ôºâ</span>
my_abs  ENDP                        <span class="token comment">; ËøáÁ®ã my_abs ÁöÑÁªìÊùü</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>neg</code> Êåá‰ª§Áî®‰∫éÂ∞ÜÂØÑÂ≠òÂô®ÊàñÂÜÖÂ≠ò‰ΩçÁΩÆ‰∏≠ÁöÑÊìç‰ΩúÊï∞ÂèñÂèç„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåÂÆÉÂ∞Ü<mark>Êìç‰ΩúÊï∞Âèò‰∏∫ÂÆÉÁöÑÁõ∏ÂèçÊï∞ÔºàÂç≥ÂèñË¥üÂÄºÔºâ</mark>„ÄÇ<code>neg</code> Êåá‰ª§ÂÆûÈôÖ‰∏äÊòØËÆ°ÁÆó‰∫åË°•Êï∞„ÄÇ</p>
<p>‰ª•‰∏ãÊòØ <code>neg</code> Êåá‰ª§ÁöÑËØ¶ÁªÜËß£ÈáäÔºö</p>
<ul>
<li>Â¶ÇÊûúÊìç‰ΩúÊï∞ÊòØÊ≠£Êï∞Ôºå<code>neg</code> ‰ºöÂ∞ÜÂÖ∂Âèò‰∏∫Ë¥üÊï∞„ÄÇ</li>
<li>Â¶ÇÊûúÊìç‰ΩúÊï∞ÊòØË¥üÊï∞Ôºå<code>neg</code> ‰ºöÂ∞ÜÂÖ∂Âèò‰∏∫Ê≠£Êï∞„ÄÇ</li>
<li>Â¶ÇÊûúÊìç‰ΩúÊï∞ÊòØÈõ∂Ôºå<code>neg</code> ‰ºö‰øùÊåÅÂÖ∂‰∏∫Èõ∂„ÄÇ</li>
</ul>
<p>Âú®Â§ÑÁêÜËøáÁ®ã‰∏≠Ôºå<code>neg</code> Êåá‰ª§‰ºöÂΩ±ÂìçÊ†áÂøóÂØÑÂ≠òÂô®ÔºàFlags RegisterÔºâ‰∏≠ÁöÑ‰ª•‰∏ãÊ†áÂøóÔºö</p>
<ul>
<li><strong>CFÔºàËøõ‰ΩçÊ†áÂøóÔºâ</strong>ÔºöÂ¶ÇÊûúÁªìÊûú‰∏∫ÈùûÈõ∂ÔºåÂàôËÆæÁΩÆ CF„ÄÇ</li>
<li><strong>ZFÔºàÈõ∂Ê†áÂøóÔºâ</strong>ÔºöÂ¶ÇÊûúÁªìÊûú‰∏∫Èõ∂ÔºåÂàôËÆæÁΩÆ ZF„ÄÇ</li>
<li><strong>SFÔºàÁ¨¶Âè∑Ê†áÂøóÔºâ</strong>ÔºöÊ†πÊçÆÁªìÊûúÁöÑÊúÄÈ´ò‰ΩçËÆæÁΩÆ SF„ÄÇ</li>
<li><strong>OFÔºàÊ∫¢Âá∫Ê†áÂøóÔºâ</strong>ÔºöÂ¶ÇÊûúÊìç‰ΩúÊï∞ÊòØÊúÄÂ∞èÁöÑË¥üÊï∞ÔºåÂàôËÆæÁΩÆ OFÔºà‰æãÂ¶ÇÔºåÂØπ‰∫é32‰ΩçÊï¥Êï∞Ôºå-2^31 Âèò‰∏∫ 2^31-1 ‰ºöÂØºËá¥Ê∫¢Âá∫Ôºâ„ÄÇ</li>
</ul>
<p>ÂÅáËÆæ <code>ECX</code> ÂØÑÂ≠òÂô®ÂåÖÂê´ÂÄº <code>5</code> Êàñ <code>-5</code>ÔºåÂú®ÊâßË°å <code>neg</code> Êåá‰ª§ÂêéÁöÑÂèòÂåñÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-none"><code class="language-none">mov ecx, 5     ; ECX &#x3D; 5
neg ecx        ; ECX &#x3D; -5

mov ecx, -5    ; ECX &#x3D; -5
neg ecx        ; ECX &#x3D; 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Êù°‰ª∂ËøêÁÆóÁ¨¶"><a class="markdownIt-Anchor" href="#Êù°‰ª∂ËøêÁÆóÁ¨¶"></a> Êù°‰ª∂ËøêÁÆóÁ¨¶</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a<span class="token operator">==</span><span class="token number">10</span> <span class="token operator">?</span> <span class="token string">"it is ten"</span> <span class="token operator">:</span> <span class="token string">"it is not ten"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>Âú®ÁºñËØëÂê´ÊúâÊù°‰ª∂ËøêÁÆóÁ¨¶ÁöÑËØ≠Âè•Êó∂ÔºåÊó©ÊúüÊó†‰ºòÂåñÂäüËÉΩÁöÑÁºñËØëÂô®‰ºö‰ª•ÁºñËØë‚Äúif/else‚ÄùËØ≠Âè•ÁöÑÊñπÊ≥ïËøõË°åÂ§ÑÁêÜ„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG746   DB       <span class="token string">'it is ten'</span>, <span class="token number">00H</span>         <span class="token comment">; ÂÆö‰πâÂ≠óÁ¨¶‰∏≤ "it is ten" Âπ∂‰ª•Á©∫Â≠óÁ¨¶ÁªìÂ∞æ</span>
<span class="token operator">$</span>SG747   DB       <span class="token string">'it is not ten'</span>, <span class="token number">00H</span>     <span class="token comment">; ÂÆö‰πâÂ≠óÁ¨¶‰∏≤ "it is not ten" Âπ∂‰ª•Á©∫Â≠óÁ¨¶ÁªìÂ∞æ</span>

tv65 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span> <span class="token comment">; ËøôÊòØ‰∏Ä‰∏™‰∏¥Êó∂ÂèòÈáèÔºåÂ≠òÂÇ®Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÈáè‰∏∫ -4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>   <span class="token comment">; ËæìÂÖ•ÂÄºÂú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÈáè‰∏∫ 8</span>

_f       PROC
         push     <span class="token register variable">ebp</span>                      <span class="token comment">; ‰øùÂ≠òÂü∫ÊåáÈíà EBP</span>
         mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>                 <span class="token comment">; ËÆæÁΩÆÊñ∞ÁöÑÊ†àÂ∏ß</span>
         push     <span class="token register variable">ecx</span>                      <span class="token comment">; ‰øùÂ≠ò ECX ÂØÑÂ≠òÂô®ÁöÑÂÄº</span>
<span class="token comment">; ÊØîËæÉËæìÂÖ•ÂÄºÊòØÂê¶‰∏∫10</span>
         cmp      DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">10</span>   <span class="token comment">; ÊØîËæÉ‰Ωç‰∫éÊ†àÂ∏ßÂÅèÁßª _a$ Â§ÑÁöÑÂÄºÊòØÂê¶‰∏∫10</span>
<span class="token comment">; Â¶ÇÊûú‰∏çÁ≠â‰∫é10ÔºåÂàôË∑≥ËΩ¨Âà∞ $LN3@f</span>
         jne      SHORT <span class="token operator">$</span>LN3@f             <span class="token comment">; Â¶ÇÊûú‰∏çÁ≠â‰∫é10ÔºåË∑≥ËΩ¨Âà∞ $LN3@f</span>
<span class="token comment">; Â∞ÜÊåáÂêëÂ≠óÁ¨¶‰∏≤ 'it is ten' ÁöÑÊåáÈíàÂ≠òÂÇ®Âà∞‰∏¥Êó∂ÂèòÈáè‰∏≠</span>
         mov      DWORD PTR tv65<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG746 <span class="token comment">; Â∞ÜÂ≠óÁ¨¶‰∏≤ "it is ten" ÁöÑÂú∞ÂùÄÂ≠òÂÇ®Âà∞ tv65 ÂèòÈáè‰∏≠</span>
<span class="token comment">; Ë∑≥ËΩ¨Âà∞ÈÄÄÂá∫Ê†áÁ≠æ</span>
         jmp      SHORT <span class="token operator">$</span>LN4@f             <span class="token comment">; Ë∑≥ËΩ¨Âà∞ $LN4@f</span>
<span class="token label function">$LN3@f:</span>
<span class="token comment">; Â∞ÜÊåáÂêëÂ≠óÁ¨¶‰∏≤ 'it is not ten' ÁöÑÊåáÈíàÂ≠òÂÇ®Âà∞‰∏¥Êó∂ÂèòÈáè‰∏≠</span>
         mov      DWORD PTR tv65<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG747 <span class="token comment">; Â∞ÜÂ≠óÁ¨¶‰∏≤ "it is not ten" ÁöÑÂú∞ÂùÄÂ≠òÂÇ®Âà∞ tv65 ÂèòÈáè‰∏≠</span>
<span class="token label function">$LN4@f:</span>
<span class="token comment">; ËøôÊòØÈÄÄÂá∫ÈÉ®ÂàÜ„ÄÇ‰ªé‰∏¥Êó∂ÂèòÈáè‰∏≠Â§çÂà∂ÊåáÂêëÂ≠óÁ¨¶‰∏≤ÁöÑÊåáÈíàÂà∞ EAX ‰∏≠</span>
         mov      <span class="token register variable">eax</span>, DWORD PTR tv65<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; Â∞Ü tv65 ÂèòÈáè‰∏≠ÁöÑÂÄºÂ§çÂà∂Âà∞ EAX ÂØÑÂ≠òÂô®</span>
         mov      <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>                 <span class="token comment">; ÊÅ¢Â§çÊ†àÊåáÈíà</span>
         pop      <span class="token register variable">ebp</span>                      <span class="token comment">; ÊÅ¢Â§çÂü∫ÊåáÈíà</span>
         ret      <span class="token number">0</span>                        <span class="token comment">; ËøîÂõûÔºåÊ∏ÖÁêÜÊ†à‰∏äÁöÑÂèÇÊï∞</span>
_f       ENDP                              <span class="token comment">; ËøáÁ®ã _f ÁªìÊùü</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂºÄÂêØÁºñËØëÂô®‰ºòÂåñ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG792  DB       <span class="token string">'it is ten'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG793  DB       <span class="token string">'it is not ten'</span>, <span class="token number">00H</span>

_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">; size = 4</span>
_f      PROC
<span class="token comment">; compare input value with 10</span>
        cmp      DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">10</span>
        mov      <span class="token register variable">eax</span>, OFFSET <span class="token operator">$</span>SG792 <span class="token comment">; 'it is ten'</span>
<span class="token comment">; jump to $LN4@f if equal</span>
        je       SHORT <span class="token operator">$</span>LN4@f
        mov      <span class="token register variable">eax</span>, OFFSET <span class="token operator">$</span>SG793 <span class="token comment">; 'it is not ten'</span>
<span class="token label function">$LN4@f:</span>
        ret      <span class="token number">0</span> 
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h4 id="ÊØîËæÉÂ§ßÂ∞è"><a class="markdownIt-Anchor" href="#ÊØîËæÉÂ§ßÂ∞è"></a> ÊØîËæÉÂ§ßÂ∞è</h4>
<ul>
<li>ÂêØÁî®‰ºòÂåñÂäüËÉΩÂêéÔºåÁºñËØëÂô®‰ºöÂ∞ΩÂèØËÉΩÈÅøÂÖç‰ΩøÁî®Êù°‰ª∂ËΩ¨ÁßªÊåá‰ª§</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">my_max</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">></span>b<span class="token punctuation">)</span>
                <span class="token keyword">return</span> a<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
                <span class="token keyword">return</span> b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">my_min</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">&lt;</span>b<span class="token punctuation">)</span>
                <span class="token keyword">return</span> a<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
                <span class="token keyword">return</span> b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê≤°ÂºÄÂêØ‰ºòÂåñ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>
_my_min PROC
        push     <span class="token register variable">ebp</span>
        mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        mov      <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
<span class="token comment">; compare A and B:</span>
        cmp      <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
<span class="token comment">; jump, if A is greater or equal to B:</span>
        jge      SHORT <span class="token operator">$</span>LN2@my_min
<span class="token comment">; reload A to EAX if otherwise and jump to exit</span>
        mov      <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        jmp      SHORT <span class="token operator">$</span>LN3@my_min
        jmp      SHORT <span class="token operator">$</span>LN3@my_min <span class="token comment">; this is redundant JMP</span>
<span class="token label function">$LN2@my_min:</span>
<span class="token comment">; return B</span>
        mov      <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
<span class="token label function">$LN3@my_min:</span>
        pop      <span class="token register variable">ebp</span>
        ret      <span class="token number">0</span>
_my_min ENDP

_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>
_my_max PROC
        push     <span class="token register variable">ebp</span>
        mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        mov      <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
<span class="token comment">; compare A and B:</span>
        cmp      <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
<span class="token comment">; jump if A is less or equal to B:</span>
        jle      SHORT <span class="token operator">$</span>LN2@my_max
<span class="token comment">; reload A to EAX if otherwise and jump to exit</span>
        mov      <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        jmp      SHORT <span class="token operator">$</span>LN3@my_max
        jmp      SHORT <span class="token operator">$</span>LN3@my_max <span class="token comment">; this is redundant JMP</span>
<span class="token label function">$LN2@my_max:</span>
<span class="token comment">; return B</span>
        mov      <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
<span class="token label function">$LN3@my_max:</span>
        pop      <span class="token register variable">ebp</span>
        ret      <span class="token number">0</span>
_my_max ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap13-switch"><a class="markdownIt-Anchor" href="#chap13-switch"></a> Chap13 Switch</h3>
<h4 id="caseËæÉÂ∞ëÁöÑÊÉÖÂΩ¢"><a class="markdownIt-Anchor" href="#caseËæÉÂ∞ëÁöÑÊÉÖÂΩ¢"></a> caseËæÉÂ∞ëÁöÑÊÉÖÂΩ¢</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"zero\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"one\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"two\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"something unknown\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//test</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>msvs‰∏çÂºÄÂêØ‰ºòÂåñ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">tv64 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span> <span class="token comment">; size = 4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>   <span class="token comment">; size = 4</span>
_f     PROC
    push   <span class="token register variable">ebp</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    push   <span class="token register variable">ecx</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
    cmp    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">0</span>
    je     SHORT <span class="token operator">$</span>LN4@f 
    cmp    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">1</span>
    je     SHORT <span class="token operator">$</span>LN3@f
    cmp    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">2</span>
    je     SHORT <span class="token operator">$</span>LN2@f
    jmp    SHORT <span class="token operator">$</span>LN1@f
<span class="token label function">$LN4@f:</span><span class="token number">0</span>
    push   OFFSET <span class="token operator">$</span>SG739 <span class="token comment">; 'zero', 0aH, 00H</span>
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
    jmp    SHORT <span class="token operator">$</span>LN7@f
<span class="token label function">$LN3@f:</span><span class="token number">1</span>
    push   OFFSET <span class="token operator">$</span>SG741 <span class="token comment">; 'one', 0aH, 00H</span>
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
    jmp    SHORT <span class="token operator">$</span>LN7@f
<span class="token label function">$LN2@f:</span><span class="token number">2</span>
    push   OFFSET <span class="token operator">$</span>SG743 <span class="token comment">; 'two', 0aH, 00H</span>
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
    jmp    SHORT <span class="token operator">$</span>LN7@f
<span class="token label function">$LN1@f:</span>default
    push   OFFSET <span class="token operator">$</span>SG745 <span class="token comment">; 'something unknown', 0aH, 00H</span>
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
<span class="token label function">$LN7@f:</span>ret
    mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
    pop    <span class="token register variable">ebp</span>
    ret    <span class="token number">0</span> 
_f     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂèØ‰ª•ÂèëÁé∞ÁºñËØëÂô®ÊääSwitchÁøªËØëÊàê‰∫Üif elseÂΩ¢ÂºèÂèØ‰ª•ËÆ§‰∏∫Ôºåswitch()ËØ≠Âè•ÊòØ‰∏ÄÁßçÊó®Âú®ÁÆÄÂåñÂ§ßÈáèÂµåÂ•óif()ËØ≠Âè•ËÄåËÆæËÆ°ÁöÑËØ≠Ê≥ïÁ≥ñ</p>
<p><mark>ÂºÄÂêØ‰ºòÂåñ</mark></p>
<p><code>cl 1.c /Fa1.asm /Ox</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">; size = 4</span>
_f     PROC
    mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=a</span>
    sub    <span class="token register variable">eax</span>, <span class="token number">0</span><span class="token comment">;eax=eax-0 </span>
    je     SHORT <span class="token operator">$</span>LN4@f<span class="token comment">;if a==0</span>
    sub    <span class="token register variable">eax</span>, <span class="token number">1</span>
    je     SHORT <span class="token operator">$</span>LN3@f<span class="token comment">;if a==1</span>
    sub    <span class="token register variable">eax</span>, <span class="token number">1</span>
    je     SHORT <span class="token operator">$</span>LN2@f<span class="token comment">;if a==2</span>
    <span class="token comment">;default</span>
    mov    DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG791 <span class="token comment">; 'something unknown', 0aH, 00H</span>
    jmp    _printf
<span class="token label function">$LN2@f:</span><span class="token comment">;2</span>
    mov    DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG789 <span class="token comment">; 'two', 0aH, 00H</span>
    jmp    _printf
<span class="token label function">$LN3@f:</span><span class="token comment">;1</span>
    mov    DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG787 <span class="token comment">; 'one', 0aH, 00H</span>
    jmp    _printf
<span class="token label function">$LN4@f:</span><span class="token comment">;0</span>
    mov    DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG785 <span class="token comment">; 'zero', 0aH, 00H</span>
    jmp    _printf
_f     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏§Â§Ñ‰∏çÂêå</p>
<ul>
<li>
<p>aÂ≠òÂà∞eax‰πãÂêéÔºåeax-0ÔºõËøôÊ†∑Áúã‰ººÊó†ÊÑè‰πâ,ÂÆûÈôÖ‰∏äÂèØ‰ª•Ê£ÄÊü•eaxÂØÑÂ≠òÂô®ÁöÑÂÄºÊòØÂê¶‰∏∫0,Â¶ÇÊûúeaxÊòØ0ÔºåZF=1,ËøõËÄåÊ£ÄÊü•Á¨¨‰∏Ä‰∏™Âà§Êñ≠Êù°‰ª∂,Â¶ÇÊûú‰∏çÊòØÂ∞±ÁªßÁª≠-1Âà§Êñ≠</p>
</li>
<li>
<p>Âú®ÊääÂ≠óÁ¨¶‰∏≤ÊåáÈíàÂ≠òÂÇ®Âà∞ÂèòÈáè<em>a</em>‰πãÂêéÔºåÂáΩÊï∞‰ΩøÁî®JMPÊåá‰ª§Ë∞ÉÁî®printf()ÂáΩÊï∞„ÄÇ</p>
<p>ËøôÁÇπ‰∏çÈöæËß£ÈáäÔºöË∞É<mark>Áî®ÊñπÂáΩÊï∞ÊääÂèÇÊï∞Êé®ÈÄÅÂÖ•Ê†à‰πãÂêéÔºåÁöÑÁ°ÆÈÄöÂ∏∏ÈÄöËøáCALLÊåá‰ª§Ë∞ÉÁî®ÂÖ∂‰ªñÂáΩÊï∞„ÄÇËøôÁßçÊÉÖÂÜµ‰∏ãÔºåCALLÊåá‰ª§‰ºöÊääËøîÂõûÂú∞ÂùÄÊé®ÈÄÅÂÖ•Ê†à„ÄÅÂπ∂ÈÄöËøáÊó†Êù°‰ª∂ËΩ¨ÁßªÁöÑÊâãÊÆµÂêØÁî®Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞</mark>„ÄÇÂ∞±Êú¨‰æãËÄåË®ÄÔºåÂú®Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ËøêË°åÁöÑ‰ªªÊÑèÊó∂ÂàªÔºåÊ†àÁöÑÂÜÖÂ≠òÂ≠òÂÇ®ÁªìÊûÑ‰∏∫Ôºö</p>
<ul>
<li>ESP‚Äî‚ÄîÊåáÂêëRA„ÄÇ</li>
<li>ESPÔºã4‚Äî‚ÄîÊåáÂêëÂèòÈáè<em>a</em>„ÄÇ</li>
</ul>
<p>Âè¶‰∏ÄÊñπÈù¢ÔºåÂú®Êú¨‰æãÁ®ãÂ∫èË∞ÉÁî®printf()ÂáΩÊï∞‰πãÂâç„ÄÅ‰πãÂêéÔºå<mark>Èô§‰∫ÜÂà∂ÂêÑÁ¨¨‰∏Ä‰∏™Ê†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÁöÑÂèÇÊï∞ÈóÆÈ¢ò‰ª•Â§ñÔºåÊ†àÁöÑÂ≠òÂÇ®ÁªìÊûÑÂÖ∂ÂÆûÊ≤°ÊúâÂèëÁîüÂèòÂåñ</mark>„ÄÇÊâÄ‰ª•ÔºåÁºñËØëÂô®Âú®ÂàÜÈÖçJMPÊåá‰ª§‰πãÂâçÔºåÊääÂ≠óÁ¨¶‰∏≤ÊåáÈíàÂ≠òÂÇ®Âà∞Áõ∏Â∫îÂú∞ÂùÄ‰∏ä„ÄÇ</p>
<p>Ëøô‰∏™Á®ãÂ∫èÊää<mark>ÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊõøÊç¢‰∏∫Â≠óÁ¨¶‰∏≤ÁöÑÊåáÈíà</mark>ÔºåÁÑ∂ÂêéË∑≥ËΩ¨Âà∞printf()ÂáΩÊï∞ÁöÑÂú∞ÂùÄÔºåÂ∞±Â•ΩÂÉèÁ®ãÂ∫èÊ≤°Êúâ‚ÄúË∞ÉÁî®‚ÄùËøáf()ÂáΩÊï∞„ÄÅÁõ¥Êé•‚ÄúËΩ¨Áßª‚Äù‰∫Üprintf()ÂáΩÊï∞‰∏ÄËà¨„ÄÇÂΩìprintf()ÂáΩÊï∞ÂÆåÊàêËæìÂá∫ÁöÑ‰ΩøÂëΩ‰ª•ÂêéÔºåÂÆÉ‰ºöÊâßË°åRETËøîÂõûÊåá‰ª§„ÄÇRETÊåá‰ª§‰ºö‰ªéÊ†à‰∏≠ËØªÂèñÔºàPOPÔºâËøîÂõûÂú∞ÂùÄRA„ÄÅÂπ∂Ë∑≥ËΩ¨Âà∞RA„ÄÇ‰∏çËøá<mark>Ëøô‰∏™RA‰∏çÊòØÂÖ∂Ë∞ÉÁî®ÊñπÂáΩÊï∞‚Äî‚Äîf()ÂáΩÊï∞ÂÜÖÁöÑÊüê‰∏™Âú∞ÂùÄÔºåËÄåÊòØË∞ÉÁî®f()ÂáΩÊï∞ÁöÑÂáΩÊï∞Âç≥main()ÂáΩÊï∞ÁöÑÊüê‰∏™Âú∞ÂùÄ</mark>„ÄÇÊç¢ËÄåË®Ä‰πãÔºå==Ë∑≥ËΩ¨Âà∞Ëøô‰∏™RAÂú∞ÂùÄÂêéÔºåprintf()ÂáΩÊï∞‰ºö‰º¥ÈöèÂÖ∂Ë∞ÉÁî®ÊñπÂáΩÊï∞f()==‰∏ÄÂêåÁªìÊùü„ÄÇ</p>
<p>Èô§ÈùûÊØè‰∏™case‰ªéÂè•ÁöÑÊúÄÂêé‰∏ÄÊù°Êåá‰ª§ÈÉΩÊòØË∞ÉÁî®printf()ÂáΩÊï∞ÔºåÂê¶ÂàôÁºñËØëÂô®Â∞±ÂÅö‰∏çÂà∞ËøôÁßçÁ®ãÂ∫¶ÁöÑ‰ºòÂåñ„ÄÇÊüêÁßçÊÑè‰πâ‰∏äËØ¥Ëøô‰∏élongjmp()ÂáΩÊï∞ÂçÅÂàÜÁõ∏‰ºº„ÄÇÂΩìÁÑ∂ÔºåËøôÁßç‰ºòÂåñÁöÑÁõÆÁöÑÊó†ÈùûÂ∞±ÊòØÊèêÈ´òÁ®ãÂ∫èÁöÑËøêË°åÈÄüÂ∫¶„ÄÇ</p>
</li>
</ul>
<h4 id="caseËæÉÂ§öÁöÑÊÉÖÂΩ¢"><a class="markdownIt-Anchor" href="#caseËæÉÂ§öÁöÑÊÉÖÂΩ¢"></a> caseËæÉÂ§öÁöÑÊÉÖÂΩ¢</h4>
<p>Âú®switch()ËØ≠Âè•Â≠òÂú®Â§ßÈáècase()ÂàÜÊîØÁöÑÊÉÖÂÜµ‰∏ãÔºåÁºñËØëÂô®Â∞±‰∏çËÉΩÁõ¥Êé•Â•óÁî®Â§ßÈáèJE/JNEÊåá‰ª§‰∫Ü„ÄÇ‰ºöÁîüÊàê‰∏ÄÁßçË∑≥ËΩ¨Ë°®,Âê¶ÂàôÁ®ãÂ∫è‰ª£Á†ÅËÇØÂÆö‰ºöÈùûÂ∏∏Â∫ûÂ§ß„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"zero\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"one\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"two\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"three\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"four\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"something unknown\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>x86,Êú™ÂºÄÂêØ‰ºòÂåñ,msvs</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">tv64 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>    <span class="token comment">; size=4 </span>
_a<span class="token operator">$</span>  <span class="token operator">=</span>  <span class="token number">8</span>    <span class="token comment">; size = 4</span>
_f     PROC
     push   <span class="token register variable">ebp</span>
     mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span><span class="token comment">;ÂáΩÊï∞Â∫èË®Ä</span>
     push   <span class="token register variable">ecx</span>
     mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">;eax=a</span>
     mov    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span><span class="token comment">;tv64=a</span>
     cmp    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">4</span><span class="token comment">;if a==4</span>
     ja     SHORT <span class="token operator">$</span>LN1@f<span class="token comment">;if a>4</span>
     mov    <span class="token register variable">ecx</span>, DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     jmp    DWORD PTR <span class="token operator">$</span>LN11@f<span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;jmp Ë∑≥ËΩ¨Ë°®</span>
<span class="token label function">$LN6@f:</span><span class="token number">0</span>
     push   OFFSET <span class="token operator">$</span>SG739 <span class="token comment">; 'zero', 0aH, 00H</span>
     call   _printf
     add    <span class="token register variable">esp</span>, <span class="token number">4</span>
     jmp    SHORT <span class="token operator">$</span>LN9@f
<span class="token label function">$LN5@f:</span><span class="token number">1</span>
     push   OFFSET <span class="token operator">$</span>SG741 <span class="token comment">; 'one', 0aH, 00H</span>
     call   _printf
     add    <span class="token register variable">esp</span>, <span class="token number">4</span>
     jmp    SHORT <span class="token operator">$</span>LN9@f
<span class="token label function">$LN4@f:</span><span class="token number">2</span>
     push   OFFSET <span class="token operator">$</span>SG743 <span class="token comment">; 'two', 0aH, 00H</span>
     call   _printf
     add    <span class="token register variable">esp</span>, <span class="token number">4</span>
     jmp    SHORT <span class="token operator">$</span>LN9@f
<span class="token label function">$LN3@f:</span><span class="token number">3</span>
     push   OFFSET <span class="token operator">$</span>SG745 <span class="token comment">; 'three', 0aH, 00H</span>
     call   _printf
     add    <span class="token register variable">esp</span>, <span class="token number">4</span>
     jmp    SHORT <span class="token operator">$</span>LN9@f
<span class="token label function">$LN2@f:</span><span class="token number">4</span>
     push   OFFSET <span class="token operator">$</span>SG747 <span class="token comment">; 'four', 0aH, 00H</span>
     call   _printf
     add    <span class="token register variable">esp</span>, <span class="token number">4</span>
     jmp    SHORT <span class="token operator">$</span>LN9@f
<span class="token label function">$LN1@f:</span>defalut
     push   OFFSET <span class="token operator">$</span>SG749 <span class="token comment">; 'something unknown', 0aH, 00H</span>
     call   _printf
     add    <span class="token register variable">esp</span>, <span class="token number">4</span>
<span class="token label function">$LN9@f:</span><span class="token comment">;ret</span>
     mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
     pop    <span class="token register variable">ebp</span>
     ret    <span class="token number">0</span>
     npad    <span class="token number">2</span><span class="token comment">; align next label</span>
<span class="token label function">$LN11@f:</span><span class="token comment">;Ë∑≥ËΩ¨Ë°®</span>
     DD    <span class="token operator">$</span>LN6@f <span class="token comment">; 0</span>
     DD    <span class="token operator">$</span>LN5@f <span class="token comment">; 1</span>
     DD    <span class="token operator">$</span>LN4@f <span class="token comment">; 2</span>
     DD    <span class="token operator">$</span>LN3@f <span class="token comment">; 3</span>
     DD    <span class="token operator">$</span>LN2@f <span class="token comment">; 4</span>
_f     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>Ê±áÁºñËß£ËØª:</p>
<ul>
<li>
<p>ËøôÊÆµ‰ª£Á†ÅÂèØË¢´ÂàÜ‰∏∫Êï∞‰∏™Ë∞ÉÁî®<code>printf()</code>ÂáΩÊï∞ÁöÑÊåá‰ª§ÁªÑ</p>
</li>
<li>
<p>$ln11@FÁöÑÂÅèÁßªÈáèÂºÄÂßãÁöÑË°®Âè´ÂÅöË∑≥ËΩ¨Ë°®(jumptable)</p>
</li>
<li>
<p>ÂáΩÊï∞ÊúÄÂàùÊääÂèòÈáèa‰∏éÊï∞Â≠ó4ËøõË°åÊØîËæÉÔºåÂ¶ÇÊûúa&gt;4ÔºåÂ∞±ÊâìÂç∞something unknown</p>
</li>
<li>
<p><code>jmp    DWORD PTR $LN11@f[ecx*4]</code>Â¶ÇÊûúa&lt;=4Ôºå‰ºöÂÖàËÆ°ÁÆóa*4,ÁÑ∂ÂêéÊ†πÊçÆLN11@fËøô‰∏™Ë°®Êü•ËØ¢ÔºåÂπ∂Ë∑≥ËΩ¨Âà∞Ëøô‰∏™Ë°®ÊâÄÊåáÂêëÁöÑÂú∞ÂùÄ„ÄÇ<mark>‰∏∫‰ªÄ‰πàË¶Åx4?ÊòØÂõ†‰∏∫x86Á≥ªÁªüÁöÑÂÜÖÂ≠òÂú∞ÂùÄÈÉΩÊòØ32‰ΩçÊï∞ÊçÆÔºåÊØè‰∏™Âú∞ÂùÄÂç†Áî®4Â≠óËäÇÔºåÂÅèÁßªÂú∞ÂùÄÈúÄË¶Åx4ÊâçËÉΩÂà∞Ëææ</mark></p>
<p>Ê≠§Êó∂ÁöÑswitchËØ≠Âè•Á≠âÊïà‰∫é<code>jmp DWORD PTR ($LN11@f[ecx*4])$LN11@f+ecx*4</code></p>
</li>
<li>
<p>npadÊåá‰ª§Â±û‰∫é<code>Ê±áÁºñÂÆè</code>Ôºå==ÂÆÉÁöÑ‰ΩúÁî®ÊòØÊääÁ¥ßÊé•ÂÖ∂ÂêéÁöÑÊ†áÁ≠æÂú∞ÂùÄÂêë4Â≠óËäÇÔºàÊàñ16Â≠óËäÇÔºâËæπÁïåÂØπÈΩê„ÄÇ==npadÁöÑÂú∞ÂùÄÂØπÈΩêÂäüËÉΩÂèØ<code>ÊèêÈ´òÂ§ÑÁêÜÂô®ÁöÑIOËØªÂÜôÊïàÁéá</code>ÔºåÈÄöËøá‰∏ÄÊ¨°Êìç‰ΩúÂç≥ÂèØÂÆåÊàêÂÜÖÂ≠òÊÄªÁ∫ø„ÄÅÁºìÂÜ≤ÂÜÖÂ≠òÁ≠âËÆæÂ§áÁöÑÊï∞ÊçÆÊìç‰Ωú„ÄÇ</p>
</li>
</ul>
</li>
</ul>
<p>switch()ÁöÑÂ§ß‰ΩìÊ°ÜÊû∂</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">MOV REG,input
CMP REG,<span class="token number">4</span> <span class="token comment">; maximal number of cases</span>
JA default 
SHL REG,<span class="token number">3</span> <span class="token comment">; find element in table.shift for 3bits in x64.</span>
MOV REG, jump_table<span class="token operator">[</span>REG<span class="token operator">]</span>
JMP REG

case1<span class="token comment">;</span>
     <span class="token comment">; do something</span>
     JMP exit
case2<span class="token comment">;</span>
     <span class="token comment">; do something</span>
     JMP exit
case3<span class="token comment">;</span>
     <span class="token comment">; do something</span>
     JMP exit
case4<span class="token comment">;</span>
     <span class="token comment">; do something</span>
     JMP exit
Case5<span class="token comment">;</span>
     <span class="token comment">; do something</span>
     JMP exit

<span class="token label function">defaule:</span>

     ‚Ä¶

<span class="token label function">exit:</span>

     ‚Ä¶

jump_table dd casel
           dd case2
           dd case3
           dd case4
           dd case5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ëã•‰∏ç‰ΩøÁî®‰∏äËø∞Êåá‰ª§ÔºåÊàë‰ª¨‰πüÂèØ‰ª•<mark>Âú®32‰ΩçÁ≥ªÁªü‰∏ä‰ΩøÁî®Êåá‰ª§JMP jump_table[REG*4]</mark>/Âú®<mark>64‰Ωç‰∏ä‰ΩøÁî®JMP jump_table[REG*8]</mark>ÔºåÂÆûÁé∞ËΩ¨ÁßªË°®‰∏≠ÁöÑÂØªÂùÄËÆ°ÁÆó„ÄÇ</p>
<p>ËØ¥Âà∞Â∫ïÔºåËΩ¨ÁßªË°®Âè™‰∏çËøáÊòØÊüêÁßçÊåáÈíàÊï∞ÁªÑÂÆÉÂíå18.5ËäÇ‰ªãÁªçÁöÑÈÇ£ÁßçÊåáÈíàÊï∞ÁªÑÂçÅÂàÜÈõ∑Âêå„ÄÇ</p>
<h4 id="case‰ªéÂè•Â§öÂØπ‰∏Ä"><a class="markdownIt-Anchor" href="#case‰ªéÂè•Â§öÂØπ‰∏Ä"></a> case‰ªéÂè•Â§öÂØπ‰∏Ä</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
         <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"1, 2, 7, 10\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"3, 4, 5\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">20</span><span class="token operator">:</span>
         <span class="token keyword">case</span> <span class="token number">21</span><span class="token operator">:</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"8 9, 21\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"22\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token keyword">default</span><span class="token operator">:</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"default\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
         <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Â¶ÇÊûúÁºñËØëÂô®ÂàªÊùøÂú∞ÊåâÁÖßÊØèÁßçÂèØËÉΩÁöÑÈÄªËæëÂàÜÊîØÈÄê‰∏ÄÂàÜÈÖçÂØπÂ∫îÁöÑÊåá‰ª§ÁªÑÔºåÈÇ£‰πàÁ®ãÂ∫èÈáåÂ∞Ü‰ºöÂ≠òÂú®Â§ßÈáèÁöÑÈáçÂ§çÊåá‰ª§„ÄÇ‰∏ÄËà¨ËÄåË®ÄÔºåÁºñËØëÂô®‰ºöÈÄöËøáÊüêÁßç<mark>Ê¥æÂèëÊú∫Âà∂</mark>Êù•Èôç‰Ωé‰ª£Á†ÅÁöÑÂÜó‰ΩôÂ∫¶„ÄÇ</p>
<p>‰ΩøÁî®MSVS ÂºÄÂêØ/Ox‰ºòÂåñ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"> <span class="token number">1</span> <span class="token operator">$</span>SG2798 DB        <span class="token string">'1, 2, 7, 10'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
 <span class="token number">2</span> <span class="token operator">$</span>SG2800 DB        <span class="token string">'3, 4, 5'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
 <span class="token number">3</span> <span class="token operator">$</span>SG2802 DB        <span class="token string">'8, 9, 21'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
 <span class="token number">4</span> <span class="token operator">$</span>SG2804 DB        <span class="token string">'22'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
 <span class="token number">5</span> <span class="token operator">$</span>SG2806 DB        <span class="token string">'default'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
 <span class="token number">6</span>
 <span class="token number">7</span> _a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
 <span class="token number">8</span> _f      PROC
 <span class="token number">9</span>         mov       <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token number">10</span>         dec       <span class="token register variable">eax</span>
<span class="token number">11</span>         cmp       <span class="token register variable">eax</span>, <span class="token number">21</span>
<span class="token number">12</span>         ja        SHORT <span class="token operator">$</span>LN1@f
<span class="token number">13</span>         movzx     <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">$</span>LN10@f<span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span><span class="token comment">;‰ªéeaxÂØÑÂ≠òÂô®ÊåáÂêëÁöÑÂÜÖÂ≠òÂú∞ÂùÄ‰∏≠ËØªÂèñ‰∏Ä‰∏™Â≠óËäÇÔºàBYTEÔºâÂ§ßÂ∞èÁöÑÊï∞ÊçÆÔºåÁÑ∂ÂêéÊó†Á¨¶Âè∑Êâ©Â±ïËøô‰∏™Â≠óËäÇÂà∞32‰ΩçÔºàDWORDÔºâÔºåÊúÄÂêéÂ∞ÜÊâ©Â±ïÂêéÁöÑÁªìÊûúÂ≠òÂÇ®Âà∞eaxÂØÑÂ≠òÂô®‰∏≠„ÄÇ</span>
<span class="token number">14</span>         jmp       DWORD PTR <span class="token operator">$</span>LN11@f<span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token number">15</span> <span class="token operator">$</span>LN5@f:
<span class="token number">16</span>         mov       DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG2798 <span class="token comment">; '1, 2, 7, 10'</span>
<span class="token number">17</span>         jmp       DWORD PTR __imp__printf
<span class="token number">18</span> <span class="token operator">$</span>LN4@f:
<span class="token number">19</span>         mov       DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG2800 <span class="token comment">; '3, 4, 5'</span>
<span class="token number">20</span>         jmp       DWORD PTR __imp__printf
<span class="token number">21</span> <span class="token operator">$</span>LN3@f:
<span class="token number">22</span>         mov       DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG2802 <span class="token comment">; '8, 9, 21'</span>
<span class="token number">23</span>         jmp       DWORD PTR __imp__printf
<span class="token number">24</span> <span class="token operator">$</span>LN2@f:
<span class="token number">25</span>         mov       DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG2804 <span class="token comment">; '22'</span>
<span class="token number">26</span>         jmp       DWORD PTR __imp__printf
<span class="token number">27</span> <span class="token operator">$</span>LN1@f:
<span class="token number">28</span>         mov       DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, OFFSET <span class="token operator">$</span>SG2806 <span class="token comment">; 'default'</span>
<span class="token number">29</span>         jmp       DWORD PTR __imp__printf
<span class="token number">30</span>         npad      <span class="token number">2</span> <span class="token comment">; align $LN11@f table on 16-byte boundary</span>
<span class="token number">31</span> <span class="token operator">$</span>LN11@f:
<span class="token number">32</span>         DD        <span class="token operator">$</span>LN5@f <span class="token comment">; print '1, 2, 7, 10'</span>
<span class="token number">33</span>         DD        <span class="token operator">$</span>LN4@f <span class="token comment">; print '3, 4, 5'</span>
<span class="token number">34</span>         DD        <span class="token operator">$</span>LN3@f <span class="token comment">; print '8, 9, 21'</span>
<span class="token number">35</span>         DD        <span class="token operator">$</span>LN2@f <span class="token comment">; print '22'</span>
<span class="token number">36</span>         DD        <span class="token operator">$</span>LN1@f <span class="token comment">; print 'default'</span>
<span class="token number">37</span> <span class="token operator">$</span>LN10@f:
<span class="token number">38</span>         DB        <span class="token number">0</span> <span class="token comment">; a=1  ;byteÂûã1‰∏™Â≠óËäÇ</span>
<span class="token number">39</span>         DB        <span class="token number">0</span> <span class="token comment">; a=2</span>
<span class="token number">40</span>         DB        <span class="token number">1</span> <span class="token comment">; a=3</span>
<span class="token number">41</span>         DB        <span class="token number">1</span> <span class="token comment">; a=4</span>
<span class="token number">42</span>         DB        <span class="token number">1</span> <span class="token comment">; a=5</span>
<span class="token number">43</span>         DB        <span class="token number">1</span> <span class="token comment">; a=6</span>
<span class="token number">44</span>         DB        <span class="token number">0</span> <span class="token comment">; a=7</span>
<span class="token number">45</span>         DB        <span class="token number">2</span> <span class="token comment">; a=8</span>
<span class="token number">46</span>         DB        <span class="token number">2</span> <span class="token comment">; a=9</span>
<span class="token number">47</span>         DB        <span class="token number">0</span> <span class="token comment">; a=10</span>
<span class="token number">48</span>         DB        <span class="token number">4</span> <span class="token comment">; a=11</span>
<span class="token number">49</span>         DB        <span class="token number">4</span> <span class="token comment">; a=12</span>
<span class="token number">50</span>         DB        <span class="token number">4</span> <span class="token comment">; a=13</span>
<span class="token number">51</span>         DB        <span class="token number">4</span> <span class="token comment">; a=14</span>
<span class="token number">52</span>         DB        <span class="token number">4</span> <span class="token comment">; a=15</span>
<span class="token number">53</span>         DB        <span class="token number">4</span> <span class="token comment">; a=16</span>
<span class="token number">54</span>         DB        <span class="token number">4</span> <span class="token comment">; a=17</span>
<span class="token number">55</span>         DB        <span class="token number">4</span> <span class="token comment">; a=18</span>
<span class="token number">56</span>         DB        <span class="token number">4</span> <span class="token comment">; a=19</span>
<span class="token number">57</span>         DB        <span class="token number">2</span> <span class="token comment">; a=20</span>
<span class="token number">58</span>         DB        <span class="token number">2</span> <span class="token comment">; a=21</span>
<span class="token number">59</span>         DB        <span class="token number">3</span> <span class="token comment">; a=22</span>
<span class="token number">60</span> _f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê±áÁºñËß£ËØª:</p>
<ul>
<li>
<p>ËøôÈáå‰ΩøÁî®‰∫Ü‰∏§‰∏™Ë°®Ôºå‰∏Ä‰∏™ÊòØÁ¥¢ÂºïË°®$LN10@f,Âè¶‰∏Ä‰∏™ËΩ¨ÁßªË°®ÊòØ$LN11@f</p>
</li>
<li>
<p><code>movzx</code> ÊòØÊ±áÁºñËØ≠Ë®Ä‰∏≠ÁöÑ‰∏Ä‰∏™Êåá‰ª§ÔºåÂÆÉÊòØ <code>move with zero extend</code> ÁöÑÁº©ÂÜôÔºåÁî®‰∫éÊó†Á¨¶Âè∑Êâ©Â±ïÂπ∂‰º†ÈÄÅÊï∞ÊçÆ„ÄÇÊ≠§Êåá‰ª§‰∏ªË¶ÅÁî®‰∫éÂ∞Ü‰∏Ä‰∏™ËæÉÂ∞è‰ΩçÂÆΩÁöÑÊï∞ÊçÆÔºàÈÄöÂ∏∏ÊòØ8‰ΩçÊàñ16‰ΩçÔºâÂä†ËΩΩÂà∞‰∏Ä‰∏™ËæÉÂ§ß‰ΩçÂÆΩÁöÑÂØÑÂ≠òÂô®ÊàñÂÜÖÂ≠ò‰ΩçÁΩÆ‰∏≠ÔºåÂπ∂Âú®<mark>Êâ©Â±ïÈ´ò‰ΩçÊó∂Áî®0Â°´ÂÖÖ„ÄÇ</mark></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">1mov <span class="token register variable">bl</span>, <span class="token number">80h</span>   <span class="token comment">; Â∞Ü8‰ΩçÁ´ãÂç≥Êï∞80hÈÄÅÂÖ•8‰ΩçÂØÑÂ≠òÂô®BL</span>
2movzx <span class="token register variable">ax</span>, <span class="token register variable">bl</span>  <span class="token comment">; Â∞ÜBLÁöÑÂÜÖÂÆπÊó†Á¨¶Âè∑Êâ©Â±ïÂà∞16‰ΩçÔºåÂπ∂ÊîæÂÖ•AXÂØÑÂ≠òÂô®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Âú®Ëøô‰∏™‰æãÂ≠ê‰∏≠Ôºå<code>BL</code> ÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÄºÊòØ <code>80h</code>ÔºàÂçÅËøõÂà∂128ÔºâÔºåÂΩì‰ΩøÁî® <code>movzx</code> Êåá‰ª§Â∞Ü <code>BL</code> ÁöÑÂÜÖÂÆπÂ§çÂà∂Âà∞ <code>AX</code> ÂØÑÂ≠òÂô®Êó∂ÔºåÂõ†‰∏∫ÊòØÊó†Á¨¶Âè∑Êâ©Â±ïÔºåÊâÄ‰ª• <code>BL</code> ÁöÑÂÄºË¢´Êâ©Â±ï‰∏∫ <code>0080h</code>ÔºàÂâçÂØºÁöÑÈ´ò‰ΩçË°•0ÔºâÔºåËøôÊ†∑ <code>AX</code> ÂØÑÂ≠òÂô®ÁöÑÂÄºÂ∞±ÂèòÊàê‰∫Ü <code>0080h</code>„ÄÇ</p>
</li>
<li>
<p>È¶ñÂÖàmovzxÊåá‰ª§Âú®Á¥¢ÂºïË°®‰∏≠Êü•ËØ¢ËæìÂÖ•ÂÄº,ËøîÂõû0(input1,2,7,10);1(input3,4,5),2(input8,9,21),3(input 22)4(default)</p>
</li>
<li>
<p>ÁÑ∂ÂêéÊääÁº©ÂΩ±Ë°®ÁöÑËøîÂõûÂÄºÔºåÂú®Á¨¨‰∫å‰∏™ËΩ¨ÁßªË°®‰∏≠ÂÆåÊàêË∑≥ËΩ¨s</p>
</li>
</ul>
<hr />
<h4 id="fall-through"><a class="markdownIt-Anchor" href="#fall-through"></a> fall-through</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"> <span class="token number">1</span> #define R <span class="token number">1</span>
 <span class="token number">2</span> #define W <span class="token number">2</span>
 <span class="token number">3</span> #define RW <span class="token number">3</span>
 <span class="token number">4</span>
 <span class="token number">5</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> type<span class="token punctuation">)</span>
 <span class="token number">6</span> <span class="token punctuation">&#123;</span>
 <span class="token number">7</span>          <span class="token keyword">int</span> read<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> write<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token number">8</span>
 <span class="token number">9</span>          <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span>
<span class="token number">10</span>          <span class="token punctuation">&#123;</span>
<span class="token number">11</span>          <span class="token keyword">case</span> RW<span class="token operator">:</span>
<span class="token number">12</span>                   read<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">13</span>          <span class="token keyword">case</span> W<span class="token operator">:</span>
<span class="token number">14</span>                   write<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">15</span>                   <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token number">16</span>          <span class="token keyword">case</span> R<span class="token operator">:</span>
<span class="token number">17</span>                   read<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">18</span>                   <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token number">19</span>          <span class="token keyword">default</span><span class="token operator">:</span>
<span class="token number">20</span>                   <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token number">21</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token number">22</span>          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"read=%d, write=%d\n"</span><span class="token punctuation">,</span> read<span class="token punctuation">,</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">23</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êó†ËÆ∫typeÁöÑÂÄºÊòØRWËøòÊòØWÔºåÁ®ãÂ∫èÈÉΩ‰ºöÊâßË°åÁ¨¨14Ë°åÁöÑÊåá‰ª§„ÄÇtype‰∏∫RWÁöÑÈôàËø∞ËØ≠Âè•ÈáåÊ≤°ÊúâbreakÊåá‰ª§Ôºå‰ªéËÄåÂà©Áî®switchËØ≠Âè•ÁöÑfall throughÊïàÂ∫î„ÄÇ</p>
<p>msvs x86 nasm</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG1305 DB       <span class="token string">'read=%d, write=%d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

_write<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">12</span>    <span class="token comment">; size= 4</span>
_read<span class="token operator">$</span>  <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span>     <span class="token comment">; size= 4</span>
tv64  <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>       <span class="token comment">; size= 4</span>
_type<span class="token operator">$</span>  <span class="token operator">=</span> <span class="token number">8</span>      <span class="token comment">; size= 4</span>
_f        PROC
          push   <span class="token register variable">ebp</span>
          mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
          sub    <span class="token register variable">esp</span>, <span class="token number">12</span><span class="token comment">;int write,read,tv64</span>
          mov    DWORD PTR _read<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">0</span><span class="token comment">;read=0</span>
          mov    DWORD PTR _write<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">0</span><span class="token comment">;write=0</span>
          mov    <span class="token register variable">eax</span>, DWORD PTR _type<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">;eax=type</span>
          mov    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span><span class="token comment">;tv64=type</span>
          cmp    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">1</span> <span class="token comment">; R</span>
          je     SHORT <span class="token operator">$</span>LN2@f
          cmp    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">2</span> <span class="token comment">; W</span>
          je     SHORT <span class="token operator">$</span>LN3@f<span class="token comment">;Êó†breakËØ≠Âè•</span>
          cmp    DWORD PTR tv64<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">3</span> <span class="token comment">; RW</span>
          je     SHORT <span class="token operator">$</span>LN4@f
          jmp    SHORT <span class="token operator">$</span>LN5@f<span class="token comment">;break</span>
<span class="token label function">$LN4@f:</span> <span class="token comment">; case RW:</span>
          mov    DWORD PTR _read<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">1</span>
<span class="token label function">$LN3@f:</span> <span class="token comment">; case W:</span>
          mov    DWORD PTR _write<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">1</span>
          jmp    SHORT <span class="token operator">$</span>LN5@f
<span class="token label function">$LN2@f:</span> <span class="token comment">; case R:</span>
          mov    DWORD PTR _read<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">1</span>
<span class="token label function">$LN5@f:</span> <span class="token comment">;printf</span>
          mov    <span class="token register variable">ecx</span>, DWORD PTR _write<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
          push   <span class="token register variable">ecx</span>
          mov    <span class="token register variable">edx</span>, DWORD PTR _read<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
          push   <span class="token register variable">edx</span>
          push   OFFSET <span class="token operator">$</span>SG1305 <span class="token comment">; 'read=%d, write=%d'</span>
          call   _printf
          add    <span class="token register variable">esp</span>, <span class="token number">12</span>
          mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
          pop    <span class="token register variable">ebp</span>
          ret    <span class="token number">0</span>
_f        ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap14-Âæ™ÁéØ"><a class="markdownIt-Anchor" href="#chap14-Âæ™ÁéØ"></a> Chap14 Âæ™ÁéØ</h3>
<p>x86Êåá‰ª§ÈõÜÈáåÊúâ‰∏ÄÊù°‰∏ìÈó®ÁöÑLOOPÊåá‰ª§„ÄÇ<mark>LOOPÊåá‰ª§Ê£ÄÊµãECXÂØÑÂ≠òÂô®ÁöÑÂÄºÊòØÂê¶ÊòØ0ÔºåÂ¶ÇÊûúÂÆÉ‰∏çÊòØ0ÂàôÂ∞ÜÂÖ∂ÈÄíÂáèÔºåÂπ∂Â∞ÜÊìç‰ΩúÊùÉ‰∫§ÁªôÊìç‰ΩúÁ¨¶ÊâÄÊåáÂÆöÁöÑÊ†áÁ≠æÂ§ÑÔºàÂç≥Ë∑≥ËΩ¨Ôºâ</mark>„ÄÇÊàñËÆ∏ÊòØÂõ†‰∏∫Âæ™ÁéØÊåá‰ª§Ëøá‰∫éÂ§çÊùÇÁöÑÁºòÊïÖÔºåËá≥‰ªäÂ∞öÊú™ËßÅËøáÁõ¥Êé•‰ΩøÁî®LOOPÊåá‰ª§Â∞ÜÂæ™ÁéØËØ≠Âè•ËΩ¨ËØëÊàêÊ±áÁºñËØ≠Âè•ÁöÑÁºñËØëÂô®„ÄÇÊâÄ‰ª•ÔºåÂ¶ÇÊûú<mark>Âì™‰∏™Á®ãÂ∫èÁõ¥Êé•‰ΩøÁî®LOOPÊåá‰ª§ËøõË°åÂæ™ÁéØÊéßÂà∂ÔºåÈÇ£ÂÆÉÂæàÂèØËÉΩÂ∞±ÊòØÊâãÂÜôÁöÑÊ±áÁºñÁ®ãÂ∫è„ÄÇ</mark></p>
<h4 id="for"><a class="markdownIt-Anchor" href="#for"></a> for</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">printing_function</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"f(%d)\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token function">printing_function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span> 
_main   PROC
    push   <span class="token register variable">ebp</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    push   <span class="token register variable">ecx</span>
    mov    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">2</span>     <span class="token comment">; ÂàùÂßãÊÄÅ;i=2</span>
    jmp    SHORT <span class="token operator">$</span>LN3@main
<span class="token label function">$LN2@main:</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>     <span class="token comment">; Âæ™ÁéØÊéßÂà∂ËØ≠Âè•Ôºö</span>
    add    <span class="token register variable">eax</span>, <span class="token number">1</span>                      <span class="token comment">; iÈÄíÂ¢û1</span>
    mov    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token label function">$LN3@main:</span>
    cmp    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">10</span>      <span class="token comment">; Âà§Êñ≠ÊòØÂê¶Êª°Ë∂≥Âæ™ÁéØÊù°‰ª∂ if i==10</span>
    jge    SHORT <span class="token operator">$</span>LN1@main             <span class="token comment">; Â¶ÇÊûúi=10 ÂàôÁªàÊ≠¢Âæ™ÁéØËØ≠Âè•</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>     <span class="token comment">; Âæ™ÁéØ‰Ωì: call f(i)</span>
    push   <span class="token register variable">ecx</span><span class="token comment">;‰º†ÂèÇ</span>
    call   _printing_function
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
    jmp    SHORT <span class="token operator">$</span>LN2@main             <span class="token comment">; Ë∑≥Âà∞Âæ™ÁéØÂºÄÂßãÂ§Ñ</span>
<span class="token label function">$LN1@main:</span> <span class="token comment">;exit                            ; Âæ™ÁéØÁªìÊùü</span>
    xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
    pop    <span class="token register variable">ebp</span>
    ret     <span class="token number">0</span>
_main    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p>gcc</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">main            proc near    <span class="token comment">; ÂºÄÂßãÂÆö‰πâ‰∏ªÁ®ãÂ∫èËøáÁ®ã</span>

var_20          <span class="token operator">=</span> dword    ptr <span class="token operator">-</span><span class="token number">20h</span>  <span class="token comment">; ÂÆö‰πâ‰∏Ä‰∏™ÂèòÈáèvar_20ÔºåÂú®Ê†à‰∏äË∑ùÁ¶ªEBP-20hÁöÑ‰ΩçÁΩÆ</span>
var_4           <span class="token operator">=</span> dword    ptr ‚Äì<span class="token number">4</span>     <span class="token comment">; ÂÆö‰πâÂè¶‰∏Ä‰∏™ÂèòÈáèvar_4ÔºåÂú®Ê†à‰∏äË∑ùÁ¶ªEBP-4ÁöÑ‰ΩçÁΩÆ</span>

                push       <span class="token register variable">ebp</span>         <span class="token comment">; ‰øùÂ≠òÂΩìÂâçÂü∫ÂùÄÊåáÈíàÔºàEBPÔºâ</span>
                mov        <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>    <span class="token comment">; Â∞ÜÊ†àÈ°∂ÊåáÈíàÔºàESPÔºâÂ§çÂà∂Âà∞Âü∫ÂùÄÊåáÈíàÔºàEBPÔºâÔºåÂª∫Á´ãÊñ∞ÁöÑÂ†ÜÊ†àÂ∏ß</span>
                and        <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span> <span class="token comment">; Á°Æ‰øùESP‰∏∫16Â≠óËäÇÂØπÈΩêÔºåÈÄöËøá‰∏éÊìç‰ΩúÂéªÊéâESPÁöÑ‰Ωé4‰Ωç</span>
                sub        <span class="token register variable">esp</span>, <span class="token number">20h</span>    <span class="token comment">; Âú®Ê†à‰∏ä‰∏∫Â±ÄÈÉ®ÂèòÈáèÂàÜÈÖçÁ©∫Èó¥ÔºåÂáèÂ∞èESP 32Â≠óËäÇ(20h)</span>

                mov        <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_4<span class="token operator">]</span>, <span class="token number">2</span> <span class="token comment">; ÂàùÂßãÂåñÂèòÈáèvar_4ÔºåÂç≥(i=2)ÔºåËøôÈáåÂ≠òÁöÑÊòØÂæ™ÁéØËµ∑ÂßãÂÄº</span>
                jmp        short loc_8048476 <span class="token comment">; Êó†Êù°‰ª∂Ë∑≥ËΩ¨Âà∞Âæ™ÁéØÊù°‰ª∂Ê£ÄÊü•Â§ÑÂºÄÂßãÂæ™ÁéØ</span>

<span class="token label function">loc_8048465:</span>                  <span class="token comment">; Âæ™ÁéØ‰ΩìÂºÄÂßã</span>
                mov        <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_4<span class="token operator">]</span> <span class="token comment">; ÊääËÆ°Êï∞Âô®(i)ÁöÑÂÄºÂä†ËΩΩÂà∞EAXÂØÑÂ≠òÂô®</span>
                mov        <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_20<span class="token operator">]</span>, <span class="token register variable">eax</span> <span class="token comment">; ÊääEAXÁöÑÂÄºÔºàÂç≥iÁöÑÂÄºÔºâÂ≠òÂÖ•var_20ÔºåÂèØËÉΩÊòØ‰∏∫Ë∞ÉÁî®ÂáÜÂ§áÂèÇÊï∞</span>
                call       printing_function <span class="token comment">; Ë∞ÉÁî®ÊâìÂç∞ÂáΩÊï∞ÔºåÂèØËÉΩÊâìÂç∞var_20‰∏≠ÁöÑÂÄº</span>
                add        <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_4<span class="token operator">]</span>, <span class="token number">1</span> <span class="token comment">; Â∞ÜËÆ°Êï∞Âô®(i)Âä†1ÔºåÂç≥i=i+1</span>

<span class="token label function">loc_8048476:</span>                  <span class="token comment">; Âæ™ÁéØÊù°‰ª∂Ê£ÄÊü•</span>
                cmp        <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_4<span class="token operator">]</span>, <span class="token number">9</span> <span class="token comment">; ÊØîËæÉËÆ°Êï∞Âô®(i)ÊòØÂê¶Â∞è‰∫éÁ≠â‰∫é9</span>
                jle        short loc_8048465 <span class="token comment">; Â¶ÇÊûúi&lt;=9ÔºåÂàôË∑≥ËΩ¨ÂõûÂæ™ÁéØ‰ΩìÁªßÁª≠ÊâßË°å</span>

                mov        <span class="token register variable">eax</span>, <span class="token number">0</span>      <span class="token comment">; ËÆæÁΩÆËøîÂõûÂÄº‰∏∫0ÔºåËøôÈáå‰Ωú‰∏∫Á®ãÂ∫èÊ≠£Â∏∏ÈÄÄÂá∫ÁöÑÊ†áÂøó</span>
                leave                   <span class="token comment">; ÊÅ¢Â§çÂÖàÂâçÁöÑÂ†ÜÊ†àÁä∂ÊÄÅÔºåÂ∞ÜESPËÆæÁΩÆÂõûEBPÁöÑÂÄºÔºåÁÑ∂ÂêéÂºπÂá∫EBP</span>
                retn                    <span class="token comment">; ËøîÂõûË∞ÉÁî®ËÄÖÔºåÁªìÊùüÁ®ãÂ∫è</span>

main            endp             <span class="token comment">; ÁªìÊùü‰∏ªÁ®ãÂ∫èËøáÁ®ãÂÆö‰πâ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p>msvsÂºÄÂêØ‰ºòÂåñ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_main    PROC
     push   <span class="token register variable">esi</span>
     mov    <span class="token register variable">esi</span>, <span class="token number">2</span>
<span class="token label function">$LL3@main:</span>
     push   <span class="token register variable">esi</span>
     call   _printing_function
     inc    <span class="token register variable">esi</span>
     add    <span class="token register variable">esp</span>, <span class="token number">4</span>
     cmp    <span class="token register variable">esi</span>, <span class="token number">10</span>     <span class="token comment">; 0000000aH</span>
     jl     SHORT <span class="token operator">$</span>LL3@main
     xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
     pop    <span class="token register variable">esi</span>
     ret    <span class="token number">0</span>
_main    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂºÄÂêØ‰ºòÂåñÂêéÔºå<code>ESI</code>ÂØÑÂ≠òÂô®Êàê‰∫ÜËÆ°Êï∞Âô®<code>i</code>ÁöÑ‰∏ìÁî®ÂØÑÂ≠òÂô®,Â§ßÂπÖÁÆÄÊ¥Å‰∫ÜÊ±áÁºñs</p>
<p><mark>ËøõË°åËøôÁßç‰ºòÂåñÁöÑÂâçÊèêÊù°‰ª∂ÊòØÔºöË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞‰∏çÂ∫îÂΩì‰øÆÊîπÂ±ÄÈÉ®ÂèòÈáè‰∏ìÁî®ÂØÑÂ≠òÂô®ÁöÑÂÄº„ÄÇÂΩìÁÑ∂ÔºåÂú®Êú¨‰æã‰∏≠ÁºñËØëÂô®ËÉΩÂ§üÂà§Êñ≠ÂáΩÊï∞printing_function ()‰∏ç‰ºö‰øÆÊîπESIÂØÑÂ≠òÂô®ÁöÑÂÄº„ÄÇÂú®ÁºñËØëÂô®ÂÜ≥ÂÆöÁªôÂ±ÄÈÉ®ÂèòÈáèÂàÜÈÖç‰∏ìÁî®ÂØÑÂ≠òÂô®ÁöÑÊó∂ÂÄôÔºåÂÆÉ‰ºöÂú®ÂáΩÊï∞Â∫èË®ÄÈÉ®ÂàÜ‰øùÂ≠òËøô‰∫õ‰∏ìÁî®ÂØÑÂ≠òÂô®ÁöÑÂàùÂßãÁä∂ÊÄÅÔºåÁÑ∂ÂêéÂú®ÂáΩÊï∞Â∞æÂ£∞ÈáåËøòÂéüËøô‰∫õÂØÑÂ≠òÂô®ÁöÑÂéüÂßãÂÄºÔºåÂõ†Ê≠§Â≠òÂú®<code>push esi</code>Âíå<code>pop esi</code>Êù•ËøòÂéüÂéüÂßãÂÄº</mark></p>
<hr />
<p><code>gcc -O3 -o 1 1,c</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">main            proc near

var_10          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">10h</span>

                push    <span class="token register variable">ebp</span>
                mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                and     <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span>
                sub     <span class="token register variable">esp</span>, <span class="token number">10h</span>
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">2</span>
                call    printing_function
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">3</span>
                call    printing_function
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">4</span>
                call    printing_function
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">5</span>
                call    printing_function
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">6</span>
                call    printing_function
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">7</span>
                call    printing_function
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">8</span>
                call    printing_function
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token number">9</span>
                call    printing_function
                xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
                leave
                retn
main            endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>Âú®ËøôÈáåÔºågccÊääÂæ™ÁéØÊåá‰ª§ÁªôÂàÜËß£‰∫Ü(Â∞±ÊòØÁªôÂ±ïÂºÄ‰∫Ü)</p>
<p>ÁºñËØëÂô®‰ºöÂØπ<mark>Ëø≠‰ª£Ê¨°Êï∞ËæÉÂ∞ëÁöÑÂæ™ÁéØËøõË°åÂæ™ÁéØÂàÜËß£</mark>ÔºàLoop unwindingÔºâÂØπÂ§ÑÁêÜ„ÄÇÂ±ïÂºÄÂæ™ÁéØ‰Ωì‰ª•Âêé‰ª£Á†ÅÁöÑÊâßË°åÊïàÁéá‰ºöÊúâÊâÄÊèêÂçáÔºå‰ΩÜÊòØ‰ºöÂ¢ûÂä†Á®ãÂ∫è‰ª£Á†ÅÁöÑ‰ΩìÁßØ„ÄÇ</p>
</li>
<li>
<p><mark>Â¶ÇÊûúËø≠‰ª£Ê¨°Êï∞Â§öÁöÑËØùÔºågccÁöÑ‰ºòÂåñ‰ª£Á†ÅÂ∞±‰∏émsvsÁõ∏Â∑ÆÊó†Âá†</mark></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">                public main
main            proc near

var_20          <span class="token operator">=</span> dword    ptr <span class="token operator">-</span><span class="token number">20h</span>

                push       <span class="token register variable">ebp</span>
                mov        <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                and        <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span>
                push       <span class="token register variable">ebx</span>
                mov        <span class="token register variable">ebx</span>, <span class="token number">2</span> <span class="token comment">; i=2</span>
                sub        <span class="token register variable">esp</span>, <span class="token number">1Ch</span>

<span class="token comment">; aligning label loc_80484D0 (loop body begin) by 16-byte border:</span>
                nop
<span class="token label function">loc_80484D0:</span>
<span class="token comment">; pass (i) as first argument to printing_function():</span>
                mov        <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_20<span class="token operator">]</span>, <span class="token register variable">ebx</span>
                add        <span class="token register variable">ebx</span>, <span class="token number">1</span> <span class="token comment">; i++</span>
                call       printing_function
                cmp        <span class="token register variable">ebx</span>, <span class="token number">64h</span> <span class="token comment">; i==100?</span>
                jnz        short loc_80484D0 <span class="token comment">; if not, continue</span>
                add        <span class="token register variable">esp</span>, <span class="token number">1Ch</span>
                xor        <span class="token register variable">eax</span>, <span class="token register variable">eax</span> <span class="token comment">; return 0</span>
                pop        <span class="token register variable">ebx</span>
                mov        <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
                pop        <span class="token register variable">ebp</span>
                retn
main            endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âå∫Âà´Âú®‰∫égccÊòØÊãøebx‰Ωú‰∏∫iÁöÑ‰∏ìÊúâÂØÑÂ≠òÂô®ÔºåÂÖ∂‰ªñ‰∏émsvsÁ±ª‰ºº</p>
</li>
</ul>
<hr />
<h4 id="ÂÜÖÂ≠òÂùóÂ§çÂà∂"><a class="markdownIt-Anchor" href="#ÂÜÖÂ≠òÂùóÂ§çÂà∂"></a> ÂÜÖÂ≠òÂùóÂ§çÂà∂</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">my_memcpy</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> dst<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">,</span> <span class="token class-name">size_t</span> cnt<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                  dst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>src<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>gcc -Os</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; RDI = ÁõÆÊ†áÂú∞ÂùÄ;dst</span>
<span class="token comment">; RSI = Ê∫êÂú∞ÂùÄ;src</span>
<span class="token comment">; RDX = ÂùóÂ§ßÂ∞è;cnt</span>

<span class="token comment">; Âú® 0 ÁöÑ‰ΩçÁΩÆÂàùÂßãÂåñËÆ°Êï∞Âô®ÔºàiÔºâ</span>
xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>   
 
<span class="token label function">.L2:</span>    
<span class="token comment">; Â¶ÇÊûúÊâÄÊúâÂ≠óËäÇÂ∑≤Â§çÂà∂ÔºåÂàôÈÄÄÂá∫Ôºö</span>
cmp     <span class="token register variable">rax</span>, <span class="token register variable">rdx</span>   <span class="token comment">; ÂØπÂØÑÂ≠òÂô®raxÂíårdxÁöÑÂÄºËøõË°åÊØîËæÉ„ÄÇ   </span>
je      .L5    <span class="token comment">; Â¶ÇÊûúËøô‰∏§‰∏™ÂÄºÁõ∏Á≠âÔºàÂç≥Â∑≤ÁªèÊã∑Ë¥ù‰∫ÜËßÑÂÆöÁöÑÂ≠óËäÇÊï∞ÔºâÔºåÂ∞±Ë∑≥ËΩ¨Âà∞.L5ÔºåÂç≥ËøîÂõûÔºàretÔºâ„ÄÇ</span>

<span class="token comment">; Âú® RSI+i Â§ÑÂä†ËΩΩÂ≠óËäÇÔºö</span>
mov     <span class="token register variable">cl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>   <span class="token comment">; Â∞ÜÂú∞ÂùÄ‰∏∫Ôºàrsi+raxÔºâÁöÑ‰∏Ä‰∏™Â≠óËäÇÂÄºÂä†ËΩΩÂà∞clÂØÑÂ≠òÂô®‰∏≠„ÄÇ</span>

<span class="token comment">; Âú® RDI+i Â§ÑÂ≠òÂÇ®Â≠óËäÇÔºö</span>
mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>, <span class="token register variable">cl</span>   <span class="token comment">; Â∞ÜclÂØÑÂ≠òÂô®ÁöÑÂÄºÂ≠òÂÇ®Âà∞Âú∞ÂùÄ‰∏∫Ôºàrdi+raxÔºâÁöÑÂÜÖÂ≠ò‰∏≠„ÄÇ</span>

inc     <span class="token register variable">rax</span>   <span class="token comment">; i++ÔºåÂ∞ÜraxÂØÑÂ≠òÂô®ÁöÑÂÄºÂ¢ûÂä†1Ôºå‰ª•‰æø‰∏ã‰∏ÄÊ¨°Â§çÂà∂‰∏ã‰∏Ä‰∏™Â≠óËäÇ„ÄÇ</span>
jmp     .L2   <span class="token comment">; Êó†Êù°‰ª∂Ë∑≥ËΩ¨Âà∞.L2ÔºåËøõË°å‰∏ã‰∏ÄËΩÆÁöÑÊØîËæÉÂíåÂ≠óËäÇÊã∑Ë¥ù„ÄÇ</span>

<span class="token label function">.L5:</span>
ret    <span class="token comment">; ÂáΩÊï∞ËøîÂõûÔºåÁªìÊùüÊã∑Ë¥ùÊìç‰Ωú„ÄÇ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ÊÄªÁªì"><a class="markdownIt-Anchor" href="#ÊÄªÁªì"></a> ÊÄªÁªì</h4>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">    MOV <span class="token operator">[</span>counter<span class="token operator">]</span>, <span class="token number">2</span> <span class="token comment">; initialization</span>
    JMP label_check
<span class="token label function">label_increment:</span>
    ADD <span class="token operator">[</span>counter<span class="token operator">]</span>, <span class="token number">1</span> <span class="token comment">; increment</span>
<span class="token label function">label_check:</span>
    CMP <span class="token operator">[</span>counter<span class="token operator">]</span>, <span class="token number">10</span>
    JGE exit
    <span class="token comment">; loop body</span>
    <span class="token comment">; do something here</span>
    <span class="token comment">; use counter variable in local stack</span>
    JMP label_increment
<span class="token label function">exit:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÁ®ãÂ∫èÂ∫îÂΩìÈ¶ñÂÖàÂà§Êñ≠Âæ™ÁéØÊù°‰ª∂ÊòØÂê¶Êª°Ë∂≥ÔºåÁÑ∂ÂêéÂÜçÊâßË°åÂæ™ÁéØ‰Ωì„ÄÇ‰ΩÜÊòØÂú®ÁºñËØëÂô®Á°ÆÂÆöÁ¨¨‰∏ÄÊ¨°Ëø≠‰ª£ËÇØÂÆö‰ºöÂèëÁîüÁöÑÊÉÖÂÜµ‰∏ãÔºåÂÆÉÂèØËÉΩ‰ºöË∞ÉÊç¢Âæ™ÁéØ‰ΩìÂíåÂà§Êñ≠ËØ≠Âè•ÁöÑÈ°∫Â∫è„ÄÇ‰∏ãÈù¢Ëøô‰∏™Á®ãÂ∫èÂ∞±ÊòØ‰∏™ÂÖ∏ÂûãÁöÑ‰æãÂ≠ê„ÄÇ</p>
<p>Êåá‰ª§Ê∏ÖÂçï14.19„ÄÄx86</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">    MOV REG, <span class="token number">2</span> <span class="token comment">; initialization</span>
<span class="token label function">body:</span>
    <span class="token comment">; loop body</span>
    <span class="token comment">; do something here</span>
    <span class="token comment">; use counter in REG, but do not modify it!</span>
    INC REG <span class="token comment">; increment</span>
    CMP REG, <span class="token number">10</span>
    JL body<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÁºñËØëÂô®‰∏ç‰ºö‰ΩøÁî®LOOPÊåá‰ª§„ÄÇÁî±LOOPÊéßÂà∂ÁöÑÂæ™ÁéØÊéßÂà∂ËØ≠Âè•ÊØîËæÉÂ∞ëËßÅ„ÄÇÂ¶ÇÊûúÊüêÊÆµ‰ª£Á†ÅÂ∏¶ÊúâLOOPÊåá‰ª§ÔºåÈÇ£‰πàÊÇ®Â∫îÂΩìËÆ§‰∏∫ËøôÊòØÊâãÂÜôÂá∫Êù•ÁöÑÊ±áÁºñÁ®ãÂ∫è„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">    <span class="token comment">; count from 10 to 1</span>
    MOV <span class="token register variable">ECX</span>, <span class="token number">10</span>
<span class="token label function">body:</span>
    <span class="token comment">; loop body</span>
    <span class="token comment">; do something here</span>
    <span class="token comment">; use counter in ECX, but do not modify it!</span>
    LOOP body<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ECX</code>‰Ωú‰∏∫countÁöÑ‰∏ìÁî®ÂØÑÂ≠òÂô®</p>
<h4 id="problem-2"><a class="markdownIt-Anchor" href="#problem-2"></a> Problem</h4>
<ol>
<li></li>
</ol>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li></li>
</ol>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">+=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap15-cËØ≠Ë®ÄÂ≠óÁ¨¶‰∏≤ÁöÑÂáΩÊï∞"><a class="markdownIt-Anchor" href="#chap15-cËØ≠Ë®ÄÂ≠óÁ¨¶‰∏≤ÁöÑÂáΩÊï∞"></a> Chap15 CËØ≠Ë®ÄÂ≠óÁ¨¶‰∏≤ÁöÑÂáΩÊï∞</h3>
<h4 id="strlen"><a class="markdownIt-Anchor" href="#strlen"></a> strlen()</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">my_strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> str<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>eos<span class="token operator">=</span>str<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>eos<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>eos<span class="token operator">-</span>str<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">my_strlen</span><span class="token punctuation">(</span><span class="token string">"hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>Non-optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_eos<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>                            <span class="token comment">; ÂÆö‰πâÂ±ÄÈÉ®ÂèòÈáèeosÁöÑÊ†àÂÅèÁßªÈáè‰∏∫-4</span>
_str<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                             <span class="token comment">; ÂÆö‰πâÂèÇÊï∞strÁöÑÊ†àÂÅèÁßªÈáè‰∏∫8</span>
_strlen PROC
    push    <span class="token register variable">ebp</span>                       <span class="token comment">; ‰øùÂ≠òÂü∫ÂùÄÊåáÈíà</span>
    mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>                  <span class="token comment">; ËÆæÁΩÆÊñ∞ÁöÑÂü∫ÂùÄÊåáÈíà</span>
    push    <span class="token register variable">ecx</span>                       <span class="token comment">; ‰øùÂ≠òecxÂØÑÂ≠òÂô®ÁöÑÂÄº</span>
    mov     <span class="token register variable">eax</span>, DWORD PTR _str<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; Â∞Ü‰º†ÂÖ•ÁöÑÂ≠óÁ¨¶‰∏≤ÊåáÈíàÂ≠òÂÇ®Âà∞eax‰∏≠</span>
    mov     DWORD PTR _eos<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span> <span class="token comment">; Â∞ÜeaxÁöÑÂÄºÔºàÂç≥Â≠óÁ¨¶‰∏≤ÊåáÈíàÔºâ‰øùÂ≠òÂà∞Â±ÄÈÉ®ÂèòÈáèeos ‰∏≠</span>
<span class="token label function">$LN2@strlen_:</span>
    mov     <span class="token register variable">ecx</span>, DWORD PTR _eos<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; Â∞ÜeosÁöÑÂÄºÂä†ËΩΩÂà∞ecx‰∏≠</span>

    <span class="token comment">; ‰ªéecxÊåáÂêëÁöÑÂú∞ÂùÄÂ§ÑÂèñ8‰ΩçÂ≠óËäÇÔºåÂπ∂Â∞ÜÂÖ∂‰Ωú‰∏∫32‰ΩçÂÄºÔºàÂ∏¶Á¨¶Âè∑Êâ©Â±ïÔºâÂä†ËΩΩÂà∞edx‰∏≠</span>
    movsx   <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span><span class="token comment">;edx=*eos</span>
    mov     <span class="token register variable">eax</span>, DWORD PTR _eos<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; Â∞ÜeosÁöÑÂÄºÂä†ËΩΩÂà∞eax‰∏≠</span>
    add     <span class="token register variable">eax</span>, <span class="token number">1</span>                    <span class="token comment">; Â∞ÜeaxËá™Â¢û1ÔºåÊåáÂêë‰∏ã‰∏Ä‰∏™Â≠óÁ¨¶</span>
    mov     DWORD PTR _eos<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span> <span class="token comment">; Â∞ÜÊõ¥Êñ∞ÂêéÁöÑeaxÂÄº‰øùÂ≠òÂõûeos‰∏≠</span>
    test    <span class="token register variable">edx</span>, <span class="token register variable">edx</span>                  <span class="token comment">; ÊµãËØïedxÂØÑÂ≠òÂô®ÔºàÂç≥ÂΩìÂâçÂ≠óÁ¨¶ÊòØÂê¶‰∏∫0Ôºâ</span>
    je      SHORT <span class="token operator">$</span>LN1@strlen_        <span class="token comment">; Â¶ÇÊûúedx‰∏∫0ÔºåË∑≥ËΩ¨Âà∞$LN1@strlen_ÔºåÁªìÊùüÂæ™ÁéØ</span>
    jmp     SHORT <span class="token operator">$</span>LN2@strlen_        <span class="token comment">; Âê¶ÂàôÔºåÁªßÁª≠Âæ™ÁéØ</span>

<span class="token label function">$LN1@strlen_:</span>
    <span class="token comment">; ËÆ°ÁÆó‰∏§‰∏™ÊåáÈíà‰πãÈó¥ÁöÑÂ∑ÆÂÄº</span>

    mov    <span class="token register variable">eax</span>, DWORD PTR _eos<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>  <span class="token comment">; Â∞ÜeosÁöÑÂÄºÂä†ËΩΩÂà∞eax‰∏≠</span>
    sub    <span class="token register variable">eax</span>, DWORD PTR _str<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>  <span class="token comment">; Áî®eosÂáèÂéªÂéüÂßãÂ≠óÁ¨¶‰∏≤ÊåáÈíà</span>
    sub    <span class="token register variable">eax</span>, <span class="token number">1</span>                     <span class="token comment">; ÂáèÂéª1ÔºåÂæóÂà∞Â≠óÁ¨¶‰∏≤ÈïøÂ∫¶Ôºà‰∏çÂåÖÊã¨ÁªìÂ∞æÁöÑÁ©∫Â≠óÁ¨¶Ôºâ</span>
    mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>                   <span class="token comment">; ÊÅ¢Â§çÊ†àÊåáÈíà</span>
    pop    <span class="token register variable">ebp</span>                        <span class="token comment">; ÊÅ¢Â§çÂü∫ÂùÄÊåáÈíà</span>
    ret    <span class="token number">0</span>                          <span class="token comment">; ËøîÂõûÁªìÊûúÔºàeax‰∏≠‰øùÂ≠òÁùÄÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶Ôºâ</span>
_strlen ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>MOVSX</code>,Âç≥<code>MOV with Sign Extend</code>,‰ªéÂÜÖÂ≠ò‰∏≠ËØªÂèñ8‰ΩçÊï∞ÊçÆÔºåÂπ∂Â≠òÂÇ®Âà∞32‰ΩçÂØÑÂ≠òÂô®Èáå</p>
<p>Êú¨‰æã‰∏≠ÔºåMOVSXÂ∞ÜÁî®ÂéüÂßãÊï∞ÊçÆÁöÑ8‰ΩçÊï∞ÊçÆÂ°´ÂÖÖEDXÂØÑÂ≠òÂô®ÁöÑ‰Ωé8‰ΩçÔºõ<mark>Â¶ÇÊûúÂéüÂßãÊï∞ÊçÆÊòØË¥üÊï∞ÔºåËØ•Êåá‰ª§Â∞Ü‰ΩøÁî®1Â°´ÂÖÖÁ¨¨8Âà∞Á¨¨31‰ΩçÔºàÈ´ò24‰ΩçÔºâÔºåÂê¶Âàô‰ΩøÁî®0Â°´ÂÖÖÈ´ò24‰Ωç</mark>„ÄÇ</p>
<p>ËøôÊòØ‰∏∫‰∫Ü‰øùËØÅÊúâÁ¨¶Âè∑ÂûãÊï∞ÊçÆÂú®Á±ªÂûãËΩ¨Êç¢ÂêéÁöÑÊï∞ÂÄº‰øùÊåÅ‰∏çÂèò„ÄÇ</p>
<p>‰∏æ‰∫Ü‰∏™‰æãÂ≠ê</p>
<p>ÂÅáÂ¶ÇcharÂûãÊï∞ÊçÆÁöÑÂéüÂßãÂÄºÊòØ‚àí2Ôºà0xFEÔºâÔºåÁõ¥Êé•ÊääÊï¥‰∏™Â≠óËäÇÂ§çÂà∂Âà∞intÂûãÊï∞ÊçÆÁöÑÊúÄ‰Ωé8‰Ωç‰∏äÊó∂ÔºåintÂûãÊï∞ÊçÆÁöÑÂÄºÂ∞±ÂèòÊàê0x000000FEÔºå‰ª•ÊúâÁ¨¶Âè∑ÂûãÊï∞ÊçÆÁöÑËßíÂ∫¶ÁúãÂÆÉË¢´ËΩ¨Êç¢‰∏∫254‰∫ÜÔºåËÄåÊ≤°Êúâ‰øùÊåÅÂéüÂßãÂÄº‚àí2„ÄÇ‚àí2ÂØπÂ∫îÁöÑintÂûãÊï∞ÊçÆÊòØ0xFFFFFFFE„ÄÇÊâÄ‰ª•ÔºåÂú®ÊääÂéüÂßãÊï∞ÊçÆÂ§çÂà∂Âà∞ÁõÆÊ†áÂèòÈáè‰πãÂêéÔºåËøòË¶Å‰ΩøÁî®Á¨¶Âè∑Ê†áÂøó‰ΩçÂ°´ÂÖÖÂâ©‰ΩôÁöÑÊï∞ÊçÆÔºåËÄåËøôÂ∞±ÊòØMOVSXÁöÑÂäüËÉΩ„ÄÇ</p>
</li>
</ul>
<hr />
<p><code>Non-optimizing GCC</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">				public strlen               <span class="token comment">; ÂÖ¨ÂÖ±Ê†áÂøóÔºå‰ΩøÂæóÂÖ∂‰ªñÊ®°ÂùóÂèØ‰ª•Ë∞ÉÁî®ËØ•ÂáΩÊï∞</span>
strlen           proc near                   <span class="token comment">; Â£∞Êòé‰∏Ä‰∏™nearËøáÁ®ãÔºåÂëΩÂêç‰∏∫strlen</span>

eos              <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">4</span>               <span class="token comment">; ÂÆö‰πâÂ±ÄÈÉ®ÂèòÈáèeosÁöÑÊ†àÂÅèÁßªÈáè‰∏∫-4</span>
arg_0            <span class="token operator">=</span> dword ptr  <span class="token number">8</span>               <span class="token comment">; ÂÆö‰πâÂèÇÊï∞arg_0ÔºàÂ≠óÁ¨¶‰∏≤ÊåáÈíàÔºâÁöÑÊ†àÂÅèÁßªÈáè‰∏∫8</span>

                 push    <span class="token register variable">ebp</span>                  <span class="token comment">; ‰øùÂ≠òÂü∫ÂùÄÊåáÈíà</span>
                 mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>             <span class="token comment">; ËÆæÁΩÆÊñ∞ÁöÑÂü∫ÂùÄÊåáÈíà</span>
                 sub     <span class="token register variable">esp</span>, <span class="token number">10h</span>             <span class="token comment">; ‰∏∫Â±ÄÈÉ®ÂèòÈáèÂàÜÈÖç16Â≠óËäÇÁöÑÊ†àÁ©∫Èó¥</span>
                 mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>     <span class="token comment">; Â∞Ü‰º†ÂÖ•ÁöÑÂ≠óÁ¨¶‰∏≤ÊåáÈíàÂä†ËΩΩÂà∞eax‰∏≠</span>
                 mov     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>eos<span class="token operator">]</span>, <span class="token register variable">eax</span>       <span class="token comment">; Â∞ÜeaxÁöÑÂÄºÔºàÂç≥Â≠óÁ¨¶‰∏≤ÊåáÈíàÔºâ‰øùÂ≠òÂà∞Â±ÄÈÉ®ÂèòÈáèeos‰∏≠</span>
<span class="token label function">loc_80483F0:</span>
                 mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>eos<span class="token operator">]</span>       <span class="token comment">; Â∞ÜeosÁöÑÂÄºÂä†ËΩΩÂà∞eax‰∏≠</span>
                 movzx   <span class="token register variable">eax</span>, byte ptr <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>  <span class="token comment">; ‰ªéeaxÊåáÂêëÁöÑÂú∞ÂùÄÂ§ÑÂä†ËΩΩ‰∏Ä‰∏™Â≠óËäÇÔºåÂπ∂Èõ∂Êâ©Â±ï‰∏∫32‰Ωç</span>
                 test    <span class="token register variable">al</span>, <span class="token register variable">al</span>               <span class="token comment">; ÊµãËØïalÂØÑÂ≠òÂô®ÁöÑÂÄºÔºàÂç≥ÂΩìÂâçÂ≠óÁ¨¶ÊòØÂê¶‰∏∫0Ôºâ</span>
                 setnz   <span class="token register variable">al</span>                   <span class="token comment">; Â¶ÇÊûúal‰∏ç‰∏∫Èõ∂Ôºåal = 1ÔºõÂê¶ÂàôÔºåal = 0</span>
                 add     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>eos<span class="token operator">]</span>, <span class="token number">1</span>         <span class="token comment">; Â∞ÜeosËá™Â¢û1ÔºåÊåáÂêë‰∏ã‰∏Ä‰∏™Â≠óÁ¨¶</span>
                 test    <span class="token register variable">al</span>, <span class="token register variable">al</span>               <span class="token comment">; ÊµãËØïalÂØÑÂ≠òÂô®ÁöÑÂÄºÔºàÂç≥ÂΩìÂâçÂ≠óÁ¨¶ÊòØÂê¶‰∏∫Èõ∂Ôºâ</span>
                 jnz     short loc_80483F0    <span class="token comment">; Â¶ÇÊûúal‰∏ç‰∏∫Èõ∂ÔºåË∑≥ËΩ¨Âà∞loc_80483F0ÔºåÁªßÁª≠Âæ™ÁéØ</span>

                 <span class="token comment">; Âæ™ÁéØÁªìÊùüÔºàÂΩìÂâçÂ≠óÁ¨¶‰∏∫0ÔºâÔºåËÆ°ÁÆóÂ≠óÁ¨¶‰∏≤ÁöÑÈïøÂ∫¶</span>
                 mov     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>eos<span class="token operator">]</span>       <span class="token comment">; Â∞ÜeosÁöÑÂÄºÂä†ËΩΩÂà∞edx‰∏≠</span>
                 mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>     <span class="token comment">; Â∞Ü‰º†ÂÖ•ÁöÑÂ≠óÁ¨¶‰∏≤ÊåáÈíàÂä†ËΩΩÂà∞eax‰∏≠</span>
                 mov     <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>             <span class="token comment">; Â∞ÜedxÁöÑÂÄºÂä†ËΩΩÂà∞ecx‰∏≠</span>
                 sub     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span>             <span class="token comment">; ecx = edx - eaxÔºåËÆ°ÁÆóeos‰∏éÂ≠óÁ¨¶‰∏≤Ëµ∑ÂßãÂú∞ÂùÄÁöÑÂ∑ÆÂÄº</span>
                 mov     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>             <span class="token comment">; Â∞ÜecxÁöÑÂÄºÂä†ËΩΩÂà∞eax‰∏≠</span>
                 sub     <span class="token register variable">eax</span>, <span class="token number">1</span>               <span class="token comment">; eaxÂáèÂéª1ÔºåÂæóÂà∞Â≠óÁ¨¶‰∏≤ÁöÑÂÆûÈôÖÈïøÂ∫¶Ôºà‰∏çÂåÖÊã¨ÁªìÂ∞æÁöÑÁ©∫Â≠óÁ¨¶Ôºâ</span>
                 leave                        <span class="token comment">; ÊÅ¢Â§çÊ†àÊåáÈíàÂíåÂü∫ÂùÄÊåáÈíà</span>
                 retn                         <span class="token comment">; ËøîÂõûÁªìÊûúÔºàeax‰∏≠‰øùÂ≠òÁùÄÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶Ôºâ</span>
strlen           endp                        <span class="token comment">; ËøáÁ®ãÁªìÊùü</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ËøôÈáå<code>sub esp,10h</code>,<code>eos</code>Âè™ÈúÄË¶Å4‰∏™Â≠óËäÇÔºå‰ΩÜÊòØ‰∏∫‰∫ÜÊª°Ë∂≥ÂØπÈΩêË¶ÅÊ±ÇÂàÜÈÖç‰∫ÜÈ¢ùÂ§ñÁöÑ12‰∏™Â≠óËäÇ</p>
</li>
<li>
<p><code>MOVZX</code>ÊòØ<code>MOV with Zero-Extent</code>ÁöÑÁº©ÂÜô,Â∞Ü8‰ΩçÊàñ16‰ΩçÊï∞ÊçÆËΩ¨Êç¢‰∏∫32‰ΩçÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÂÆÉÁõ¥Êé•Â§çÂà∂ÂéüÂßãÊï∞ÊçÆÂà∞ÁõÆÊ†áÂØÑÂ≠òÂô®ÁöÑÁõ∏Â∫î‰Ωé‰ΩçÔºåÂπ∂‰∏î‰ΩøÁî®0Â°´ÂÖÖÂâ©‰ΩôÁöÑÈ´ò‰Ωç„ÄÇ</p>
<p>==Áõ∏ÂΩì‰∫é‰∏ÄÊ≠•ÂÆåÊàê‰∫Ü‚Äúxor eax, eax‚ÄùÂíå‚Äúmov alÔºå[Ê∫ê8/16‰ΩçÊï∞ÊçÆ]‚Äù2Êù°Êåá‰ª§</p>
</li>
<li>
<p><code>SETNZ</code>Êåá‰ª§:Â¶ÇÊûúALÁöÑÂÄº‰∏çÊòØ0ÔºåÂàô‚Äútest al, al‚ÄùÊåá‰ª§‰ºöËÆæÁΩÆÊ†áÂøóÂØÑÂ≠òÂô®ZF=0ÔºõËÄåSETNZÔºàNot ZeroÔºâÊåá‰ª§‰ºöÂú®ZFÔºù0ÁöÑÊó∂ÂÄôÔºåËÆæÁΩÆALÔºù1„ÄÇÁî®ÁôΩËØùËß£ËØ¥ÔºåÂ∞±ÊòØÔºö<mark>Â¶ÇÊûúAL‰∏çÁ≠â‰∫é0ÔºåÂàôË∑≥Âà∞loc_80483F0Â§Ñ</mark>„ÄÇÁºñËØëÂô®ËΩ¨ËØëÂá∫Êù•ÁöÑ‰ª£Á†Å‰∏≠ÔºåÊúâ‰∫õ‰ª£Á†ÅÁ°ÆÂÆûÊ≤°ÊúâÂÆûÈôÖÊÑè‰πâ</p>
</li>
</ul>
<hr />
<p><code>Optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_str<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                                     <span class="token comment">; size = 4</span>
_strlen PROC
        mov     <span class="token register variable">edx</span>, DWORD PTR _str<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>   <span class="token comment">;Áî®EDX‰ΩúÂ≠óÁ¨¶‰∏≤ÊåáÈíà</span>
        mov     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>                      <span class="token comment">;  Â§çÂà∂Âà∞ EAX</span>

<span class="token label function">$LL2@strlen:</span>
        mov     <span class="token register variable">cl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>            <span class="token comment">; CL = *EAX</span>
        inc     <span class="token register variable">eax</span>                           <span class="token comment">; EAX++</span>
        test    <span class="token register variable">cl</span>, <span class="token register variable">cl</span>                        <span class="token comment">; CL==0?</span>
        jne     SHORT <span class="token operator">$</span>LL2@strlen             <span class="token comment">; no, continue loop</span>
        sub     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>                      <span class="token comment">; ËÆ°ÁÆóÊåáÈíàÁöÑÂèòÂåñÈáè</span>
        dec     <span class="token register variable">eax</span>                           <span class="token comment">; decrement EAX</span>
        ret     <span class="token number">0</span>
_strlen ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>Optimizing GCC</code> <code>-O3</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">                public strlen
strlen          proc near

arg_0           <span class="token operator">=</span> dword ptr  <span class="token number">8</span>

                push    <span class="token register variable">ebp</span>
                mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                mov     <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span><span class="token comment">;ecx=arg_0;</span>
                mov     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span><span class="token comment">;eax=arg_0</span>

<span class="token label function">loc_8048418:</span>
                movzx   <span class="token register variable">edx</span>, byte ptr <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span><span class="token comment">;edx=*eop</span>
                add     <span class="token register variable">eax</span>, <span class="token number">1</span><span class="token comment">;eop++</span>
                test    <span class="token register variable">dl</span>, <span class="token register variable">dl</span><span class="token comment">;if dl ==0?</span>
                jnz     short loc_8048418<span class="token comment">;dl !=0,loop</span>
                not     <span class="token register variable">ecx</span>
                add     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
                pop     <span class="token register variable">ebp</span>
                retn
strlen          endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>movzx</code>ÊõøÊç¢‰∏∫<code>mov dl byte ptr[eax]</code>‰πüÂèØÔºå‰ΩøÁî®<code>movzx</code>ÊàñËÆ∏ÊòØ‰∏∫‰∫Ü‰øùËØÅÂØÑÂ≠òÂô®ÁöÑÈ´òÂú∞ÂùÄ‰Ωç‰∏çÂê´ÊúâÂô™Èü≥Êï∞ÊçÆ</p>
</li>
<li>
<p><mark><code>NOT</code>ÔºåNOTÊåá‰ª§ÂØπÊìç‰ΩúÊï∞ÁöÑÊâÄÊúâbitÈÉΩËøõË°åÈùûËøêÁÆóÔºåÁ≠â‰ª∑‰∫é<code>XOR ECX,0xfffffffh</code>,<code>not ecx</code>ÁöÑÁªìÊûú‰∏éÊüêÊï∞Áõ∏Âä†,Áõ∏ÂΩì‰∫éÊüêÊï∞ÂáèÂéª<code>ECX</code>ÁÑ∂ÂêéÂÜçÂáè<code>1</code></mark></p>
<p>‰ªéËÄåÂæóÂà∞Ê≠£Á°ÆÁöÑÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶</p>
<p><code>not ecx</code>Áõ∏ÂΩì‰∫é<code>ecx=(-ecx)-1</code>ÔºåÁî±‰ΩçËøêÁÆóÂèØ‰ª•Êé®ÂØº</p>
</li>
</ul>
<hr />
<p>Problems:</p>
<ol>
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_s<span class="token operator">$</span>   <span class="token operator">=</span>  <span class="token number">8</span>
_f    PROC
           mov  <span class="token register variable">edx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;edx=_s</span>
           mov  <span class="token register variable">cl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">]</span><span class="token comment">;cl=*_s=8</span>
           xor  <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
           test <span class="token register variable">cl</span>, <span class="token register variable">cl</span>
           je   SHORT <span class="token operator">$</span>LN2@f<span class="token comment">;if cl==0,exit</span>
           npad <span class="token number">4</span>    <span class="token comment">; align next label</span>
<span class="token label function">$LL4@f:</span>
           cmp  <span class="token register variable">cl</span>, <span class="token number">32</span><span class="token comment">;</span>
           jne  SHORT <span class="token operator">$</span>LN3@f<span class="token comment">;if cl!=32,jmp LN3</span>
           inc  <span class="token register variable">eax</span><span class="token comment">;eax++</span>
<span class="token label function">$LN3@f:</span>
           mov  <span class="token register variable">cl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span><span class="token comment">;cl=*(_s+1)</span>
           inc  <span class="token register variable">edx</span><span class="token comment">;eax++</span>
           test <span class="token register variable">cl</span>, <span class="token register variable">cl</span>
           jne  SHORT <span class="token operator">$</span>LL4@f<span class="token comment">;if cl!=0;jmp LL4</span>
<span class="token label function">$LN2@f:</span>
           ret  <span class="token number">0</span>
_f         ENDP
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>_s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>_s<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>_s<span class="token operator">==</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//' 'Áõ∏ÂΩì‰∫éÁªüËÆ°Â≠óÁ¨¶‰∏≤ÁöÑÁ©∫Ê†ºÊï∞</span>
        <span class="token punctuation">&#123;</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">.LFB24:</span>
        push      <span class="token register variable">ebx</span>                    <span class="token comment">; ‰øùÂ≠ò ebx ÂØÑÂ≠òÂô®ÁöÑÂÄº</span>
        mov       <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span> <span class="token comment">; Â∞ÜÂèÇÊï∞(ÂÅáËÆæÊòØÂ≠óÁ¨¶‰∏≤ÊåáÈíà)‰º†ÈÄíÁªô ecx</span>
        xor       <span class="token register variable">eax</span>, <span class="token register variable">eax</span>               <span class="token comment">; Â∞Ü eax ÂØÑÂ≠òÂô®Ê∏ÖÈõ∂ (ËÆ°Êï∞Âô®)</span>
        movzx     <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>    <span class="token comment">; Â∞ÜÂ≠óÁ¨¶‰∏≤ÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶Âä†ËΩΩÂà∞ edx</span>
        test      <span class="token register variable">dl</span>, <span class="token register variable">dl</span>                 <span class="token comment">; ÊµãËØïËØ•Â≠óÁ¨¶ÊòØÂê¶‰∏∫ null (Â≠óÁ¨¶‰∏≤ÁªìÂ∞æ)</span>
        je        .L2                    <span class="token comment">; Â¶ÇÊûúÊòØ null, Ë∑≥ËΩ¨Âà∞ .L2 ÁªìÊùü</span>
<span class="token label function">.L3:</span>
        cmp       <span class="token register variable">dl</span>, <span class="token number">32</span>                 <span class="token comment">; ÊØîËæÉËØ•Â≠óÁ¨¶‰∏éÁ©∫Ê†º (ASCII 32)</span>
        lea       <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>           <span class="token comment">; ËÆ°ÁÆóÂΩìÂâçËÆ°Êï∞Âô®ÂÄºÂä†1ÁöÑÂú∞ÂùÄ</span>
        cmove     <span class="token register variable">eax</span>, <span class="token register variable">ebx</span>               <span class="token comment">; Â¶ÇÊûúÂ≠óÁ¨¶ÊòØÁ©∫Ê†ºÔºåeax = ebx (Âç≥eaxÂä†1)</span>
        add       <span class="token register variable">ecx</span>, <span class="token number">1</span>                 <span class="token comment">; Â∞Ü ecx ÊåáÈíàÂâçÁßª‰∏Ä‰∏™Â≠óÁ¨¶</span>
        movzx     <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>    <span class="token comment">; Â∞Ü‰∏ã‰∏Ä‰∏™Â≠óÁ¨¶Âä†ËΩΩÂà∞ edx</span>
        test      <span class="token register variable">dl</span>, <span class="token register variable">dl</span>                 <span class="token comment">; ÊµãËØïËØ•Â≠óÁ¨¶ÊòØÂê¶‰∏∫ null</span>
        jne       .L3                    <span class="token comment">; Â¶ÇÊûú‰∏çÊòØ null, Ë∑≥ËΩ¨Âà∞ .L3 ÁªßÁª≠Â§ÑÁêÜ</span>
<span class="token label function">.L2:</span>
        pop       <span class="token register variable">ebx</span>                    <span class="token comment">; ÊÅ¢Â§ç ebx ÂØÑÂ≠òÂô®ÁöÑÂÄº</span>
        ret                              <span class="token comment">; ËøîÂõû</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>cmove</code> Êåá‰ª§ÊòØ x86 Ê±áÁºñ‰∏≠ÁöÑÊù°‰ª∂ÁßªÂä®Êåá‰ª§‰πã‰∏ÄÔºåÂÆÉÁöÑÂÖ®ÂêçÊòØ<code>conditional move if equal</code>„ÄÇËøôÊÑèÂë≥ÁùÄÂΩìÊª°Ë∂≥ÁªôÂÆöÊù°‰ª∂Êó∂Ôºå‰ªéÊ∫êÊìç‰ΩúÊï∞ÁßªÂä®Âà∞ÁõÆÊ†áÊìç‰ΩúÊï∞ÔºåËÄåÂ¶ÇÊûúÊù°‰ª∂‰∏çÊàêÁ´ãÔºåÂàô‰∏çËøõË°åÁßªÂä®.Â¶ÇÊûúÊØîËæÉÁªìÊûúÊòØÁõ∏Á≠âÔºàÂç≥ÂΩìÂâçÂ≠óÁ¨¶ÊòØÁ©∫Ê†ºÔºâ<code>eax=ebx=eax+1</code></li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> temp<span class="token operator">=</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token operator">==</span><span class="token number">32</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            count<span class="token operator">=</span>temp<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ëøõ‰∏ÄÊ≠•ÁÆÄÂåñ‰ª£Á†ÅÂ∞±ÊòØËÆ°Êï∞ÊâÄÊúâÁ©∫Ê†ºÂ≠óÁ¨¶</p>
<h3 id="chap16-Êï∞Â≠¶ËÆ°ÁÆóÊåá‰ª§ÁöÑÊõøÊç¢"><a class="markdownIt-Anchor" href="#chap16-Êï∞Â≠¶ËÆ°ÁÆóÊåá‰ª§ÁöÑÊõøÊç¢"></a> Chap16 Êï∞Â≠¶ËÆ°ÁÆóÊåá‰ª§ÁöÑÊõøÊç¢</h3>
<p><code>Âá∫‰∫éÊÄßËÉΩ‰ºòÂåñÁöÑËÄÉËôëÔºåÁºñËØëÂô®ÂèØËÉΩ‰ºöÂ∞Ü1Êù°Êï∞Â≠¶ËøêÁÆóÊåá‰ª§ÊõøÊç¢‰∏∫ÂÖ∂‰ªñÁöÑ1Êù°„ÄÅÁîöËá≥ÊòØ‰∏ÄÁªÑÁ≠âÊïàÊåá‰ª§„ÄÇ</code>‰æãÂ¶Ç<code>LEA</code>Êåá‰ª§ÈÄöÂ∏∏Êõø‰ª£ÂÖ∂‰ªñÁÆÄÂçïËÆ°ÁÆóÊåá‰ª§Ôºå<code>ADD</code>‰∏é<code>SUB</code>ÂêåÊ†∑ÂèØ‰ª•Áõ∏‰∫íÊõøÊç¢</p>
<h4 id="‰πòÊ≥ï"><a class="markdownIt-Anchor" href="#‰πòÊ≥ï"></a> ‰πòÊ≥ï</h4>
<h5 id="ÊõøÊç¢‰∏∫Âä†Ê≥ïËøêÁÆó"><a class="markdownIt-Anchor" href="#ÊõøÊç¢‰∏∫Âä†Ê≥ïËøêÁÆó"></a> ÊõøÊç¢‰∏∫Âä†Ê≥ïËøêÁÆó</h5>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰ΩøÁî®MSVC 2010ÔºàÂêØÁî®/OxÔºâËøõË°åÁºñËØëÔºåÁºñËØëÂô®‰ºöÊää‚Äú‰πò‰ª•8‚ÄùÁöÑËøêÁÆóÊåá‰ª§ÊãÜËß£‰∏∫3Êù°Âä†Ê≥ïÊåá‰ª§„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
add     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
add     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
add     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
ret     <span class="token number">0</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="ÊõøÊç¢‰∏∫Áßª‰ΩçËøêÁÆó"><a class="markdownIt-Anchor" href="#ÊõøÊç¢‰∏∫Áßª‰ΩçËøêÁÆó"></a> ÊõøÊç¢‰∏∫Áßª‰ΩçËøêÁÆó</h5>
<p>ÁºñËØëÂô®ÈÄöÂ∏∏‰ºöÊää‚Äú‰πò‰ª•2‚Äù‚ÄúÈô§‰ª•2‚ÄùÁöÑËøêÁÆóÊåá‰ª§Â§ÑÁêÜ‰∏∫‰ΩçÁßªËøêÁÆóÊåá‰ª§</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>          <span class="token comment">; size = 4</span>
_f       PROC
         push    <span class="token register variable">ebp</span>
         mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
         mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
         shl     <span class="token register variable">eax</span>, <span class="token number">2</span><span class="token comment">;shift left</span>
         pop     <span class="token register variable">ebp</span>
         ret     <span class="token number">0</span>
_f       ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="ÊõøÊç¢‰∏∫Áßª‰ΩçÂä†ÂáèÊ≥ïÁöÑÊ∑∑ÂêàËøêÁÆó"><a class="markdownIt-Anchor" href="#ÊõøÊç¢‰∏∫Áßª‰ΩçÂä†ÂáèÊ≥ïÁöÑÊ∑∑ÂêàËøêÁÆó"></a> ÊõøÊç¢‰∏∫Áßª‰Ωç,Âä†ÂáèÊ≥ïÁöÑÊ∑∑ÂêàËøêÁÆó</h5>
<p>Âç≥‰Ωø‰πòÊï∞ÊòØ7Êàñ17Ôºå‰πòÊ≥ïËøêÁÆó‰ªçÁÑ∂ÂèØ‰ª•Áî®Èùû‰πòÊ≥ïËøêÁÆóÊåá‰ª§ÈÖçÂêà‰ΩçÁßªÊåá‰ª§ÂÆûÁé∞„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token keyword">int</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">*</span><span class="token number">28</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">*</span><span class="token number">17</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; a*7</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_f1      PROC
         mov     <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; ECX=a</span>
         lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>
<span class="token comment">; EAX=ECX*8</span>
         sub     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
<span class="token comment">; EAX=EAX-ECX=ECX*8-ECX=ECX*7=a*7</span>
         ret     <span class="token number">0</span> 
_f1     ENDP

<span class="token comment">; a*28</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_f2     PROC
         mov     <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; ECX=a</span>
         lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>
<span class="token comment">; EAX=ECX*8</span>
         sub     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
<span class="token comment">; EAX=EAX-ECX=ECX*8-ECX=ECX*7=a*7</span>
         shl     <span class="token register variable">eax</span>, <span class="token number">2</span>
<span class="token comment">; EAX=EAX&lt;&lt;2=(a*7)*4=a*28</span>
         ret     <span class="token number">0</span> 
_f2     ENDP

<span class="token comment">; a*17</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_f3     PROC
         mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; EAX=a</span>
         shl     <span class="token register variable">eax</span>, <span class="token number">4</span>
<span class="token comment">; EAX=EAX&lt;&lt;4=EAX*16=a*16</span>
         add     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; EAX=EAX+a=a*16+a=a*17</span>
         ret     <span class="token number">0</span>
_f3     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Èô§Ê≥ïËøêÁÆó"><a class="markdownIt-Anchor" href="#Èô§Ê≥ïËøêÁÆó"></a> Èô§Ê≥ïËøêÁÆó</h4>
<h5 id="ÊõøÊç¢‰∏∫‰ΩçÁßªËøêÁÆó"><a class="markdownIt-Anchor" href="#ÊõøÊç¢‰∏∫‰ΩçÁßªËøêÁÆó"></a> ÊõøÊç¢‰∏∫‰ΩçÁßªËøêÁÆó</h5>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
       <span class="token keyword">return</span> a<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>shr eax,2</code></p>
<h4 id="problem-3"><a class="markdownIt-Anchor" href="#problem-3"></a> Problem</h4>
<ol>
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_f      PROC
        mov     <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;ecx=a</span>
        lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span><span class="token comment">;eax=a*8</span>
        sub     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span><span class="token comment">;eax=eax-a=7a</span>
        ret     <span class="token number">0</span>
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap17-fpu"><a class="markdownIt-Anchor" href="#chap17-fpu"></a> Chap17 FPU</h3>
<ul>
<li>
<p><code>FPUÊòØ‰∏ìÈó®Â§ÑÁêÜÊµÆÁÇπÊï∞ÁöÑËøêÁÆóÂçïÂÖÉÔºåÊòØCPUÁöÑ‰∏Ä‰∏™ÁªÑ‰ª∂„ÄÇ</code></p>
</li>
<li>
<p><code>IEEE 754 </code>Ê†áÂáÜËßÑÂÆö‰∫ÜËÆ°ÁÆóÊú∫Á®ãÂ∫èËÆæËÆ°ÁéØÂ¢É‰∏≠ÁöÑ‰∫åËøõÂà∂ÂíåÂçÅËøõÂà∂ÁöÑÊµÆÁÇπÊï∞ÁöÑ‰∫§Êç¢„ÄÅÁÆóÊúØÊ†ºÂºè‰ª•ÂèäÊñπÊ≥ï„ÄÇÁ¨¶ÂêàËøôÁßçÊ†áÂáÜÁöÑÊµÆÁÇπÊï∞Áî±Á¨¶Âè∑‰Ωç„ÄÅÂ∞æÊï∞ÔºàÂèàÁß∞‰∏∫ÊúâÊïàÊï∞Â≠ó„ÄÅÂ∞èÊï∞‰ΩçÔºâÂíåÊåáÊï∞‰ΩçÊûÑÊàê„ÄÇ</p>
</li>
<li>
<p>Âú®80486Â§ÑÁêÜÂô®ÈóÆ‰∏ñ‰πãÂâçÔºåFPUÔºà‰∏éCPU‰Ωç‰∫é‰∏çÂêåÁöÑËäØÁâáÔºâÂè´‰ΩúÂçè‰ΩúÔºàËæÖÂä©ÔºâÂ§ÑÁêÜÂô®„ÄÇËÄå‰∏îÈÇ£‰∏™Êó∂ÂÄôÁöÑFPUËøò‰∏çÂ±û‰∫é‰∏ªÊùøÁöÑÊ†áÂáÜÈÖçÁΩÆÔºõÂ¶ÇÊûúÊÉ≥Ë¶ÅÂú®‰∏ªÊùø‰∏äÂÆâË£ÖFPUÔºå‰∫∫‰ª¨ËøòÂæóÂçïÁã¨Ë¥≠‰π∞ÂÆÉ„ÄÇ</p>
<p>80486 DX‰πãÂêéÁöÑCPUÂ§ÑÁêÜÂô®ÈõÜÊàê‰∫ÜFPUÁöÑÂäüËÉΩ„ÄÇ</p>
<p>Ëã•Ê≤°ÊúâFWAITÊåá‰ª§Âíåopcode‰ª•D8ÔΩûDFÂºÄÂ§¥ÁöÑÊâÄË∞ìÁöÑ‚ÄúESC‚ÄùÂ≠óÁ¨¶Êåá‰ª§Ôºàopcode‰ª•D8ÔΩûDFÂºÄÂ§¥ÔºâÔºåÊÅêÊÄïÂæàÂ∞ëÊúâ‰∫∫Ëøò‰ºöÊÉ≥Ëµ∑FPUÂ±û‰∫éÁã¨Á´ãËøêÁÆóÂçïÂÖÉÁöÑËøôÊÆµÂéÜÂè≤„ÄÇFWAITÊåá‰ª§ÁöÑ‰ΩúÁî®ÊòØËÆ©CPUÁ≠âÂæÖFPUËøêÁÆóÁªìÊùüÔºåËÄåESCÂ≠óÁ¨¶Êåá‰ª§ÈÉΩÂú®FPU‰∏äÊâßË°å„ÄÇ</p>
<p>FPUËá™Â∏¶‰∏Ä‰∏™Áî±<code>8‰∏™80‰ΩçÂØÑÂ≠òÂô®ÊûÑÊàêÁöÑÂæ™ÁéØÊ†à</code>„ÄÇËøô‰∫õ80‰ΩçÂØÑÂ≠òÂô®Áî®‰ª•Â≠òÂÇ®IEEE 754Ê†ºÂºèÁöÑÊµÆÁÇπÊï∞ÊçÆÔºåÈÄöÂ∏∏Âè´‰Ωú<code>ST(0)ÔΩûST(7)ÂØÑÂ≠òÂô®</code>„ÄÇIDAÂíåOllyDbgÈÉΩÊääST(0)ÊòæÁ§∫‰∏∫ST„ÄÇ‰πüÊúâ‰∏çÂ∞ëÊïôÁßë‰π¶ÊääST(0)Âè´‰Ωú‚ÄúÊ†àÈ°∂/Stack Top‚ÄùÂØÑÂ≠òÂô®„ÄÇ</p>
</li>
</ul>
<hr />
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">double</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> a<span class="token operator">/</span><span class="token number">3.14</span> <span class="token operator">+</span> b<span class="token operator">*</span><span class="token number">4.1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">CONST    SEGMENT
__real@<span class="token number">4010666666666666</span> DQ 04010666666666666r <span class="token comment">; 4.1    ; ÂÆö‰πâÂ∏∏Èáè4.1ÔºåÂ≠òÂÇ®Âú®ÊÆµ`CONST`‰∏≠</span>
CONST    ENDS
CONST    SEGMENT
__real@40091eb851eb851f DQ 040091eb851eb851fr <span class="token comment">; 3.14   ; ÂÆö‰πâÂ∏∏Èáè3.14ÔºåÂ≠òÂÇ®Âú®ÊÆµ`CONST`‰∏≠</span>
CONST    ENDS
_TEXT    SEGMENT
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>             <span class="token comment">; ÂèòÈáè`_a`ÁöÑÂÅèÁßªÈáèÔºåÁõ∏ÂØπ‰∫éÂü∫ÊåáÈíà(`ebp`)ÁöÑ8Â≠óËäÇ‰ΩçÁΩÆ</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>            <span class="token comment">; ÂèòÈáè`_b`ÁöÑÂÅèÁßªÈáèÔºåÁõ∏ÂØπ‰∫éÂü∫ÊåáÈíà(`ebp`)ÁöÑ16Â≠óËäÇ‰ΩçÁΩÆ</span>

_f PROC                <span class="token comment">; `_f` ÊòØ‰∏Ä‰∏™ËøáÁ®ãÔºàÂáΩÊï∞Ôºâ</span>
   push    <span class="token register variable">ebp</span>         <span class="token comment">; ‰øùÂ≠òË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ßÂü∫ÊåáÈíàÔºåÊääÂΩìÂâç`ebp`ÂÄºÊé®ÂÖ•Ê†à</span>
   mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>    <span class="token comment">; Â∞ÜÊ†àÊåáÈíà`esp`ÁöÑÂÄº‰øùÂ≠òÂú®Ê†àÂ∏ßÂü∫ÊåáÈíà`ebp`‰∏≠ÔºåÂª∫Á´ãÂáΩÊï∞Ê†àÂ∏ß</span>
   fld     QWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
                        <span class="token comment">; Â∞ÜebpÂÅèÁßª_aÁöÑÂÄºÔºàÂç≥ÂèòÈáè_aÁöÑÂÄºÔºâÂä†ËΩΩÂà∞FPUÔºàÊµÆÁÇπËøêÁÆóÂçïÂÖÉÔºâÂ†ÜÊ†à‰∏≠</span>

<span class="token comment">; ÂΩìÂâçFPUÂ†ÜÊ†àÁä∂ÊÄÅ: ST(0) = _a</span>

   fdiv   QWORD PTR __real@40091eb851eb851f
                        <span class="token comment">; Â∞ÜST(0)‰∏≠ÁöÑÂÄºÈô§‰ª•Â∏∏Èáè3.14ÔºåÂπ∂Â∞ÜÁªìÊûúÂ≠òÂÇ®Âú®ST(0)‰∏≠</span>

<span class="token comment">; ÂΩìÂâçFPUÂ†ÜÊ†àÁä∂ÊÄÅ: ST(0) = _a / 3.14</span>

   fld    QWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
                        <span class="token comment">; Â∞ÜebpÂÅèÁßª_bÁöÑÂÄºÔºàÂç≥ÂèòÈáè_bÁöÑÂÄºÔºâÂä†ËΩΩÂà∞FPUÂ†ÜÊ†à‰∏≠</span>

<span class="token comment">; ÂΩìÂâçFPUÂ†ÜÊ†àÁä∂ÊÄÅ: ST(0) = _b; ST(1) = _a / 3.14</span>

   fmul   QWORD PTR __real@<span class="token number">4010666666666666</span>
                        <span class="token comment">; Â∞ÜST(0)‰∏≠ÁöÑÂÄº‰πò‰ª•Â∏∏Èáè4.1ÔºåÂπ∂Â∞ÜÁªìÊûúÂ≠òÂÇ®Âú®ST(0)‰∏≠</span>

<span class="token comment">; ÂΩìÂâçFPUÂ†ÜÊ†àÁä∂ÊÄÅ: ST(0) = _b * 4.1; ST(1) = _a / 3.14</span>

   faddp ST(<span class="token number">1</span>), ST(<span class="token number">0</span>)
                        <span class="token comment">; Â∞ÜST(0)ÂíåST(1)‰∏≠ÁöÑÂÄºÁõ∏Âä†ÔºåÂπ∂Â∞ÜÁªìÊûúÂ≠òÂÇ®Âú®ST(1)‰∏≠Ôºå</span>
                        <span class="token comment">; ÁÑ∂ÂêéÂºπÂá∫Â†ÜÊ†àÈ°∂ÔºàÂç≥ST(0)ÔºâÔºåÂ†ÜÊ†àÂπ≥Ë°°</span>

<span class="token comment">; ÂΩìÂâçFPUÂ†ÜÊ†àÁä∂ÊÄÅ: ST(0) = (_a / 3.14) + (_b * 4.1)</span>

   pop   <span class="token register variable">ebp</span>            <span class="token comment">; ÊÅ¢Â§çË∞ÉÁî®ËÄÖÁöÑÂü∫ÊåáÈíàÔºåÂ∞ÜÊ†àÈ°∂ÁöÑÂÄºÂºπÂá∫Âà∞`ebp`‰∏≠</span>
   ret   <span class="token number">0</span>              <span class="token comment">; ‰ªéÂáΩÊï∞ËøîÂõûÔºå‰º†ÈÄí0‰∏™ÂèÇÊï∞ÁªôË∞ÉÁî®ËÄÖ</span>
_f  ENDP                <span class="token comment">; ÁªìÊùüËøáÁ®ãÂÆö‰πâ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê±áÁºñËß£ËØª</p>
<ul>
<li><code>FLD</code>Êåá‰ª§‰ªéÊ†à‰∏≠ËØªÂèñ8‰∏™Â≠óËäÇÔºåÊääËøô‰∏™ÂÄºËΩ¨Êç¢Êàê<code>FPU</code>ÂØÑÂ≠òÂô®ÊâÄÈúÄÁöÑ80‰ΩçÊï∞ÊçÆÊ†ºÂºèÔºåÂπ∂Â≠òÂÖ•<code>ST(0)</code>ÂØÑÂ≠òÂô®</li>
<li><code>FDIV</code>Êåá‰ª§Êää<code>ST(0)</code>ÂØÑÂ≠òÂô®ÁöÑÂÄºÁî®‰ΩúË¢´Èô§Êï∞,ÊääÂèÇÊï∞<code>__real@40091eb851eb851f</code>ÔºàÂç≥3.14ÔºâÁöÑÂÄºÂΩì‰ΩúÈô§Êï∞.Âõ†‰∏∫Ê±áÁºñËØ≠Ê≥ï‰∏çÊîØÊåÅÂê´ÊúâÂ∞èÊï∞ÁÇπÁöÑÊµÆÁÇπÁ´ãÂç≥Êï∞ÔºåÊâÄ‰ª•Á®ãÂ∫è‰ΩøÁî®64‰ΩçIEEE 754Ê†ºÂºèÁöÑ16ËøõÂà∂Êï∞</li>
<li>ËøõË°å<code>FDIV</code>ËøêÁÆó‰πãÂêéÔºå<code>ST(0)</code>ÂØÑÂ≠òÂô®Â∞Ü‰øùÂ≠òÂïÜ</li>
<li>Ê≠§Â§ñÔºå<code>FDIVP</code>‰πüÊòØFPUÁöÑÈô§Ê≥ïËøêÁÆóÊåá‰ª§„ÄÇFDIVPÂú®ËøõË°åST(1)/ST(0)ËøêÁÆóÊó∂ÔºåÂÖàÊää‰∏§‰∏™ÂØÑÂ≠òÂô®ÁöÑÂÄºPOPÂá∫Êù•ËøõË°åËøêÁÆóÔºåÂÜçÊääÂïÜÊé®ÈÄÅÂÖ•(PUSH)FPUÁöÑÊ†àÔºàÂç≥ST(0)ÂØÑÂ≠òÂô®Ôºâ„ÄÇ</li>
<li>‰∏ã‰∏ÄÊù°<code>FLD</code>Êåá‰ª§Êää<code>b</code>ÈÄÅÂÖ•<code>FPU</code>ÁöÑÊ†à‰∏≠</li>
<li>Ê≠§Êó∂<code>ST(1)</code>ÂØÑÂ≠òÂô®ÈáåÊòØ‰∏äÊ¨°Èô§Ê≥ïËøêÁÆóÁöÑÂïÜÔºå<code>ST(0)</code>ÂØÑÂ≠òÂô®ÈáåÊòØÂèòÈáè<code>b</code>ÁöÑÂÄº</li>
<li>Êé•‰∏ãÊù•ÁöÑ<code>FMUL</code>Êåá‰ª§ÂÅö‰πòÊ≥ïËøêÁÆóÔºåÂÆÉÁî®ST(0)ÂØÑÂ≠òÂô®ÈáåÁöÑÂÄºÔºàÂç≥ÂèòÈáè<em>b</em>ÔºâÔºå‰πò‰ª•ÂèÇÊï∞__real @4010666666666666ÔºàÂç≥4.1ÔºâÔºåÂπ∂Â∞ÜËøêÁÆóÁªìÊûúÔºàÁßØÔºâÂ≠òÂÇ®Âà∞ST(0)ÂØÑÂ≠òÂô®„ÄÇ</li>
<li>ÊúÄÂêé‰∏ÄÊù°ËøêÁÆóÊåá‰ª§FADDPËÆ°ÁÆóÊ†àÂÜÖÈ°∂ÈÉ®‰∏§‰∏™ÂÄºÁöÑÂíå„ÄÇÂÆÉ<code>ÂÖàÊääËøêÁÆóÁªìÊûúÂ≠òÂÇ®Âú®ST(1)ÂØÑÂ≠òÂô®ÔºåÂÜçPOP ST(0)</code>„ÄÇÊâÄ‰ª•Ôºå<mark>ËøêÁÆóË°®ËææÂºèÁöÑËøêÁÆóÁªìÊûúÂ≠òÂÇ®Âú®Ê†àÈ°∂ÁöÑST(0)ÂØÑÂ≠òÂô®Èáå„ÄÇ</mark></li>
<li>Ê†πÊçÆÊúâÂÖ≥ËßÑËåÉÔºå<mark>ÂáΩÊï∞ÂøÖÈ°ª‰ΩøÁî®ST(0)ÂØÑÂ≠òÂô®Â≠òÂÇ®ÊµÆÁÇπËøêÁÆóÁöÑËøîÂõûÁªìÊûú</mark>„ÄÇÊâÄ‰ª•Âú®FADDPÊåá‰ª§‰πãÂêéÔºåÈô§‰∫ÜÂáΩÊï∞Â∞æÂ£∞ÁöÑÊåá‰ª§‰πãÂ§ñÂÜçÊó†ÂÖ∂‰ªñÊåá‰ª§„ÄÇ</li>
</ul>
<hr />
<p><code>GCC -O3</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂÆö‰πâËøáÁ®ã fÔºå‰Ωú‰∏∫‰∏Ä‰∏™ËøëËøáÁ®ã</span>
public f
f proc near

<span class="token comment">; ÂÆö‰πâËøáÁ®ãÁöÑÂèÇÊï∞</span>
arg_0 <span class="token operator">=</span> qword ptr <span class="token number">8</span>      <span class="token comment">; Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÁöÑÂÅèÁßªÈáèÔºåÁõ∏ÂØπ‰∫é`ebp`ÁöÑ8Â≠óËäÇ‰ΩçÁΩÆ</span>
arg_8 <span class="token operator">=</span> qword ptr <span class="token number">10h</span>    <span class="token comment">; Á¨¨‰∫å‰∏™ÂèÇÊï∞ÁöÑÂÅèÁßªÈáèÔºåÁõ∏ÂØπ‰∫é`ebp`ÁöÑ16Â≠óËäÇ‰ΩçÁΩÆ</span>

                push    <span class="token register variable">ebp</span>      <span class="token comment">; ÊääË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ßÂü∫ÊåáÈíà`ebp`Êé®ÂÖ•Ê†à‰∏≠Ôºå‰øùÁïôË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ß</span>
                fld     <span class="token register variable">ds</span>:dbl_8048608 <span class="token comment">; Âä†ËΩΩÂÖ®Â±ÄÊï∞ÊçÆÊÆµ‰∏≠ÁöÑÂ∏∏Èáè3.14Âà∞FPUÔºàÊµÆÁÇπËøêÁÆóÂçïÂÖÉÔºâÂ†ÜÊ†à</span>

<span class="token comment">; ÂΩìÂâçÊ†àÁä∂ÊÄÅ: ST(0) = 3.14</span>
                mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span> <span class="token comment">; ÂàõÂª∫Êñ∞ÁöÑÊ†àÂ∏ßÔºåebpÊåáÂêëÂΩìÂâçÊ†àÈ°∂</span>
                fdivr   <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span> <span class="token comment">; ÂèçÈô§Ê≥ïÊåá‰ª§ÔºåÂ∞ÜST(0)‰∏≠ÁöÑÂ∏∏Èáè3.14Èô§‰ª•Á¨¨‰∏Ä‰∏™ÂèÇÊï∞Ôºàarg_0Ôºâ</span>

<span class="token comment">; ÂΩìÂâçÊ†àÁä∂ÊÄÅ: ST(0) = Èô§Ê≥ïÁªìÊûú (3.14 / arg_0)</span>
                fld     <span class="token register variable">ds</span>:dbl_8048610 <span class="token comment">; Âä†ËΩΩÂÖ®Â±ÄÊï∞ÊçÆÊÆµ‰∏≠ÁöÑÂ∏∏Èáè4.1Âà∞FPUÂ†ÜÊ†à</span>

<span class="token comment">; ÂΩìÂâçÊ†àÁä∂ÊÄÅ: ST(0) = 4.1, ST(1) = Èô§Ê≥ïÁªìÊûú</span>
                fmul    <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_8<span class="token operator">]</span> <span class="token comment">; Â∞ÜST(0)‰∏≠ÁöÑ4.1‰πò‰ª•Á¨¨‰∫å‰∏™ÂèÇÊï∞Ôºàarg_8Ôºâ</span>

<span class="token comment">; ÂΩìÂâçÊ†àÁä∂ÊÄÅ: ST(0) = ‰πòÊ≥ïÁªìÊûú (4.1 * arg_8), ST(1) = Èô§Ê≥ïÁªìÊûú</span>
                pop     <span class="token register variable">ebp</span>      <span class="token comment">; ÊÅ¢Â§çË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ßÔºåÂ∞ÜÊ†àÈ°∂ÁöÑÂÄºÂºπÂá∫Âà∞ebp‰∏≠</span>
                faddp   st(<span class="token number">1</span>), st <span class="token comment">; Â∞ÜST(0)ÂíåST(1)Áõ∏Âä†ÔºåÂπ∂Â∞ÜÁªìÊûúÂ≠òÂÇ®Âú®ST(1)‰∏≠Ôºå</span>
                                  <span class="token comment">; ÁÑ∂ÂêéÂºπÂá∫Â†ÜÊ†àÈ°∂ÔºàÂç≥ST(0)ÔºâÔºåÊ†àÂπ≥Ë°°</span>

<span class="token comment">; ÂΩìÂâçÊ†àÁä∂ÊÄÅ: ST(0) = Âä†Ê≥ïÁªìÊûú ((3.14 / arg_0) + (4.1 * arg_8))</span>
                ret               <span class="token comment">; ‰ªéËøáÁ®ãËøîÂõûÔºåËøîÂõûÂú∞ÂùÄ‰ªéÊ†àÈ°∂ÂºπÂá∫</span>
f endp           <span class="token comment">; ÁªìÊùüËøáÁ®ãÂÆö‰πâ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>gcc</code>Êää3.14ÈÄÅÂÖ•FPUÁöÑÊ†à‰∏≠(ST(0)ÂØÑÂ≠òÂô®),Áî®‰Ωú<code>arg_0</code>ÁöÑÈô§Êï∞</p>
</li>
<li>
<p><code>FDIVR</code>ÊòØ<code>Reverse Divide</code>ÁöÑÁº©ÂÜô„ÄÇ<code>FDIVR</code>Êåá‰ª§ÁöÑÈô§Êï∞ÂíåË¢´Èô§Êï∞ÔºåÂØπÂ∫î<code>FDIV</code>Êåá‰ª§ÁöÑË¢´Èô§Êï∞ÂíåÈô§Êï∞ÔºåÂç≥‰ΩçÁΩÆÁõ∏ÂèçÔºå<code>FDIV</code>ÊòØ<code>ST[0]</code>‰Ωú‰∏∫Ë¢´Èô§Êï∞Ôºå<code>FDIVR</code>ÊòØ<code>ST[0]</code>‰ΩúÈô§Êï∞</p>
<p>ÂÖ∂‰ªñÁõ∏Âêå</p>
</li>
</ul>
<h4 id="Âà©Áî®ÂèÇÊï∞‰º†ÈÄíÊµÆÁÇπÂûã"><a class="markdownIt-Anchor" href="#Âà©Áî®ÂèÇÊï∞‰º†ÈÄíÊµÆÁÇπÂûã"></a> Âà©Áî®ÂèÇÊï∞‰º†ÈÄíÊµÆÁÇπÂûã</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"32.01 ^ 1.54 = %lf\n"</span><span class="token punctuation">,</span> <span class="token function">pow</span> <span class="token punctuation">(</span><span class="token number">32.01</span><span class="token punctuation">,</span><span class="token number">1.54</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>msvs x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">CONST    SEGMENT
__real@40400147ae147ae1 DQ 040400147ae147ae1r    <span class="token comment">; 32.01  ; ÂÆö‰πâÂ∏∏Èáè32.01ÔºåÂ≠òÂÇ®Âú®ÊÆµ`CONST`‰∏≠</span>
__real@3ff8a3d70a3d70a4 DQ 03ff8a3d70a3d70a4r    <span class="token comment">; 1.54   ; ÂÆö‰πâÂ∏∏Èáè1.54ÔºåÂ≠òÂÇ®Âú®ÊÆµ`CONST`‰∏≠</span>
CONST    ENDS

_main    PROC                          <span class="token comment">; ‰∏ªËøáÁ®ã _main ÁöÑÂºÄÂßã</span>
    push   <span class="token register variable">ebp</span>                         <span class="token comment">; Â∞ÜË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ßÂü∫ÊåáÈíà`ebp`Êé®ÂÖ•Ê†àÔºå‰øùÁïôË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ß</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>                    <span class="token comment">; Â∞ÜÂΩìÂâçÊ†àÈ°∂ÊåáÈíà`esp`ÁöÑÂÄºËµãÁªô`ebp`ÔºåÂª∫Á´ãÊñ∞ÁöÑÊ†àÂ∏ß</span>
    sub    <span class="token register variable">esp</span>, <span class="token number">8</span>                      <span class="token comment">; ‰∏∫Á¨¨1‰∏™ÂèòÈáèÂàÜÈÖç8‰∏™Â≠óËäÇÁöÑÊ†àÁ©∫Èó¥</span>
    fld    QWORD PTR __real@3ff8a3d70a3d70a4   <span class="token comment">; Âä†ËΩΩÂ∏∏Èáè1.54Âà∞FPUÔºàÊµÆÁÇπËøêÁÆóÂçïÂÖÉÔºâÂ†ÜÊ†à</span>
    fstp   QWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>             <span class="token comment">; Â∞ÜFPUÂ†ÜÊ†àÈ°∂ÈÉ®ÔºàST(0)ÔºâÁöÑÂÄºÂ≠òÂÇ®Âà∞Ê†àÈ°∂ÔºàÂØπÂ∫îÁ¨¨1‰∏™ÂèòÈáèÁöÑÁ©∫Èó¥Ôºâ</span>
    sub    <span class="token register variable">esp</span>, <span class="token number">8</span>                      <span class="token comment">; ‰∏∫Á¨¨2‰∏™ÂèòÈáèÂàÜÈÖç8‰∏™Â≠óËäÇÁöÑÊ†àÁ©∫Èó¥</span>
    fld    QWORD PTR __real@40400147ae147ae1   <span class="token comment">; Âä†ËΩΩÂ∏∏Èáè32.01Âà∞FPUÂ†ÜÊ†à</span>
    fstp   QWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>             <span class="token comment">; Â∞ÜFPUÂ†ÜÊ†àÈ°∂ÈÉ®ÁöÑÂÄºÂ≠òÂÇ®Âà∞Ê†àÈ°∂ÔºàÂØπÂ∫îÁ¨¨2‰∏™ÂèòÈáèÁöÑÁ©∫Èó¥Ôºâ</span>
    call   _pow                        <span class="token comment">; Ë∞ÉÁî®`_pow`ÂáΩÊï∞ËÆ°ÁÆóÂπÇÔºàÈªòËÆ§Â∫ïÊï∞Âú® [esp + 8]ÔºåÊåáÊï∞Âú® [esp]Ôºâ</span>

    add    <span class="token register variable">esp</span>, <span class="token number">8</span>                      <span class="token comment">; Ë∞ÉÊï¥Ê†àÊåáÈíàÔºåÈáäÊîæÁ¨¨2‰∏™ÂèòÈáèÁöÑÁ©∫Èó¥</span>
                                       
<span class="token comment">; Ê†àÂàÜÈÖç‰∫Ü8‰∏™Â≠óËäÇÁöÑÁ©∫Èó¥Áî®‰∫éÂ≠òÂÇ®ÂáΩÊï∞ `_pow` ÁöÑÁªìÊûú</span>
<span class="token comment">; ËøêÁÆóÁªìÊûúÂ≠òÂÇ®‰∫éFPUÂ†ÜÊ†àÁöÑST(0)ÂØÑÂ≠òÂô®</span>

    fstp   QWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>             <span class="token comment">; Â∞ÜFPUÂ†ÜÊ†àÈ°∂ÈÉ®ÁöÑÂÄºÔºà`_pow`ÁªìÊûúÔºâÂ≠òÂÇ®Âà∞Ê†àÈ°∂Ôºå‰æõ`printf()`‰ΩøÁî®</span>
    push   OFFSET <span class="token operator">$</span>SG2651              <span class="token comment">; Êé®ÈÄÅÊ†ºÂºèÂ≠óÁ¨¶‰∏≤ÁöÑÂú∞ÂùÄÂà∞Ê†àÔºåÁî®‰∫é`printf()`Ë∞ÉÁî®</span>
    call   _printf                     <span class="token comment">; Ë∞ÉÁî®`printf()`ÂáΩÊï∞ÊâìÂç∞ÁªìÊûú</span>
    add    <span class="token register variable">esp</span>, <span class="token number">12</span>                     <span class="token comment">; Ë∞ÉÊï¥Ê†àÊåáÈíàÔºåÈáäÊîæÁî®‰∫é`printf`Ë∞ÉÁî®ÁöÑÊ†àÁ©∫Èó¥Ôºà8Â≠óËäÇÁªìÊûú + 4Â≠óËäÇÂú∞ÂùÄÔºâ</span>
    xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>                    <span class="token comment">; Â∞Ü`eax`ÂØÑÂ≠òÂô®ÁΩÆÈõ∂ÔºåË°®Á§∫Á®ãÂ∫èËøîÂõûÂÄº‰∏∫0</span>
    pop    <span class="token register variable">ebp</span>                         <span class="token comment">; ÊÅ¢Â§çË∞ÉÁî®ËÄÖÁöÑÊ†àÂ∏ßÔºåÂ∞ÜÊ†àÈ°∂ÁöÑÂÄºÂºπÂá∫Âà∞`ebp`‰∏≠</span>
    ret    <span class="token number">0</span>                           <span class="token comment">; ‰ªéËøáÁ®ãËøîÂõûÔºå‰º†ÈÄí0‰∏™ÂèÇÊï∞ÁªôË∞ÉÁî®ËÄÖ</span>
_main    ENDP                          <span class="token comment">; ÁªìÊùüËøáÁ®ãÂÆö‰πâ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê±áÁºñËß£ËØª</p>
<ul>
<li>FLDÂíåFSTPÊåá‰ª§ÊòØÂú®Êï∞ÊçÆÊÆµÔºàSEGMENTÔºâÂíåFPUÁöÑÊ†àÈó¥‰∫§Êç¢Êï∞ÊçÆÁöÑÊåá‰ª§„ÄÇ<mark>FLDÊääÂÜÖÂ≠òÈáåÁöÑÊï∞ÊçÆÊé®ÈÄÅÂÖ•FPUÁöÑÊ†à</mark>ÔºåËÄå<mark>FSTPÂàôÊääFPUÊ†àÈ°∂ÁöÑÊï∞ÊçÆ<code>Â§çÂà∂</code>Âà∞ÂÜÖÂ≠ò‰∏≠</mark>„ÄÇËøô‰∏§‰∏™ËøûÁî®Áõ∏ÂΩì‰∫é‰ΩøÊµÆÁÇπÊï∞ÁªôÂÖ•Ê†à‰∫Ü,Áªôpow‰º†ÈÄíÂèÇÊï∞</li>
<li>pow()ÂáΩÊï∞ÊòØÊåáÊï∞ËøêÁÆóÂáΩÊï∞ÔºåÂÆÉ‰ªé<mark>FPUÁöÑÊ†àÂÜÖËØªÂèñ‰∏§‰∏™ÂèÇÊï∞ËøõË°åËÆ°ÁÆóÔºåÂπ∂ÊääËøêÁÆóÁªìÊûúÔºà<em>x</em>ÁöÑ<em>y</em>Ê¨°ÂπÇÔºâÂ≠òÂÇ®Âú®ST(0)ÂØÑÂ≠òÂô®Èáå</mark>„ÄÇ‰πãÂêéÔºåprintf()ÂáΩÊï∞ÂÖà‰ªéÂÜÖÂ≠òÊ†à‰∏≠ËØªÂèñ8‰∏™Â≠óËäÇÁöÑÊï∞ÊçÆÔºåÂÜç‰ª•ÂèåÁ≤æÂ∫¶ÊµÆÁÇπÁöÑÂΩ¢ÂºèËøõË°åËæìÂá∫„ÄÇ</li>
<li>Ê≠§Â§ñÔºåËøô‰∏™‰æãÂ≠êÈáåËøòÂèØ‰ª•<mark>Áõ¥Êé•ÊàêÂØπ‰ΩøÁî®MOVÊåá‰ª§ÊääÊµÆÁÇπÊï∞ÊçÆ‰ªéÂÜÖÂ≠òÂ§çÂà∂Âà∞FPUÁöÑÊ†àÈáå„ÄÇÂÜÖÂ≠òÊú¨Ë∫´Â∞±ÊääÊµÆÁÇπÊï∞ÊçÆÂ≠òÂÇ®‰∏∫IEEE 754ÁöÑÊï∞ÊçÆÊ†ºÂºèÔºåËÄåpow()ÂáΩÊï∞ÊâÄÈúÄÁöÑÂèÇÊï∞Â∞±ÊòØËøô‰∏™Ê†ºÂºèÁöÑÊï∞ÊçÆÔºåÊâÄ‰ª•Ê≠§Â§ÑÊ≤°ÊúâÊ†ºÂºèËΩ¨Êç¢ÁöÑÂøÖË¶Å</mark>„ÄÇ</li>
</ul>
<h4 id="ÊØîËæÉËØ¥Êòé"><a class="markdownIt-Anchor" href="#ÊØîËæÉËØ¥Êòé"></a> ÊØîËæÉËØ¥Êòé</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">double</span> <span class="token function">d_max</span> <span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">></span>b<span class="token punctuation">)</span>
                <span class="token keyword">return</span> a<span class="token punctuation">;</span>

        <span class="token keyword">return</span> b<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">d_max</span> <span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">d_max</span> <span class="token punctuation">(</span><span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>Non-Optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">PUBLIC    _d_max
_TEXT    SEGMENT
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>              <span class="token comment">; ÂèòÈáè_a$Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÔºåÂ§ßÂ∞è‰∏∫8Â≠óËäÇ</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>             <span class="token comment">; ÂèòÈáè_b$Âú®Ê†àÂ∏ß‰∏≠ÁöÑÂÅèÁßªÔºåÂ§ßÂ∞è‰∏∫8Â≠óËäÇ</span>
_d_max     PROC
    push   <span class="token register variable">ebp</span>               <span class="token comment">; ‰øùÂ≠òÊóßÁöÑÂü∫ÂùÄÊåáÈíà</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>          <span class="token comment">; Â∞ÜÂΩìÂâçÊ†àÈ°∂ÊåáÈíàËµãÂÄºÁªôÂü∫ÂùÄÊåáÈíà</span>
    fld    QWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">; Âä†ËΩΩ_b$ÔºåÂ∞ÜÂÖ∂ÂéãÂÖ•FPUÂ†ÜÊ†àÁöÑST(0)ÂØÑÂ≠òÂô®</span>

    <span class="token comment">; ÂΩìÂâçÂ†ÜÊ†àÁä∂ÊÄÅÔºöST(0) = _b</span>
    <span class="token comment">; ÊØîËæÉ_bÔºàST(0)ÔºâÂíå_a$ÔºåÁÑ∂ÂêéÂºπÂá∫ÂØÑÂ≠òÂô®</span>

    fcomp  QWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">; ÊØîËæÉST(0)Âíå_a$ÔºåÂπ∂ÂºπÂá∫ST(0)</span>

    <span class="token comment">; Ê≠§Êó∂FPUÂ†ÜÊ†à‰∏∫Á©∫</span>

    fnstsw <span class="token register variable">ax</span>                <span class="token comment">; Â∞ÜFPUÁä∂ÊÄÅÂ≠óÂ≠òÂÇ®Âà∞AXÂØÑÂ≠òÂô®</span>
    test   <span class="token register variable">ah</span>, <span class="token number">5</span>             <span class="token comment">; Ê£ÄÊü•AXÂØÑÂ≠òÂô®ÁöÑÈ´ò8‰ΩçÁöÑÁ¨¨0ÂíåÁ¨¨2‰Ωç(ÂØπÂ∫îÁöÑÊòØC2,C0Ê†áÂøó‰Ωç)</span>
    jp     SHORT <span class="token operator">$</span>LN1@d_max  <span class="token comment">; Â¶ÇÊûúÊ†áÂøó‰ΩçÊúâÊ≠£Êï∞Ê†áÂøó(a&lt;=b)ÔºåÂàôË∑≥ËΩ¨Âà∞$LN1@d_max</span>

    <span class="token comment">; Â¶ÇÊûú_a > _bÔºåÁªßÁª≠ÊâßË°å‰ª•‰∏ã‰ª£Á†Å</span>

    fld    QWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">; Âä†ËΩΩ_a$ÔºåÂ∞ÜÂÖ∂ÂéãÂÖ•FPUÂ†ÜÊ†àÁöÑST(0)</span>
    jmp    SHORT <span class="token operator">$</span>LN2@d_max  <span class="token comment">; Ë∑≥ËΩ¨Âà∞$LN2@d_max</span>
<span class="token label function">$LN1@d_max:</span>
    fld    QWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">; Âä†ËΩΩ_b$ÔºåÂ∞ÜÂÖ∂ÂéãÂÖ•FPUÂ†ÜÊ†àÁöÑST(0)</span>
<span class="token label function">$LN2@d_max:</span>
    pop    <span class="token register variable">ebp</span>               <span class="token comment">; ÊÅ¢Â§çÂü∫ÂùÄÊåáÈíà</span>
    ret    <span class="token number">0</span>                 <span class="token comment">; ËøîÂõû</span>
_d_max    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>FCOMP</code>È¶ñÂÖàÊØîËæÉ<code>ST(0)</code>‰∏é<code>_a</code>ÁöÑÂÄºÔºåÁÑ∂ÂêéÊ†πÊçÆÊØîËæÉÁöÑÁªìÊûúËÆæÁΩÆ<code>FPU</code>Áä∂ÊÄÅÂ≠ó(ÂØÑÂ≠òÂô®)ÁöÑC3/C2/C0‰Ωç„ÄÇ<mark><code>FPU</code>ÁöÑÁä∂ÊÄÅÂ≠óÂØÑÂ≠òÂô®ÊòØ‰∏Ä‰∏™16‰ΩçÂØÑÂ≠òÂô®ÔºåÁî®‰∫éÊèèËø∞<code>FPU</code>ÁöÑÂΩìÂâçÁä∂ÊÄÅ</mark></p>
<ul>
<li>Â¶ÇÊûú<em>b</em>&gt;aÔºåÂàôC3„ÄÅC2„ÄÅC0ÂØÑÂ≠òÂô®ÁöÑÂÄº‰ºöÂàÜÂà´ÊòØ0„ÄÅ0„ÄÅ0„ÄÇ</li>
<li>Â¶ÇÊûú<em>a</em>&gt;<em>b</em>ÔºåÂàôÂØÑÂ≠òÂô®ÁöÑÂÄº‰ºöÂàÜÂà´ÊòØ0„ÄÅ0„ÄÅ1„ÄÇ</li>
<li>Â¶ÇÊûú<em>a</em>=<em>b</em>ÔºåÂàôÂØÑÂ≠òÂô®ÁöÑÂÄº‰ºöÂàÜÂà´ÊòØ1„ÄÅ0„ÄÅ0„ÄÇ</li>
<li>Â¶ÇÊûúÂá∫Áé∞‰∫ÜÈîôËØØÔºàNaNÊàñÊï∞ÊçÆ‰∏çÂÖºÂÆπÔºâÔºåÂàôÂØÑÂ≠òÂô®ÁöÑÂÄºÊòØ1„ÄÅ1„ÄÅ1„ÄÇ</li>
</ul>
<p>Âú®ËÆæÁΩÆÂ•ΩÁõ∏Â∫îÊØîÁâπ‰Ωç‰πãÂêéÔºå<code>FCOMPÊåá‰ª§Ëøò‰ºö‰ªéÊ†àÈáåÊäõÂá∫ÔºàPOPÔºâ‰∏Ä‰∏™ÂÄº</code>„ÄÇFCOM‰∏éFCOMPÁöÑÂäüËÉΩÂçÅÂàÜÁõ∏‰ºº„ÄÇ<code>FCOMÊåá‰ª§Âè™Ê†πÊçÆÊï∞ÂÄºÊØîËæÉÁöÑÁªìÊûúËÆæÁΩÆÁä∂ÊÄÅÂ≠óÔºåËÄå‰∏ç‰ºöÂÜçÊìç‰ΩúFPUÁöÑÊ†à</code>„ÄÇ</p>
</li>
<li>
<p><code>FNSTSW</code> Êåá‰ª§Âú® x86 Ê±áÁºñ‰∏≠Áî®‰∫éÂ∞ÜÊµÆÁÇπÁä∂ÊÄÅÂ≠óÔºà<code>Floating Point Status Word</code>ÔºâÂ≠òÂÇ®Âà∞ÊåáÂÆö‰ΩçÁΩÆÊàñ AX ÂØÑÂ≠òÂô®‰∏≠</p>
<p><code>F</code>:Êìç‰ΩúÂâç‰∏çÁ≠âÂæÖFPUÂèØÁî®</p>
<p><code>NST</code>:No SToreÂà∞ÂÜÖÂ≠òÊìç‰Ωú</p>
<p><code>SW</code>:Status Word(Áä∂ÊÄÅÂ≠ó)</p>
<p>C3/C2/C0Ê†áÂøó‰ΩçÂØπÂ∫îAXÁöÑÁ¨¨14/10/8‰Ωç„ÄÇ<code>Â§çÂà∂Êï∞ÂÄºÂπ∂‰∏ç‰ºöÊîπÂèòÊ†áÂøó‰ΩçÔºàbitÔºâÁöÑÊï∞ÊùÉÔºà‰ΩçÁΩÆÔºâ</code>„ÄÇÊ†áÂøó‰Ωç‰ºöÈõÜ‰∏≠Âú®AXÂØÑÂ≠òÂô®ÁöÑÈ´òÂú∞ÂùÄ‰ΩçÂå∫Âüü‚Äî‚ÄîÂç≥AHÂØÑÂ≠òÂô®Èáå„ÄÇ</p>
<p>‰ª•AHÊù•Áúã:0:C0   1:C1   2:C2   6:C3</p>
<p><code>test ah, 5</code>Êåá‰ª§ÊääahÁöÑÂÄºÔºàFPUÊ†áÂøó‰ΩçÁöÑÂä†ÊùÉÊ±ÇÂíåÂÄºÔºâÂíå0101Ôºà‰∫åËøõÂà∂ÁöÑ5ÔºâÂÅö‰∏éÔºàANDÔºâËøêÁÆóÔºåÂπ∂ËÆæÁΩÆÊ†áÂøó‰Ωç„ÄÇÂΩ±ÂìçtestÁªìÊûúÁöÑÂè™ÊúâÁ¨¨0ÊØîÁâπ‰ΩçÁöÑC0Ê†áÂøó‰ΩçÂíåÁ¨¨2ÊØîÁâπ‰ΩçÁöÑC2Ê†áÂøó‰ΩçÔºåÂõ†‰∏∫ÂÖ∂‰ªñÁöÑ‰ΩçÈÉΩ‰ºöË¢´ÁΩÆÈõ∂„ÄÇ</p>
</li>
<li>
<p>Â•áÂÅ∂Ê†°È™å‰ΩçPFÔºàparity flagÔºâÁöÑ‰ªãÁªç</p>
<p><mark>PFÊ†áÂøó‰ΩçÁöÑ‰ΩúÁî®ÊòØÂà§ÂÆöËøêÁÆóÁªìÊûú‰∏≠ÁöÑ‚Äú1‚ÄùÁöÑ‰∏™Êï∞ÔºåÂ¶ÇÊûú‚Äú1‚ÄùÁöÑ‰∏™Êï∞‰∏∫ÂÅ∂Êï∞ÔºåÂàôPFÁöÑÂÄº‰∏∫1ÔºåÂê¶ÂàôÂÖ∂ÂÄº‰∏∫0„ÄÇ</mark></p>
<p>Ê£ÄÈ™åÂ•áÂÅ∂‰ΩçÈÄöÂ∏∏Áî®‰∫éÂà§Êñ≠Â§ÑÁêÜËøáÁ®ãÊòØÂê¶Âá∫Áé∞ÊïÖÈöúÔºåÂπ∂<mark>‰∏çËÉΩÂà§Êñ≠Ëøô‰∏™Êï∞ÂÄºÊòØÂ•áÊï∞ËøòÊòØÂÅ∂Êï∞</mark>„ÄÇFPUÊúâÂõõ‰∏™Êù°‰ª∂Ê†áÂøó‰ΩçÔºàC0Âà∞C3Ôºâ„ÄÇ‰ΩÜÊòØÔºåÂøÖÈ°ªÊääÊ†áÂøó‰ΩçÁöÑÂÄºÁªÑÁªáËµ∑Êù•„ÄÅÂ≠òÊîæÂú®Ê†áÂøó‰ΩçÂØÑÂ≠òÂô®‰∏≠ÔºåÊâçËÉΩËøõË°åÂ•áÂÅ∂Ê†°È™å‰ΩçÁöÑÊ≠£Á°ÆÊÄßÈ™åËØÅ„ÄÇFPUÊ†áÂøó‰ΩçÁöÑÁî®ÈÄîÂêÑÊúâ‰∏çÂêåÔºö<mark>C0‰ΩçÊòØËøõ‰ΩçÊ†áÂøó‰ΩçCFÔºåC2ÊòØÂ•áÂÅ∂Ê†°È™å‰ΩçPFÔºåC3ÊòØÈõ∂Ê†áÂøó‰ΩçZF</mark></p>
<p>Âú®‰ΩøÁî®FUCOMÊåá‰ª§ÔºàFPUÊØîËæÉÊåá‰ª§ÁöÑÈÄöÁß∞ÔºâÊó∂Ôºå<mark>Â¶ÇÊûúÊìç‰ΩúÊï∞ÈáåÂá∫Áé∞‰∫Ü‰∏çÂèØÊØîËæÉÁöÑÊµÆÁÇπÂÄºÔºàÈùûÊï∞ÂÄºÂûãÂÜÖÂÆπNaNÊàñÂÖ∂‰ªñÊó†Ê≥ïË¢´Êåá‰ª§ÊîØÊåÅÁöÑÊ†ºÂºèÔºâÔºåÂàôC2‰ºöË¢´ËÆæ‰∏∫1„ÄÇ</mark></p>
<p><mark>Â¶ÇÊûúC0ÂíåC2ÈÉΩÊòØ0ÊàñÈÉΩÊòØ1ÔºåÂàôËÆæPFÊ†áÂøó‰∏∫1Âπ∂Ëß¶ÂèëJPË∑≥ËΩ¨ÔºàJump on Parity</mark>Ôºâ„ÄÇÂâçÈù¢ÂØπC3/C2/C0ÁöÑÂèñÂÄºËøõË°å‰∫ÜÂàÜÁ±ªËÆ®ËÆ∫Ôºå<mark>C2ÂíåC0ÁöÑÊï∞ÂÄºÁõ∏ÂêåÁöÑÊÉÖÂÜµÂàÜ‰∏∫<em>b</em>&gt;<em>a</em>Âíå <em>a</em>=<em>b</em>Ëøô‰∏§ÁßçÊÉÖÂÜµ„ÄÇÂõ†‰∏∫testÊåá‰ª§ÊääahÁöÑÂÄº‰∏é5ËøõË°å‚Äú‰∏é‚ÄùËøêÁÆóÔºåÊâÄ‰ª•C3ÁöÑÂÄºÊó†ÂÖ≥Á¥ßË¶Å</mark>„ÄÇ</p>
<p>Âú®Ê≠§‰πãÂêéÁöÑÊåá‰ª§Â∞±ÂæàÁÆÄÂçï‰∫Ü„ÄÇÂ¶ÇÊûúËß¶Âèë‰∫ÜJPË∑≥ËΩ¨ÔºåÂàôFLDÊåá‰ª§ÊääÂèòÈáè_bÁöÑÂÄºÂ§çÂà∂Âà∞ST(0)ÂØÑÂ≠òÂô®ÔºåÂê¶ÂàôÂèòÈáè_aÁöÑÂÄºÂ∞Ü‰ºö‰º†ÈÄíÁªôSTÔºà0ÔºâÂØÑÂ≠òÂô®„ÄÇ</p>
<p>Â¶ÇÊûúÈúÄË¶ÅÊ£ÄÊµãC2ÁöÑÁä∂ÊÄÅ</p>
<p>Â¶ÇÊûúTESTÊåá‰ª§ÈÅáÂà∞ÈîôËØØÔºàNaNÁ≠âÊÉÖÂΩ¢ÔºâÔºåÂàôC2Ê†áÂøó‰ΩçÁöÑÂÄº‰ºöË¢´ËÆæÁΩÆ‰∏∫1„ÄÇ‰∏çËøáÊàë‰ª¨ÁöÑÁ®ãÂ∫è‰∏çÊ£ÄÊµãËøôÁ±ªÈîôËØØ„ÄÇ<code>Â¶ÇÊûúÁºñÁ®ã‰∫∫ÂëòÈúÄË¶ÅÂ§ÑÁêÜFPUÁöÑÈîôËØØÔºå‰ªñÂ∞±‰∏çÂæó‰∏çÊ∑ªÂä†È¢ùÂ§ñÁöÑÈîôËØØÊ£ÄÊü•Êåá‰ª§</code>„ÄÇ</p>
</li>
</ul>
<hr />
<p><code>Optimizing MSVS 2010</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                  <span class="token comment">; size = 8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>                 <span class="token comment">; size = 8</span>
_d_max     PROC
    fld     QWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
    fld     QWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>

<span class="token comment">; current stack state: ST(0) = _a, ST(1) = _b</span>

    fcom    ST(<span class="token number">1</span>) <span class="token comment">; compare _a and ST(1) = (_b)</span>
    fnstsw  <span class="token register variable">ax</span>
    test    <span class="token register variable">ah</span>, <span class="token number">65</span> <span class="token comment">; 00000041H</span>
    jne     SHORT <span class="token operator">$</span>LN5@d_max
<span class="token comment">; copy ST(0) to ST(1) and pop register,</span>
<span class="token comment">; leave (_a) on top</span>
    fstp    ST(<span class="token number">1</span>)

<span class="token comment">; current stack state: ST(0) = _a</span>

    ret     <span class="token number">0</span>
<span class="token label function">$LN5@d_max:</span>
<span class="token comment">; copy ST(0) to ST(0) and pop register,</span>
<span class="token comment">; leave (_b) on top</span>
    fstp    ST(<span class="token number">0</span>)

<span class="token comment">; current stack state: ST(0) = _b</span>
    ret <span class="token number">0</span>
_d_max ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>FCOMÊåá‰ª§ÂíåÂâçÈù¢Áî®ËøáÁöÑFCOMPÊåá‰ª§Áï•Êúâ‰∏çÂêåÔºåÂÆÉ‰∏çÊìç‰ΩúFPUÊ†à„ÄÇËÄå‰∏îÊú¨‰æãÁöÑÊìç‰ΩúÊï∞‰πüÂíåÂâçÊñáÊúâÂå∫Âà´ÔºåËøôÈáåÂÆÉÊòØÈÄÜÂ∫èÁöÑ„ÄÇÊâÄ‰ª•ÔºåFCOMÁîüÊàêÁöÑÊù°‰ª∂Ê†áÂøó‰ΩçÁöÑÊ∂µ‰πâ‰πü‰∏éÂâç‰æã‰∏çÂêå„ÄÇ</p>
<ul>
<li>Â¶ÇÊûú<em>a</em>&gt;<em>b</em>ÔºåÂàôC3„ÄÅC2„ÄÅC0‰ΩçÁöÑÂÄºÂàÜÂà´‰∏∫0„ÄÅ0„ÄÅ0„ÄÇ</li>
<li>Â¶ÇÊûú<em>b</em>&gt;<em>a</em>ÔºåÂàôÂØπÂ∫îÊï∞ÂÄº‰∏∫0„ÄÅ0„ÄÅ1„ÄÇ</li>
<li>Â¶ÇÊûú<em>a</em>=<em>b</em>ÔºåÂàôÂØπÂ∫îÊï∞ÂÄº‰∏∫1„ÄÅ0„ÄÅ0„ÄÇ</li>
</ul>
</li>
<li>
<p>ÊòØËØ¥Ôºå‚Äútest ah, 65‚ÄùËøôÊù°Êåá‰ª§‰ªÖ‰ªÖÊØîËæÉ‰∏§‰∏™Ê†áÂøó‰Ωç‚Äî‚ÄîC3ÔºàÁ¨¨6‰Ωç/bitÔºâÂíåC0ÔºàÁ¨¨0‰Ωç/bitÔºâ„ÄÇÂú®<em>a</em>&gt;<em>b</em>ÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏§ËÄÖÈÉΩÂ∫î‰∏∫0ÔºöËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÁ®ãÂ∫è‰∏ç‰ºöË¢´Ëß¶ÂèëJNEË∑≥ËΩ¨ÔºåÂπ∂‰ºöÊâßË°åÂêéÈù¢ÁöÑFSTP ST(1)Êåá‰ª§ÔºåÊääSTÔºà0ÔºâÁöÑÂÄºÂ§çÂà∂Âà∞Êìç‰ΩúÊï∞‰∏≠ÔºåÁÑ∂Âêé‰ªéFPUÊ†àÈáåÊäõÂá∫‰∏Ä‰∏™ÂÄº„ÄÇÊç¢Âè•ËØùËØ¥ÔºåËøôÊù°Êåá‰ª§ÊääSTÔºà0ÔºâÁöÑÂÄºÔºàÂç≥ÂèòÈáè_aÁöÑÂÄºÔºâÂ§çÂà∂Âà∞STÔºà1ÔºâÂØÑÂ≠òÂô®ÔºõÊ≠§ÂêéÊ†àÈ°∂ÁöÑ2‰∏™ÂÄºÈÉΩÊòØ_a„ÄÇÁÑ∂ÂêéÔºåÁõ∏ÂΩì‰∫éPOPÂá∫‰∏Ä‰∏™ÂÄºÊù•Ôºå‰ΩøST(0)ÂØÑÂ≠òÂô®ÁöÑÂÄº‰∏∫_aÔºåÂáΩÊï∞ÈöèÂç≥ÁªìÊùü„ÄÇ</p>
<p>Âú®<em>b</em>&gt;<em>a</em>Êàñ<em>a</em>==<em>b</em>ÁöÑÊÉÖÂÜµ‰∏ãÔºåÁ®ãÂ∫èÂ∞ÜËß¶ÂèëÊù°‰ª∂ËΩ¨ÁßªÊåá‰ª§JNE„ÄÇ‰ªéST(0)ÂèñÂÄº„ÄÅÂÜçËµãÂÄºÁªôST(0)ÂØÑÂ≠òÂô®ÔºåÁõ∏ÂΩì‰∫éNOPÊìç‰ΩúÊ≤°ÊúâÂÆûÈôÖÊÑè‰πâ„ÄÇÊé•ÁùÄÂÆÉ‰ªéÊ†àÈáåPOPÂá∫‰∏Ä‰∏™ÂÄºÔºå‰ΩøST(0)ÁöÑÂÄº‰∏∫ÂÖàÂâçST(1)ÁöÑÂÄºÔºå‰πüÂ∞±ÊòØÂèòÈáè_b„ÄÇÁÑ∂ÂêéÁªìÊùüÊú¨ÂáΩÊï∞„ÄÇÂ§ßÊ¶ÇÊòØÂõ†‰∏∫FPUÁöÑÊåá‰ª§ÈõÜÈáåÊ≤°ÊúâPOPÂπ∂ËàçÂºÉÊ†àÈ°∂ÂÄºÁöÑÊåá‰ª§ÔºåÊâÄ‰ª•Êâç‰ºöÂá∫Áé∞ËøôÊ†∑ÁöÑÊ±áÊä•Êåá‰ª§„ÄÇ</p>
</li>
</ul>
<h3 id="chap18-Êï∞ÁªÑ"><a class="markdownIt-Anchor" href="#chap18-Êï∞ÁªÑ"></a> Chap18 Êï∞ÁªÑ</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a[%d]=%d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Áî®msvs 2008 ËøõË°åÁºñËØë</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_TEXT     SEGMENT
_i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">84</span>              <span class="token comment">; size = 4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span>              <span class="token comment">; size = 80</span>
_main      PROC
    push   <span class="token register variable">ebp</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    sub    <span class="token register variable">esp</span>, <span class="token number">84</span>    <span class="token comment">; 00000054H</span>
    mov    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">0</span><span class="token comment">;i=0</span>
    jmp    SHORT <span class="token operator">$</span>LN6@main
<span class="token label function">$LN5@main:</span><span class="token comment">;i+=1 </span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    add    <span class="token register variable">eax</span>,  <span class="token number">1</span>
    mov    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token label function">$LN6@main:</span>
    cmp    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">20</span><span class="token comment">; 00000014H</span>
    jge    SHORT <span class="token operator">$</span>LN4@main
    mov    <span class="token register variable">ecx</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">;i&lt;20</span>
    shl    <span class="token register variable">ecx</span>, <span class="token number">1</span><span class="token comment">;ecx*2=2i</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov    DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ecx</span><span class="token comment">;a[i]=2i</span>
    jmp    SHORT <span class="token operator">$</span>LN5@main
<span class="token label function">$LN4@main:</span><span class="token comment">;i=0</span>
    mov    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">0</span>
    jmp    SHORT <span class="token operator">$</span>LN3@main
<span class="token label function">$LN2@main:</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    add    <span class="token register variable">eax</span>, <span class="token number">1</span>
    mov    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token label function">$LN3@main:</span><span class="token comment">;for i in range(20) printf(a[i])</span>
    cmp    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">20</span>    <span class="token comment">; 00000014H</span>
    jge    SHORT <span class="token operator">$</span>LN1@main<span class="token comment">;ret</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
    push   <span class="token register variable">edx</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    push   <span class="token register variable">eax</span>
    push   OFFSET <span class="token operator">$</span>SG2463
    call   _printf
    add    <span class="token register variable">esp</span>, <span class="token number">12</span>        <span class="token comment">; 0000000cH</span>
    jmp    SHORT <span class="token operator">$</span>LN2@main
<span class="token label function">$LN1@main:</span>
    xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
    pop    <span class="token register variable">ebp</span>
    ret    <span class="token number">0</span>
_main      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Á®ãÂ∫è‰∏∫Êï∞ÁªÑÁî≥ËØ∑‰∫Ü80Â≠óËäÇÁöÑÊ†àÁ©∫Èó¥Ôºå‰ª•Â≠òÂÇ®20‰∏™4Â≠óËäÇÂÖÉÁ¥†„ÄÇ</li>
<li>Âõ†‰∏∫ÂÖ®ÈÉ®Êï∞ÁªÑÈÉΩÂ≠òÂÇ®‰∫éÊ†à‰∏≠ÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•Âú®ÂÜÖÂ≠òÊï∞ÊçÆÁ™óÂè£ÈáåÁúãÂà∞Êï¥‰∏™Êï∞ÁªÑ„ÄÇ</li>
</ul>
<hr />
<p>gcc</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">                public main
main            proc near                   <span class="token comment">; DATA XREF: _start+17</span>

var_70          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">70h</span>
var_6C          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">6Ch</span>
var_68          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">68h</span>
i_2             <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">54h</span>
i               <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">4</span>

                push     <span class="token register variable">ebp</span>
                mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                and      <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span><span class="token comment">;ÂØπÈΩê</span>
                sub      <span class="token register variable">esp</span>, <span class="token number">70h</span>
                mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">0</span>     <span class="token comment">; i=0</span>
                jmp      short loc_804840A

<span class="token label function">loc_80483F7:</span>
                mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>
                mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>
                add      <span class="token register variable">edx</span>, <span class="token register variable">edx</span>           <span class="token comment">; edx=i*2</span>
                mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i_2<span class="token operator">]</span>, <span class="token register variable">edx</span>
                add      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">1</span>     <span class="token comment">;  i++</span>

<span class="token label function">loc_804840A:</span>
                cmp      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">13h</span><span class="token comment">;19</span>
                jle      short loc_80483F7<span class="token comment">;i&lt;=19</span>
                mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">0</span><span class="token comment">;i=0</span>
                jmp      short loc_8048441

<span class="token label function">loc_804841B:</span>
                mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>
                mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i_2<span class="token operator">]</span>
                mov      <span class="token register variable">eax</span>, offset aADD <span class="token comment">; "a[%d]=%d\n"</span>
                mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>var_68<span class="token operator">]</span>, <span class="token register variable">edx</span>
                mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>
                mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>var_6C<span class="token operator">]</span>, <span class="token register variable">edx</span>
                mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>var_70<span class="token operator">]</span>, <span class="token register variable">eax</span>
                call     _printf
                add      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">1</span>

<span class="token label function">loc_8048441:</span>
                cmp      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">70h</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">13h</span>
                jle      short loc_804841B<span class="token comment">;i&lt;=19</span>
                mov      <span class="token register variable">eax</span>, <span class="token number">0</span>
                leave
                retn
main            endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ÂÆûÈôÖ‰∏äÂèòÈáè==<em>a</em>ÁöÑÊï∞ÊçÆÁ±ªÂûãÊòØÊï¥ÂûãÊåáÈíà„ÄÇ‰∏•Ê†ºÂú∞ËØ¥ÔºåÂú®ÊääÊï∞ÁªÑ‰º†ÈÄíÁªôÂáΩÊï∞ÁöÑÊó∂ÂÄôÔºå‰º†ÈÄíÁöÑÊï∞ÊçÆÂ∞±ÊòØÊåáÂêëÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑÊåáÈíàÔºåÊàë‰ª¨ÂÜçÊ†πÊçÆËøô‰∏™ÊåáÈíàÂ∞±ÂèØ‰ª•ËΩªÊùæÂú∞ËÆ°ÁÆóÂá∫Êï∞ÁªÑÊØè‰∏™ÂÖÉÁ¥†ÁöÑÂú∞ÂùÄÔºàÂç≥ÊåáÈíàÔºâ„ÄÇ==Â¶ÇÊûú‰ΩøÁî®a[idx]ÁöÑÂΩ¢ÂºèË°®Á§∫Êï∞ÁªÑÂÖÉÁ¥†ÔºåÂÖ∂‰∏≠idxÊòØÊï∞ÁªÑÂÖÉÁ¥†Âú®Êï∞ÁªÑÈáåÁöÑÊéíÂàóÂ∫èÂè∑ÔºàÂç≥Á¥¢ÂºïÂè∑ÔºâÔºåÈÇ£‰πàÂ∞±ÂèØ‰ª•ÈÄöËøáÊï∞ÁªÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑÂú∞ÂùÄ„ÄÅÁ¥¢ÂºïÂè∑ÂíåÊï∞ÊçÆÂÆπÈáèÊ±ÇÂæóÂêÑ‰∏™ÂÖÉÁ¥†ÁöÑÂú∞ÂùÄ„ÄÇ</p>
<p>‰∏æ‰∏™ÂÖ∏ÂûãÁöÑ‰æãÂ≠êÔºöÂ≠óÁ¨¶‰∏≤Â∏∏Èáè‚Äústring‚ÄùÊòØÂ≠óÁ¨¶ÂûãÊï∞ÁªÑÔºåÂÆÉÁöÑÊØè‰∏™Â≠óÁ¨¶ÂÖÉÁ¥†ÈÉΩÊòØconst char*ÂûãÊï∞ÊçÆ„ÄÇ‰ΩøÁî®Á¥¢ÂºïÂè∑‰πãÂêéÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•‰ΩøÁî®‚Äústring‚Äù[i]ÁöÑÂΩ¢ÂºèÊèèËø∞Â≠óÁ¨¶‰∏≤‰∏≠ÁöÑÁ¨¨<em>i</em>‰∏™Â≠óÁ¨¶‚Äî‚ÄîËøôÊ≠£ÊòØC/CÔºãÔºãË°®ËææÂºèÁöÑË°®Á§∫ÊñπÊ≥ïÔºÅ</p>
</li>
</ul>
<h4 id="ÁºìÂÜ≤Âå∫Ê∫¢Âá∫"><a class="markdownIt-Anchor" href="#ÁºìÂÜ≤Âå∫Ê∫¢Âá∫"></a> ÁºìÂÜ≤Âå∫Ê∫¢Âá∫</h4>
<p>‰ªéÊ±áÁºñ‰ª£Á†ÅÂèØ‰ª•ÁúãÂá∫:ÁºñËØëÂô®Ê≤°ÊúâÂØπÁ¥¢ÂºïËøõË°åÂà§Êñ≠Ôºå</p>
<p>ÂèØ‰ª•ËÆøÈóÆa[20]</p>
<hr />
<p>ÂêëÊï∞ÁªÑËæπÁïå‰πãÂ§ñÁöÑÂú∞ÂùÄËµãÂÄº</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                 a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Á®ãÂ∫èÂèëÁîü‰∫ÜÂ¥©Ê∫É</p>
<p>‰ΩøÁî®onlydbgÂä†ËΩΩÔºåË∑üË∏™Á®ãÂ∫èÂ¥©Ê∫ÉÂéüÂõ†</p>
<ul>
<li>
<p>ÂΩì30‰∏™Âæ™ÁéØÁªìÊùüÂêéÔºå<code>EIP</code>ÁöÑÂÄºÊòØ0x15ÔºåÊòæÁÑ∂‰∏çÂêàÊ≥ïÔºåÊ≠§Êó∂<code>EBP</code>‰∏∫0x14Ôºå<code>ECX</code>Âíå<code>EDX</code>ÂÄº‰∏∫0x1D</p>
<p>Why?</p>
</li>
<li>
<p>È¶ñÂÖàÂõûÈ°æÊ†àÁöÑÁªìÊûÑ</p>
<p>Ôºåmain()ÂáΩÊï∞ÁöÑÊ†àÁªìÊûÑÂ¶Ç‰∏ãÔºö</p>
<table>
<thead>
<tr>
<th>ESP</th>
<th><em>i</em>ÊâÄÂç†Áî®ÁöÑ4Â≠óËäÇ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ESP+4</td>
<td><em>a</em>[20]Âç†Áî®ÁöÑ80Â≠óËäÇ</td>
</tr>
<tr>
<td>ESP+84</td>
<td>‰øùÂ≠òËøáÁöÑEBP</td>
</tr>
<tr>
<td>ESP+88</td>
<td>ËøîÂõûÂú∞ÂùÄ</td>
</tr>
</tbody>
</table>
<p>ËµãÂÄºÁªô<em>a</em>[19]ÁöÑÊó∂ÂÄôÔºåÊï∞ÁªÑ<em>a</em>[]Â∑≤ÁªèË¢´ÂÖ®ÈÉ®ËµãÂÄº„ÄÇ</p>
<p>ËµãÂÄºÁªôa[20]ÂÆûÈôÖ‰∏ä‰øÆÊîπÁöÑÊòØÊ†àÈáå‰øùÂ≠òÁöÑ<code>EBP</code>ÔºåÊú¨‰æã‰∏≠Â∞Ü20ËµãÂÄº‰∫ÜÁªôa[10],ÂáΩÊï∞ÈÄÄÂá∫‰πãÂâç‰ºöÂ∞ÜebpËÆæÁΩÆ‰∏∫Ëøô‰∏™ÂÄºÔºåÂõ†Ê≠§ebp‰∏∫0x14</p>
<p>ÊúÄÂêéËøêË°å<code>RET</code>Êåá‰ª§ÔºåÁõ∏ÂΩì‰∫é<code>POP EIP</code>Ôºå<code>RET</code>Êåá‰ª§Â∞ÜÁ®ãÂ∫èÁöÑÊéßÂà∂ÊùÉ‰º†ÈÄíÁªôÊ†àÈáåÁöÑËøîÂõûÂú∞ÂùÄÔºå‰∏çËøáÊ≠§Êó∂Ëøô‰∏™ÂÄº‰∏∫0x15ÔºåËøôÈáåÊ≤°ÊúâÂèØÊâßË°å‰ª£Á†ÅÔºåÂõ†Ê≠§Â¥©Ê∫É</p>
</li>
<li>
<p>‰∫ãÂÆû‰∏äÔºåËøôÂ∞±ÊòØÁºìÂÜ≤Âå∫Ê∫¢Âá∫ÊîªÂáªÁöÑÂéüÁêÜÔºåÊàë‰ª¨ÂèØ‰ª•Âä´ÊåÅËøîÂõûÂú∞ÂùÄÊù•ÊéßÂà∂eipÊù•Ë∑≥ËΩ¨Âà∞ÂÖ∂‰ªñÁ®ãÂ∫èÁöÑÂú∞ÂùÄ</p>
<p>ÁõÆÂâçÂ∑≤ÁªèÊúâ‰∫ÜÂæàÂ§öÊâãÊÆµÊù•Èò≤Âæ°ËøôÁßçÊîªÂáªÔºåÂ≠¶pwnÁöÑÊó∂ÂÄôÂÜçÊ∑±ÂÖ•‰∫ÜËß£</p>
<ul>
<li>
<p>canaryÔºåÈöèÊú∫ÂÜôÂÖ•ÈöèÊú∫Êï∞ÔºåÂú®ÂáΩÊï∞ÁªìÊùü‰πãÂâçÊ£ÄÊü•Ëøô‰∫õÂÄºÊòØÂê¶ÂèëÁîüÂèòÂåñ</p>
</li>
<li>
<p>Â¶ÇÊûúÂêØÁî®MSVCÁöÑRTC1ÂíåRTCsÈÄâÈ°πÁºñËØëÊú¨Á´†ÂºÄÂ§¥ÁöÑÈÇ£ÊÆµÁ®ãÂ∫èÔºåÂ∞±‰ºöÂú®Ê±áÁºñÊåá‰ª§ÈáåÁúãÂà∞ÂáΩÊï∞Âú®ÈÄÄÂá∫‰πãÂâçË∞ÉÁî®@_RTC_CheckStackVars@8ÔºåÁî®‰ª•Ê£ÄÊµã‚ÄúÁôæÁÅµÈ∏ü‚ÄùÊòØÂê¶‰ºöÊä•Ë≠¶„ÄÇ</p>
</li>
<li>
<p>Áî®gccÁºñËØë</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">		mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">]</span>
        xor     <span class="token register variable">eax</span>, DWORD PTR <span class="token register variable">gs</span>:<span class="token number">20</span>Ôºõ 
        jne     .L5
        mov     <span class="token register variable">ebx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token label function">.L5:</span>
        call    __stack_chk_fail<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊòæÁÑ∂ÈöèÊú∫ÂÄº‰Ωç‰∫égsÔºö20,</p>
</li>
</ul>
</li>
<li>
<p>gsÂºÄÂ§¥ÁöÑÂØÑÂ≠òÂô®Â∞±ÊòØÂ∏∏ËØ¥ÁöÑÊÆµÂØÑÂ≠òÂô®„ÄÇÂú®MS-DOSÂíåÂü∫‰∫éDOSÁöÑÁ≥ªÁªüÈáåÔºåÊÆµÂØÑÂ≠òÂô®ÁöÑ‰ΩúÁî®ÂæàÂπøÊ≥õ„ÄÇ‰ΩÜÊòØÔºå‰ªäÂ§©ÂÆÉÁöÑ‰ΩúÁî®ÂèëÁîü‰∫ÜÂèòÂåñ„ÄÇÁÆÄÂçïÂú∞ËØ¥ÔºåLinux‰∏ãÁöÑgs ÂØÑÂ≠òÂô®ÊÄªÊòØÊåáÂêëTLSÔºàÂèÇËßÅÁ¨¨65Á´†Ôºâ‚Äî‚ÄîÂ≠òÂÇ®Á∫øÁ®ãÁöÑÂ§öÁßçÁâπÂÆö‰ø°ÊÅØ„ÄÇÔºàWin32ÁéØÂ¢É‰∏ãÁöÑfsÂØÑÂ≠òÂô®Ëµ∑Âà∞Linux‰∏ãgsÂØÑÂ≠òÂô®ÁöÑ‰ΩúÁî®„ÄÇWin32ÁöÑfsÂØÑÂ≠òÂô®ÊåáÂêëTIBÔºâ</p>
</li>
</ul>
<h4 id="ÂÖ∂‰ªñ"><a class="markdownIt-Anchor" href="#ÂÖ∂‰ªñ"></a> ÂÖ∂‰ªñ</h4>
<p>Áé∞Âú®Êàë‰ª¨Â∫îËØ•ÂèØ‰ª•ÁêÜËß£‰∏∫‰ªÄ‰πàC/C++ÁºñËØë‰∏ç‰∫Ü‰∏ãÈù¢ÁöÑÁ®ãÂ∫è‰∫Ü„ÄÇ</p>
<pre class="line-numbers language-none"><code class="language-none">void f(int size)
&#123;
    int a[size];
...
&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><mark>Âú®ÁºñËØëÈò∂ÊÆµÔºåÁºñËØëÂô®ÂøÖÈ°ªÁ°ÆÂàáÂú∞Áü•ÈÅìÈúÄË¶ÅÁªôÊï∞ÁªÑÂàÜÈÖçÂ§öÂ§ßÁöÑÂ≠òÂÇ®Á©∫Èó¥ÔºåÂÆÉÈúÄË¶Å‰∫ãÂÖàÊòéÁ°ÆÂàÜÈÖçÂ±ÄÈÉ®Ê†àÊàñÊï∞ÊçÆÊÆµÔºàÂÖ®Â±ÄÂèòÈáèÔºâÁöÑÊ†ºÂ±ÄÔºåÊâÄ‰ª•ÁºñËØëÂô®Êó†Ê≥ïÂ§ÑÁêÜ‰∏äËø∞ËøôÁßçÈïøÂ∫¶ÂèØÂèòÁöÑÊï∞ÁªÑ„ÄÇ</mark></p>
<p>Â¶ÇÊûúÊó†Ê≥ï‰∫ãÂÖàÁ°ÆÂÆöÊï∞ÁªÑÁöÑÈïøÂ∫¶ÔºåÈÇ£‰πàÊàë‰ª¨Â∞±Â∫îÂΩì‰ΩøÁî®malloc()ÂáΩÊï∞ÂàÜÈÖçÂá∫‰∏ÄÂùóÂÜÖÂ≠òÔºåÁÑ∂ÂêéÁõ¥Êé•ÊåâÁÖßÂ∏∏ËßÑÂèòÈáèÊï∞ÁªÑÁöÑÊñπÂºèËÆøÈóÆËøôÂùóÂÜÖÂ≠òÔºõÊàñËÄÖÈÅµÂæ™C99Ê†áÂáÜÔºàÂèÇËßÅISO07Ôºå6.7.5/2ÔºâËøõË°åÂ§ÑÁêÜÔºå‰ΩÜÊòØÈÅµÂæ™C99Ê†áÂáÜËÄåËÆæËÆ°Âá∫Êù•ÁöÑÁ®ãÂ∫èÔºåÂÜÖÈÉ®ÂÆûÁé∞ÁöÑÊñπÊ≥ïÊõ¥Êé•Ëøëalloca()ÂáΩÊï∞ÔºàËØ¶ÊÉÖËØ∑ÂèÇÈòÖ5.2.4ËäÇÔºâ„ÄÇ</p>
<h4 id="Â≠óÁ¨¶‰∏≤ÊåáÈíà"><a class="markdownIt-Anchor" href="#Â≠óÁ¨¶‰∏≤ÊåáÈíà"></a> Â≠óÁ¨¶‰∏≤ÊåáÈíà</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> month1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>
<span class="token punctuation">&#123;</span>
        <span class="token string">"January"</span><span class="token punctuation">,</span>
        <span class="token string">"February"</span><span class="token punctuation">,</span>
        <span class="token string">"March"</span><span class="token punctuation">,</span>
        <span class="token string">"April"</span><span class="token punctuation">,</span>
        <span class="token string">"May"</span><span class="token punctuation">,</span>
        <span class="token string">"June"</span><span class="token punctuation">,</span>
        <span class="token string">"July"</span><span class="token punctuation">,</span>
        <span class="token string">"August"</span><span class="token punctuation">,</span>
        <span class="token string">"September"</span><span class="token punctuation">,</span>
        <span class="token string">"October"</span><span class="token punctuation">,</span>
        <span class="token string">"November"</span><span class="token punctuation">,</span>
        <span class="token string">"December"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// in 0..11 range</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">get_month1</span> <span class="token punctuation">(</span><span class="token keyword">int</span> month<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> month1<span class="token punctuation">[</span>month<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p>msvs x64</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_DATA   SEGMENT
month1  DQ      FLAT:<span class="token operator">$</span>SG3122
        DQ      FLAT:<span class="token operator">$</span>SG3123
        DQ      FLAT:<span class="token operator">$</span>SG3124
        DQ      FLAT:<span class="token operator">$</span>SG3125
        DQ      FLAT:<span class="token operator">$</span>SG3126
        DQ      FLAT:<span class="token operator">$</span>SG3127
        DQ      FLAT:<span class="token operator">$</span>SG3128
        DQ      FLAT:<span class="token operator">$</span>SG3129
        DQ      FLAT:<span class="token operator">$</span>SG3130
        DQ      FLAT:<span class="token operator">$</span>SG3131
        DQ      FLAT:<span class="token operator">$</span>SG3132
        DQ      FLAT:<span class="token operator">$</span>SG3133
<span class="token operator">$</span>SG3122 DB     <span class="token string">'January'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3123 DB     <span class="token string">'February'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3124 DB     <span class="token string">'March'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3125 DB     <span class="token string">'April'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3126 DB     <span class="token string">'May'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3127 DB     <span class="token string">'June'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3128 DB     <span class="token string">'July'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3129 DB     <span class="token string">'August'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3130 DB     <span class="token string">'September'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3156 DB     <span class="token string">'%s'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3131 DB     <span class="token string">'October'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3132 DB     <span class="token string">'November'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3133 DB     <span class="token string">'December'</span>, <span class="token number">00H</span>
_DATA   ENDS

month<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
get_month1 PROC
         movsxd  <span class="token register variable">rax</span>, <span class="token register variable">ecx</span>
         lea     <span class="token register variable">rcx</span>, OFFSET FLAT:month1
         mov     <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>
         ret     <span class="token number">0</span>
get_month1 ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><mark>MOVSXD</mark>ÊääECXÁöÑ32‰ΩçÊï¥ÂûãÊï∞ÂÄº„ÄÅËøûÂêåÂÖ∂Á¨¶Âè∑Êâ©Â±ï‰Ωç(sign-extension)Êâ©Â±ï‰∏∫64‰ΩçÊï¥ÂûãÊï∞ÊçÆÔºåÂÜçÂ≠òÂÇ®‰∫éRAXÂØÑÂ≠òÂô®‰∏≠„ÄÇECXÂ≠òÂÇ®ÁöÑ‚ÄúÊúà‰ªΩ‚Äù‰ø°ÊÅØÊòØ32‰ΩçÊï¥ÂΩ¢Êï∞ÊçÆ„ÄÇÂõ†‰∏∫Á®ãÂ∫èÈöèÂêéËøòË¶ÅËøõË°å64‰ΩçËøêÁÆóÔºåÊâÄ‰ª•ÈúÄË¶ÅÊääËæìÂÖ•ÂèòÈáèËΩ¨Êç¢‰∏∫64‰ΩçÂÄº„ÄÇ</li>
<li>ÁÑ∂ÂêéÂáΩÊï∞Êää<code>ÊåáÈíàË°®ÁöÑÂú∞ÂùÄÂ≠òÂÇ®‰∫éRCXÂØÑÂ≠òÂô®„ÄÇ</code></li>
<li>ÊúÄÂêéÔºåÂáΩÊï∞ÁöÑËæì<code>ÂÖ•ÂèòÈáè(month)ÁöÑÂÄº‰πò‰ª•8„ÄÅÂÜç‰∏éÊåáÈíàË°®ÁöÑÂú∞ÂùÄÁõ∏Âä†</code>„ÄÇÂõ†‰∏∫ÊòØ64‰ΩçÁ≥ªÁªüÁöÑÁºòÊïÖÔºåÊØè‰∏™Âú∞ÂùÄÔºàÂç≥ÊåáÈíàÔºâÁöÑÊï∞ÊçÆÈúÄË¶ÅÂç†Áî®64‰ΩçÔºàÂç≥8Â≠óËäÇÔºâ„ÄÇÊâÄ‰ª•ÊåáÈíàË°®‰∏≠ÁöÑÊØè‰∏™ÂÖÉÁ¥†ÈÉΩÂç†Áî®8Â≠óËäÇÁ©∫Èó¥„ÄÇÂõ†Ê≠§ÔºåÊúÄÁªàÂ≠óÁ¨¶‰∏≤ÁöÑÂú∞ÂùÄË¶ÅÂä†‰∏ämonth*8„ÄÇMOVÊåá‰ª§‰∏ç‰ªÖÂÆåÊàê‰∫ÜÂ≠óÁ¨¶‰∏≤Âú∞ÂùÄÁöÑËÆ°ÁÆóÔºåËÄå‰∏îËøòÂÆåÊàê‰∫ÜÊåáÈíàË°®ÁöÑÊü•ËØ¢„ÄÇÂú®ËæìÂÖ•ÂÄº‰∏∫1Êó∂ÔºåÂáΩÊï∞Â∞ÜËøîÂõûÂ≠óÁ¨¶‰∏≤‚ÄúFebruary‚ÄùÁöÑÊåáÈíàÂú∞ÂùÄ„ÄÇ</li>
</ul>
<hr />
<p><code>Optimizing gcc</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">movsx   <span class="token register variable">rdi</span>, <span class="token register variable">edi</span>
     mov     <span class="token register variable">rax</span>, QWORD PTR month1<span class="token operator">[</span><span class="token number">0</span><span class="token operator">+</span><span class="token register variable">rdi</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>
     ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>Optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_month<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_get_month1 PROC
        mov     <span class="token register variable">eax</span>, DWORD PTR _month<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _month1<span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
_get_month1 ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>32‰ΩçÁ®ãÂ∫èÂ∞±‰∏çÁî®ÊääËæìÂÖ•ÂÄºËΩ¨Âåñ‰∏∫64‰ΩçÊï∞ÊçÆ‰∫Ü„ÄÇÊ≠§Â§ñÔºå32‰ΩçÁ≥ªÁªüÁöÑÊåáÈíàÂ±û‰∫é4Â≠óËäÇÊï∞ÊçÆÔºåÊâÄ‰ª•Áõ∏ÂÖ≥ÁöÑËÆ°ÁÆóÂõ†Â≠êÂèò‰∏∫‰∫Ü4„ÄÇ</p>
<h4 id="Â§öÁª¥Êï∞ÁªÑ"><a class="markdownIt-Anchor" href="#Â§öÁª¥Êï∞ÁªÑ"></a> Â§öÁª¥Êï∞ÁªÑ</h4>
<p>ËÆ°ÁÆóÊú∫ÂÜÖÂ≠òÊòØËøûÁª≠ÁöÑÁ∫øÊÄßÁ©∫Èó¥ÔºåÂÆÉÂèØ‰ª•‰∏é‰∏ÄÁª¥Êï∞ÁªÑÁõ¥Êé•ÂØπÂ∫î„ÄÇÂú®Ë¢´ÊãÜÂàÜÊàêÂ§ö‰∏™‰∏ÄÁª¥Êï∞ÁªÑ‰πãÂêéÔºåÂ§öÁª¥Êï∞ÁªÑ‰∏éÂÜÖÊ†àÁ∫øÊÄßÁ©∫Èó¥ÂêåÊ†∑Â≠òÂú®Áõ¥Êé•ÂØπÂ∫îÁöÑÂ≠òÂÇ®ÂÖ≥Á≥ª„ÄÇ</p>
<table>
<thead>
<tr>
<th>Â≠òÂÇ®Âú∞ÂùÄ</th>
<th>Êï∞ÁªÑÂÖÉÁ¥†</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>[0] [0]</td>
</tr>
<tr>
<td>1</td>
<td>[0] [1]</td>
</tr>
<tr>
<td>2</td>
<td>[0] [2]</td>
</tr>
<tr>
<td>3</td>
<td>[0] [3]</td>
</tr>
<tr>
<td>4</td>
<td>[1] [0]</td>
</tr>
<tr>
<td>5</td>
<td>[1] [1]</td>
</tr>
<tr>
<td>6</td>
<td>[1] [2]</td>
</tr>
<tr>
<td>7</td>
<td>[1] [3]</td>
</tr>
<tr>
<td>8</td>
<td>[2] [0]</td>
</tr>
<tr>
<td>9</td>
<td>[2] [1]</td>
</tr>
<tr>
<td>10</td>
<td>[2] [2]</td>
</tr>
<tr>
<td>11</td>
<td>[2] [3]</td>
</tr>
</tbody>
</table>
<p>Âú®ÂÜÖÂ≠ò‰πã‰∏≠Ôºå3√ó4ÁöÑ‰∫åÁª¥Êï∞ÁªÑÂ∞Ü‰æùÊ¨°Â≠òÂÇ®‰∏∫ËøûÁª≠ÁöÑ12‰∏™ÂÖÉÁ¥†ÔºåÂ¶ÇË°®18.2ÊâÄÁ§∫„ÄÇ</p>
<p>Âú®<code>ËÆ°ÁÆó‰∏äËø∞Êï∞ÁªÑ‰∏≠Êüê‰∏™ÁâπÂÆöÂÖÉÁ¥†ÁöÑÂÜÖÂ≠òÂ≠òÂÇ®ÁºñÂè∑Êó∂ÔºåÂèØ‰ª•ÂÖàÂ∞Ü‰∫åÁª¥Á¥¢ÂºïÂè∑ÁöÑÁ¨¨‰∏Ä‰∏™Á¥¢ÂºïÂè∑‰πò‰ª•4ÔºàÁü©ÈòµÂÆΩÂ∫¶ÔºâÔºåËÄåÂêéÂä†‰∏äÁ¨¨‰∫å‰∏™Á¥¢ÂºïÂè∑„ÄÇ</code>ËøôÁßçÊñπÂºèÂ∞±ÊòØC/C++„ÄÅPythonÊâÄÁî®ÁöÑ‚ÄúË°å‰ºòÂÖàÁöÑÈ°∫Â∫è‚ÄùÔºàrow-majororderÔºâ„ÄÇ<mark>ÊâÄË∞ìË°å‰ºòÂÖàÔºåÂ∞±ÊòØÂÖàÁî®Á¨¨‰∏ÄË°åÊéíÊª°Á¨¨‰∏Ä‰∏™Á¥¢ÂºïÂè∑‰∏ãÁöÑÊâÄÊúâÂÖÉÁ¥†ÔºåÁÑ∂ÂêéÂÜç‰æùÊ¨°ÁºñÊéíÂÖ∂‰ªñÂêÑË°å„ÄÇ</mark></p>
<p><code>‰ªéÊÄßËÉΩÂèäÁºìÂ≠òÁöÑËßíÂ∫¶Êù•ÁúãÔºå‰∏éÊï∞ÊçÆÁöÑÂ≠òÂÇ®ÊñπÊ°àÔºàscheme)ÂíåÁªÑÁªáÊñπÂºèÔºàdata organizationÔºâÂåπÈÖçÁöÑ‰ºòÂÖàÈ°∫Â∫èÊúÄ‰ºò</code>„ÄÇÂè™Ë¶ÅÁõ∏‰∫íÂåπÈÖçÔºåÈÇ£‰πàÁ®ãÂ∫èÂ∞±ÂèØ‰ª•ËøûÁª≠ËÆøÈóÆÊï∞ÊçÆÔºåÊï¥‰ΩìÊÄßËÉΩÂ∞±‰ºöÊèêÈ´ò„ÄÇÊâÄ‰ª•ÔºåÂ¶ÇÊûúÁ®ãÂ∫è‰ª•‚ÄúÈÄêË°å‚ÄùÁöÑÊñπÂºèËÆøÈóÆÊï∞ÊçÆÔºåÈÇ£‰πàÂ∞±Â∫îÂΩì‰ª•Ë°å‰ºòÂÖàÁöÑÈ°∫Â∫èÁªÑÁªáÊï∞ÁªÑÔºõÂèç‰πã‰∫¶ÁÑ∂„ÄÇ</p>
<hr />
<p>ÊòæÁÑ∂Ê†πÊçÆËøôÁßçËßÑÂàôÊàë‰ª¨ÂèØ‰ª•Âà©Áî®‰∏ÄÁª¥Êï∞ÁªÑÁöÑÊñπÂºèËÆøÈóÆ‰∫åÁª¥Êï∞ÁªÑ</p>
<p>‰æãÂ¶Ç</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">char</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">char</span> <span class="token function">get_by_coordinates1</span> <span class="token punctuation">(</span><span class="token keyword">char</span> array<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> array<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">char</span> <span class="token function">get_by_coordinates2</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>array<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token comment">// treat input array as one-dimensional</span>
        <span class="token comment">// 4 is array width here</span>
        <span class="token keyword">return</span> array<span class="token punctuation">[</span>a<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">char</span> <span class="token function">get_by_coordinates3</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>array<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token comment">// treat input array as pointer,</span>
        <span class="token comment">// calculate address, get value at it</span>
        <span class="token comment">// 4 is array width here</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span>array<span class="token operator">+</span>a<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">get_by_coordinates1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">get_by_coordinates2</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">get_by_coordinates3</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>Optimizing gcc</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; RDI=address of array</span>
<span class="token comment">; RSI=a</span>
<span class="token comment">; RDX=b</span>

<span class="token label function">get_by_coordinates1:</span>
<span class="token comment">; sign-extend input 32-bit int values "a" and "b" to 64-bit ones</span>
        movsx   <span class="token register variable">rsi</span>, <span class="token register variable">esi</span>
        movsx   <span class="token register variable">rdx</span>, <span class="token register variable">edx</span>
        lea     <span class="token register variable">rax</span>, <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token register variable">rsi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; RAX=RDI+RSI*4=address of array+a*4</span>
        movzx   <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">]</span>
<span class="token comment">; AL=load byte at address RAX+RDX=address of array+a*4+b</span>
        ret

<span class="token label function">get_by_coordinates2:</span>
        lea     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token register variable">rsi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; RAX=RDX+RSI*4=b+a*4</span>
        cdqe
        movzx   <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>
<span class="token comment">; AL=load byte at address RDI+RAX=address of array+b+a*4</span>
        ret

<span class="token label function">get_by_coordinates3:</span>
        sal     <span class="token register variable">esi</span>, <span class="token number">2</span>
<span class="token comment">; ESI=a&lt;&lt;2=a*4</span>
<span class="token comment">; sign-extend input 32-bit int values "a*4" and "b" to 64-bit ones</span>
        movsx   <span class="token register variable">rdx</span>, <span class="token register variable">edx</span>
        movsx   <span class="token register variable">rsi</span>, <span class="token register variable">esi</span>
        add     <span class="token register variable">rdi</span>, <span class="token register variable">rsi</span>
<span class="token comment">; RDI=RDI+RSI=address of array+a*4</span>
        movzx   <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">]</span>
<span class="token comment">; AL=load byte at address RDI+RDX=address of array+a*4+b</span>
        ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏âËÄÖÊ±áÁºñÂæàÊé•ËøëÂπ∂‰∏îËÆ°ÁÆóÁöÑ‰∏ãÊ†áÊòØ‰∏ÄÊ†∑ÁöÑ</p>
<hr />
<p>Â§öÁª¥Êï∞ÁªÑÁöÑÊÉÖÂÜµ‰πüÂ∑Æ‰∏çÂ§öÔºå‰æãÂ¶Ç‰∏âÁª¥</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        a<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token operator">=</span>value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>msvs x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_DATA      SEGMENT
COMM       _a:DWORD:<span class="token number">01770H</span>
_DATA      ENDS
PUBLIC     _insert
_TEXT      SEGMENT
_x<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>               <span class="token comment">; size = 4</span>
_y<span class="token operator">$</span><span class="token operator">=</span><span class="token number">12</span>                <span class="token comment">; size = 4</span>
_z<span class="token operator">$</span><span class="token operator">=</span><span class="token number">16</span>                <span class="token comment">; size = 4</span>
_value<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">20</span>          <span class="token comment">; size = 4</span>
_insert     PROC
    push    <span class="token register variable">ebp</span>
    mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    mov     <span class="token register variable">eax</span>, DWORD PTR _x<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    imul    <span class="token register variable">eax</span>, <span class="token number">2400</span>                <span class="token comment">; eax=600*4*x</span>
    mov     <span class="token register variable">ecx</span>, DWORD PTR _y<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    imul    <span class="token register variable">ecx</span>, <span class="token number">120</span>                 <span class="token comment">; ecx=30*4*y</span>
    lea     <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">]</span><span class="token comment">; edx=a + 600*4*x + 30*4*y</span>
    mov     <span class="token register variable">eax</span>, DWORD PTR _z<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov     <span class="token register variable">ecx</span>, DWORD PTR _value<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ecx</span><span class="token comment">; *(edx+z*4)=value</span>
    pop     <span class="token register variable">ebp</span>
    ret     <span class="token number">0</span>
_insert     ENDP
_TEXT       ENDS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êï∞ÁªÑÂÖÉÁ¥†Âú∞ÂùÄ=600√ó4<em>x</em> + 30√ó4<em>y</em> + 4<em>z</em>„ÄÇ32‰ΩçÁ≥ªÁªüÈáåintÁ±ªÂûãÊòØ32‰ΩçÔºà4Â≠óËäÇÔºâÊï∞ÊçÆÔºåÊâÄ‰ª•Ë¶ÅÊØèÈ°πÈÉΩË¶Å‰πò‰ª•4„ÄÇ</p>
<hr />
<p><code>gcc</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">           public  insert
insert     proc near

x          <span class="token operator">=</span> dword ptr <span class="token number">8</span>
y          <span class="token operator">=</span> dword ptr  <span class="token number">0Ch</span>
z          <span class="token operator">=</span> dword ptr  <span class="token number">10h</span>
value      <span class="token operator">=</span> dword ptr  <span class="token number">14h</span>

           push    <span class="token register variable">ebp</span>
           mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
           push    <span class="token register variable">ebx</span>
           mov     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>x<span class="token operator">]</span><span class="token comment">;ebx=x</span>
           mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>y<span class="token operator">]</span><span class="token comment">;eax=y</span>
           mov     <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>z<span class="token operator">]</span><span class="token comment">;ecx=z</span>
           lea     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">]</span>              <span class="token comment">; edx=y*2</span>
           mov     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>                    <span class="token comment">; eax=y*2</span>
           shl     <span class="token register variable">eax</span>, <span class="token number">4</span>                      <span class="token comment">; eax=(y*2)&lt;&lt;4 = y*2*16 = y*32</span>
           sub     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>                    <span class="token comment">; eax=y*32 - y*2=y*30</span>
           imul    <span class="token register variable">edx</span>, <span class="token register variable">ebx</span>, <span class="token number">600</span>               <span class="token comment">; edx=x*600</span>
           add     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>                    <span class="token comment">; eax=eax+edx=y*30 + x*600</span>
           lea     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">]</span>              <span class="token comment">; edx=y*30 + x*600 + z</span>
           mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>value<span class="token operator">]</span>
           mov     dword ptr <span class="token register variable">ds</span>:a<span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">eax</span>  <span class="token comment">; *(a+edx*4)=value</span>
           pop     <span class="token register variable">ebx</span>
           pop     <span class="token register variable">ebp</span>
           retn
insert     endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>gccÂú®ËÆ°ÁÆó30yËøõË°å‰∫Ü‰ºòÂåñ;(<em>y</em> + <em>y</em>) &lt;&lt; 4 ‚àí (<em>y</em> + <em>y</em>) = (2 <em>y</em>)&lt;&lt; 4 ‚àí 2 <em>y</em> = 2√ó16<em>y</em> ‚àí 2 <em>y</em> = 32 <em>y</em> ‚àí 2 <em>y</em> = 30 <em>y</em></li>
</ul>
<hr />
<p>ËÆ°ÁÆóÊú∫ÁöÑÊòæÁ§∫Â±èÂπïÊòØ‰∏Ä‰∏™2DÊòæÁ§∫Á©∫Èó¥Ôºå‰ΩÜÊòØÊòæÂ≠òÂç¥ÊòØ‰∏Ä‰∏™‰∏ÄÁª¥Á∫øÊÄßÊï∞ÁªÑ„ÄÇ</p>
<h4 id="‰∫åÁª¥Â≠óÁ¨¶‰∏≤Êï∞ÁªÑÁöÑÂ∞ÅË£ÖÊ†ºÂºè"><a class="markdownIt-Anchor" href="#‰∫åÁª¥Â≠óÁ¨¶‰∏≤Êï∞ÁªÑÁöÑÂ∞ÅË£ÖÊ†ºÂºè"></a> ‰∫åÁª¥Â≠óÁ¨¶‰∏≤Êï∞ÁªÑÁöÑÂ∞ÅË£ÖÊ†ºÂºè</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h></span></span>

<span class="token keyword">const</span> <span class="token keyword">char</span> month2<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">=</span>
<span class="token punctuation">&#123;</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'J'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'n'</span><span class="token punctuation">,</span><span class="token char">'u'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span><span class="token char">'y'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'F'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span><span class="token char">'u'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span><span class="token char">'y'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'M'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span><span class="token char">'c'</span><span class="token punctuation">,</span><span class="token char">'h'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'A'</span><span class="token punctuation">,</span><span class="token char">'p'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span><span class="token char">'i'</span><span class="token punctuation">,</span><span class="token char">'l'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'M'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'y'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'J'</span><span class="token punctuation">,</span><span class="token char">'u'</span><span class="token punctuation">,</span><span class="token char">'n'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'J'</span><span class="token punctuation">,</span><span class="token char">'u'</span><span class="token punctuation">,</span><span class="token char">'l'</span><span class="token punctuation">,</span><span class="token char">'y'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'A'</span><span class="token punctuation">,</span><span class="token char">'u'</span><span class="token punctuation">,</span><span class="token char">'g'</span><span class="token punctuation">,</span><span class="token char">'u'</span><span class="token punctuation">,</span><span class="token char">'s'</span><span class="token punctuation">,</span><span class="token char">'t'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'S'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'p'</span><span class="token punctuation">,</span><span class="token char">'t'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'m'</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'O'</span><span class="token punctuation">,</span><span class="token char">'c'</span><span class="token punctuation">,</span><span class="token char">'t'</span><span class="token punctuation">,</span><span class="token char">'o'</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'N'</span><span class="token punctuation">,</span><span class="token char">'o'</span><span class="token punctuation">,</span><span class="token char">'v'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'m'</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token char">'D'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'c'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'m'</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'r'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// in 0..11 range</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">get_month2</span> <span class="token punctuation">(</span><span class="token keyword">int</span> month<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">&amp;</span>month2<span class="token punctuation">[</span>month<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Optimizing msvs</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">month2  DB      <span class="token number">04aH</span>
        DB      <span class="token number">061H</span>
        DB      <span class="token number">06eH</span>
        DB      <span class="token number">075H</span>
        DB      <span class="token number">061H</span>
        DB      <span class="token number">072H</span>
        DB      <span class="token number">079H</span>
        DB      <span class="token number">00H</span>
        DB      <span class="token number">00H</span>
        DB      <span class="token number">00H</span>
...
get_month2 PROC
<span class="token comment">; sign-extend input argument and promote to 64-bit value</span>
        movsxd  <span class="token register variable">rax</span>, <span class="token register variable">ecx</span>
        lea     <span class="token register variable">rcx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; RCX=month+month*4=month*5</span>
        lea     <span class="token register variable">rax</span>, OFFSET FLAT:month2
<span class="token comment">; RAX=pointer to table</span>
        lea     <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rcx</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">]</span>
<span class="token comment">; RAX=pointer to table + RCX*2=pointer to table + month*5*2=pointer to table + month*10</span>
        ret     <span class="token number">0</span>
get_month2  ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>‰∏äËø∞Á®ãÂ∫èÂÆåÂÖ®‰∏çËÆøÈóÆÂÜÖÂ≠ò„ÄÇÊï¥‰∏™ÂáΩÊï∞ÁöÑÂäüËÉΩÔºåÂè™ÊòØËÆ°ÁÆóÊúà‰ªΩÂêçÁß∞Â≠óÁ¨¶‰∏≤ÁöÑÈ¶ñÂ≠óÊØçÊåáÈíàpointer_to_the_table+month*10„ÄÇÂÆÉ‰ΩøÁî®ÂçïÊù°LEAÊåá‰ª§ÔºåÊõø‰ª£‰∫ÜÂ§öÊù°MULÂíåMOVÊåá‰ª§„ÄÇ</p>
</li>
<li>
<p>‰∏äËø∞Êï∞ÁªÑÁöÑÊØè‰∏™Â≠óÁ¨¶‰∏≤ÈÉΩÂç†Áî®10Â≠óËäÇÁ©∫Èó¥„ÄÇÊúÄÈïøÁöÑÂ≠óÁ¨¶‰∏≤Áî±‚ÄúSeptember‚ÄùÂíåÂÜÖÂÆπ‰∏∫Èõ∂ÁöÑÂ≠óËäÇÊûÑÊàêÔºåÂÖ∂‰ΩôÁöÑÂ≠óÁ¨¶‰∏≤‰ΩøÁî®Èõ∂Â≠óËäÇÂØπÈΩêÔºåÊâÄ‰ª•ÊØè‰∏™Â≠óÁ¨¶‰∏≤ÈÉΩÂç†Áî®10‰∏™Â≠óËäÇ„ÄÇÂ¶ÇÊ≠§‰∏ÄÊù•ÔºåËÆ°ÁÆóÂ≠óÁ¨¶‰∏≤È¶ñÂú∞ÂùÄÁöÑÊñπÂºèÂèòÂæóÁÆÄÂçïÔºåÊï¥‰∏™ÂáΩÊï∞ÁöÑÊïàÁéá‰πü‰ºöÊúâÊâÄÊèêÈ´ò„ÄÇ</p>
</li>
</ul>
<hr />
<p><code>Optimizing gcc</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">movsx   <span class="token register variable">rdi</span>, <span class="token register variable">edi</span>
    lea     <span class="token register variable">rax</span>, <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token register variable">rdi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
    lea     <span class="token register variable">rax</span>, month2<span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>
    ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Áõ¥Êé•‰ΩøÁî®LEAÊåá‰ª§ËøõË°å‰πò‰ª•10ÁöÑËÆ°ÁÆó</p>
<hr />
<p><code>Not Optimizing GCC</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">get_month2:</span>
        push    <span class="token register variable">rbp</span>
        mov     <span class="token register variable">rbp</span>, <span class="token register variable">rsp</span>
        mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edi</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        movsx   <span class="token register variable">rdx</span>, <span class="token register variable">eax</span>
<span class="token comment">; RDX = sign-extended input value</span>
        mov     <span class="token register variable">rax</span>, <span class="token register variable">rdx</span>
<span class="token comment">; RAX = month</span>
        sal     <span class="token register variable">rax</span>, <span class="token number">2</span>
<span class="token comment">; RAX = month&lt;&lt;2 = month*4</span>
        add     <span class="token register variable">rax</span>, <span class="token register variable">rdx</span>
<span class="token comment">; RAX = RAX+RDX = month*4+month = month*5</span>
        add     <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
<span class="token comment">; RAX = RAX*2 = month*5*2 = month*10</span>
        add     <span class="token register variable">rax</span>, OFFSET FLAT:month2
<span class="token comment">; RAX = month*10 + pointer to the table</span>
        pop     <span class="token register variable">rbp</span>
        ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏çÂºÄÂêØ‰ºòÂåñÁºñËØëÔºåGCCÁöÑ‰πòÊ≥ïËøêÁÆóÊñπÂºè‰∏çÂêå</p>
<hr />
<p><code>Not Optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">month<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
get_month2 PROC
        mov      DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
        movsxd   <span class="token register variable">rax</span>, DWORD PTR month<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
<span class="token comment">; RAX = sign-extended input value into 64-bit one</span>
        imul     <span class="token register variable">rax</span>, <span class="token register variable">rax</span>, <span class="token number">10</span>
<span class="token comment">; RAX = RAX*10</span>
        lea      <span class="token register variable">rcx</span>, OFFSET FLAT:month2
<span class="token comment">; RCX = pointer to the table</span>
        add      <span class="token register variable">rcx</span>, <span class="token register variable">rax</span>
<span class="token comment">; RCX = RCX+RAX = pointer to the table+month*10</span>
        mov      <span class="token register variable">rax</span>, <span class="token register variable">rcx</span>
<span class="token comment">; RAX = pointer to the table+month*10</span>
        mov      <span class="token register variable">ecx</span>, <span class="token number">1</span>
<span class="token comment">; RCX = 1</span>
        imul     <span class="token register variable">rcx</span>, <span class="token register variable">rcx</span>, <span class="token number">0</span>
<span class="token comment">; RCX = 1*0 = 0</span>
        add      <span class="token register variable">rax</span>, <span class="token register variable">rcx</span>
<span class="token comment">; RAX = pointer to the table+month*10 + 0 = pointer to the table+month*10</span>
        ret      <span class="token number">0</span>
get_month2 ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>msvs‰∏çÂºÄÂêØ‰ºòÂåñÔºå‰ºöÁõ¥Êé•‰ΩøÁî®imulÊåá‰ª§ÔºåÁÑ∂ËÄå‰∏∫‰ªÄ‰πàRCXË¶Å‰πò‰ª•0Ôºü‰ΩúËÄÖËØ¥ËøôÊòØMSVSÁöÑÊÄ™Áôñ‰ª£Á†ÅÔºåÂ∏åÊúõÊàë‰ª¨‰ªéÁºñÁ®ã‰∫∫ÂëòÁöÑËßíÂ∫¶Êù•ÁêÜËß£Á®ãÂ∫èÁöÑÊ∫ê‰ª£Á†Å</li>
</ul>
<h4 id="problem-4"><a class="markdownIt-Anchor" href="#problem-4"></a> Problem</h4>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂáΩÊï∞ÂºÄÂßã</span>
?s@@YAXPAN00@Z PROC<span class="token comment">; s, COMDAT</span>

<span class="token comment">; Â∞ÜÂèÇÊï∞Âä†ËΩΩÂà∞ÂØÑÂ≠òÂô®‰∏≠</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>  <span class="token comment">; eax = ÁªìÊùüÂú∞ÂùÄ - 4 (ÂÆûÈôÖÊòØ_bÁöÑÂú∞ÂùÄ)</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>  <span class="token comment">; ecx = Ëµ∑ÂßãÂú∞ÂùÄ - 4(aÁöÑÂú∞ÂùÄ)</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR _c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>  <span class="token comment">; edx = ÁªìÊûúÂ≠òÊîæÂú∞ÂùÄ - 4(cÁöÑÂú∞ÂùÄ)</span>

<span class="token comment">; ‰øùÂ≠òÂØÑÂ≠òÂô®ediÂíåesiÔºåÁî®‰∫éÂæ™ÁéØ,Âõ†‰∏∫Ê≠§ÂêéediÂíåesi‰Ωú‰∏∫ËÆ°Êï∞Âô®,</span>
    push   <span class="token register variable">esi</span>  
    push   <span class="token register variable">edi</span>
    
<span class="token comment">; ËÆ°ÁÆóÊï∞ÁªÑÈïøÂ∫¶Ôºå‰∏§Ê¨°ÂáèÊ≥ïÂÆûË¥®‰∏äÂæóÂà∞ÁöÑÊòØ_b - _aÁöÑÂÄºÔºåÂç≥ÂÖÉÁ¥†‰∏™Êï∞Ôºå‰ΩÜËøôÈáåÊòØÁî®Â≠óËäÇÊï∞Ë°®Á§∫ÁöÑ</span>
    sub    <span class="token register variable">ecx</span>, <span class="token register variable">eax</span>                  <span class="token comment">; ecx = Ëµ∑ÂßãÂú∞ÂùÄ‰∏éÁªìÊùüÂú∞ÂùÄ‰πãÈó¥ÁöÑË∑ùÁ¶ªÔºàÂ≠óËäÇÊï∞Ôºâ</span>
    sub    <span class="token register variable">edx</span>, <span class="token register variable">eax</span>                  <span class="token comment">; edxÂêåÊ†∑Ë∞ÉÊï¥ÔºåÁ°Æ‰øùÁªìÊûúÂ≠òÂõûÂéüÂå∫Èó¥</span>

<span class="token comment">; ËÆæÁΩÆÂ§ñÂ±ÇÂæ™ÁéØÊ¨°Êï∞‰∏∫200Ê¨°ÔºàÊØèÊ¨°Â§ÑÁêÜ‰∏§‰∏™ÊµÆÁÇπÊï∞ÔºåÂêàËÆ°Â§ÑÁêÜ400‰∏™ÊµÆÁÇπÊï∞Ôºâ</span>
    mov    <span class="token register variable">edi</span>, <span class="token number">200</span>     <span class="token comment">; 000000c8H;edi=i</span>

<span class="token label function">$LL6@s:</span>                              <span class="token comment">; Â§ñÂ±ÇÂæ™ÁéØÂºÄÂßã</span>
    push   <span class="token number">100</span>          <span class="token comment">; 00000064H   ; ÂÜÖÂ±ÇÂæ™ÁéØËÆ°Êï∞Âô®ÔºåÊØèÊ¨°Â§ÑÁêÜ100ÂØπÊµÆÁÇπÊï∞</span>
    pop	<span class="token register variable">esi</span><span class="token comment">;esi=100,‰Ωú‰∏∫ËÆ°Êï∞Âô®</span>
<span class="token label function">$LL3@s:</span>                              <span class="token comment">; ÂÜÖÂ±ÇÂæ™ÁéØÂºÄÂßã</span>
    fld    QWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">]</span>      <span class="token comment">; Â∞ÜÂΩìÂâçÂú∞ÂùÄÁöÑÊµÆÁÇπÊï∞Êé®ÂÖ•FPUÂ†ÜÊ†à</span>
    fadd   QWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>          <span class="token comment">; Â∞ÜÊ∫êÂú∞ÂùÄÁöÑÊµÆÁÇπÊï∞‰∏éÊ†àÈ°∂ÁöÑÊµÆÁÇπÊï∞Áõ∏Âä†</span>
    fstp   QWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">]</span>      <span class="token comment">; Â∞ÜÁªìÊûú‰ªéÂ†ÜÊ†àÂºπÂá∫Âπ∂Â≠òÂõûÁõÆÁöÑÂú∞ÂùÄ</span>
    add    <span class="token register variable">eax</span>, <span class="token number">8</span>                   <span class="token comment">; eaxÊåáÈíàÂêëÂâçÁßªÂä®8Â≠óËäÇÔºåÊåáÂêë‰∏ã‰∏Ä‰∏™ÊµÆÁÇπÊï∞</span>
    dec    <span class="token register variable">esi</span>                      <span class="token comment">; ÂÜÖÂ±ÇÂæ™ÁéØËÆ°Êï∞Âô®ÈÄíÂáè</span>
    jne    SHORT <span class="token operator">$</span>LL3@s              <span class="token comment">; Â¶ÇÊûúÊú™ËææÂà∞ÂÜÖÂ±ÇÂæ™ÁéØÊ¨°Êï∞ÔºåÂàôË∑≥ËΩ¨ÁªßÁª≠ÂÜÖÂ±ÇÂæ™ÁéØ</span>

    dec    <span class="token register variable">edi</span>                      <span class="token comment">; Â§ñÂ±ÇÂæ™ÁéØËÆ°Êï∞Âô®ÈÄíÂáè</span>
    jne    SHORT <span class="token operator">$</span>LL6@s              <span class="token comment">; Â¶ÇÊûúÊú™ËææÂà∞Â§ñÂ±ÇÂæ™ÁéØÊ¨°Êï∞ÔºåÂàôË∑≥ËΩ¨ÁªßÁª≠Â§ñÂ±ÇÂæ™ÁéØ</span>

<span class="token comment">; ÊÅ¢Â§ç‰øùÂ≠òÁöÑÂØÑÂ≠òÂô®ÔºåÂπ∂Ê∏ÖÁêÜÊ†à</span>
    pop    <span class="token register variable">edi</span>
    pop    <span class="token register variable">esi</span>
    ret    <span class="token number">0</span>                        <span class="token comment">; ÂáΩÊï∞ËøîÂõûÔºå‰∏çÂ∏¶ËøîÂõûÂÄº</span>
?s@@YAXPAN00@Z  ENDP   <span class="token comment">; s ÂáΩÊï∞ÁªìÊùü</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">M</span>    <span class="token expression"><span class="token number">100</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span>    <span class="token expression"><span class="token number">200</span></span></span>
<span class="token keyword">void</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">*</span>c<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>M<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token operator">*</span><span class="token punctuation">(</span>c<span class="token operator">+</span>i<span class="token operator">*</span>M<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">*</span><span class="token punctuation">(</span>a<span class="token operator">+</span>i<span class="token operator">*</span>M<span class="token operator">+</span>j<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>b<span class="token operator">+</span>i<span class="token operator">*</span>M<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<ol start="2">
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂáΩÊï∞ÂºÄÂßãÔºåÊ†áÂáÜÁöÑÂáΩÊï∞Ê°ÜÊû∂Âª∫Á´ã</span>
?m@@YAXPAN00@Z PROC<span class="token comment">; m, COMDAT</span>
    push   <span class="token register variable">ebp</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    push   <span class="token register variable">ecx</span>                     <span class="token comment">; ‰øùÂ≠òecx</span>
    push   <span class="token register variable">ecx</span>                     <span class="token comment">; ËøôÈáåÈáçÂ§çpush ecxÂèØËÉΩÊòØ‰∏∫‰∫ÜÂØπÈΩêÊ†àÊàñËÄÖ‰øùÁïôÁ©∫Èó¥(MSVSÁöÑÊÄ™Áôñ‰ª£Á†Å)</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; edx = _a$ (Ëµ∑ÂßãÂú∞ÂùÄ)</span>
    push   <span class="token register variable">ebx</span>                     <span class="token comment">; ‰øùÂ≠òebx</span>
    mov    <span class="token register variable">ebx</span>, DWORD PTR _c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; ebx = _c$ (ÁõÆÊ†áÂú∞ÂùÄÊàñÂè¶‰∏Ä‰∏™Ëµ∑ÂßãÂú∞ÂùÄ)</span>
    push   <span class="token register variable">esi</span>                     <span class="token comment">; ‰øùÂ≠òesi</span>
    mov    <span class="token register variable">esi</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; esi = _b$ (ÂèØËÉΩÁöÑÁªìÊùüÂú∞ÂùÄÊàñÂÅèÁßªÈáè)</span>

<span class="token comment">; ËÆ°ÁÆóÊï∞ÁªÑÈïøÂ∫¶ÊàñÂÅèÁßª</span>
    sub    <span class="token register variable">edx</span>, <span class="token register variable">esi</span>                <span class="token comment">; ËÆ°ÁÆóÈïøÂ∫¶ÊàñÂÅèÁßª1;edx=edx-esi=ptr(a-b)</span>
    push   <span class="token register variable">edi</span>                     <span class="token comment">; ‰øùÂ≠òedi</span>
    sub    <span class="token register variable">esi</span>, <span class="token register variable">ebx</span>                <span class="token comment">; ËÆ°ÁÆóÈïøÂ∫¶ÊàñÂÅèÁßª2ÔºåÊ≥®ÊÑèËøôÈáåÁöÑÊìç‰Ωú‰ºº‰πé‰∏éÈ¢ÑÊúüÈÄªËæë‰∏çÁ¨¶ÔºåÈúÄÁªìÂêàÂÖ∑‰ΩìÁÆóÊ≥ïÁêÜËß£</span>
<span class="token comment">;esi=esi-ebx=ptr(b-c)</span>
<span class="token comment">; ÂàùÂßãÂåñÂæ™ÁéØËÆ°Êï∞Âô®</span>
    mov    DWORD PTR tv315<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">100</span>  <span class="token comment">; Â§ñÂ±ÇÂæ™ÁéØËÆ°Êï∞Âô®ËÆæ‰∏∫100;tv315=100</span>
<span class="token label function">$LL9@m:</span>                              <span class="token comment">; Â§ñÂ±ÇÂæ™ÁéØÂºÄÂßã</span>
    mov    <span class="token register variable">eax</span>, <span class="token register variable">ebx</span>                <span class="token comment">; eax = ebx=cÔºåÂèØËÉΩÁî®‰∫éÂú∞ÂùÄËÆ°ÁÆó</span>
    mov    DWORD PTR tv291<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">300</span>  <span class="token comment">; ÂÜÖÂ±ÇÂæ™ÁéØËÆ°Êï∞Âô®ËÆæ‰∏∫300;tv291=300</span>
<span class="token label function">$LL6@m:</span>                              <span class="token comment">; ÂÜÖÂ±ÇÂæ™ÁéØÂºÄÂßã</span>
    fldz                           <span class="token comment">; Âä†ËΩΩ0.0Âà∞FPUÂ†ÜÊ†àÔºåÂáÜÂ§áÁ¥ØÂä†</span>
    lea    <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">]</span> <span class="token comment">; ËÆ°ÁÆóÂΩìÂâçÂ§ÑÁêÜÂÖÉÁ¥†ÁöÑÂú∞ÂùÄ;ecx=b</span>
    fstp   QWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>         <span class="token comment">; Â∞Ü0.0Â≠òÂÖ•eaxÊåáÂêëÁöÑ‰ΩçÁΩÆÔºåÊ∏Ö0,Ê≠§Êó∂eaxÊåáÂêëc;*c=0‰Ωç‰∫éÁ¨¨‰∫åÂ±ÇÂæ™ÁéØÔºåeax‰Ωú‰∏∫Âæ™ÁéØÁöÑÊåáÈíà</span>

    mov    <span class="token register variable">edi</span>, <span class="token number">200</span>                <span class="token comment">; edi‰Ωú‰∏∫ËÆ°Êï∞Âô®;edi=200</span>
<span class="token label function">$LL3@m:</span>                              <span class="token comment">; Á¨¨‰∏âÂ±ÇÂæ™ÁéØÂºÄÂßã</span>
    dec    <span class="token register variable">edi</span>                     <span class="token comment">; Âæ™ÁéØËÆ°Êï∞Âô®ÈÄíÂáè</span>
    fld    QWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">]</span>     <span class="token comment">; ‰ªéÂΩìÂâçÂú∞ÂùÄÂä†‰∏ä‰πãÂâçËÆ°ÁÆóÁöÑÂÅèÁßªÂ§ÑÂèñÂÖÉÁ¥†ÔºåÊé®ÂÖ•FPUÊ†à;ecx+edx=b+a-b=a</span>
    fmul   QWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>         <span class="token comment">; Â∞ÜÊ†àÈ°∂ÂÖÉÁ¥†‰∏éecxÂú∞ÂùÄÂ§ÑÁöÑÂÖÉÁ¥†Áõ∏‰πò *a=*ax*b+c</span>
    fadd   QWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>         <span class="token comment">; Â∞Ü‰πòÁßØ‰∏éeaxÂú∞ÂùÄÂ§ÑÁöÑÂÖÉÁ¥†Áõ∏Âä†ÔºåÂπ∂Â∞ÜÁªìÊûúÊîæÂõûeaxÂú∞ÂùÄ,c</span>
    fstp   QWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>         <span class="token comment">; ÂºπÂá∫FPUÊ†àÈ°∂ÂÖÉÁ¥†ÔºàÂ∑≤Êó†Áî®Ôºâ;ËøôÈáåÁöÑËøêÁÆó‰∏éediÊó†ÂÖ≥</span>
    jne    SHORT <span class="token operator">$</span>LL3@m             <span class="token comment">; Ëã•ediÈùûÈõ∂ÔºåÁªßÁª≠ÂÜÖÂ±ÇÂæ™ÁéØ</span>

    add    <span class="token register variable">eax</span>, <span class="token number">8</span>                  <span class="token comment">; eaxÊåáÂêë‰∏ã‰∏Ä‰∏™ÂÖÉÁ¥†</span>
    dec    DWORD PTR tv291<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>     <span class="token comment">; ÂÜÖÂ±ÇÂæ™ÁéØËÆ°Êï∞Âô®ÈÄíÂáè</span>
    jne    SHORT <span class="token operator">$</span>LL6@m             <span class="token comment">; Ëã•ÂÜÖÂ±ÇËÆ°Êï∞Âô®ÈùûÈõ∂ÔºåÁªßÁª≠ÂÜÖÂ±ÇÂæ™ÁéØ</span>

    add    <span class="token register variable">ebx</span>, <span class="token number">800</span>                <span class="token comment">; ebxÂ¢ûÂä†800ÔºåÂèØËÉΩÁî®‰∫éÂ§ÑÁêÜ‰∏ã‰∏ÄÊâπÊï∞ÊçÆ</span>
    dec    DWORD PTR tv315<span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>     <span class="token comment">; Â§ñÂ±ÇÂæ™ÁéØËÆ°Êï∞Âô®ÈÄíÂáè</span>
    jne    SHORT <span class="token operator">$</span>LL9@m             <span class="token comment">; Ëã•Â§ñÂ±ÇËÆ°Êï∞Âô®ÈùûÈõ∂ÔºåÁªßÁª≠Â§ñÂ±ÇÂæ™ÁéØ</span>

<span class="token comment">; Ê∏ÖÁêÜÂπ∂ËøîÂõû</span>
    pop    <span class="token register variable">edi</span>
    pop    <span class="token register variable">esi</span>
    pop    <span class="token register variable">ebx</span>
    leave                          <span class="token comment">; ÊÅ¢Â§çebpÂíåesp</span>
    ret    <span class="token number">0</span>                       <span class="token comment">; ÂáΩÊï∞ËøîÂõû</span>
?m@@YAXPAN00@Z ENDP                   <span class="token comment">; mÂáΩÊï∞ÁªìÊùü</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> tv315 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> tv291 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>c<span class="token operator">+</span>tv315<span class="token operator">*</span><span class="token number">100</span><span class="token operator">+</span>tv291<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span>
        <span class="token keyword">for</span> edi <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token operator">*</span><span class="token punctuation">(</span>c<span class="token operator">+</span>tv315<span class="token operator">*</span><span class="token number">100</span><span class="token operator">+</span>tv291<span class="token punctuation">)</span><span class="token operator">+=</span><span class="token operator">*</span><span class="token punctuation">(</span>a<span class="token operator">+</span>tv315<span class="token operator">*</span><span class="token number">100</span><span class="token operator">+</span>tv291<span class="token punctuation">)</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">(</span>b<span class="token operator">+</span>tv315<span class="token operator">*</span><span class="token number">100</span><span class="token operator">+</span>tv291<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_array<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_x<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>
_y<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>
_f      PROC
        mov     <span class="token register variable">eax</span>, DWORD PTR _x<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=x;</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR _y<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;edx=y;</span>
        mov     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span><span class="token comment">;ecx=x;</span>
        shl     <span class="token register variable">ecx</span>, <span class="token number">4</span><span class="token comment">;x*2^4;</span>
        sub     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span><span class="token comment">;ecx=15x</span>
        lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span><span class="token comment">;eax=y+120x</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;ecx=_array</span>
        fld     QWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span><span class="token comment">;ÊòæÁÑ∂ÊòØ8‰ΩçÊµÆÁÇπÊï∞ÔºådoubleÁ±ªÂûã</span>
        ret     <span class="token number">0</span><span class="token comment">;ËøîÂõûÁöÑÊòØ_array[y+120x]</span>
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">double</span> array<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> array<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//ÁêÜËÆ∫‰∏ä50ÊòØÁúã‰∏çÂá∫Êù•ÁöÑÔºåÂè™ËÉΩÂèçÊ±áÁºñÊàê‰∏ÄÁª¥ÁöÑÊï∞ÁªÑ_array[y+120x]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_array<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_x<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>
_y<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>
_z<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">20</span>
_f      PROC
        mov     <span class="token register variable">eax</span>, DWORD PTR _x<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=x</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR _y<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;edx=y</span>
        mov     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span><span class="token comment">;ecx=x</span>
        shl     <span class="token register variable">ecx</span>, <span class="token number">4</span><span class="token comment">;ecx=x*16</span>
        sub     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span><span class="token comment">;ecx=15x</span>
        lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=y+60x</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;ecx=ptr(array)</span>
        lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=5*(y+60x)</span>
        shl     <span class="token register variable">eax</span>, <span class="token number">4</span><span class="token comment">;eax=80*(y+60x)</span>
        add     <span class="token register variable">eax</span>, DWORD PTR _z<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=80y+4800x+z</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=array[80y+4800x+z];array‰∏∫intÁ±ªÂûã</span>
        ret     <span class="token number">0</span>
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊòæÁÑ∂ÊòØ‰∏âÁª¥Êï∞ÁªÑ<code>int array[][60][80];return array[x][y][z];</code></p>
<p>*5.(Â§™Èöæ‰∫Ü)</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂàùÂßãÂåñÊÆµÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Âêç‰∏∫_tblÁöÑÊï∞ÊçÆÊÆµÔºåÂ§ßÂ∞è‰∏∫64Â≠óËäÇÔºåÁî®‰∫éÂ≠òÊîæDWORDÔºàÂèåÂ≠óÔºâÁ±ªÂûãÁöÑÊï∞ÊçÆ</span>
COMM    _tbl:DWORD:<span class="token number">064H</span>

<span class="token comment">; ÂÆö‰πâÊú¨Âú∞ÂèòÈáètv759ÔºåÂàùÂßãÂåñÂÄº‰∏∫-4ÔºåÂç†Áî®4Â≠óËäÇ</span>
tv759 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>      <span class="token comment">;size= 4</span>

_main   PROC
    <span class="token comment">; ‰øùÂ≠òË∞ÉÁî®ËÄÖ‰øùÂ≠òÁöÑÂØÑÂ≠òÂô®</span>
    push    <span class="token register variable">ecx</span>
    push    <span class="token register variable">ebx</span>
    push    <span class="token register variable">ebp</span>
    push    <span class="token register variable">esi</span>
    
    <span class="token comment">; ÂàùÂßãÂåñÂØÑÂ≠òÂô®</span>
    xor     <span class="token register variable">edx</span>, <span class="token register variable">edx</span>          <span class="token comment">; EDX = 0</span>
    push    <span class="token register variable">edi</span>               <span class="token comment">; ‰øùÂ≠òEDI</span>
    xor     <span class="token register variable">esi</span>, <span class="token register variable">esi</span>          <span class="token comment">; ESI = 0</span>
    xor     <span class="token register variable">edi</span>, <span class="token register variable">edi</span>          <span class="token comment">; EDI = 0</span>
    xor     <span class="token register variable">ebx</span>, <span class="token register variable">ebx</span>          <span class="token comment">; EBX = 0</span>
    xor     <span class="token register variable">ebp</span>, <span class="token register variable">ebp</span>          <span class="token comment">; EBP = 0</span>
    
    <span class="token comment">; Â∞ÜEDXÔºàÂΩìÂâç‰∏∫0ÔºâÁöÑÂÄºÂ≠òÂÖ•Â±ÄÈÉ®ÂèòÈáètv759ÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆÔºåÂÅèÁßªesp+20</span>
    mov     DWORD PTR tv759<span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">]</span>, <span class="token register variable">edx</span><span class="token comment">;t=0</span>
    
    <span class="token comment">; ËÆæÁΩÆEAX‰∏∫_tblÁöÑÂú∞ÂùÄÂÅèÁßª4Â≠óËäÇÔºåÂç≥ÊåáÂêë_tblÁöÑÁ¨¨‰∏Ä‰∏™ÊúâÊïàÂÖÉÁ¥†</span>
    mov     <span class="token register variable">eax</span>, OFFSET _tbl<span class="token operator">+</span><span class="token number">4</span><span class="token comment">;eax=tbl[1]</span>
    
    <span class="token comment">; ÂØπÈΩêÊåá‰ª§ÔºåÁ°Æ‰øù‰∏ã‰∏ÄÊù°Ê†áÁ≠æÊ≠£Á°ÆÂØπÈΩê</span>
    npad    <span class="token number">8</span> 
    
<span class="token label function">$LL6@main:</span>
    <span class="token comment">; ËÆ°ÁÆóECX = EDX * 2ÔºåÁî®‰∫éÂêéÁª≠ËµãÂÄº</span>
    lea     <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">]</span><span class="token comment">;ecx=2*edx</span>
    
    <span class="token comment">; Â∞ÜECXÁöÑÂÄºÊîæÂÖ•ÂΩìÂâç_EAXÊåáÂêëÁöÑ‰ΩçÁΩÆ+4ÔºåÂç≥ÂàùÂßãÂåñtblÁöÑÁ¨¨‰∫å‰∏™DWORD</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ecx</span><span class="token comment">;tbl[i+1]=2*edx</span>
    
    <span class="token comment">; ‰ªéÂ†ÜÊ†à‰∏≠ËØªÂèñtv759ÁöÑÂÄºÂπ∂Â¢ûÂä†3ÔºåÁÑ∂ÂêéÂ≠òÂõûtv759ÁöÑ‰ΩçÁΩÆ</span>
    mov     <span class="token register variable">ecx</span>, DWORD PTR tv759<span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">]</span><span class="token comment">;ecx=t;</span>
    add     DWORD PTR tv759<span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">]</span>, <span class="token number">3</span><span class="token comment">;t+=3;</span>
    
    <span class="token comment">; Â∞ÜÊõ¥Êñ∞ÂêéÁöÑtv759ÂÄºÊîæÂÖ•ÂΩìÂâç_EAXÊåáÂêëÁöÑ‰ΩçÁΩÆ+8</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">ecx</span><span class="token comment">;ecx[i+2]=t</span>
    
    <span class="token comment">; ËÆ°ÁÆóECX = EDX * 4ÔºåÂπ∂Â≠òÂÖ•ÂΩìÂâç_EAXÊåáÂêëÁöÑ‰ΩçÁΩÆ+12</span>
    lea     <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
    
    <span class="token comment">; ËÆ°ÁÆóECX = EDX * 8ÔºåÂπ∂Â≠òÂÖ•ÂΩìÂâç_EAXÊåáÂêëÁöÑ‰ΩçÁΩÆ</span>
    lea     <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
    
    <span class="token comment">; ÂàùÂßãÂåñË°®ÁöÑÂÖ∂‰ªñÈÉ®ÂàÜÔºå‰ΩøÁî®Âõ∫ÂÆöÁöÑÂÄº</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">ebp</span>  <span class="token comment">; ebpÁöÑÂΩìÂâçÂÄºÔºà0Ôºâ</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>  <span class="token comment">; ebxÁöÑÂΩìÂâçÂÄºÔºà0Ôºâ</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>, <span class="token register variable">edi</span>  <span class="token comment">; ediÁöÑÂΩìÂâçÂÄºÔºà0Ôºâ</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>, <span class="token register variable">esi</span>  <span class="token comment">; esiÁöÑÂΩìÂâçÂÄºÔºà0Ôºâ</span>
    
    <span class="token comment">; Âú®ÂΩìÂâç_EAXÊåáÈíàÂâç‰∏Ä‰∏™DWORDÁöÑ‰ΩçÁΩÆÁΩÆ0</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">0</span>
    
    <span class="token comment">; Â∞ÜECXÔºàÂç≥EDX*8ÔºâÂ≠òÂÖ•ÂΩìÂâç_EAXÊåáÂêëÁöÑ‰ΩçÁΩÆ+28</span>
    mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
    
    <span class="token comment">; Êõ¥Êñ∞_EAXÊåáÈíàÔºåÂâçËøõÂà∞‰∏ã‰∏Ä‰∏™Ë¶ÅÂàùÂßãÂåñÁöÑË°®È°π</span>
    add     <span class="token register variable">eax</span>, <span class="token number">40</span>
    
    <span class="token comment">; Â¢ûÂä†Âæ™ÁéØËÆ°Êï∞Âô®</span>
    inc     <span class="token register variable">edx</span>
    
    <span class="token comment">; ÂÖ∂‰ªñÂæ™ÁéØÂÜÖÂ¢ûÈáèÔºåÁúã‰ºº‰∏éÊüêÁßçÊ®°ÂºèÊàñÁÆóÊ≥ïÁõ∏ÂÖ≥</span>
    add     <span class="token register variable">ebp</span>, <span class="token number">5</span>
    add     <span class="token register variable">ebx</span>, <span class="token number">6</span>
    add     <span class="token register variable">edi</span>, <span class="token number">7</span>
    add     <span class="token register variable">esi</span>, <span class="token number">9</span>
    
    <span class="token comment">; Ê£ÄÊü•ÊòØÂê¶Â∑≤Â§ÑÁêÜÂÆåÊï¥‰∏™Ë°®</span>
    cmp     <span class="token register variable">eax</span>, OFFSET _tbl<span class="token operator">+</span><span class="token number">404</span><span class="token comment">;400/4=100‰∏™intÂÄº</span>
    jl      SHORT <span class="token operator">$</span>LL6@main      <span class="token comment">; Ëã•Êú™Â§ÑÁêÜÂÆåÔºåË∑≥ËΩ¨ÂõûÂæ™ÁéØÂºÄÂßãÂ§ÑÁªßÁª≠</span>
    
    <span class="token comment">; Âæ™ÁéØÁªìÊùüÔºåÊÅ¢Â§ç‰πãÂâç‰øùÂ≠òÁöÑÂØÑÂ≠òÂô®</span>
    pop     <span class="token register variable">edi</span>
    pop     <span class="token register variable">esi</span>
    pop     <span class="token register variable">ebp</span>
    
    <span class="token comment">; ÂáΩÊï∞ËøîÂõûÂÄºÊ∏ÖÈõ∂</span>
    xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    
    <span class="token comment">; ÊÅ¢Â§çEBXÂíåECXÔºåÂáÜÂ§áËøîÂõû</span>
    pop     <span class="token register variable">ebx</span>
    pop     <span class="token register variable">ecx</span>
    
    <span class="token comment">; ÂáΩÊï∞ËøîÂõûÔºå‰∏çÂ∏¶ÂèÇÊï∞</span>
    ret     <span class="token number">0</span>
_main   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÊÆµ‰ª£Á†ÅÂ∑≤ÁªèÈù¢ÁõÆÂÖ®Èùû‰∫ÜÔºåÊÑüËßâÁúüÁöÑÂæàÈöæÁúãÊáÇ,</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> tbl<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> x<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
             <span class="token keyword">for</span> <span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> y<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
                    tbl<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">=</span>x<span class="token operator">*</span>y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>ÊüØ‰Ω¨‚ÄòsTips:ÈÅáÂà∞ËøôÁßçÂæàÈöæÁúãÊáÇÁöÑÊ±áÁºñÔºåÂ¶ÇÊûúÁªôÁöÑÊòØ‰∫åËøõÂà∂Êñá‰ª∂ÔºåËÉΩËøêË°åÁöÑÁõ¥Êé•ËøêË°åÂÆådumpÔºå‰∏çËÉΩËøêË°åÁöÑÊääÁâáÊÆµÊä†‰∏ãÊù•ÔºåÊàñËÄÖÁÖßÁùÄÊ±áÁºñÂÜô‰∏ÄÈÅçÔºåÁÑ∂ÂêéË∑ë‰∏ÄÈÅçËøõË°åÁåúÊµãÔºåÊêûÈÄÜÂêëÈ¶ñÂÖàÊúâÂ§ßËÉÜÁöÑÁåúÊµãÂíåÊÉ≥Ë±°</em></p>
<h3 id="chap19-‰ΩçËøêÁÆó"><a class="markdownIt-Anchor" href="#chap19-‰ΩçËøêÁÆó"></a> Chap19 ‰ΩçËøêÁÆó</h3>
<p><em>ÊúâÂæàÂ§öÁ®ãÂ∫èÈÉΩÊääËæìÂÖ•ÂèÇÊï∞ÁöÑÊüê‰∫õÊØîÁâπ‰ΩçÂΩì‰ΩúÊ†áËØÜ‰ΩçÂ§ÑÁêÜ„ÄÇ</em></p>
<h4 id="ÁâπÂÆö‰Ωç"><a class="markdownIt-Anchor" href="#ÁâπÂÆö‰Ωç"></a> ÁâπÂÆö‰Ωç</h4>
<h5 id="x86-3"><a class="markdownIt-Anchor" href="#x86-3"></a> x86</h5>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">HANDLE fh<span class="token punctuation">;</span>
   fh<span class="token operator">=</span><span class="token function">CreateFile</span> <span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">,</span> GENERIC_WRITE <span class="token operator">|</span> GENERIC_READ<span class="token punctuation">,</span> FILE_SHARE_READ<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> OPEN_ALWAYS <span class="token punctuation">,</span>FILE_ATTRIBUTE_NORMAL<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>msvs 2010ÁºñËØëÂêé</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push    <span class="token number">0</span>	<span class="token comment">;NULL</span>
   push    <span class="token number">128</span>                            <span class="token comment">; 00000080H</span>
   push    <span class="token number">4</span>	<span class="token comment">;OPEN_ALWAYS</span>
   push    <span class="token number">0</span>	<span class="token comment">;NULL</span>
   push    <span class="token number">1</span>	<span class="token comment">;FILE_SHARE_READ</span>
   push    <span class="token operator">-</span><span class="token number">1073741824</span>                    <span class="token comment">; c0000000H</span>
   push    OFFSET <span class="token operator">$</span>SG78813	<span class="token comment">;ptr(file)</span>
   call    DWORD PTR __imp__CreateFileA@<span class="token number">28</span>
   mov     DWORD PTR _fh<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Â∫ìÊñá‰ª∂<code>WinNT.h</code>ÂØπÁõ∏ÂÖ≥‰ΩçÂüüËøõË°å‰∫ÜÂÆö‰πâ</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GENERIC_READ</span>           <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x80000000L</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GENERIC_WRITE</span>          <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x40000000L</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GENERIC_EXECUTE</span>        <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x20000000L</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GENERIC_ALL</span>            <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x10000000L</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®APIÂ£∞ÊòéÈáåÔºå<code>CreateFile()</code>ÂáΩÊï∞ÁöÑÁ¨¨‰∫å‰∏™ÂèÇÊï∞‰∏∫<code>GENERIC_WRITE|GENERIC_READ</code>Âç≥<code>0x0x80000000 | 0x40000000 = 0xC0000000</code>,CreateFile()ÂáΩÊï∞Â¶Ç‰ΩïÊ£ÄÊµãÊ†áÂøó‰ΩçÂë¢</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">.text:7C83D429  test       byte ptr [ebp+dwDesiredAccess+3], 40h
.text:7C83D42   Dmov       [ebp+var_8], 1
.text:7C83D434  jz         short loc_7C83D417
.text:7C83D436  jmp        loc_7C810817<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>byte ptr [ebp+dwDesiredAccess+3],Âç≥0xC0000000ÁöÑÂ§¥‰∏Ä‰∏™Â≠óËäÇ(ËøôÈáåÊòØÂ∞èÁ´ØË°®Á§∫),ÂÆûÈôÖ‰∏äÂ∞±ÊòØ0xC0ËøõË°å‰∏éËøêÁÆó</p>
<p><code>TEST</code>‰∏é<code>AND</code>Êåá‰ª§ÁöÑÂîØ‰∏ÄÂå∫Âà´ÊòØÂâçËÄÖ‰∏ç‰øùÂ≠òËøêÁÆóÁªìÊûú</p>
<p>Âç≥Ôºå‰∏äËø∞ÂèØÊâßË°åÁöÑÁ®ãÂ∫èÊ∫ê‰ª£Á†ÅÈÄªËæëÊòØÔºö</p>
<pre class="line-numbers language-none"><code class="language-none">if ((dwDesiredAccess&amp;0x40000000) &#x3D;&#x3D; 0) goto loc_7C83D417<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>‰ªéËÄåËææÂà∞‰∫ÜÊ£ÄÊµãÊ†áÂøó‰ΩçÁöÑÊïàÊûú</p>
<hr />
<p>ÁúãÁúãlinuxÁöÑ</p>
<p>Áî®<code>gcc 4.4.1ÁºñËØë</code></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> handle<span class="token punctuation">;</span>
        handle<span class="token operator">=</span><span class="token function">open</span> <span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">,</span> O_RDWR <span class="token operator">|</span> O_CREAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">           public main
main       proc near

var_20     <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">20h</span>
var_1C     <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">1Ch</span>
var_4      <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">4</span>

           push    <span class="token register variable">ebp</span>
           mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
           and     <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span>
           sub     <span class="token register variable">esp</span>, <span class="token number">20h</span>
           mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_1C<span class="token operator">]</span>, <span class="token number">42h</span>
           mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_20<span class="token operator">]</span>, offset aFile <span class="token comment">; "file"</span>
           call    _open
           mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_4<span class="token operator">]</span>, <span class="token register variable">eax</span>
           leave
           retn
main       endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®<code>libc.so.6</code>Èáå,<code>open()</code>ÂáΩÊï∞Ë∞ÉÁî®ÁöÑÊòØ<code>syscall_sys_open</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">.text:</span>000BE69B            mov  <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">+</span>mode<span class="token operator">]</span> <span class="token comment">; mode</span>
<span class="token label function">.text:</span>000BE69F            mov  <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">+</span>flags<span class="token operator">]</span> <span class="token comment">; flags</span>
<span class="token label function">.text:</span>000BE6A3            mov  <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">+</span>filename<span class="token operator">]</span> <span class="token comment">; filename</span>
<span class="token label function">.text:</span>000BE6A7            mov  <span class="token register variable">eax</span>, <span class="token number">5</span>
<span class="token label function">.text:</span>000BE6AC            int  <span class="token number">80h</span>       <span class="token comment">; LINUX - sys_open</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®ÊâßË°å<code>open()</code>ÂáΩÊï∞Êó∂Ôºå<code>linux</code>ÂÜÖÊ†∏‰ºöÊ£ÄÊµãÊüê‰∫õÊ†áËØÜ‰Ωç</p>
<p>Âú®Linux 2.6‰∏≠ÔºåÂΩìÁ®ãÂ∫èÈÄöËøá<code>syscall</code>Ë∞ÉÁî® <code>sys_open</code>ÁöÑÊó∂ÂÄôÔºåÂÆÉË∞ÉÁî®ÁöÑÂáΩÊï∞ÂÆûÈôÖ‰∏äÊòØÂÜÖÊ†∏ÂáΩÊï∞ <code>do_sys_open()</code>„ÄÇÂú®ÊâßË°åÂáΩÊï∞<code>do_sys_open()</code>ÁöÑÊó∂ÂÄôÔºåÁ≥ªÁªüÂèà‰ºöË∞ÉÁî®<code>do_filp_open() </code>ÂáΩÊï∞„ÄÇ<em>ÂèØ‰ª•Âú®LinuxÂÜÖÊ†∏Ê∫ê‰ª£Á†ÅÈáåÁöÑfs/namei.cÈáåÊâæÂà∞ËøôÈÉ®ÂàÜÂÜÖÂÆπ„ÄÇ</em></p>
<p>LINUX‰∏≠ÁºñËØëÂô®‰∏ç‰ªÖ‰ºö‰ΩøÁî®Ê†àÊù•‰º†ÈÄíÂèÇÊï∞ÔºåÂÆÉËøò‰ºö‰ΩøÁî®ÂØÑÂ≠òÂô®‰º†ÈÄíÈÉ®ÂàÜÂèÇÊï∞„ÄÇÁºñËØëÂô®ÊúÄÂ∏∏ÈááÁî®ÁöÑÂáΩÊï∞Ë∞ÉÁî®Á∫¶ÂÆöÊòØ<code>fastcall</code>ÔºàÂèÇËßÅ6.4.3ËäÇÔºâ„ÄÇËøô‰∏™ËßÑËåÉ<code>‰ºòÂÖà‰ΩøÁî®ÂØÑÂ≠òÂô®Êù•‰º†ÈÄíÂèÇÊï∞</code>„ÄÇËøô‰ΩøÂæó<code>CPU‰∏çÂøÖÊØèÊ¨°ÈÉΩË¶ÅËÆøÈóÆÂÜÖÂ≠òÈáåÁöÑÊï∞ÊçÆÊ†à</code>ÔºåÂ§ßÂ§ßÊèêÂçá‰∫ÜÁ®ãÂ∫èÁöÑËøêË°åÊïàÁéá„ÄÇÊ≠§Â§ñÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáGCCÁöÑregparmÈÄâÈ°π[<a href="#anchor191">1]</a>ÔºåËÆæÁΩÆ‰º†ÈÄíÂèÇÊï∞ÁöÑÂØÑÂ≠òÂô®Êï∞Èáè„ÄÇ</p>
<p>Âú®Linux 2.6ÂÜÖÊ†∏ÁöÑÁºñËØëÈÄâÈ°π‰∏≠ÔºåËÆæÂÆö‰∫ÜÂØÑÂ≠òÂô®ÈÄâÈ°π‚Äú-mregparm=3‚Äù</p>
<p>Ëøô‰∏™ÈÄâÈ°πÂÜ≥ÂÆöÔºåÁºñËØëÂô®È¶ñÂÖàÈÄöËøá<code>EAX,EDXÂíåECXÂØÑÂ≠òÂô®</code>‰º†ÈÄíÂáΩÊï∞ÊâÄÈúÄÁöÑÂ§¥‰∏â‰∏™ÂèÇÊï∞,ÂÜçÈÄöËøáÊ†à‰º†ÈÄíÂÖ∂‰ΩôÁöÑÂèÇÊï∞ÔºåÂ¶ÇÊûúÂèÇÊï∞ÁöÑÊÄªÊï∞‰∏çË∂≥3‰∏™ÔºåÂè™‰ºöÁî®Âà∞ÈÉ®ÂàÜÂØÑÂ≠òÂô®</p>
<p><code>Âú®UbuntuÈáå‰∏ãËΩΩLinux Kernel 2.6.31ÔºåÂπ∂Áî®‚Äúmake vmlinux‚ÄùÊåá‰ª§ÁºñËØëÔºåÁÑ∂Âêé‰ΩøÁî®IDAÊâìÂºÄÁ®ãÂ∫èÔºåÂØªÊâæÂáΩÊï∞do_filp_open()</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">do_filp_open    proc near
...... 
                push    <span class="token register variable">ebp</span>
                mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                push    <span class="token register variable">edi</span>
                push    <span class="token register variable">esi</span>
                push    <span class="token register variable">ebx</span>
                mov     <span class="token register variable">ebx</span>, <span class="token register variable">ecx</span>
                add     <span class="token register variable">ebx</span>, <span class="token number">1</span>
                sub     <span class="token register variable">esp</span>, <span class="token number">98h</span>
                mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_4<span class="token operator">]</span>  <span class="token comment">; acc_mode (5th arg)</span>
                test    <span class="token register variable">bl</span>, <span class="token number">3</span>
                mov     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>var_80<span class="token operator">]</span>, <span class="token register variable">eax</span> <span class="token comment">; dfd (1th arg)</span>
                mov     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>var_7C<span class="token operator">]</span>, <span class="token register variable">edx</span> <span class="token comment">; pathname (2th arg)</span>
                mov     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>var_78<span class="token operator">]</span>, <span class="token register variable">ecx</span> <span class="token comment">; open_flag (3th arg)</span>
                jnz     short loc_C01EF684
                mov     <span class="token register variable">ebx</span>, <span class="token register variable">ecx</span>          <span class="token comment">; ebx &lt;- open_flag</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">loc_C01EF6B4:</span>                       <span class="token comment">; CODE XREF: do_filp_open+4F</span>
                test    <span class="token register variable">bl</span>, <span class="token number">40h</span>     <span class="token comment">; O_CREAT</span>
                jnz     loc_C01EF810
                mov     <span class="token register variable">edi</span>, <span class="token register variable">ebx</span>
                shr     <span class="token register variable">edi</span>, <span class="token number">11h</span>
                xor     <span class="token register variable">edi</span>, <span class="token number">1</span>
                and     <span class="token register variable">edi</span>, <span class="token number">1</span>
                test    <span class="token register variable">ebx</span>, <span class="token number">10000h</span>
                jz      short loc_C01EF6D3
                or      <span class="token register variable">edi</span>, <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>40h,ÂÆûÈôÖ‰∏äÊòØÊ±áÁºñÂÆè<code>O_CREAT</code>ÁöÑÂÄº.ËøôÈáåÁöÑ<code>test</code>Êåá‰ª§Ê£ÄÊü•<code>open_flag</code>ÈáåÊòØÂê¶Â≠òÂú®0x40ÁöÑÊ†áÂøó‰ΩçÔºåÂ¶ÇÊûúËøô‰∏™‰ΩçÊòØ1ÔºåÂ∞±‰ºöËß¶Âèë‰∏ã‰∏ÄÊù°<code>JNZ</code>Êåá‰ª§</p>
<h4 id="Ê∏ÖÈô§‰Ωç"><a class="markdownIt-Anchor" href="#Ê∏ÖÈô§‰Ωç"></a> Ê∏ÖÈô§‰Ωç</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">IS_SET</span><span class="token expression"><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> bit<span class="token punctuation">)</span>       <span class="token punctuation">(</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>bit<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SET_BIT</span><span class="token expression"><span class="token punctuation">(</span>var<span class="token punctuation">,</span> bit<span class="token punctuation">)</span>       <span class="token punctuation">(</span><span class="token punctuation">(</span>var<span class="token punctuation">)</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>bit<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">REMOVE_BIT</span><span class="token expression"><span class="token punctuation">(</span>var<span class="token punctuation">,</span> bit<span class="token punctuation">)</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>var<span class="token punctuation">)</span> <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span>bit<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> rt<span class="token operator">=</span>a<span class="token punctuation">;</span>
    <span class="token function">SET_BIT</span> <span class="token punctuation">(</span>rt<span class="token punctuation">,</span> <span class="token number">0x4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">REMOVE_BIT</span> <span class="token punctuation">(</span>rt<span class="token punctuation">,</span> <span class="token number">0x200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> rt<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">0x12340678</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>Non-optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_rt<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>             <span class="token comment">; size = 4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>               <span class="token comment">; size = 4</span>

_f  PROC
    push   <span class="token register variable">ebp</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    push   <span class="token register variable">ecx</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov    DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    or     <span class="token register variable">ecx</span>, <span class="token number">16384</span>               <span class="token comment">; 00004000H;set bit</span>
    mov    DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    and    <span class="token register variable">edx</span>, <span class="token operator">-</span><span class="token number">513</span>                <span class="token comment">; fffffdffH;remove bit</span>
    mov    DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
    pop    <span class="token register variable">ebp</span>
    ret    <span class="token number">0</span>
_f  ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>#define IS_SET(flag, bit)       ((flag) &amp; (bit)) #define SET_BIT(var, bit)       ((var) |= (bit)) #define REMOVE_BIT(var, bit)    ((var) &amp;= ~(bit))</code></p>
<p>‰ª•‰∏ä‰∏∫Ê†∏ÂøÉ</p>
<p>Âú®Ê±áÁºñ‰∏≠Ôºå<code>OR</code>Êåá‰ª§ÊòØÈÄê‰ΩçËøõË°åÊàñËøêÁÆóÁöÑÊåá‰ª§ÔºåÁî®Êù•Â∞ÜÊåáÂÆö‰ΩçÁΩÆÁΩÆ1</p>
<p><code>AND</code>Êåá‰ª§ÁöÑ‰ΩúÁî®ÊòØÈáçÁΩÆ<code>bit</code>‰ΩçÔºåÂ¶ÇÊûúÁ´ãÂç≥Êï∞ÁöÑÊüê‰∏™<code>bit</code>‰Ωç‰∏∫1,<code>AND</code>Êåá‰ª§Â∞Ü‰ºö‰øùÁïôÂØÑÂ≠òÂô®ÁöÑËøô‰∏™bit‰ΩçÔºåÂê¶ÂàôÁΩÆ0</p>
<hr />
<p><code>Optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                      <span class="token comment">; size = 4</span>
_f     PROC
    mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
    and    <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">513</span>         <span class="token comment">; fffffdffH</span>
    or     <span class="token register variable">eax</span>, <span class="token number">16384</span>        <span class="token comment">; 00004000H</span>
    ret    <span class="token number">0</span> 
_f     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÈáå‰∫íÊç¢‰∫ÜÈ°∫Â∫èÔºåÂÖ∂ÂÆûÊ≤°ÂΩ±ÂìçÔºåÂõ†‰∏∫ÂØπ‰ΩçÊìç‰ΩúÊòØÈíàÂØπ‰∏çÂêå‰ΩçÁöÑ</p>
<hr />
<p><code>Optimizing GCC</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">           public f
f          proc near

arg_0      <span class="token operator">=</span> dword ptr  <span class="token number">8</span>

           push     <span class="token register variable">ebp</span>
           mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
           mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>
           pop      <span class="token register variable">ebp</span>
           or       <span class="token register variable">ah</span>, <span class="token number">40h</span>
           and      <span class="token register variable">ah</span>, <span class="token number">0FDh</span>
           retn
f          endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÈáåÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÂéüÊú¨Â∞±Âú®eaxÈáåÈù¢ÔºåÂáΩÊï∞Â∫èË®ÄÂíåÂáΩÊï∞Â∞æÂ£∞ÂÖ∂ÂÆûÂèØ‰ª•ÁúÅÁï•</p>
<h4 id="‰ΩçÁßª"><a class="markdownIt-Anchor" href="#‰ΩçÁßª"></a> ‰ΩçÁßª</h4>
<p><code>&lt;&lt;</code>‰∏é<code>&gt;&gt;</code>ÊòØ‰ΩçÁßªËøêÁÆóÁ¨¶</p>
<p>ÂØπÂ∫îÁöÑx86Êåá‰ª§ÈõÜ‰∏∫<code>SHL</code>Âíå<code>SHR</code></p>
<p>‰ΩçÁßªÊåá‰ª§ÂèØÁî®Êù•ÂØπÁâπÂÆö‰ΩçËøõË°åÂèñÂÄºÊàñÈöîÁ¶ªÔºåÁî®ÈÄîÂçÅÂàÜÂπøÊ≥õ„ÄÇ</p>
<h4 id="Âú®fpu‰∏äËÆæÁΩÆÁâπÂÆö‰Ωç"><a class="markdownIt-Anchor" href="#Âú®fpu‰∏äËÆæÁΩÆÁâπÂÆö‰Ωç"></a> Âú®FPU‰∏äËÆæÁΩÆÁâπÂÆö‰Ωç</h4>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240609142026432.png" class="" alt="image-20240609142026432" loading="lazy">
<p>ÂèØ‰ª•Âú®‰∏ç‰ΩøÁî®FPUÊåá‰ª§ÁöÑÂâçÊèêÂèòÊõ¥SÁ¨¶Âè∑‰Ωç</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">float</span> <span class="token function">my_abs</span> <span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> tmp<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x7FFFFFFF</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>tmp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">float</span> <span class="token function">set_sign</span> <span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> tmp<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80000000</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>tmp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> <span class="token function">negate</span> <span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> tmp<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x80000000</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>tmp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"my_abs():\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">my_abs</span> <span class="token punctuation">(</span><span class="token number">123.456</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">my_abs</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">456.123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"set_sign():\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">set_sign</span> <span class="token punctuation">(</span><span class="token number">123.456</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">set_sign</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">456.123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"negate():\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">negate</span> <span class="token punctuation">(</span><span class="token number">123.456</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">negate</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">456.123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Áî®‰ΩçÊìç‰ΩúC/C++Êåá‰ª§‰πãÂêéÔºåÊàë‰ª¨‰∏çÂøÖÂú®CPUÂíåFPUÁöÑÂØÑÂ≠òÂô®‰πãÈó¥‰º†ÈÄíÊï∞ÊçÆ„ÄÅÂÜçËøõË°åÊï∞Â≠¶ËøêÁÆó‰∫Ü„ÄÇÊú¨ËäÇÂàó‰∏æ‰∫Ü‰∏â‰∏™‰ΩçÊìç‰ΩúÂáΩÊï∞Ôºö<code>Ê∏ÖÈô§MSBÁ¨¶Âè∑‰ΩçÁöÑmy_abs()ÂáΩÊï∞„ÄÅËÆæÁΩÆÁ¨¶Âè∑‰ΩçÁöÑset_sign()ÂáΩÊï∞ÂèäÊ±ÇË¥üÂáΩÊï∞negate()„ÄÇ</code></p>
<hr />
<p>x86</p>
<hr />
<p><code>Optimizing MSVS</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_my_abs PROC
        and     DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">2147483647</span>    <span class="token comment">; 7fffffffH</span>
        fld     DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
_my_abs ENDP<span class="token comment">;set S=0</span>

_tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_set_sign PROC
        or      DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token operator">-</span><span class="token number">2147483648</span>   <span class="token comment">; 80000000H</span>
        fld     DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
_set_sign ENDP<span class="token comment">;set S=1</span>

_tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_negate PROC
        xor     DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token operator">-</span><span class="token number">2147483648</span>   <span class="token comment">; 80000000H</span>
        fld     DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
_negate ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂáΩÊï∞‰ªéÊ†à‰∏≠ÊèêÂèñ‰∏Ä‰∏™ÊµÆÁÇπÁ±ªÂûãÁöÑÊï∞ÊçÆÔºå‰ΩÜÊòØÊääÂÆÉÂΩì‰ΩúÊï¥Êï∞Á±ªÂûãÊï∞ÊçÆËøõË°åÂ§ÑÁêÜ„ÄÇ</p>
<p>ANDÂíåORËÆæÁΩÆÁõ∏Â∫îÁöÑÊØîÁâπ‰ΩçÔºåËÄåXORÁî®Êù•ËÆæÁΩÆÁõ∏ÂèçÁöÑÁ¨¶Âè∑‰Ωç„ÄÇ</p>
<p>Âõ†‰∏∫Ë¶ÅÊääÊµÆÁÇπÊï∞ËøòÁªôFPUÔºåÊâÄ‰ª•ÊúÄÂêéÊää‰øÆÊîπÂêéÁöÑÂ§ÑÁêÜÁªìÊûú‰øùÂ≠òÂà∞ST0ÂØÑÂ≠òÂô®„ÄÇ</p>
<hr />
<p>x64</p>
<hr />
<p><code>optimizing msvs</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
my_abs  PROC
        movss   DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">xmm0</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
        btr     <span class="token register variable">eax</span>, <span class="token number">31</span>
        mov     DWORD PTR tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
        movss   <span class="token register variable">xmm0</span>, DWORD PTR tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
my_abs  ENDP
_TEXT   ENDS

tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
set_sign PROC
        movss   DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">xmm0</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
        bts     <span class="token register variable">eax</span>, <span class="token number">31</span>
        mov     DWORD PTR tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
        movss   <span class="token register variable">xmm0</span>, DWORD PTR tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
set_sign ENDP

tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
i<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
negate  PROC
        movss   DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">xmm0</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
        btc     <span class="token register variable">eax</span>, <span class="token number">31</span>
        mov     DWORD PTR tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
        movss   <span class="token register variable">xmm0</span>, DWORD PTR tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
negate  END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>
<p><strong>BTR (Bit Test and Reset)</strong>Ôºö</p>
<ul>
<li><strong>ÂäüËÉΩ</strong>ÔºöÊµãËØïÂπ∂Â§ç‰ΩçÔºàÊ∏ÖÈõ∂ÔºâÊåáÂÆö‰ΩçÁΩÆÁöÑ‰Ωç„ÄÇ</li>
<li><strong>ËØ≠Ê≥ï</strong>Ôºö<code>BTR destination, source</code></li>
<li><strong>Êìç‰Ωú</strong>ÔºöÈ¶ñÂÖàÂ∞Ü destination Êìç‰ΩúÊï∞ÁöÑ source ÊåáÂÆöÁöÑ‰ΩçÂÄºÂ≠òÂÇ®Âú® CFÔºàCarry FlagÔºâÊ†áÂøó‰∏≠ÔºåÁÑ∂ÂêéÂ∞ÜËØ•‰ΩçÂ§ç‰ΩçÔºàÂç≥Ê∏ÖÈõ∂Ôºâ„ÄÇ</li>
<li><strong>‰æãÂ≠ê</strong>Ôºö<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">BTR EAX, 5 ; ÊµãËØï EAX ÂØÑÂ≠òÂô®‰∏≠Á¨¨ 5 ‰ΩçÁöÑÂÄºÔºåÂ∞ÜÂÖ∂Â≠òÂÇ®Âú® CF ‰∏≠ÔºåÁÑ∂ÂêéÊ∏ÖÈõ∂Ëøô‰∏™‰Ωç<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ul>
</li>
<li>
<p><strong>BTS (Bit Test and Set)</strong>Ôºö</p>
<ul>
<li><strong>ÂäüËÉΩ</strong>ÔºöÊµãËØïÂπ∂ËÆæÁΩÆÔºàÁΩÆ‰ΩçÔºâÊåáÂÆö‰ΩçÁΩÆÁöÑ‰Ωç„ÄÇ</li>
<li><strong>ËØ≠Ê≥ï</strong>Ôºö<code>BTS destination, source</code></li>
<li><strong>Êìç‰Ωú</strong>ÔºöÈ¶ñÂÖàÂ∞Ü destination Êìç‰ΩúÊï∞ÁöÑ source ÊåáÂÆöÁöÑ‰ΩçÂÄºÂ≠òÂÇ®Âú® CF Ê†áÂøó‰∏≠ÔºåÁÑ∂ÂêéÂ∞ÜËØ•‰ΩçÁΩÆ‰ΩçÔºàÂç≥ËÆæ‰∏∫ 1Ôºâ„ÄÇ</li>
<li><strong>‰æãÂ≠ê</strong>Ôºö<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">BTS EAX, 5 ; ÊµãËØï EAX ÂØÑÂ≠òÂô®‰∏≠Á¨¨ 5 ‰ΩçÁöÑÂÄºÔºåÂ∞ÜÂÖ∂Â≠òÂÇ®Âú® CF ‰∏≠ÔºåÁÑ∂ÂêéÂ∞ÜËøô‰ΩçËÆæ‰∏∫ 1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ul>
</li>
<li>
<p><strong>BTC (Bit Test and Complement)</strong>Ôºö</p>
<ul>
<li>
<p><strong>ÂäüËÉΩ</strong>ÔºöÊµãËØïÂπ∂ÂèñÂèçÔºàÁøªËΩ¨ÔºâÊåáÂÆö‰ΩçÁΩÆÁöÑ‰Ωç„ÄÇ</p>
</li>
<li>
<p><strong>ËØ≠Ê≥ï</strong>Ôºö<code>BTC destination, source</code></p>
</li>
<li>
<p><strong>Êìç‰Ωú</strong>ÔºöÈ¶ñÂÖàÂ∞Ü destination Êìç‰ΩúÊï∞ÁöÑ source ÊåáÂÆöÁöÑ‰ΩçÂÄºÂ≠òÂÇ®Âú® CF Ê†áÂøó‰∏≠ÔºåÁÑ∂ÂêéÂ∞ÜËØ•‰ΩçÂèñÂèçÔºàÂ¶ÇÊûúÊòØ 1 ÂàôÂèò‰∏∫ 0ÔºåÂ¶ÇÊûúÊòØ 0 ÂàôÂèò‰∏∫ 1Ôºâ„ÄÇ</p>
</li>
<li>
<p><strong>‰æãÂ≠ê</strong>Ôºö</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">BTC EAX, 5 ; ÊµãËØï EAX ÂØÑÂ≠òÂô®‰∏≠Á¨¨ 5 ‰ΩçÁöÑÂÄºÔºåÂ∞ÜÂÖ∂Â≠òÂÇ®Âú® CF ‰∏≠ÔºåÁÑ∂ÂêéÂ∞ÜËøô‰ΩçÁΩÆ‰ΩçÁøªËΩ¨<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ul>
</li>
</ol>
<ul>
<li>
<p>Ëøô‰∫õÊåá‰ª§Âú®ËøõË°å‰ΩçÊìç‰ΩúÊó∂‰ºö‰øÆÊîπ CFÔºàËøõ‰ΩçÊ†áÂøóÔºâ‰ª•ÂèçÊò†Ë¢´ÊµãËØïÁöÑ‰ΩçÂÄºÔºåÂèØ‰ª•Áî®‰∫éÂÆûÁé∞Â§çÊùÇÁöÑ‰ΩçÊìç‰ΩúÂíåÈÄªËæëÂà§Êñ≠„ÄÇ</p>
</li>
<li>
<p><code>movss</code> Áî®‰∫éÂú® SSEÔºàStreaming SIMD ExtensionsÔºâÂØÑÂ≠òÂô®ÊàñÂÜÖÂ≠ò‰πãÈó¥‰º†ËæìÂçïÁ≤æÂ∫¶ÊµÆÁÇπÊï∞„ÄÇÂÆÉÁöÑÂÖ®Áß∞ÊòØ ‚ÄúMove Scalar Single-Precision Floating-Point Value‚Äù„ÄÇ</p>
</li>
<li>
<p>ËæìÂÖ•ÂÄº‰ºö<code>ÁªèXMM0ÂØÑÂ≠òÂô®Â≠òÂÇ®Âà∞Â±ÄÈÉ®Êï∞ÊçÆÊ†à</code>ÔºåÁÑ∂ÂêéÈÄöËøáBTR„ÄÅBTS„ÄÅBTCÁ≠âÊåá‰ª§ËøõË°åÂ§ÑÁêÜ„ÄÇËøô‰∫õÊåá‰ª§Áî®‰∫éÈáçÁΩÆÔºàBTRÔºâ„ÄÅÁΩÆ‰ΩçÔºàBTSÔºâÂíåÁøªËΩ¨ÔºàBTCÔºâÁâπÂÆöÊØîÁâπ‰Ωç„ÄÇÂ¶ÇÊûú‰ªé0ÂºÄÂßãÊï∞ÁöÑËØùÔºåÊµÆÁÇπÊï∞ÁöÑÁ¨¨31‰ΩçÊâçÊòØMSB„ÄÇ</p>
</li>
<li>
<p>ÊúÄÁªàÔºåËøêÁÆóÁªìÊûúË¢´Â§çÂà∂Âà∞XMM0ÂØÑÂ≠òÂô®„ÄÇÂú®Win64Á≥ªÁªü‰∏≠ÔºåÊµÆÁÇπÂûãËøîÂõûÂÄºË¶Å‰øùÂ≠òÂú®Ëøô‰∏™ÂØÑÂ≠òÂô®Èáå„ÄÇ</p>
</li>
</ul>
<h5 id="‰ΩçÊ†°È™å"><a class="markdownIt-Anchor" href="#‰ΩçÊ†°È™å"></a> ‰ΩçÊ†°È™å</h5>
<p><em>‰ªãÁªç‰∏Ä‰∏™ÊµãÁÆóËæìÂÖ•ÂèòÈáèÁöÑ2ËøõÂà∂Êï∞ÈáåÊúâÂ§öÂ∞ë‰∏™1ÁöÑÂáΩÊï∞„ÄÇËøôÁßçÂáΩÊï∞Âè´‰Ωú‚Äúpopulation count/ÁÇπÊï∞‚ÄùÂáΩÊï∞„ÄÇÂú®ÊîØÊåÅSSE4ÁöÑx86 CPUÁöÑÊåá‰ª§ÈõÜÈáåÔºåÁîöËá≥ÊúâÁõ¥Êé•ÂØπÂ∫îÁöÑPOPCNTÊåá‰ª§„ÄÇ</em></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">IS_SET</span><span class="token expression"><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> bit<span class="token punctuation">)</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>bit<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> rt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IS_SET</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        rt<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">0x12345678</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>1&lt;&lt;i</code>‰ºöÈÄê‰∏ÄÈÅçÂéÜ32‰ΩçÊï∞Â≠óÁöÑÊØè‰∏Ä‰ΩçÔºåÂêåÊó∂‰ΩøÂÖ∂‰ªñ‰ΩçÁΩÆÈõ∂Ôºå‰ªéËÄåËÆ°ÁÆó‰∫åËøõÂà∂ÁöÑ1</p>
<p>ËøôÊÆµÁ®ãÂ∫èÈáåÔºå1&lt;&lt;<em>i</em>ÂèØËÉΩ‰∫ßÁîüÁöÑÂÄºÊúâÔºö</p>
<table>
<thead>
<tr>
<th>C/C++Ë°®ËææÂºè</th>
<th>2ÁöÑÊåáÊï∞</th>
<th>ÂçÅËøõÂà∂Êï∞</th>
<th>ÂçÅÂÖ≠ËøõÂà∂Êï∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>1&lt;&lt;0</td>
<td>20</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1&lt;&lt;1</td>
<td>21</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>1&lt;&lt;2</td>
<td>22</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>1&lt;&lt;3</td>
<td>23</td>
<td>8</td>
<td>8</td>
</tr>
<tr>
<td>1&lt;&lt;4</td>
<td>24</td>
<td>16</td>
<td>0x10</td>
</tr>
<tr>
<td>1&lt;&lt;5</td>
<td>25</td>
<td>32</td>
<td>0x20</td>
</tr>
<tr>
<td>1&lt;&lt;6</td>
<td>26</td>
<td>64</td>
<td>0x40</td>
</tr>
<tr>
<td>1&lt;&lt;7</td>
<td>27</td>
<td>128</td>
<td>0x80</td>
</tr>
<tr>
<td>1&lt;&lt;8</td>
<td>28</td>
<td>256</td>
<td>0x100</td>
</tr>
<tr>
<td>1&lt;&lt;9</td>
<td>29</td>
<td>512</td>
<td>0x200</td>
</tr>
<tr>
<td>1&lt;&lt;10</td>
<td>210</td>
<td>1024</td>
<td>0x400</td>
</tr>
<tr>
<td>1&lt;&lt;11</td>
<td>211</td>
<td>2048</td>
<td>0x800</td>
</tr>
<tr>
<td>1&lt;&lt;12</td>
<td>212</td>
<td>4096</td>
<td>0x1000</td>
</tr>
<tr>
<td>1&lt;&lt;13</td>
<td>213</td>
<td>8192</td>
<td>0x2000</td>
</tr>
<tr>
<td>1&lt;&lt;14</td>
<td>214</td>
<td>16384</td>
<td>0x4000</td>
</tr>
<tr>
<td>1&lt;&lt;15</td>
<td>215</td>
<td>32768</td>
<td>0x8000</td>
</tr>
<tr>
<td>1&lt;&lt;16</td>
<td>216</td>
<td>65536</td>
<td>0x10000</td>
</tr>
<tr>
<td>1&lt;&lt;17</td>
<td>217</td>
<td>131072</td>
<td>0x20000</td>
</tr>
<tr>
<td>1&lt;&lt;18</td>
<td>218</td>
<td>262144</td>
<td>0x40000</td>
</tr>
<tr>
<td>1&lt;&lt;19</td>
<td>219</td>
<td>524288</td>
<td>0x80000</td>
</tr>
<tr>
<td>1&lt;&lt;20</td>
<td>220</td>
<td>1048576</td>
<td>0x100000</td>
</tr>
<tr>
<td>1&lt;&lt;21</td>
<td>221</td>
<td>2097152</td>
<td>0x200000</td>
</tr>
<tr>
<td>1&lt;&lt;22</td>
<td>222</td>
<td>4194304</td>
<td>0x400000</td>
</tr>
<tr>
<td>1&lt;&lt;23</td>
<td>223</td>
<td>8388608</td>
<td>0x800000</td>
</tr>
<tr>
<td>1&lt;&lt;24</td>
<td>224</td>
<td>16777216</td>
<td>0x1000000</td>
</tr>
<tr>
<td>1&lt;&lt;25</td>
<td>225</td>
<td>33554432</td>
<td>0x2000000</td>
</tr>
<tr>
<td>1&lt;&lt;26</td>
<td>226</td>
<td>67108864</td>
<td>0x4000000</td>
</tr>
<tr>
<td>1&lt;&lt;27</td>
<td>227</td>
<td>134217728</td>
<td>0x8000000</td>
</tr>
<tr>
<td>1&lt;&lt;28</td>
<td>228</td>
<td>268435456</td>
<td>0x10000000</td>
</tr>
<tr>
<td>1&lt;&lt;29</td>
<td>229</td>
<td>536870912</td>
<td>0x20000000</td>
</tr>
<tr>
<td>1&lt;&lt;30</td>
<td>230</td>
<td>1073741824</td>
<td>0x40000000</td>
</tr>
<tr>
<td>1&lt;&lt;31</td>
<td>231</td>
<td>2147483648</td>
<td>0x80000000</td>
</tr>
</tbody>
</table>
<p>ÈÄÜÂêëÂ∑•Á®ãÁöÑÂÆûÈôÖÂ∑•‰Ωú‰∏≠ÁªèÂ∏∏Âá∫Áé∞Ëøô‰∫õÂ∏∏Êï∞Ôºàbit maskÔºâ„ÄÇÈÄÜÂêëÂ∑•Á®ã‰∫∫ÂëòÂ∫îÂΩìÂ∏∏Â§áËøô‰∏™Ë°®Ê†º„ÄÇËÉå‰∏ãÂçÅÂÖ≠ËøõÂà∂Êï∞Âπ∂‰∏çÂ§™Âõ∞Èöæ„ÄÇ</p>
<hr />
<p>x86 msvs nasm</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_rt<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span>             <span class="token comment">;size=4</span>
_i<span class="token operator">$</span> <span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span>               <span class="token comment">;size=4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span><span class="token number">8</span>                <span class="token comment">;size=4</span>

_f PROC
    push   <span class="token register variable">ebp</span>
    mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    sub    <span class="token register variable">esp</span>, <span class="token number">8</span>
    mov    WORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">0</span>
    mov    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">0</span>
    jmp    SHORT <span class="token operator">$</span>LN4@f
<span class="token label function">$LN3@f:</span>
    mov    <span class="token register variable">ax</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>    <span class="token comment">; ÈÄíÂ¢û</span>
    add    x, <span class="token number">1</span>
    mov    WORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token label function">$LN4@f:</span>
    cmp    DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">32</span>    <span class="token comment">; 00000020H</span>
    jge    SHORT <span class="token operator">$</span>LN2@f              <span class="token comment">; Âæ™ÁéØÁªìÊùüÔºü</span>
    mov    <span class="token register variable">edx</span>, <span class="token number">1</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _i<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    shl    <span class="token register variable">edx</span>, <span class="token register variable">cl</span>                   <span class="token comment">; EDX=EDX&lt;&lt;CL</span>
    and    <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    je     SHORT <span class="token operator">$</span>LN1@f              <span class="token comment">; result of AND instruction was 0?</span>
                                     <span class="token comment">; then skip next instructions</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>  <span class="token comment">; no, not zero</span>
    add    <span class="token register variable">eax</span>, <span class="token number">1</span>                    <span class="token comment">; increment rt</span>
    mov    DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">eax</span><span class="token comment">;rt+=1</span>
<span class="token label function">$LN1@f:</span>
    jmp    SHORT <span class="token operator">$</span>LN3@f
    <span class="token label function">$LN2@f:</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR _rt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
    mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
    pop    <span class="token register variable">ebp</span>
    ret    <span class="token number">0</span>
_f    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊØîËæÉÁÆÄÂçïÔºå‰∏çÈöæÁúãÊáÇÔºåÔºåÔºå</p>
<hr />
<p><code>gcc</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">             public f
f            proc near

rt           <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">0Ch</span>
i            <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">8</span>
arg_0        <span class="token operator">=</span> dword ptr  <span class="token number">8</span>

             push    <span class="token register variable">ebp</span>
             mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
             push    <span class="token register variable">ebx</span>
             sub     <span class="token register variable">esp</span>, <span class="token number">10h</span>
             mov     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>rt<span class="token operator">]</span>, <span class="token number">0</span><span class="token comment">;rt=0</span>
             mov     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">0</span><span class="token comment">;i=0</span>
             jmp     short loc_80483EF
<span class="token label function">loc_80483D0:</span>
             mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>i<span class="token operator">]</span><span class="token comment">;eax=i</span>
             mov     <span class="token register variable">edx</span>, <span class="token number">1</span><span class="token comment">;edx=1</span>
             mov     <span class="token register variable">ebx</span>, <span class="token register variable">edx</span><span class="token comment">;ebx=edx=1</span>
             mov     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span><span class="token comment">;ecx=i</span>
             shl     <span class="token register variable">ebx</span>, <span class="token register variable">cl</span><span class="token comment">;ebx&lt;&lt;=cl;1&lt;&lt;cl</span>
             mov     <span class="token register variable">eax</span>, <span class="token register variable">ebx</span><span class="token comment">;eax=ebx</span>
             and     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span><span class="token comment">;eax&amp;=arg_0</span>
             test    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
             jz      short loc_80483EB<span class="token comment">;&amp;=0,no ++l&amp;=1,++</span>
             add     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>rt<span class="token operator">]</span>, <span class="token number">1</span><span class="token comment">;rt+=1</span>
<span class="token label function">loc_80483EB:</span>
             add     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">1</span>
<span class="token label function">loc_80483EF:</span><span class="token comment">;main loop</span>
             cmp     <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>i<span class="token operator">]</span>, <span class="token number">1Fh</span><span class="token comment">;i ?=31</span>
             jle     short loc_80483D0<span class="token comment">;y,continue;no,jmp</span>
             mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>rt<span class="token operator">]</span><span class="token comment">;eax=rt</span>
             add     <span class="token register variable">esp</span>, <span class="token number">10h</span>
             pop     <span class="token register variable">ebx</span>
             pop     <span class="token register variable">ebp</span>
             retn
f            endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p>x64</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">IS_SET</span><span class="token expression"><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> bit<span class="token punctuation">)</span>   <span class="token punctuation">(</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>bit<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token class-name">uint64_t</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> rt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">64</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IS_SET</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1ULL</span><span class="token operator">&lt;&lt;</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            rt<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rt<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Non-optimizing GCC 4.8.2</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">f:</span>
        push    <span class="token register variable">rbp</span>
        mov     <span class="token register variable">rbp</span>, <span class="token register variable">rsp</span>
        mov     QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">24</span><span class="token operator">]</span>, <span class="token register variable">rdi</span>   <span class="token comment">; a</span>
        mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token number">0</span>     <span class="token comment">; rt=0</span>
        mov     QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token number">0</span>      <span class="token comment">; i=0</span>
        jmp     .L2
<span class="token label function">.L4:</span>
        mov     <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>
        mov     <span class="token register variable">rdx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">24</span><span class="token operator">]</span>
<span class="token comment">; RAX = i, RDX = a</span>
        mov     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span>
<span class="token comment">; ECX = i</span>
        shr     <span class="token register variable">rdx</span>, <span class="token register variable">cl</span>
<span class="token comment">; RDX = RDX>>CL = a>>i</span>
        mov     <span class="token register variable">rax</span>, <span class="token register variable">rdx</span>
<span class="token comment">; RAX = RDX = a>>i</span>
        and     <span class="token register variable">eax</span>, <span class="token number">1</span>
<span class="token comment">; EAX = EAX&amp;1 = (a>>i)&amp;1</span>
        test    <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
<span class="token comment">; the last bit is zero?</span>
<span class="token comment">; skip the next ADD instruction, if it was so.</span>
        je      .L3
        add     DWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token number">1</span>     <span class="token comment">; rt++</span>
<span class="token label function">.L3:</span>
        add     QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token number">1</span>      <span class="token comment">; i++</span>
<span class="token label function">.L2:</span>
        cmp     QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token number">63</span>     <span class="token comment">; i&lt; 63?</span>
        jbe     .L4                       <span class="token comment">; jump to the loop boday begin, if so</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">]</span>   <span class="token comment">; return rt</span>
        pop     <span class="token register variable">rbp</span>
        ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏éx86Âá†‰πé‰∏ÄÊ†∑</p>
<hr />
<p><code>Optimizing GCC</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">1</span> f:
 <span class="token number">2</span>      xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>             <span class="token comment">; rt variable will be in EAX register</span>
 <span class="token number">3</span>      xor     <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>             <span class="token comment">; i variable will be in ECX register</span>
 <span class="token number">4</span> .L3:
 <span class="token number">5</span>      mov     <span class="token register variable">rsi</span>, <span class="token register variable">rdi</span>             <span class="token comment">; load input value</span>
 <span class="token number">6</span>      lea     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>         <span class="token comment">; EDX=EAX+1</span>
 <span class="token number">7</span> <span class="token comment">; EDX here is a "new version of rt", which will be written into rt variable, if the last bit is 1</span>
 <span class="token number">8</span>      shr     <span class="token register variable">rsi</span>, <span class="token register variable">cl</span>              <span class="token comment">; RSI=RSI>>CL</span>
 <span class="token number">9</span>      and     <span class="token register variable">esi</span>, <span class="token number">1</span>               <span class="token comment">; ESI=ESI&amp;1</span>
<span class="token number">10</span> <span class="token comment">; the last bit is 1? If so, write "new version of rt" into EAX</span>
<span class="token number">11</span>      cmovne  <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
<span class="token number">12</span>      add     <span class="token register variable">rcx</span>, <span class="token number">1</span>               <span class="token comment">; RCX++</span>
<span class="token number">13</span>      cmp     <span class="token register variable">rcx</span>, <span class="token number">64</span>
<span class="token number">14</span>      jne     .L3
<span class="token number">15</span>      rep ret                      <span class="token comment">; AKA fatret</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ÂÖàÂâçÁöÑÁ®ãÂ∫èÈÉΩÊòØÂÖàÊØîËæÉÁâπÂÆö‰ΩçÔºåÂÜç<code>rt++</code>ÔºåËÄåËøôÊÆµÁ®ãÂ∫èÁöÑÈ°∫Â∫èÊúâÊâÄ‰∏çÂêåÔºåÊòØÂÖàÈÄíÂ¢û<code>rt</code>ÂÜçÂÜôÂÖ•<code>EDX</code>ÂØÑÂ≠òÂô®</p>
</li>
<li>
<p><code>line 11</code>Â¶ÇÊûúÊúÄÂêéÁöÑÊØîÁâπ‰ΩçÊòØ1ÔºåÈÇ£‰πàÁ®ãÂ∫èÂ∞Ü‰ΩøÁî®CMOVNEÊåá‰ª§ÔºàÁ≠âÂêå‰∫éCMOVNZÔºâÊääEDXÂØÑÂ≠òÂô®ÔºàrtÁöÑÂÄôÈÄâÂÄºÔºâ‰º†ÈÄíÁªôEAXÂØÑÂ≠òÂô®ÔºàÂΩìÂâçÁöÑrtÂÄºÔºå‰πüÊòØÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºâÔºå‰ªéËÄåÂÆåÊàêrtÁöÑÊõ¥Êñ∞„ÄÇ</p>
</li>
<li>
<p>Ëø≠‰ª£64Ê¨°</p>
</li>
<li>
<p>‰ºòÁÇπÔºöÂõ†‰∏∫ÂÆÉÂè™Âê´Êúâ‰∏Ä‰∏™Êù°‰ª∂ËΩ¨ÁßªÊåá‰ª§ÔºàÂú®Âæ™ÁéØÁöÑÂ∞æÈÉ®ÔºâÔºåÊâÄ‰ª•ËøôÁßçÁºñËØëÊñπÊ≥ïÁã¨ÂÖ∑‰ºòÂäø„ÄÇÂ¶ÇÊûúÁºñËØëÁöÑÊñπÂºèËøá‰∫éÊú∫Ê¢∞ÂåñÔºåÈÇ£‰πàÁ®ãÂ∫èË¶ÅÂú®ÈÄíÂ¢ûrtÂíåÂæ™ÁéØÂ∞æÈÉ®ËøõË°å‰∏§Ê¨°Êù°‰ª∂ËΩ¨Áßª„ÄÇÁé∞Âú®ÁöÑCPUÈÉΩÂÖ∑ÊúâÂàÜÊîØÈ¢ÑÊµãÁöÑÂäüËÉΩÔºàËØ∑ÂèÇÂä†Êú¨‰π¶33.1ËäÇÔºâ„ÄÇÂú®ÊÄßËÉΩÊñπÈù¢ÔºåÊú¨‰æãËøôÁ±ªÁ®ãÂ∫èÁöÑÊïàÁéáÊõ¥È´ò„ÄÇ</p>
</li>
<li>
<p><code>line 15</code>ÁöÑÊåá‰ª§<code>rep ret</code>Áõ∏ÂΩì‰∫é<code>MSVS</code>ÁöÑ<code>FATRET</code>ÔºåÊòØÁî±retË°çÁîüÂá∫Êù•ÁöÑÂêë‰ºòÂåñÊåá‰ª§</p>
<p><em>AMDÂª∫ËÆÆÔºöÂ¶ÇÊûúRETÊåá‰ª§ÁöÑÂâç‰∏ÄÊù°Êåá‰ª§ÊòØÊù°‰ª∂ËΩ¨ÁßªÊåá‰ª§ÔºåÈÇ£‰πàÂú®ÂáΩÊï∞ÊúÄÂêéÁöÑËøîÂõûÊåá‰ª§ÊúÄÂ•Ω‰ΩøÁî®REP RETÊåá‰ª§„ÄÇ</em></p>
</li>
</ul>
<hr />
<p><code>optimizing msvs</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
f       PROC
<span class="token comment">; RCX = input value</span>
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        mov     <span class="token register variable">edx</span>, <span class="token number">1</span>
        lea     <span class="token register variable">r8d</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token number">64</span><span class="token operator">]</span>
<span class="token comment">; R8D=64</span>
        npad    <span class="token number">5</span><span class="token comment">;align</span>
<span class="token label function">$LL4@f:</span>
        test    <span class="token register variable">rdx</span>, <span class="token register variable">rcx</span>
<span class="token comment">; there are no such bit in input value?</span>
<span class="token comment">; skip the next INC instruction then.</span>
        je      SHORT <span class="token operator">$</span>LN3@f
        inc     <span class="token register variable">eax</span>     <span class="token comment">; rt++</span>
<span class="token label function">$LN3@f:</span>
        rol     <span class="token register variable">rdx</span>, <span class="token number">1</span>  <span class="token comment">; RDX=RDX&lt;&lt;1</span>
        dec     <span class="token register variable">r8</span>      <span class="token comment">; R8--</span>
        jne     SHORT <span class="token operator">$</span>LL4@f
        fatret  <span class="token number">0</span>
f       ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ROL</code> Âíå <code>SHL</code> ÊòØ x86 Ê±áÁºñËØ≠Ë®Ä‰∏≠ÁöÑ‰∏§Áßç‰∏çÂêåÁöÑÁßª‰ΩçÊåá‰ª§ÔºåÂÆÉ‰ª¨ËôΩÁÑ∂ÈÉΩÊ∂âÂèä‰ΩçÊìç‰ΩúÔºå‰ΩÜÂäüËÉΩÂíåÊïàÊûú‰∏çÂêå„ÄÇ‰ª•‰∏ãÊòØÂÆÉ‰ª¨ÁöÑËØ¶ÁªÜËß£ÈáäÔºö</p>
<p>ROLÔºàRotate LeftÔºâ</p>
<p><strong>ÂäüËÉΩ</strong>ÔºöÂæ™ÁéØÂ∑¶Áßª‰Ωç</p>
<ul>
<li><strong>ËØ≠Ê≥ï</strong>Ôºö<code>ROL destination, count</code></li>
<li><strong>Êìç‰Ωú</strong>ÔºöÂ∞ÜÁõÆÁöÑÊìç‰ΩúÊï∞‰∏≠ÁöÑÊâÄÊúâ‰ΩçÂêëÂ∑¶ÁßªÂä®ÊåáÂÆöÁöÑÊ¨°Êï∞Ôºà<code>count</code>ÔºâÔºåÈ´ò‰ΩçÂ∑¶ÁßªÂêéÈáçÊñ∞ËøõÂÖ•ÊúÄ‰Ωé‰ΩçÔºåËøô‰∏™ËøáÁ®ãÊòØÂæ™ÁéØÁöÑ„ÄÇ</li>
<li><strong>ÊïàÊûú</strong>Ôºö‰∏ç‰ºö‰∏¢Â§±‰ªª‰Ωï‰ΩçÔºåÂéüÊú¨Ë¢´ÁßªÂá∫ÁöÑÈ´ò‰ΩçÂ∞Ü‰ºöÈáçÊñ∞ËøõÂÖ•‰Ωé‰Ωç„ÄÇ</li>
<li><strong>‰æãÂ≠ê</strong>Ôºö<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">ROL EAX, 1 ; Â∞Ü EAX ÂØÑÂ≠òÂô®ÁöÑÂÄºÂæ™ÁéØÂ∑¶Áßª 1 ‰ΩçÔºå‰æãÂ¶ÇÔºö0b1011 -&gt; 0b0111<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ul>
<p>SHLÔºàShift Logical LeftÔºâ</p>
<p><strong>ÂäüËÉΩ</strong>ÔºöÈÄªËæëÂ∑¶Áßª‰Ωç</p>
<ul>
<li><strong>ËØ≠Ê≥ï</strong>Ôºö<code>SHL destination, count</code></li>
<li><strong>Êìç‰Ωú</strong>ÔºöÂ∞ÜÁõÆÁöÑÊìç‰ΩúÊï∞ÁöÑÊâÄÊúâ‰ΩçÂêëÂ∑¶ÁßªÂä®ÊåáÂÆöÁöÑÊ¨°Êï∞Ôºà<code>count</code>ÔºâÔºåÈ´ò‰ΩçÁßªÂá∫Âêé‰∏¢ÂºÉÔºå‰Ωé‰ΩçÁî® 0 Â°´Ë°•„ÄÇ</li>
<li><strong>ÊïàÊûú</strong>ÔºöÂú®Â∑¶ÁßªËøáÁ®ã‰∏≠È´ò‰Ωç‰∏¢Â§±Ôºå‰Ωé‰ΩçÁî®0Â°´ÂÖÖ„ÄÇ</li>
<li><strong>‰æãÂ≠ê</strong>Ôºö<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">SHL EAX, 1 ; Â∞Ü EAX ÂØÑÂ≠òÂô®ÁöÑÂÄºÂ∑¶Áßª 1 ‰ΩçÔºå‰Ωé‰ΩçÁî® 0 Â°´ÂÖÖÔºå‰æãÂ¶ÇÔºö0b1011 -&gt; 0b0110Ôºà‰Ωé‰Ωç‰∏∫0Ôºâ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ul>
<p><code>ROL</code>Êåá‰ª§Êõø‰ª£‰∫Ü<code>SHL</code>Ôºå<code>ROL</code>ÊòØ<code>rotate left</code>Ôºå‰∏é<code>SHL</code>Âú®Êú¨‰æã‰∏≠ÊïàÊûú‰∏ÄÊ†∑</p>
<p><code>R8</code>‰ªé64ÈÄíÂáè‰∏∫0,Âæ™ÁéØ64Ê¨°</p>
<h4 id="promblem"><a class="markdownIt-Anchor" href="#promblem"></a> Promblem</h4>
<ol>
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_f      PROC
        mov     <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;ecx=a</span>
        mov     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span><span class="token comment">;eax=a</span>
        mov     <span class="token register variable">edx</span>, <span class="token register variable">ecx</span><span class="token comment">;edx=a</span>
        shl     <span class="token register variable">edx</span>, <span class="token number">16</span>         <span class="token comment">; 00000010H;edx=a&lt;&lt;16</span>
        and     <span class="token register variable">eax</span>, <span class="token number">65280</span>      <span class="token comment">; 0000ff00H;eax=a&amp;0xff00</span>
        or      <span class="token register variable">eax</span>, <span class="token register variable">edx</span><span class="token comment">;eax|a&lt;&lt;16;eax=a&amp;0xff00|a&lt;&lt;16</span>
        mov     <span class="token register variable">edx</span>, <span class="token register variable">ecx</span><span class="token comment">;edx=ecx=a</span>
        and     <span class="token register variable">edx</span>, <span class="token number">16711680</span>   <span class="token comment">; 00ff0000H;edx=a&amp;0xff0000</span>
        shr     <span class="token register variable">ecx</span>, <span class="token number">16</span>         <span class="token comment">; 00000010H;ecx=a>>16</span>
        or      <span class="token register variable">edx</span>, <span class="token register variable">ecx</span><span class="token comment">;;edx=a&amp;0xff0000|a>>16</span>
        shl     <span class="token register variable">eax</span>, <span class="token number">8</span><span class="token comment">;eax&lt;&lt;8;eax=(a&amp;0xff00|a&lt;&lt;16)&lt;&lt;8</span>
        shr     <span class="token register variable">edx</span>, <span class="token number">8</span><span class="token comment">;;eax>>8;edx=(a&amp;0xff0000|a>>16)>>8</span>
        or      <span class="token register variable">eax</span>, <span class="token register variable">edx</span><span class="token comment">;eax|edx;((a&amp;0xff00|a&lt;&lt;16)&lt;&lt;8)|((a&amp;0xff0000|a>>16)>>8)</span>
        ret     <span class="token number">0</span>
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÈÄÜÂêëÂæóÂà∞ÁöÑÈÄªËæëÊòØ<code>return ((a&amp;0xff00|a&lt;&lt;16)&lt;&lt;8)|((a&amp;0xff0000|a&gt;&gt;16)&gt;&gt;8)</code></p>
<p>‰∫ãÂÆû‰∏äÂåñÁÆÄÁªìÊûú‰∏éÊ∫êÁ†ÅÊòØÁ≠â‰ª∑ÁöÑ,ÁºñËØëÂô®ÂØπËøô‰∏ÄÁ≥ªÂàóÊìç‰ΩúËøõË°å‰∫Ü‰ºòÂåñ</p>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240609153017613.png" class="" alt="image-20240609153017613" loading="lazy">
<ol start="2">
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                                    <span class="token comment">; size = 4</span>
_f      PROC
        push   <span class="token register variable">esi</span>
        mov    <span class="token register variable">esi</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span><span class="token comment">;esi=a</span>
        xor    <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span><span class="token comment">;ecx=0</span>
        push   <span class="token register variable">edi</span><span class="token comment">;save edi</span>
        lea    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span><span class="token comment">;edx=1</span>
        xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span><span class="token comment">;eax=0</span>
        npad   <span class="token number">3</span> <span class="token comment">; align next label</span>
        <span class="token comment">;loop0:edx=1;ecx=counter=i=0</span>
<span class="token label function">$LL3@f:</span>
        mov    <span class="token register variable">edi</span>, <span class="token register variable">esi</span><span class="token comment">;edi=a</span>
        shr    <span class="token register variable">edi</span>, <span class="token register variable">cl</span><span class="token comment">;edi=(a>>cl)&amp;0xff(ecx,low,iÁöÑ‰Ωé8‰Ωç)</span>
        add    <span class="token register variable">ecx</span>, <span class="token number">4</span><span class="token comment">;ecx=i+4</span>
        and    <span class="token register variable">edi</span>, <span class="token number">15</span><span class="token comment">;edi=a>>cl&amp;15</span>
        imul   <span class="token register variable">edi</span>, <span class="token register variable">edx</span><span class="token comment">;edi*edx;edi=(a>>cl)*edx</span>
        lea    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;edx=edx*5</span>
        add    <span class="token register variable">eax</span>, <span class="token register variable">edi</span><span class="token comment">;eax=eax+(a>>cl)*edx</span>
        add    <span class="token register variable">edx</span>, <span class="token register variable">edx</span><span class="token comment">;edx=edx*2=edx*10</span>
        cmp    <span class="token register variable">ecx</span>, <span class="token number">28</span><span class="token comment">;ecx=28?</span>
        jle    SHORT <span class="token operator">$</span>LL3@f
        pop    <span class="token register variable">edi</span>
        pop    <span class="token register variable">esi</span>
        ret    <span class="token number">0</span>
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">function <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token comment">//ËøôÈáåÂ∫îËØ•ÊòØunsigned int</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> eax<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> temp<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">28</span><span class="token punctuation">;</span>i<span class="token operator">+=</span><span class="token number">4</span><span class="token punctuation">,</span>temp<span class="token operator">*=</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        eax<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">>></span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xf</span><span class="token punctuation">)</span><span class="token operator">*</span>j<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> eax<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÈÄÜÂêëÂæóÂà∞ÁöÑÊ∫êÁ†Å,<code>ËøôÊòØ‰∏Ä‰∏™ÊääBCDÂ∞ÅË£ÖÁöÑ32‰Ωç‰∫åËøõÂà∂ÂÄºËΩ¨Êç¢‰∏∫Â∏∏ËßÑÊ†ºÂºèÁöÑ10ËøõÂà∂ÁöÑÂáΩÊï∞</code></p>
<p><em>BCDÔºàBinary-Coded DecimalÔºå‰∫åËøõÂà∂ÁºñÁ†ÅÁöÑÂçÅËøõÂà∂ÔºâË°®Á§∫Ê≥ïÊòØ‰∏ÄÁßçË°®ËææÂçÅËøõÂà∂Êï∞Â≠óÁöÑÊñπÊ≥ïÔºåÊØè‰∏™ÂçÅËøõÂà∂Êï∞Â≠óÔºà0-9ÔºâÈÉΩÁî®‰∏Ä‰∏™Âõ∫ÂÆöÈïøÂ∫¶ÁöÑ‰∫åËøõÂà∂Êï∞Ë°®Á§∫„ÄÇ</em></p>
<p>Ê∫êÁ†ÅÂ¶Ç‰∏ã</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
       <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
       <span class="token keyword">unsigned</span> <span class="token keyword">int</span> rt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">28</span><span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">4</span><span class="token punctuation">,</span> j<span class="token operator">*=</span><span class="token number">10</span><span class="token punctuation">)</span>
          rt<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">>></span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xF</span><span class="token punctuation">)</span> <span class="token operator">*</span> j<span class="token punctuation">;</span>
       <span class="token keyword">return</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰æãÂ¶Ç34‰ª£Ë°®0011 0100</p>
<ol start="3">
<li></li>
</ol>
<p>ËØ∑Êü•ÈòÖMSDNËµÑÊñôÔºåÊâæÂà∞MessageBox()ÂáΩÊï∞‰ΩøÁî®‰∫ÜÂì™‰∫õÊ†áÂøó‰Ωç„ÄÇ</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">,</span> <span class="token string">"caption"</span><span class="token punctuation">,</span>
                     MB_TOPMOST <span class="token operator">|</span> MB_ICONINFORMATION <span class="token operator">|</span> MB_HELP <span class="token operator">|</span> MB_YESNOCANCEL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li></li>
</ol>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_m<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>         <span class="token comment">; size = 4</span>
_n<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>        <span class="token comment">; size = 4</span>
_f      PROC
        <span class="token comment">; Â∞Ü ecx ËÆæÁΩÆ‰∏∫ÂèòÈáè n ÁöÑÂÄºÔºõecx=12</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _n<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        <span class="token comment">; Â∞Ü eax Âíå edx Ê∏ÖÈõ∂</span>
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span><span class="token comment">;eax=0</span>
        xor     <span class="token register variable">edx</span>, <span class="token register variable">edx</span><span class="token comment">;edx=0</span>
        <span class="token comment">; ÊµãËØï ecx ÊòØÂê¶‰∏∫Èõ∂ÔºåÂ¶ÇÊûú‰∏∫Èõ∂ÂàôË∑≥ËΩ¨Âà∞ $LN2@f ‰ΩçÁΩÆ</span>
        test    <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>
        je      SHORT <span class="token operator">$</span>LN2@f<span class="token comment">;loop exitÔºü</span>
        <span class="token comment">; ‰øùÂ≠ò esi ÂØÑÂ≠òÂô®ÂéüÂÄºÂà∞Ê†à</span>
        push    <span class="token register variable">esi</span>
        <span class="token comment">; Â∞ÜÂèòÈáè m ÁöÑÂÄºËµãÁªô esi</span>
        mov     <span class="token register variable">esi</span>, DWORD PTR _m<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span><span class="token comment">;esi=m</span>
<span class="token label function">$LL3@f:</span>
        <span class="token comment">; ÊµãËØï ecx ÁöÑÊúÄ‰Ωé‰ΩçÔºàÂç≥ cl ÁöÑÊúÄ‰Ωé‰ΩçÔºâ</span>
        test    <span class="token register variable">cl</span>, <span class="token number">1</span>
        <span class="token comment">; Â¶ÇÊûúÊúÄ‰Ωé‰Ωç‰∏∫ 0 ÂàôË∑≥ËΩ¨Âà∞ $LN1@f ‰ΩçÁΩÆ</span>
        je      SHORT <span class="token operator">$</span>LN1@f
        <span class="token comment">; Â¶ÇÊûúÊúÄ‰Ωé‰Ωç‰∏∫ 1ÔºåÂàôÂ∞Ü esi Âä†Âà∞ eax ‰∏≠ÔºåÂπ∂ËÄÉËôëËøõ‰ΩçÂä†Âà∞ edx ‰∏≠</span>
        add     <span class="token register variable">eax</span>, <span class="token register variable">esi</span><span class="token comment">;eax=eax+m</span>
        adc     <span class="token register variable">edx</span>, <span class="token number">0</span>
<span class="token label function">$LN1@f:</span>
        <span class="token comment">; Â∞Ü esi Â∑¶Áßª‰∏Ä‰ΩçÔºàÂç≥‰πò 2Ôºâ</span>
        add     <span class="token register variable">esi</span>, <span class="token register variable">esi</span><span class="token comment">;m*2</span>
        <span class="token comment">; Â∞Ü ecx Âè≥Áßª‰∏Ä‰ΩçÔºàÂç≥Èô§ 2Ôºâ</span>
        shr     <span class="token register variable">ecx</span>, <span class="token number">1</span><span class="token comment">;n/=2</span>
        <span class="token comment">; Â¶ÇÊûú ecx ‰∏ç‰∏∫Èõ∂ÔºåÂàôÁªßÁª≠Âæ™ÁéØ</span>
        jne     SHORT <span class="token operator">$</span>LL3@f
        <span class="token comment">; ÊÅ¢Â§çË¢´‰øùÂ≠òÁöÑ esi ÂØÑÂ≠òÂô®ÂÄº</span>
        pop     <span class="token register variable">esi</span>
<span class="token label function">$LN2@f:</span>
        <span class="token comment">; ËøîÂõûÂà∞Ë∞ÉÁî®ËÄÖ</span>
        ret     <span class="token number">0</span>
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">m<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>
n<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>
function <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> eax<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>n<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">;</span>n<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>m<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Áõ∏ÂΩì‰∫éÊòØ<span class="token punctuation">(</span>m<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token punctuation">(</span>m<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            eax<span class="token operator">+=</span>m<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> eax<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÈÄªËæëËøòÂéü‰∫ÜÔºå‰ΩÜÊòØËøòÊòØÊ≤°ÁúãÂá∫Êù•ÊòØÂπ≤ÂòõÁöÑ</p>
<p>ÁúãÊ∫êÁ†ÅÁöÑÂäüËÉΩÊòØÊää32‰ΩçÊï∞Áõ∏‰πò(Ëøô‰∏™ÊòØ‰πòÊ≥ï‰ºòÂåñÁöÑÁÆóÊ≥ï)ÔºåËøîÂõû64‰ΩçÁöÑÁßØ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token comment">// source code taken from</span>
<span class="token comment">//http://www4.wittenberg.edu/academics/mathcomp/shelburne/comp255/notes/binarymultiplication.pdf</span>

<span class="token class-name">uint64_t</span> <span class="token function">mult</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span> m<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> n<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token class-name">uint64_t</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// initialize product p to 0</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// while multiplier n is not 0</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// test LSB of multiplier</span>
            p <span class="token operator">=</span> p <span class="token operator">+</span> m<span class="token punctuation">;</span> <span class="token comment">// if 1 then add multiplicand m</span>
        m <span class="token operator">=</span> m <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// left shift multiplicand</span>
        n <span class="token operator">=</span> n <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// right shift multiplier</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap20-Á∫øÊÄßÂêå‰ΩôÊ≥ï‰∏é‰º™ÈöèÊú∫Êï∞"><a class="markdownIt-Anchor" href="#chap20-Á∫øÊÄßÂêå‰ΩôÊ≥ï‰∏é‰º™ÈöèÊú∫Êï∞"></a> Chap20 Á∫øÊÄßÂêå‰ΩôÊ≥ï‰∏é‰º™ÈöèÊú∫Êï∞</h3>
<p><em>Á∫øÊÄßÂêå‰ΩôÊ≥ïÊòØÁîüÊàêÈöèÊú∫Êï∞ÁöÑÊúÄÁÆÄÊñπÊ≥ïÔºåËôΩÁÑ∂ÁõÆÂâçÁöÑÈöèÊú∫ÂáΩÊï∞ÈÉΩ‰∏çÁî®‰∫ÜÔºå‰ΩÜÊòØÂéüÁêÜÁÆÄÂçïÔºàÂè™Ê∂âÂèä‰πòÊ≥ï„ÄÅÂä†Ê≥ïÂíå‰∏éËøêÁÆóÔºâ</em></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token comment">// constants from the Numerical Recipes book</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RNG_a</span> <span class="token expression"><span class="token number">1664525</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RNG_c</span> <span class="token expression"><span class="token number">1013904223</span></span></span>

<span class="token keyword">static</span> <span class="token class-name">uint32_t</span> rand_state<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">my_srand</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span> init<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        rand_state<span class="token operator">=</span>init<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">my_rand</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        rand_state<span class="token operator">=</span>rand_state<span class="token operator">*</span>RNG_a<span class="token punctuation">;</span>
        rand_state<span class="token operator">=</span>rand_state<span class="token operator">+</span>RNG_c<span class="token punctuation">;</span>
        <span class="token keyword">return</span> rand_state <span class="token operator">&amp;</span> <span class="token number">0x7fff</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Á¨¨‰∏Ä‰∏™ÂáΩÊï∞Áî®‰∫éÂàùÂßãÂåñÂÜÖÈÉ®Áä∂ÊÄÅÔºåÁ¨¨‰∫å‰∏™ÂáΩÊï∞ÁîüÊàê‰º™ÈöèÊú∫Êï∞</p>
<p>ËøôÈáåÁöÑ&amp;ÂèØ‰ª•ÊéßÂà∂‰ΩçÊï∞</p>
<hr />
<p>x86</p>
<p><code>Optimizing msvs</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_BSS     SEGMENT
_rand_state DD  <span class="token number">01H</span> DUP (?)
_BSS     ENDS

_init<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_srand  PROC
        mov     <span class="token register variable">eax</span>, DWORD PTR _init<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        mov     DWORD PTR _rand_state, <span class="token register variable">eax</span>
        ret     <span class="token number">0</span>
_srand  ENDP

_TEXT   SEGMENT
_rand   PROC
        imul    <span class="token register variable">eax</span>, DWORD PTR _rand_state, <span class="token number">1664525</span>
        add     <span class="token register variable">eax</span>, <span class="token number">1013904223</span>         <span class="token comment">; 3c6ef35fH</span>
        mov     DWORD PTR _rand_state, <span class="token register variable">eax</span>
        and     <span class="token register variable">eax</span>, <span class="token number">32767</span>              <span class="token comment">; 00007fffH</span>
        ret     <span class="token number">0</span>
_rand   ENDP

_TEXT   ENDS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>x64‰∏≠ mysrandÁõ¥Êé•‰ΩøÁî®ecxÂØÑÂ≠òÂô®Ëé∑Âèñ‰∫ÜÊâÄÈúÄÂèÇÊï∞ÔºåÊ≤°ÊúâÈÄöËøáÊ†àËØªÂèñÂèÇÊï∞</p>
<hr />
<p>Â§öÊï∞ÈöèÊú∫ÂáΩÊï∞ÈÉΩÈááÁî®Ê¢ÖÊ£ÆÊóãËΩ¨ÁÆóÊ≥ïÔºàMersenne twisterÔºâ„ÄÇ</p>
<h3 id="chap21-ÁªìÊûÑ‰Ωì"><a class="markdownIt-Anchor" href="#chap21-ÁªìÊûÑ‰Ωì"></a> Chap21 ÁªìÊûÑ‰Ωì</h3>
<h4 id="systemtime"><a class="markdownIt-Anchor" href="#systemtime"></a> systemtime</h4>
<p>Êú¨ËäÇÊòØ‰ª•Win32ÊèèËø∞Á≥ªÁªüÊó∂Èó¥ÁöÑSYSTEMTIMEÁªìÊûÑ‰Ωì(Êù•Ê∫ê<code>WinBase.h</code>)‰∏∫‰æãÁöÑ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_SYSTEMTIME</span> <span class="token punctuation">&#123;</span>
  WORD wYear<span class="token punctuation">;</span>
  WORD wMonth<span class="token punctuation">;</span>
  WORD wDayOfWeek<span class="token punctuation">;</span>
  WORD wDay<span class="token punctuation">;</span>
  WORD wHour<span class="token punctuation">;</span>
  WORD wMinute<span class="token punctuation">;</span>
  WORD wSecond<span class="token punctuation">;</span>
  WORD wMilliseconds<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> SYSTEMTIME<span class="token punctuation">,</span> <span class="token operator">*</span>PSYSTEMTIME<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    SYSTEMTIME t<span class="token punctuation">;</span>
    <span class="token function">GetSystemTime</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%04d-%02d-%02d %02d:%02d:%02d\n"</span><span class="token punctuation">,</span>
        t<span class="token punctuation">.</span>wYear<span class="token punctuation">,</span> t<span class="token punctuation">.</span>wMonth<span class="token punctuation">,</span> t<span class="token punctuation">.</span>wDay<span class="token punctuation">,</span>
        t<span class="token punctuation">.</span>wHour<span class="token punctuation">,</span> t<span class="token punctuation">.</span>wMinute<span class="token punctuation">,</span> t<span class="token punctuation">.</span>wSecond<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>MSVS 2010(ÂêØÁî®/GSÈÄâÈ°π)</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_t<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">16</span> <span class="token comment">; size = 16</span>
_main       PROC
     push   <span class="token register variable">ebp</span>
     mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
     sub    <span class="token register variable">esp</span>, <span class="token number">16</span>
     lea    <span class="token register variable">eax</span>, DWORD PTR _t<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     push   <span class="token register variable">eax</span>
     call   DWORD PTR __imp__GetSystemTime@<span class="token number">4</span>
     movzx  <span class="token register variable">ecx</span>, WORD PTR _t<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span> <span class="token comment">; wSecond</span>
     push   <span class="token register variable">ecx</span>
     movzx  <span class="token register variable">edx</span>, WORD PTR _t<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span> <span class="token comment">; wMinute</span>
     push   <span class="token register variable">edx</span>
     movzx  <span class="token register variable">eax</span>, WORD PTR _t<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span> <span class="token comment">; wHour</span>
     push   <span class="token register variable">eax</span>
     movzx  <span class="token register variable">ecx</span>, WORD PTR _t<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span> <span class="token comment">; wDay</span>
     push   <span class="token register variable">ecx</span>
     movzx  <span class="token register variable">edx</span>, WORD PTR _t<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span> <span class="token comment">; wMonth</span>
     push   <span class="token register variable">edx</span>
     movzx  <span class="token register variable">eax</span>, WORD PTR _t<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; wYear</span>
     push   <span class="token register variable">eax</span>
     push   OFFSET <span class="token operator">$</span>SG78811 <span class="token comment">; ‚Äô%04d-%02d-%02d %02d:%02d:%02d‚Äô, 0aH, 00H</span>
     call   _printf
     add    <span class="token register variable">esp</span>, <span class="token number">28</span>
     xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
     mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
     pop    <span class="token register variable">ebp</span>
     ret    <span class="token number">0</span>
_main     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ÂáΩÊï∞Âú®Ëøô‰∏™Ê†à‰∏≠‰∏∫ÁªìÊûÑ‰ΩìÁî≥ËØ∑‰∫Ü16Â≠óËäÇÁ©∫Èó¥ÔºàËøô‰∏™ÁªìÊûÑ‰ΩìÁî±8‰∏™WORDÂûãÊï∞ÊçÆÊûÑÊàê),ÊØè‰∏™<code>WORD</code>ÂûãÊï∞ÊçÆÂç†Áî®2Â≠óËäÇ</p>
<p>‰º†ÈÄíÁªôÂáΩÊï∞ÁöÑÊòØSYSTEMTIMEÁªìÊûÑ‰ΩìÁöÑÊåáÈíà„ÄÇ‰ΩÜÊòØÊç¢‰∏™ËßíÂ∫¶ÁúãÔºåËøô‰πüÊòØ<code>wYearÂ≠óÊÆµ</code>ÁöÑÊåáÈíà„ÄÇ<code>GetSystemTime()</code>ÂáΩÊï∞È¶ñÂÖà‰ºöÂú®ÁªìÊûÑ‰ΩìÁöÑÈ¶ñÂú∞ÂùÄÂÜôÂÖ•Âπ¥‰ªΩ‰ø°ÊÅØÔºåÁÑ∂ÂêéÂÜçÊääÊåáÈíàË∞ÉÊï¥2‰∏™Â≠óËäÇÂπ∂ÂÜôÂÖ•Êúà‰ªΩ‰ø°ÊÅØÔºåÂ¶ÇÊ≠§Á±ªÊé®ÂÜôÂÖ•ÂÖ®ÈÉ®‰ø°ÊÅØ„ÄÇ</p>
</li>
</ul>
<hr />
<p>Áî®<code>onlydbg</code>Êü•ÁúãËøô‰∏™ÁªìÊûÑ‰ΩìÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂàÜÂ∏É</p>
<p>‰ªé<code>t</code>ÊåáÈíàÂºÄÂßãÁöÑ‰ΩçÁΩÆÁöÑÂÜÖÂÆπ‰æùÊ¨°ÊòØ:</p>
<pre class="line-numbers language-none"><code class="language-none">DE 07 0C 00 02 00 09 00 16 00 1D 00 34 00 D4 03<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Ëøô‰∏§‰∏™Á©∫Èó¥ÁöÑÊØè‰∏§‰∏™Â≠óËäÇ‰ª£Ë°®ÁªìÊûÑ‰ΩìÁöÑ‰∏Ä‰∏™Â≠óÊÆµÔºåÁî±‰∫éÈááÁî®‰∫Ü<code>Â∞èÁ´ØÂ≠óËäÇÂ∫è</code>ÔºåÊâÄ‰ª•Â∞±Âêå‰∏Ä‰∏™<code>WORD</code>ÂûãÊï∞ÊçÆËÄåË®ÄÔºå‰ΩéÂú∞ÂùÄÂú®ÂâçÔºåÈ´òÂú∞ÂùÄÂú®Âêé</p>
<table>
<thead>
<tr>
<th>ÂçÅÂÖ≠ËøõÂà∂Êï∞</th>
<th>ÂçÅËøõÂà∂Âê´‰πâ</th>
<th>Â≠óÊÆµÂêç</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x07DE</td>
<td>2014</td>
<td>wYear</td>
</tr>
<tr>
<td>0x000C</td>
<td>12</td>
<td>wMonth</td>
</tr>
<tr>
<td>0x0002</td>
<td>2</td>
<td>wDayOfWeek</td>
</tr>
<tr>
<td>0x0009</td>
<td>9</td>
<td>wDay</td>
</tr>
<tr>
<td>0x0016</td>
<td>22</td>
<td>wHour</td>
</tr>
<tr>
<td>0x001D</td>
<td>29</td>
<td>wMinute</td>
</tr>
<tr>
<td>0x0034</td>
<td>52</td>
<td>wSecond</td>
</tr>
<tr>
<td>0x03D4</td>
<td>980</td>
<td>wMilliSeconds</td>
</tr>
</tbody>
</table>
<hr />
<h5 id="‰ª•Êï∞ÁªÑÊõø‰ª£ÁªìÊûÑ‰Ωì"><a class="markdownIt-Anchor" href="#‰ª•Êï∞ÁªÑÊõø‰ª£ÁªìÊûÑ‰Ωì"></a> ‰ª•Êï∞ÁªÑÊõø‰ª£ÁªìÊûÑ‰Ωì</h5>
<p>Áî±‰∫éÁªìÊûÑ‰Ωì‰∏≠ÁöÑÂêÑ‰∏™ÂÖÉÁ¥†ÔºåÂú®ÂÜÖÂ≠ò‰∏≠‰∏ÄÊ¨°ÊéíÂàóÔºåÊàë‰ª¨ÂèØ‰ª•È™åËØÅÂÖ∂Âú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂ≠òÂÇ®Áä∂ÂÜµÂíåÊï∞ÁªÑÁõ∏Âêå</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    WORD array<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">GetSystemTime</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%04d-%02d-%02d %02d:%02d:%02d\n"</span><span class="token punctuation">,</span>
        array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">/* wYear */</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">/* wMonth */</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment">/* wDay */</span><span class="token punctuation">,</span> 
        array<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">/* wHour */</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token comment">/* wMinute */</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token comment">/* wSecond */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰ºöÂºπË≠¶ÂëäÔºå‰ΩÜÊòØ‰ªçÁÑ∂ËÉΩÁºñËØë</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG78573 DB     <span class="token string">'%04d-%02d-%02d %02d:%02d:%02d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
_array<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">16</span><span class="token comment">;size=16</span>
_main   PROC
        Push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        sub     <span class="token register variable">esp</span>, <span class="token number">16</span>
        lea     <span class="token register variable">eax</span>, DWORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        call    DWORD PTR __imp__GetSystemTime@<span class="token number">4</span>
        movzx   <span class="token register variable">ecx</span>, WORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span> <span class="token comment">; wSecond</span>
        push    <span class="token register variable">ecx</span>
        movzx   <span class="token register variable">edx</span>, WORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span> <span class="token comment">; wMinute</span>
        push    <span class="token register variable">edx</span>
        movzx   <span class="token register variable">eax</span>, WORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span> <span class="token comment">; wHoure</span>
        push    <span class="token register variable">eax</span>
        movzx   <span class="token register variable">ecx</span>, WORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span> <span class="token comment">; wDay</span>
        push    <span class="token register variable">ecx</span>
        movzx   <span class="token register variable">edx</span>, WORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span> <span class="token comment">; wMonth</span>
        push    <span class="token register variable">edx</span>
        movzx   <span class="token register variable">eax</span>, WORD PTR _array<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span> <span class="token comment">; wYear</span>
        push    <span class="token register variable">eax</span>
        push    OFFSET <span class="token operator">$</span>SG78573
        call    _printf
        add     <span class="token register variable">esp</span>, <span class="token number">28</span>
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        mov     <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_main   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âç≥‰æøË∞ÉÊï¥‰∫ÜÊï∞ÊçÆÁªìÊûÑÔºåÂèØ‰ª•ÂèëÁé∞Ê±áÁºñ‰ª£Á†ÅÁõ∏Â∑ÆÊó†Âá†</p>
<p><code>‰ªÖ‰ªéÊ±áÁºñÊåá‰ª§ÂàÜÊûêÔºåÂæàÈöæÂà§Êñ≠Âá∫Âà∞Â∫ïÊ∫êÁ®ãÂ∫è‰ΩøÁî®ÁöÑÊòØÂ§öÂèòÈáèÁöÑÁªìÊûÑ‰ΩìËøòÊòØÊï∞ÁªÑ„ÄÇ</code></p>
<p>Â•ΩÂú®Ê≠£Â∏∏‰∫∫‰∏ç‰ºöÂÅöËøôÁßçÂà´Êâ≠ÁöÑÊõøÊç¢„ÄÇÊØïÁ´üÁªìÊûÑ‰ΩìÁöÑÂèØËØªÊÄß„ÄÅÊòìÁî®ÊÄßÈÉΩÊØîÊï∞ÁªÑÂº∫Ôºå‰πüÊñπ‰æøÁºñÁ®ã‰∫∫ÂëòÊõøÊç¢ÁªìÊûÑ‰Ωì‰∏≠ÁöÑÂ≠óÊÆµ„ÄÇ</p>
<h4 id="malloc"><a class="markdownIt-Anchor" href="#malloc"></a> malloc()</h4>
<p><em>Âú®ÂæàÂ§öÊÉÖÂÜµÔºåÈÉΩÁî®heapÊù•Â≠òÂÇ®ÁªìÊûÑ‰ΩìÔºåÈúÄË¶ÅÂÄüÂä©mallocÂáΩÊï∞</em></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    SYSTEMTIME <span class="token operator">*</span>t<span class="token punctuation">;</span>
    t<span class="token operator">=</span><span class="token punctuation">(</span>SYSTEMTIME <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span> <span class="token punctuation">(</span>SYSTEMTIME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GetSystemTime</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%04d-%02d-%02d %02d:%02d:%02d\n"</span><span class="token punctuation">,</span>
        t<span class="token operator">-></span>wYear<span class="token punctuation">,</span> t<span class="token operator">-></span>wMonth<span class="token punctuation">,</span> t<span class="token operator">-></span>wDay<span class="token punctuation">,</span>
        t<span class="token operator">-></span>wHour<span class="token punctuation">,</span> t<span class="token operator">-></span>wMinute<span class="token punctuation">,</span> t<span class="token operator">-></span>wSecond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs /ox </code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_main      PROC
    push   <span class="token register variable">esi</span>
    push   <span class="token number">16</span>
    call   _malloc<span class="token comment">;eax=ptr(t)</span>
    add    <span class="token register variable">esp</span>, <span class="token number">4</span>
    mov    <span class="token register variable">esi</span>, <span class="token register variable">eax</span>
    push   <span class="token register variable">esi</span>
    call   DWORD PTR __imp__GetSystemTime@<span class="token number">4</span><span class="token comment">;</span>
    movzx  <span class="token register variable">eax</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span> <span class="token comment">; wSecond</span>
    movzx  <span class="token register variable">ecx</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span> <span class="token comment">; wMinute</span>
    movzx  <span class="token register variable">edx</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span> <span class="token comment">; wHour</span>
    push   <span class="token register variable">eax</span>
    movzx  <span class="token register variable">eax</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span> <span class="token comment">; wDay</span>
    push   <span class="token register variable">ecx</span>
    movzx  <span class="token register variable">ecx</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span> <span class="token comment">; wMonth</span>
    push   <span class="token register variable">edx</span>
    movzx  <span class="token register variable">edx</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">]</span> <span class="token comment">; wYear</span>
    push   <span class="token register variable">eax</span>
    push   <span class="token register variable">ecx</span>
    push   <span class="token register variable">edx</span>
    push   OFFSET <span class="token operator">$</span>SG78833
    call   _printf
    push   <span class="token register variable">esi</span>
    call   _free
    add    <span class="token register variable">esp</span>, <span class="token number">32</span>
    xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    pop    <span class="token register variable">esi</span>
    ret    <span class="token number">0</span>
_main      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>mallocÊé•Êî∂ÁöÑÂèÇÊï∞16Â∞±ÊòØ<code>sizeof(systemtime)</code>,<code>malloc()</code>ÂáΩÊï∞Ê†πÊçÆÂèÇÊï∞ÊåáÂÆöÁöÑÂ§ßÂ∞èÂàÜÈÖç‰∏ÄÂùóÁ©∫Èó¥ÔºåÂπ∂ÊääÁ©∫Èó¥ÁöÑÊåáÈíà‰º†ÈÄíÁªô<code>EAX</code>ÂØÑÂ≠òÂô®</li>
</ul>
<h4 id="unix-struct-tm"><a class="markdownIt-Anchor" href="#unix-struct-tm"></a> UNIX: struct tm</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">tm</span> t<span class="token punctuation">;</span>
    <span class="token class-name">time_t</span> unix_time<span class="token punctuation">;</span>

    unix_time<span class="token operator">=</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">localtime_r</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>unix_time<span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Year: %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>tm_year<span class="token operator">+</span><span class="token number">1900</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Month: %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>tm_mon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Day: %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>tm_mday<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Hour: %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>tm_hour<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Minutes: %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>tm_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Seconds: %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>tm_sec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">main proc  near
     push     <span class="token register variable">ebp</span>
     mov      <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
     and      <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span>
     sub      <span class="token register variable">esp</span>, <span class="token number">40h</span>
     mov      dword ptr <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token number">0</span> <span class="token comment">; first argument for time()</span>
     call     time
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">3Ch</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     lea      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">3Ch</span><span class="token operator">]</span>  <span class="token comment">; take pointer to what time() returned</span>
     lea      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">]</span>  <span class="token comment">; at ESP+10h struct tm will begin</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>    <span class="token comment">; pass pointer to the structure begin</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>      <span class="token comment">; pass pointer to result of time()</span>
     call     localtime_r
     mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">24h</span><span class="token operator">]</span>  <span class="token comment">; tm_year</span>
     lea      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">76Ch</span><span class="token operator">]</span> <span class="token comment">; edx=eax+1900</span>
     mov      <span class="token register variable">eax</span>, offset format <span class="token comment">; "Year: %d\n"</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     call     printf
     mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">]</span>      <span class="token comment">; tm_mon</span>
     mov      <span class="token register variable">eax</span>, offset aMonthD <span class="token comment">; "Month: %d\n"</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     call     printf
     mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">1Ch</span><span class="token operator">]</span>     <span class="token comment">; tm_mday</span>
     mov      <span class="token register variable">eax</span>, offset aDayD  <span class="token comment">; "Day: %d\n"</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     call     printf
     mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">18h</span><span class="token operator">]</span>     <span class="token comment">; tm_hour</span>
     mov      <span class="token register variable">eax</span>, offset aHourD <span class="token comment">; "Hour: %d\n"</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     call     printf
     mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">14h</span><span class="token operator">]</span>        <span class="token comment">; tm_min</span>
     mov      <span class="token register variable">eax</span>, offset aMinutesD <span class="token comment">; "Minutes: %d\n"</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     call     printf
     mov      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">]</span>
     mov      <span class="token register variable">eax</span>, offset aSecondsD <span class="token comment">; "Seconds: %d\n"</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>          <span class="token comment">; tm_sec</span>
     mov      <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     call     printf
     leave
     retn
main endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØ‚Äúlea edx, [eax+76Ch]‚ÄùÊåá‰ª§„ÄÇÂÆÉÁªôEAXÂØÑÂ≠òÂô®ÈáåÁöÑÂÄºÂä†‰∏ä0x76CÔºà1900ÔºâÔºåËÄå‰∏ç‰ºö‰øÆÊîπ‰ªª‰ΩïÊ†áÂøó‰Ωç„ÄÇ</li>
</ul>
<p>‰∏é‰∏äÊñáÁ±ª‰ººÔºåÂèØ‰ª•Áî®WORDÊï∞ÁªÑ‰ª£ÊõøËøô‰∏™ÁªìÊûÑ‰ΩìÔºå‰ΩÜÊòØÊàë‰ª¨ÁîöËá≥‰πüÂèØ‰ª•Áî®Â≠óËäÇÂûãÊï∞ÁªÑÊù•‰ª£Êõø</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">tm</span> t<span class="token punctuation">;</span>
    <span class="token class-name">time_t</span> unix_time<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>

    unix_time<span class="token operator">=</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">localtime_r</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>unix_time<span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"0x%02X "</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âè™Ë¶ÅÊéßÂà∂Â•ΩÊØè‰∏™Êé•ÂèóÁöÑÂèÇÊï∞ÁöÑÊï∞ÁªÑÁöÑÂêàÈÄÇ‰ΩçÁΩÆÂç≥ÂèØ</p>
<h4 id="ÁªìÊûÑ‰ΩìÁöÑÂ≠óÊÆµÂ∞ÅË£Ö"><a class="markdownIt-Anchor" href="#ÁªìÊûÑ‰ΩìÁöÑÂ≠óÊÆµÂ∞ÅË£Ö"></a> ÁªìÊûÑ‰ΩìÁöÑÂ≠óÊÆµÂ∞ÅË£Ö</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">struct</span> <span class="token class-name">s</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b<span class="token punctuation">;</span>
    <span class="token keyword">char</span> c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> d<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">s</span> s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a=%d; b=%d; c=%d; d=%d\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>a<span class="token punctuation">,</span> s<span class="token punctuation">.</span>b<span class="token punctuation">,</span> s<span class="token punctuation">.</span>c<span class="token punctuation">,</span> s<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">s</span> tmp<span class="token punctuation">;</span>
    tmp<span class="token punctuation">.</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    tmp<span class="token punctuation">.</span>b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
    tmp<span class="token punctuation">.</span>c<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
    tmp<span class="token punctuation">.</span>d<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token function">f</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs 2012 /GS /Ob0</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"> <span class="token number">1</span> _tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">16</span>
 <span class="token number">2</span> _main    PROC
 <span class="token number">3</span>     push   <span class="token register variable">ebp</span>
 <span class="token number">4</span>     mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
 <span class="token number">5</span>     sub    <span class="token register variable">esp</span>, <span class="token number">16</span>
 <span class="token number">6</span>     mov    BYTE PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token number">1</span>       <span class="token comment">; set field a</span>
 <span class="token number">7</span>     mov    DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">2</span>    <span class="token comment">; set field b</span>
 <span class="token number">8</span>     mov    BYTE PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token number">3</span>     <span class="token comment">; set field c</span>
 <span class="token number">9</span>     mov    DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token number">4</span>   <span class="token comment">; set field d</span>
<span class="token number">10</span>     sub    <span class="token register variable">esp</span>, <span class="token number">16</span>                      <span class="token comment">; allocate place for temporary structure</span>
<span class="token number">11</span>     mov    <span class="token register variable">eax</span>, <span class="token register variable">esp</span>
<span class="token number">12</span>     mov    <span class="token register variable">ecx</span>, DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>    <span class="token comment">; copy our structure to the temporary one</span>
<span class="token number">13</span>     mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
<span class="token number">14</span>     mov    <span class="token register variable">edx</span>, DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token number">15</span>     mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
<span class="token number">16</span>     mov    <span class="token register variable">ecx</span>, DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
<span class="token number">17</span>     mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
<span class="token number">18</span>     mov    <span class="token register variable">edx</span>, DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
<span class="token number">19</span>     mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
<span class="token number">20</span>     call    _f
<span class="token number">21</span>     add    <span class="token register variable">esp</span>, <span class="token number">16</span>
<span class="token number">22</span>     xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
<span class="token number">23</span>     mov    <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
<span class="token number">24</span>     pop    <span class="token register variable">ebp</span>
<span class="token number">25</span>     ret    <span class="token number">0</span>
<span class="token number">26</span> _main   ENDP
<span class="token number">27</span>
<span class="token number">28</span> _s<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                <span class="token comment">; size = 16</span>
<span class="token number">29</span> ?f@@YAXUs@@@Z PROC     <span class="token comment">; f</span>
<span class="token number">30</span>     push  <span class="token register variable">ebp</span>
<span class="token number">31</span>     mov   <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
<span class="token number">32</span>     mov   <span class="token register variable">eax</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
<span class="token number">33</span>     push  <span class="token register variable">eax</span>
<span class="token number">34</span>     movsx <span class="token register variable">ecx</span>, BYTE PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
<span class="token number">35</span>     push  <span class="token register variable">ecx</span>
<span class="token number">36</span>     mov   <span class="token register variable">edx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token number">37</span>     push  <span class="token register variable">edx</span>
<span class="token number">38</span>     movsx <span class="token register variable">eax</span>, BYTE PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
<span class="token number">39</span>     push  <span class="token register variable">eax</span>
<span class="token number">40</span>     push  OFFSET <span class="token operator">$</span>SG3842
<span class="token number">41</span>     call  _printf
<span class="token number">42</span>     add   <span class="token register variable">esp</span>, <span class="token number">20</span>
<span class="token number">43</span>     pop   <span class="token register variable">ebp</span>
<span class="token number">44</span>     ret   <span class="token number">0</span>
<span class="token number">45</span> ?f@@YAXUs@@@Z ENDP <span class="token comment">; f</span>
<span class="token number">46</span> _TEXT     ENDS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ËôΩÁÑ∂Êàë‰ª¨Âú®‰ª£Á†ÅÈáå‰∏ÄÊ¨°ÊÄßÂàÜÈÖç‰∫ÜÁªìÊûÑ‰ΩìtmpÔºåÂπ∂‰æùÊ¨°ÁªôÂÆÉÁöÑÂõõ‰∏™Â≠óÊÆµËµãÂÄºÔºå‰ΩÜÊòØÂèØÊâßË°åÁ®ãÂ∫èÁöÑÊåá‰ª§Êúâ‰∫õ‰∏çÂêåÔºöÂÆÉÂ∞ÜÁªìÊûÑ‰ΩìÁöÑÊåáÈíàÂ§çÂà∂Âà∞‰∏¥Êó∂Âú∞ÂùÄÔºàÁ¨¨10Ë°åÊåá‰ª§ÂàÜÈÖçÁöÑÁ©∫Èó¥ÈáåÔºâÔºåÁÑ∂ÂêéÈÄöËøá‰∏¥Êó∂ÁöÑ‰∏≠Èó¥ÂèòÈáèÊääÁªìÊûÑ‰ΩìÁöÑÂõõ‰∏™ÂÄºËµãÂÄºÁªô‰∏¥Êó∂ÁªìÊûÑ‰ΩìÔºàÁ¨¨12ÔΩû19Ë°åÁöÑÊåá‰ª§ÔºâÔºåËøòÊääÊåáÈíà‰πüÂ§çÂà∂Âá∫Êù•‰æõf()Ë∞ÉÁî®„ÄÇ</p>
</li>
<li>
<p><mark>Ëøô‰∏ªË¶ÅÊòØÂõ†‰∏∫ÁºñËØëÂô®Êó†Ê≥ïÂà§Êñ≠f()ÂáΩÊï∞ÊòØÂê¶‰ºö‰øÆÊîπÁªìÊûÑ‰ΩìÁöÑÂÜÖÂÆπ„ÄÇÂÄüÂä©‰∏≠Èó¥ÂèòÈáèÔºåÁºñËØëÂô®ÂèØ‰ª•‰øùËØÅmain()ÂáΩÊï∞ÈáåtmpÁªìÊûÑ‰ΩìÁöÑÂÄº‰∏çÂèóË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÁöÑÂΩ±Âìç„ÄÇ</mark></p>
</li>
<li>
<p>Âè¶Â§ñÔºå<mark>Ëøô‰∏™Á®ãÂ∫èÈáåÁªìÊûÑ‰ΩìÁöÑÂ≠óÊÆµÂêë4Â≠óËäÇËæπÁïåÂØπÈΩê</mark>„ÄÇ‰πüÂ∞±ÊòØËØ¥ÂÆÉÁöÑcharÂûãÊï∞ÊçÆ‰πüÂíåintÂûãÊï∞ÊçÆ‰∏ÄÊ†∑Âç†4Â≠óËäÇÂ≠òÂÇ®Á©∫Èó¥„ÄÇËøô‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÊñπ‰æøCPU‰ªéÂÜÖÂ≠òËØªÂèñÊï∞ÊçÆÔºåÊèêÈ´òËØªÂÜôÂíåÁºìÂ≠òÁöÑÊïàÁéá„ÄÇ</p>
<p>ËøôÊ†∑ÁöÑÁº∫ÁÇπÊòØÊµ™Ë¥πÂ≠òÂÇ®Á©∫Èó¥ÔºåÊàë‰ª¨ÂèØ‰ª•ÂêØÁî®ÁºñËØëÂô®ÁöÑ/Zp1 (/Zp[n]Ë°®Á§∫Âêë<em>n</em>‰∏™Â≠óËäÇÁöÑËæπÁïåÂØπÈΩê)ÈÄâÈ°π„ÄÇ</p>
<ul>
<li>Â¶ÇÊûúÊüê‰∏™ÁªìÊûÑ‰ΩìË¢´Â§ö‰∏™Ê∫êÊñá‰ª∂„ÄÅÁõÆÊ†áÊñá‰ª∂Ôºàobject filesÔºâË∞ÉÁî®ÔºåÈÇ£‰πàÂú®ÁºñËØëËøô‰∫õÁ®ãÂ∫èÊó∂ÔºåÁªìÊûÑÂ∞ÅË£ÖÊ†ºÂºèÂíåÊï∞ÊçÆÂØπÂÖ∂ËßÑËåÉ(/Zp[n])ÂøÖÈ°ªÂÆåÂÖ®ÂåπÈÖç„ÄÇ</li>
</ul>
</li>
</ul>
<hr />
<pre class="line-numbers language-c" data-language="c"><code class="language-c">Âú®ÂêëË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞‰º†ÈÄíÁªìÊûÑ‰ΩìÊó∂Ôºà‰∏çÊòØ‰º†ÈÄíÁªìÊûÑ‰ΩìÁöÑÊåáÈíàÔºâÔºå‰º†ÈÄíÂèÇÊï∞ÁöÑËøáÁ®ãÁõ∏ÂΩì‰∫é‰æùÊ¨°‰º†ÈÄíÁªìÊûÑ‰ΩìÁöÑÂêÑÂ≠óÊÆµ„ÄÇÂç≥ÊòØËØ¥ÔºåÂ¶ÇÊûúÁªìÊûÑ‰ΩìÂêÑÂ≠óÊÆµÁöÑÂÆö‰πâ‰∏çÂèòÔºåÈÇ£‰πà<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ÂáΩÊï∞ÁöÑÊ∫ê‰ª£Á†ÅÂèØÊîπÂÜô‰∏∫Ôºö

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">char</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a=%d; b=%d; c=%d; d=%d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ÁªìÊûÑ‰ΩìÁöÑÂµåÂ•ó"><a class="markdownIt-Anchor" href="#ÁªìÊûÑ‰ΩìÁöÑÂµåÂ•ó"></a> ÁªìÊûÑ‰ΩìÁöÑÂµåÂ•ó</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">inner_struct</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">outer_struct</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">inner_struct</span> c<span class="token punctuation">;</span>
    <span class="token keyword">char</span> d<span class="token punctuation">;</span>
    <span class="token keyword">int</span> e<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">outer_struct</span> s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a=%d; b=%d; c.a=%d; c.b=%d; d=%d; e=%d\n"</span><span class="token punctuation">,</span>
        s<span class="token punctuation">.</span>a<span class="token punctuation">,</span> s<span class="token punctuation">.</span>b<span class="token punctuation">,</span> s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>a<span class="token punctuation">,</span> s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>b<span class="token punctuation">,</span> s<span class="token punctuation">.</span>d<span class="token punctuation">,</span> s<span class="token punctuation">.</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">outer_struct</span> s<span class="token punctuation">;</span>
    s<span class="token punctuation">.</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span>b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>a<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>b<span class="token operator">=</span><span class="token number">101</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span>d<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span>e<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>MSVC 2010ÔºàÂêØÁî®/Ox /Ob0ÈÄâÈ°πÔºâ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG2802 DB    ‚Äôa<span class="token operator">=</span><span class="token operator">%</span>d<span class="token comment">; b=%d; c.a=%d; c.b=%d; d=%d; e=%d‚Äô, 0aH, 00H</span>

_TEXT    SEGMENT
_s<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_f    PROC
      mov    <span class="token register variable">eax</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>
      movsx  <span class="token register variable">ecx</span>, BYTE PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
      mov    <span class="token register variable">edx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
      push   <span class="token register variable">eax</span>
      mov    <span class="token register variable">eax</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
      push   <span class="token register variable">ecx</span>
      mov    <span class="token register variable">ecx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
      push   <span class="token register variable">edx</span>
      movsx  <span class="token register variable">edx</span>, BYTE PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
      push   <span class="token register variable">eax</span>
      push   <span class="token register variable">ecx</span>
      push   <span class="token register variable">edx</span>
      push   OFFSET <span class="token operator">$</span>SG2802 <span class="token comment">; ‚Äôa=%d; b=%d; c.a=%d; c.b=%d; d=%d; e=%d‚Äô</span>
      call   _printf
      add    <span class="token register variable">esp</span>, <span class="token number">28</span>
      ret    <span class="token number">0</span>
_f       ENDP

_s<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">24</span>
_main    PROC
    sub    <span class="token register variable">esp</span>, <span class="token number">24</span>
    push   <span class="token register variable">ebx</span>
    push   <span class="token register variable">esi</span>
    push   <span class="token register variable">edi</span>
    mov    <span class="token register variable">ecx</span>, <span class="token number">2</span>
    sub    <span class="token register variable">esp</span>, <span class="token number">24</span>
    mov    <span class="token register variable">eax</span>, <span class="token register variable">esp</span>
    mov    BYTE PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">60</span><span class="token operator">]</span>, <span class="token number">1</span><span class="token comment">;s.a=1</span>
    mov    <span class="token register variable">ebx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">60</span><span class="token operator">]</span>
    mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>
    mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
    lea    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">98</span><span class="token operator">]</span>
    lea    <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">99</span><span class="token operator">]</span>
    lea    <span class="token register variable">edi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span>
    mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
    mov    BYTE PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">76</span><span class="token operator">]</span>, <span class="token number">3</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">76</span><span class="token operator">]</span>
    mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token register variable">esi</span>
    mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
    mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">]</span>, <span class="token register variable">edi</span>
    call   _f
    add    <span class="token register variable">esp</span>, <span class="token number">24</span>
    pop    <span class="token register variable">edi</span>
    pop    <span class="token register variable">esi</span>
    xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    pop    <span class="token register variable">ebx</span>
    add    <span class="token register variable">esp</span>, <span class="token number">24</span>
    ret    <span class="token number">0</span>
_main    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Áî±Ê±áÁºñ‰ª£Á†ÅÂèØ‰ª•ÁúãÂá∫ÔºåÂÜÖÂµåÁªìÊûÑ‰Ωì‰ºöË¢´ÁºñËØëÂô®Â±ïÂºÄÂΩ¢Êàê‰∏ÄÁª¥ÁªìÊûÑ‰Ωì</li>
<li>ÂÜÖÂ≠ò‰∏≠ÁöÑÊûÑÈÄ†Â¶Ç‰∏ãÔºö
<ul>
<li>(outer_struct.a)ÂÄº‰∏∫1ÁöÑÂ≠óËäÇÔºåÂÖ∂Âêé3Â≠óËäÇÊòØÈöèÊú∫ËÑèÊï∞ÊçÆ„ÄÇ</li>
<li>(outer_struct.b) 32 ‰ΩçwordÂûãÊï∞ÊçÆ2„ÄÇ</li>
<li>(outer_struct.a)32 ‰ΩçwordÂûãÊï∞ÊçÆ0x64(100)„ÄÇ</li>
<li>(outer_struct.b)32 ‰ΩçwordÂûãÊï∞ÊçÆ0x65(101)„ÄÇ</li>
<li>(outer_struct.d)ÂÄº‰∏∫3ÁöÑÂ≠óËäÇÔºå‰ª•ÂèäÂÖ∂Âêé3Â≠óËäÇÁöÑËÑèÊï∞ÊçÆ„ÄÇ</li>
<li>(outer_struct.e)32 ‰ΩçwordÂûãÊï∞ÊçÆ4„ÄÇ</li>
</ul>
</li>
</ul>
<h4 id="ÁªìÊûÑ‰ΩìÁöÑ‰ΩçÊìç‰Ωú"><a class="markdownIt-Anchor" href="#ÁªìÊûÑ‰ΩìÁöÑ‰ΩçÊìç‰Ωú"></a> ÁªìÊûÑ‰ΩìÁöÑ‰ΩçÊìç‰Ωú</h4>
<p>‰ª•CPUIDÊåá‰ª§‰∏∫‰æã„ÄÇËØ•Êåá‰ª§Áî®‰∫éËé∑ÂèñCPUÂèäÂÖ∂ÁâπÊÄß‰ø°ÊÅØ„ÄÇ</p>
<p>Â¶ÇÊûúÂú®Ë∞ÉÁî®Êåá‰ª§‰πãÂâçËÆæÁΩÆEAXÂØÑÂ≠òÂô®ÁöÑÂÄº‰∏∫1ÔºåÈÇ£‰πàCPUIDÊåá‰ª§Â∞Ü‰ºöÊåâÁÖß‰∏ãÂàóÊ†ºÂºèÂú®EAXÂØÑÂ≠òÂô®ÈáåÂ≠òÂÇ®CPUÁöÑÁâπÂæÅ‰ø°ÊÅØ„ÄÇ</p>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240609202329684.png" class="" alt="image-20240609202329684" loading="lazy">
<p><em>C/C++ËØ≠Ë®ÄÂèØ‰ª•Á≤æÁ°ÆÊìç‰ΩúÁªìÊûÑ‰Ωì‰∏≠ÁöÑ‰ΩçÂüü„ÄÇËøôËÉΩÂ§üÂ∏ÆÂä©Á®ãÂ∫èÂëòÂ§ßÂπÖÂ∫¶Âú∞ËäÇÁúÅÁ®ãÂ∫èÁöÑÂÜÖÂ≠òÊ∂àËÄó„ÄÇ</em></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">__GNUC__</span></span>
<span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">cpuid</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>c<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span><span class="token string">"cpuid"</span><span class="token operator">:</span><span class="token string">"=a"</span><span class="token punctuation">(</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"=b"</span><span class="token punctuation">(</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"=c"</span><span class="token punctuation">(</span><span class="token operator">*</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"=d"</span><span class="token punctuation">(</span><span class="token operator">*</span>d<span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">"a"</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_MSC_VER</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;intrin.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token keyword">struct</span> <span class="token class-name">CPUID_1_EAX</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> stepping<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> model<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> family_id<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> processor_type<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> reserved1<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> extended_model_id<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> extended_family_id<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> reserved2<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">CPUID_1_EAX</span> <span class="token operator">*</span>tmp<span class="token punctuation">;</span>
    <span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_MSC_VER</span></span>
    <span class="token function">__cpuid</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">__GNUC__</span></span>
    <span class="token function">cpuid</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    tmp<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">CPUID_1_EAX</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"stepping=%d\n"</span><span class="token punctuation">,</span> tmp<span class="token operator">-></span>stepping<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"model=%d\n"</span><span class="token punctuation">,</span> tmp<span class="token operator">-></span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"family_id=%d\n"</span><span class="token punctuation">,</span> tmp<span class="token operator">-></span>family_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"processor_type=%d\n"</span><span class="token punctuation">,</span> tmp<span class="token operator">-></span>processor_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"extended_model_id=%d\n"</span><span class="token punctuation">,</span> tmp<span class="token operator">-></span>extended_model_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"extended_family_id=%d\n"</span><span class="token punctuation">,</span> tmp<span class="token operator">-></span>extended_family_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®CPUIDÂ∞ÜËøîÂõûÂÄºÂ≠òÂÇ®Âà∞EAX/EBX/ECX/EDX‰πãÂêéÔºåÁ®ãÂ∫è‰ΩøÁî®Êï∞ÁªÑb[]Êî∂ÈõÜÁõ∏ÂÖ≥‰ø°ÊÅØ„ÄÇÁÑ∂ÂêéÔºåÊàë‰ª¨ÈÄöËøáÊåáÂêëÁªìÊûÑ‰ΩìCPUID_1_EAXÁöÑÊåáÈíàÔºå‰ªéÊï∞ÁªÑb[]‰∏≠Ëé∑ÂèñEAXÂØÑÂ≠òÂô®ÈáåÁöÑÂÄº„ÄÇ</p>
<hr />
<p>Êàë‰ª¨‰πüÂèØ‰ª•Áî®ÁªìÊûÑ‰ΩìÊ®°ÊãüÂá∫ÊµÆÁÇπÊï∞ÔºåÂπ∂‰∏îÂú®Á®ãÂ∫è‰∏≠Êõø‰ª£floatÁ±ªÂûãÔºå‰ΩÜÊòØÊ≤°‰ªÄ‰πàÊÑè‰πâÔºåÁï•Ëøá</p>
<hr />
<h3 id="chap22-unionÂÖ±Áî®‰Ωì"><a class="markdownIt-Anchor" href="#chap22-unionÂÖ±Áî®‰Ωì"></a> Chap22 UnionÂÖ±Áî®‰Ωì</h3>
<h4 id="‰º™ÈöèÊú∫Êï∞ÁîüÊàê"><a class="markdownIt-Anchor" href="#‰º™ÈöèÊú∫Êï∞ÁîüÊàê"></a> ‰º™ÈöèÊú∫Êï∞ÁîüÊàê</h4>
<ul>
<li>
<p>Âà©Áî®unionÁªìÊûÑÂèØ‰ª•‰∏çÁî®Èô§Ê≥ïÂ∞±ÁîüÊàê‰ªã‰∫é0~1‰πãÈó¥ÁöÑÈöèÊú∫Êï∞</p>
<p>ÂèØÈááÁî®ÂÖ±Áî®‰ΩìÁ±ªÂûãÔºàunionÔºâÁöÑÊï∞ÊçÆË°®Á§∫ÂçïÁ≤æÂ∫¶ÊµÆÁÇπÊï∞ÔºàfloatÔºâ„ÄÇÂàõÂª∫‰∏Ä‰∏™unionÂûãÂèòÈáèÔºåÁÑ∂ÂêéÊääÂÆÉÂΩì‰ΩúfloatÂûãÊàñuint32_tÂûãÊï∞ÊçÆËøõË°åËØªÂèñ„ÄÇ</p>
</li>
<li>
<p>ÂçïÁ≤æÂ∫¶ÊµÆÁÇπÊï∞ÔºàfloatÔºâÂûãÊï∞ÊçÆÁî±Á¨¶Âè∑‰Ωç„ÄÅÊúâÊïàÊï∞Â≠óÂíåÊåáÊï∞‰∏âÈÉ®ÂàÜÊûÑÊàê„ÄÇËøôÁßçÊï∞ÊçÆÁªìÊûÑÂÜ≥ÂÆöÔºåÂè™Ë¶ÅÈöèÊú∫Â°´ÂÖÖÊúâÊïàÊï∞Â≠ó‰ΩçÂ∞±ÂèØ‰ª•ÁîüÊàêÈöèÊú∫ÁöÑÂçïÁ≤æÂ∫¶Êï∞</p>
</li>
<li>
<p>‰æùÊçÆÊúâÂÖ≥ËßÑËåÉÔºåÈöèÊú∫ÊµÆÁÇπÊï∞ÁöÑÊåáÊï∞ÈÉ®ÂàÜ‰∏çÂèØ‰ª•ÊòØ0„ÄÇÈÇ£‰πàÊàë‰ª¨‰∏çÂ¶®ÊääÊåáÊï∞ÈÉ®ÂàÜÁõ¥Êé•ËÆæÁΩÆ‰∏∫01111111ÔºàÂç≥ÂçÅËøõÂà∂ÁöÑ1ÔºâÔºåÁî®ÈöèÊú∫Êï∞Â≠óÂ°´ÂÖÖÊúâÊïàÊï∞Â≠óÈÉ®ÂàÜÔºåÂÜçÊääÁ¨¶Âè∑‰ΩçËÆæÁΩÆ‰∏∫Èõ∂ÔºàË°®Á§∫Ê≠£Êï∞Ôºâ„ÄÇ</p>
</li>
<li>
<p>ÂÜçÊääÂÆÉÂáèÂéª1Â∞±ÂèØ‰ª•ÂæóÂà∞‰∏Ä‰∏™Ê†áÂáÜÁöÑÈöèÊú∫ÂáΩÊï∞„ÄÇ</p>
</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">nclude</span> <span class="token expression"><span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>

<span class="token comment">// integer PRNG definitions, data and routines:</span>

<span class="token comment">//constants from the Numerical Recipes book</span>
<span class="token keyword">const</span> <span class="token class-name">uint32_t</span> RNG_a<span class="token operator">=</span><span class="token number">1664525</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token class-name">uint32_t</span> RNG_c<span class="token operator">=</span><span class="token number">1013904223</span><span class="token punctuation">;</span>
<span class="token class-name">uint32_t</span> RNG_state<span class="token punctuation">;</span> <span class="token comment">// global variable</span>

<span class="token keyword">void</span> <span class="token function">my_srand</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         RNG_state<span class="token operator">=</span>i<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">uint32_t</span> <span class="token function">my_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         RNG_state<span class="token operator">=</span>RNG_state<span class="token operator">*</span>RNG_a<span class="token operator">+</span>RNG_c<span class="token punctuation">;</span>
         <span class="token keyword">return</span> RNG_state<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// FPU PRNG definitions and routines:</span>

<span class="token keyword">union</span> uint32_t_float
<span class="token punctuation">&#123;</span>
         <span class="token class-name">uint32_t</span> i<span class="token punctuation">;</span>
         <span class="token keyword">float</span> f<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">float</span> <span class="token function">float_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">union</span> uint32_t_float tmp<span class="token punctuation">;</span>
         tmp<span class="token punctuation">.</span>i<span class="token operator">=</span><span class="token function">my_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x007fffff</span> <span class="token operator">|</span> <span class="token number">0x3F800000</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> tmp<span class="token punctuation">.</span>f<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// test</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
         <span class="token function">my_srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// PRNG initialization</span>

         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> <span class="token function">float_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG4232  DB     <span class="token string">'%f'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

__real@3ff0000000000000 DQ 03ff0000000000000r <span class="token comment">;1</span>

tv140 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>                
_tmp<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>                
?float_rand@@YAMXZ PROC
        push    <span class="token register variable">ecx</span>
        call    ?my_rand@@YAIXZ
<span class="token comment">; EAX=pseudorandom value</span>
        and     <span class="token register variable">eax</span>, <span class="token number">8388607</span>        <span class="token comment">; 007fffffH</span>
        or      <span class="token register variable">eax</span>, <span class="token number">1065353216</span>     <span class="token comment">; 3f800000H</span>
<span class="token comment">; EAX=pseudorandom value &amp; 0x007fffff | 0x3f800000</span>
<span class="token comment">; store it into local stack:</span>
        mov     DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token comment">; reload it as float point number:</span>
        fld     DWORD PTR _tmp<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; subtract 1.0:</span>
        fsub    QWORD PTR __real@3ff0000000000000
<span class="token comment">; store value we got into local stack and reload it:</span>
        fstp    DWORD PTR tv130<span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; \  these instructions are redundant</span>
        fld     DWORD PTR tv130<span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; /</span>
        pop     <span class="token register variable">ecx</span>
        ret     <span class="token number">0</span>
?float_rand@@YAMXZ ENDP

_main   PROC
        push    <span class="token register variable">esi</span>
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        call    _time
        push    <span class="token register variable">eax</span>
        call    ?my_srand@@YAXI@Z
        add     <span class="token register variable">esp</span>, <span class="token number">4</span>
        mov     <span class="token register variable">esi</span>, <span class="token number">100</span>
<span class="token label function">$LL3@main:</span>
        call    ?float_rand@@YAMXZ
        sub     <span class="token register variable">esp</span>, <span class="token number">8</span>
        fstp    QWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
        push    OFFSET <span class="token operator">$</span>SG4238
        call    _printf
        add     <span class="token register variable">esp</span>, <span class="token number">12</span>
        dec     <span class="token register variable">esi</span>
        jne     SHORT <span class="token operator">$</span>LL3@main
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        pop     <span class="token register variable">esi</span>
        ret     <span class="token number">0</span>
_main   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Â¶ÇÊûú‰ΩøÁî®MSVC 2012ÁºñËØëÂô®ËøõË°åÁºñËØëÔºåÈÇ£‰πàÂèØÊâßË°åÁ®ãÂ∫èÂàô‰ºö‰ΩøÁî®Èù¢ÂêëFPUÁöÑSIMDÊåá‰ª§„ÄÇ</p>
<h4 id="ËÆ°ÁÆóÊú∫Âô®Á≤æÂ∫¶"><a class="markdownIt-Anchor" href="#ËÆ°ÁÆóÊú∫Âô®Á≤æÂ∫¶"></a> ËÆ°ÁÆóÊú∫Âô®Á≤æÂ∫¶</h4>
<p><code>ÂçïÁ≤æÂ∫¶ÊµÆÁÇπÊï∞ÁöÑ‚ÄúÊú∫Âô®Á≤æÂ∫¶/machine epsilon‚ÄùÊåáÁöÑÊòØÁõ∏ÂØπËØØÂ∑ÆÁöÑ‰∏äÈôêÔºåÂç≥FPUÊìç‰ΩúÁöÑÊúÄÂ∞èÂÄº</code>„ÄÇÂõ†Ê≠§ÔºåÊµÆÁÇπÊï∞ÁöÑÊï∞ÊçÆ‰ΩçË∂äÂ§öÔºåËØØÂ∑ÆË∂äÂ∞è„ÄÅÁ≤æÂ∫¶Ë∂äÈ´ò„ÄÇÊïÖËÄåÂçïÁ≤æÂ∫¶floatÂûãÊï∞ÊçÆÁöÑÊúÄÈ´òÁ≤æÂ∫¶‰∏∫2‚àí23=1.19e‚àí7ÔºåËÄåÂèåÁ≤æÂ∫¶doubleÂûãÁöÑÊúÄÈ´òÁ≤æÂ∫¶‰∏∫2‚àí52=2.22e‚àí16„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token keyword">union</span> uint_float
<span class="token punctuation">&#123;</span>
        <span class="token class-name">uint32_t</span> i<span class="token punctuation">;</span>
        <span class="token keyword">float</span> f<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">float</span> <span class="token function">calculate_machine_epsilon</span><span class="token punctuation">(</span><span class="token keyword">float</span> start<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">union</span> uint_float v<span class="token punctuation">;</span>
        v<span class="token punctuation">.</span>f<span class="token operator">=</span>start<span class="token punctuation">;</span>
        v<span class="token punctuation">.</span>i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> v<span class="token punctuation">.</span>f<span class="token operator">-</span>start<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span> 
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%g\n"</span><span class="token punctuation">,</span> <span class="token function">calculate_machine_epsilon</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏äËø∞Á®ãÂ∫è‰ªéIEEE 754Ê†ºÂºèÁöÑÊµÆÁÇπÊï∞‰∏≠ÊèêÂèñÂ∞èÊï∞ÈÉ®ÂàÜÔºåÊääËøôÈÉ®ÂàÜÂΩì‰ΩúÊï¥Êï∞Â§ÑÁêÜÂπ∂‰∏îÁªôÂÆÉÂä†‰∏ä1„ÄÇ<code>ËøêÁÆóÁöÑ‰∏≠Èó¥ÂÄºÊòØ‚ÄúËæìÂÖ•ÂÄºÔºãÊú∫Âô®Á≤æÂ∫¶‚Äù„ÄÇÈÄöËøáÊµãÁÆóËæìÂÖ•ÂÄºÔºàÂçïÁ≤æÂ∫¶ÂûãÊï∞ÂÄºÔºâ‰∏é‰∏≠Èó¥ÂÄºÁöÑÂ∑ÆÂÄº</code>Êù•ÊµãÁÆóÂÖ∑‰ΩìfloatÂûãÊï∞ÊçÆÁöÑÊú∫Âô®Á≤æÂ∫¶„ÄÇ</p>
<p>Á®ãÂ∫è‰ΩøÁî®unionÂûãÊï∞ÊçÆÁªìÊûÑËß£ÊûêIEEE 754Ê†ºÂºèÁöÑfloatÂûãÊµÆÁÇπÊï∞ÔºåÂπ∂Âà©Áî®ËøôÁßçÊï∞ÊçÆÁªìÊûÑÊääfloatÊï∞ÊçÆÁöÑÂ∞èÊï∞ÈÉ®ÂàÜÊèêÂèñ‰∏∫Êï¥Êï∞<code>‚Äú1‚ÄùÂÆûÈôÖ‰∏äÂä†Âà∞ÊµÆÁÇπÊï∞Â∞èÊï∞ÈÉ®ÂàÜ‰∏≠Âéª‰∫Ü„ÄÇÂΩìÁÑ∂ÔºåËøôÂèØËÉΩÈÄ†ÊàêÊ∫¢Âá∫ÔºåÂèØËÉΩÊääÊúÄÈ´ò‰ΩçÁöÑËøõ‰ΩçÂä†Âà∞ÊµÆÁÇπÊï∞ÁöÑÊåáÊï∞ÈÉ®ÂàÜ</code>„ÄÇ</p>
<p>X86 asm</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">tv130 <span class="token operator">=</span> <span class="token number">8</span>
_v<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_start<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_calculate_machine_epsilon PROC
        fld      DWORD PTR _start<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;1.0</span>
        fst      DWORD PTR _v<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>      <span class="token comment">;ÂÜó‰Ωô‰ª£Á†Å</span>
        inc      DWORD PTR _v<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        fsubr    DWORD PTR _v<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;_v-start</span>
        fstp     DWORD PTR tv130<span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>    <span class="token comment">;ÂÜó‰Ωô‰ª£Á†Å</span>
        fld      DWORD PTR tv130<span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>    <span class="token comment">;ÂÜó‰Ωô‰ª£Á†Å</span>
        ret      <span class="token number">0</span>
_calculate_machine_epsilon ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>È¶ñÂÖàÂ≠òÂÇ®Âú∞ÂùÄ</li>
<li>Êé•ÁùÄ<code>inc</code>Êåá‰ª§ÊääËæìÂÖ•ÂÄºÁöÑÂ∞èÊï∞ÈÉ®ÂàÜÂΩìÂÅöÊï¥Êï∞Êï∞ÊçÆÂ§ÑÁêÜ,Â∞èÊï∞ÈÉ®ÂàÜ+1ÔºåÂà©Áî®<code>FSUBR</code>ËÆ°ÁÆóÂ∑ÆÂÄº,‰ªéËÄåÂæóÂà∞Áõ∏ÂØπËØØÂ∑Æ</li>
</ul>
<h4 id="Âø´ÈÄüÂπ≥ÊñπÊ†πËÆ°ÁÆó"><a class="markdownIt-Anchor" href="#Âø´ÈÄüÂπ≥ÊñπÊ†πËÆ°ÁÆó"></a> Âø´ÈÄüÂπ≥ÊñπÊ†πËÆ°ÁÆó</h4>
<p>Âø´ÈÄüÂπ≥ÊñπÊ†πËÆ°ÁÆó‰πüÊòØÂà©Áî®‰∫ÜÊµÆÁÇπÊï∞Ëß£Èáä‰∏∫Êï¥Êï∞ÁöÑÊÄùÊÉ≥</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* Assumes that float is in the IEEE 754 single precision floating point format
 * and that int is 32 bits. */</span>
<span class="token keyword">float</span> <span class="token function">sqrt_approx</span><span class="token punctuation">(</span><span class="token keyword">float</span> z<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> val_int <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>z<span class="token punctuation">;</span> <span class="token comment">/* Same bits, but as an int */</span>
    <span class="token comment">/*
     * To justify the following code, prove that
     *
     * ((((val_int / 2^m) - b) / 2) + b) * 2^m = ((val_int - 2^m) / 2) + ((b + 1) / 2) * 2^m)
     *
     *where
     *
     *b = exponent bias
     * m = number of mantissa bits
     *
     *
     .
     */</span>

    val_int <span class="token operator">-=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">23</span><span class="token punctuation">;</span> <span class="token comment">/* Subtract 2^m. */</span>
    val_int <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* Divide by 2. */</span>
    val_int <span class="token operator">+=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">29</span><span class="token punctuation">;</span> <span class="token comment">/* Add ((b + 1) / 2) * 2^m. */</span>

    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>val_int<span class="token punctuation">;</span> <span class="token comment">/* Interpret again as float */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>ÈÄöËøáÊï¥Êï∞Ë°®Á§∫Áõ¥Êé•Â§ÑÁêÜÂéüÂßãÊµÆÁÇπÂÄºÁöÑÊØîÁâπ„ÄÇ</li>
<li>ÂùêÊ†áË∞ÉÊï¥ÊåáÊï∞ÈÉ®ÂàÜÊù•ÂÆûÁé∞Âπ≥ÊñπÊ†πËøë‰ºº„ÄÇ</li>
<li>ÈÄöËøáÂè≥ÁßªÊìç‰ΩúÂíåÊ∑ªÂä†ÂÅèÁßªÈáèÁöÑÊñπÂºèÔºåÊèê‰æõ‰∫Ü‰∏Ä‰∏™Âø´ÈÄü‰∏îÊúâÊïàÁöÑËøë‰ººÁªìÊûú„ÄÇ<strong>‰∏çÊòØÂæàÈáçË¶Å</strong></li>
</ol>
<h3 id="chap23-ÂáΩÊï∞ÊåáÈíà"><a class="markdownIt-Anchor" href="#chap23-ÂáΩÊï∞ÊåáÈíà"></a> Chap23 ÂáΩÊï∞ÊåáÈíà</h3>
<p><em>ÂáΩÊï∞ÊåáÈíàÂíåÂÖ∂‰ªñÊåáÈíàÊ≤°ÊúâÂ§™Â§ßÂå∫Âà´„ÄÇÂÆÉ‰ª£Ë°®ÁöÑÂú∞ÂùÄ‰∏∫ÂáΩÊï∞‰ª£Á†ÅÊÆµÁöÑËµ∑ÂßãÂú∞ÂùÄ„ÄÇ</em></p>
<p>Âú®<code>ÂáΩÊï∞ÊåáÈíàÔºàÂú∞ÂùÄÔºâ</code>‰ª•<code>ÂáΩÊï∞ÂèÇÊï∞ÁöÑÂΩ¢Âºè</code>‰º†ÈÄíÁªô<code>Âè¶‰∏Ä‰∏™ÂáΩÊï∞</code>ÔºåÁªßËÄå<code>Ë¢´Áî®Êù•Ë∞ÉÁî®ËØ•ÊåáÈíàÊâÄÊåáÂêëÁöÑÂáΩÊï∞</code>Êó∂ÔºåËøôÁßçÂáΩÊï∞ÊåáÈíàÁöÑÊâÄÊåáÂêëÁöÑÂáΩÊï∞Â∞±ÊòØ‚Äú<code>ÂõûË∞ÉÂáΩÊï∞</code>‚Äù/callback function</p>
<p>Ê≠§Á±ªÊåáÈíà‰∏ªË¶ÅÂ∫îÁî®‰∫éÔºö</p>
<ul>
<li>Ê†áÂáÜCÂáΩÊï∞Â∫ìÈáåÁöÑ<code>qsort()</code>ÂáΩÊï∞Âíå<code>atexit()ÂáΩÊï∞</code>[<a href="#anchor232">2]</a>„ÄÇ</li>
<li>*NIXÁ≥ªÁªüÈáåÁöÑ‰ø°Âè∑ÔºàSignalsÔºâ[<a href="#anchor233">3]</a>„ÄÇ</li>
<li>ÂêØÂä®Á∫øÁ®ãÁöÑCreateThread()ÔºàwindowsÂáΩÊï∞ÔºâÂíåpthread_create()ÔºàPOSIXÂáΩÊï∞Ôºâ„ÄÇ</li>
<li>Win32ÁöÑÂ§öÁßçÂáΩÊï∞Ôºå‰æãÂ¶ÇEnumChildWindows()[<a href="#anchor234">4]</a>„ÄÇ</li>
<li>LinuxÂÜÖÊ†∏„ÄÇ‰æãÂ¶ÇÔºåLinux‰ª•callbackÁöÑÊñπÂºèË∞ÉÁî®Êñá‰ª∂Á≥ªÁªüÁöÑÈ©±Âä®ÂáΩÊï∞Ôºö<a target="_blank" rel="noopener" href="http://lxr.free-electrons.com/source/include/linux/fs.h?v=3.14#L1525%E3%80%82">http://lxr.free-electrons.com/source/include/linux/fs.h?v=3.14#L1525„ÄÇ</a></li>
<li>GCCÊèí‰ª∂Ôºö<a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gccint/Plugin-API.html#Plugin-API%E3%80%82">https://gcc.gnu.org/onlinedocs/gccint/Plugin-API.html#Plugin-API„ÄÇ</a></li>
<li>LinuxÁ™óÂè£ÁÆ°ÁêÜÁ®ãÂ∫èÂÆö‰πâÂø´Êç∑ÊñπÂºèÁöÑdwmË°®„ÄÇÂΩìÈîÆÁõòÊé•Êî∂Âà∞ÂèØÂåπÈÖçÁöÑÁâπÂÆöÈîÆÊó∂ÔºåÂØπÂ∫îÁöÑÂø´Êç∑ÊñπÂºèÂ∞±ÈÄöËøácallbackË∞ÉÁî®Áõ∏Â∫îÂáΩÊï∞„ÄÇËØ∑ÂèÇËßÅGitHubÔºà<a target="_blank" rel="noopener" href="https://github.com/cdown/dwm/">https://github.com/cdown/dwm/</a> blob/master/config.def.h#L117ÔºâÔºåcallbackÊñπÊ≥ïË¶ÅÊØîÂ§ßÈáè‰ΩøÁî®switch()ËØ≠Âè•ÁöÑÊñπÊ≥ïÊõ¥‰∏∫ÁÆÄÂçï„ÄÇ</li>
</ul>
<p>ÂÖ∂‰∏≠Ôºåqsort()ÂáΩÊï∞ÊòØC/C++ÁºñËØëÂô®ÂáΩÊï∞Â∫ìËá™Â∏¶ÁöÑÂø´ÈÄüÊéíÂ∫èÂáΩÊï∞„ÄÇÊó†ËÆ∫ÂæÖÊéíÂ∫èÁöÑÊï∞ÊçÆÊòØ‰ΩïÁßçÊï∞ÊçÆÁ±ªÂûãÔºåÂè™Ë¶ÅÁºñÂÜôÂá∫ÊØîËæÉ‰∏§‰∏™ÂÖÉÁ¥†ÁöÑÂáΩÊï∞ÔºåÈÇ£‰πàÂ∞±ÂèØ‰ª•Áî®qsort()ÂáΩÊï∞‰ª•callbackÁöÑÊñπÂºèË∞ÉÁî®ÊØîËæÉÂáΩÊï∞„ÄÇ‰æãÂ¶ÇÔºåÊàë‰ª¨ÂèØÂ£∞ÊòéÊØîËæÉÂáΩÊï∞‰∏∫Ôºö</p>
<pre class="line-numbers language-none"><code class="language-none">int (*compare)(const void *, const void *)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"> <span class="token number">1</span>  <span class="token comment">/* ex3 Sorting ints with qsort */</span>
 <span class="token number">2</span>
 <span class="token number">3</span>  #include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span>
 <span class="token number">4</span>  #include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>
 <span class="token number">5</span>
 <span class="token number">6</span>  <span class="token keyword">int</span> <span class="token function">comp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span> _a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span> _b<span class="token punctuation">)</span>
 <span class="token number">7</span>  <span class="token punctuation">&#123;</span>
 <span class="token number">8</span>    <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">*</span>a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>_a<span class="token punctuation">;</span>
 <span class="token number">9</span>    <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">*</span>b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>_b<span class="token punctuation">;</span>
<span class="token number">10</span>
<span class="token number">11</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>a<span class="token operator">==</span><span class="token operator">*</span>b<span class="token punctuation">)</span>
<span class="token number">12</span>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token number">13</span>    <span class="token keyword">else</span>
<span class="token number">14</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>a <span class="token operator">&lt;</span> <span class="token operator">*</span>b<span class="token punctuation">)</span>
<span class="token number">15</span>           <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">16</span>       <span class="token keyword">else</span>
<span class="token number">17</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">18</span>  <span class="token punctuation">&#125;</span>
<span class="token number">19</span>
<span class="token number">20</span>  <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">21</span>  <span class="token punctuation">&#123;</span>
<span class="token number">22</span>    <span class="token keyword">int</span> numbers<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">1892</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">4087</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">12345</span><span class="token punctuation">,</span><span class="token number">1087</span><span class="token punctuation">,</span><span class="token number">88</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">100000</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token number">23</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
<span class="token number">24</span>
<span class="token number">25</span>   <span class="token comment">/* Sort the array */</span>
<span class="token number">26</span>   <span class="token function">qsort</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span>comp<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token number">27</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">9</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token number">28</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Number = %d\n"</span><span class="token punctuation">,</span>numbers<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token number">29</span>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token number">30</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs 2010 asm</code>ÂêØÁî®ÈÄâÈ°π/Ox /GS- /MD</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">__a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>          <span class="token comment">; size = 4</span>
__b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>         <span class="token comment">; size = 4</span>
_comp   PROC
         mov  <span class="token register variable">eax</span>, DWORD PTR __a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
         mov  <span class="token register variable">ecx</span>, DWORD PTR __b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
         mov  <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>
         mov  <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
         cmp  <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
         jne  SHORT <span class="token operator">$</span>LN4@comp
         xor  <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
         ret  <span class="token number">0</span>
<span class="token label function">$LN4@comp:</span>
         xor  <span class="token register variable">edx</span>, <span class="token register variable">edx</span>
         cmp  <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
         setge <span class="token register variable">dl</span>
         lea  <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">]</span>
         ret  <span class="token number">0</span>
_comp ENDP


_numbers<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40</span>       <span class="token comment">; size = 40</span>
_argc<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>        „ÄÄ„ÄÄ <span class="token comment">; size = 4</span>
_argv<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>        „ÄÄ„ÄÄ<span class="token comment">; size = 4</span>
_main   PROC
         sub  <span class="token register variable">esp</span>, <span class="token number">40</span>     „ÄÄ„ÄÄ„ÄÄ<span class="token comment">; 00000028H</span>
         push <span class="token register variable">esi</span>
         push OFFSET _comp
         push <span class="token number">4</span>
         lea  <span class="token register variable">eax</span>, DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">52</span><span class="token operator">]</span>
         push <span class="token number">10</span>       <span class="token comment">; 0000000aH</span>
         push <span class="token register variable">eax</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">60</span><span class="token operator">]</span>, <span class="token number">1892</span> „ÄÄ <span class="token comment">; 00000764H</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">64</span><span class="token operator">]</span>, <span class="token number">45</span> „ÄÄ„ÄÄ <span class="token comment">; 0000002dH</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">68</span><span class="token operator">]</span>, <span class="token number">200</span>„ÄÄ„ÄÄ <span class="token comment">; 000000c8H</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">72</span><span class="token operator">]</span>, <span class="token operator">-</span><span class="token number">98</span> „ÄÄ„ÄÄ<span class="token comment">; ffffff9eH</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">76</span><span class="token operator">]</span>, <span class="token number">4087</span>„ÄÄ„ÄÄ<span class="token comment">; 00000ff7H</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">80</span><span class="token operator">]</span>, <span class="token number">5</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">84</span><span class="token operator">]</span>, <span class="token operator">-</span><span class="token number">12345</span>  <span class="token comment">; ffffcfc7H</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">88</span><span class="token operator">]</span>, <span class="token number">1087</span> „ÄÄ <span class="token comment">; 0000043fH</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">92</span><span class="token operator">]</span>, <span class="token number">88</span>„ÄÄ„ÄÄ  <span class="token comment">; 00000058H</span>
         mov  DWORD PTR _numbers<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">96</span><span class="token operator">]</span>, <span class="token operator">-</span><span class="token number">100000</span> <span class="token comment">; fffe7960H</span>
         call  _qsort
         add  <span class="token register variable">esp</span>, <span class="token number">16</span>    „ÄÄ„ÄÄ„ÄÄ    <span class="token comment">; 00000010H</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ëøô‰∏ÄÈÉ®ÂàÜÊØîËæÉÊôÆÈÄöÔºåÂèØ‰ª•ÁúãÂà∞Âú®‰º†ÈÄíÁ¨¨4‰∏™ÂèÇÊï∞ÁöÑÊó∂ÂÄô‰º†ÈÄíÁöÑÊòØÊ†áÁ≠æ<code>_comp</code>ÁöÑÂú∞ÂùÄÂÖ≥ÈîÆÊòØÁúã<code>qsort</code>Â¶Ç‰ΩïË∞ÉÁî®<code>comp()</code></p>
<p><code>qsort</code>‰Ωç‰∫é<code>MSVCR80.dll</code></p>
<hr />
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">.text:</span>7816CBF0 <span class="token comment">; void __cdecl qsort(void *, unsigned int, unsigned int, int (__cdecl *)(const ‚Üô</span>
    ‚Üò void <span class="token operator">*</span>, const void <span class="token operator">*</span>))
<span class="token label function">.text:</span>7816CBF0                 public _qsort
<span class="token label function">.text:</span>7816CBF0 _qsort          proc near
<span class="token label function">.text:</span>7816CBF0
<span class="token label function">.text:</span>7816CBF0 lo              <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">104h</span>
<span class="token label function">.text:</span>7816CBF0 hi              <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">100h</span>
<span class="token label function">.text:</span>7816CBF0 var_FC          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">0FCh</span>
<span class="token label function">.text:</span>7816CBF0 stkptr          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">0F8h</span>
<span class="token label function">.text:</span>7816CBF0 lostk           <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">0F4h</span>
<span class="token label function">.text:</span>7816CBF0 histk           <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">7Ch</span>
<span class="token label function">.text:</span>7816CBF0 base            <span class="token operator">=</span> dword ptr  <span class="token number">4</span>
<span class="token label function">.text:</span>7816CBF0 num             <span class="token operator">=</span> dword ptr  <span class="token number">8</span>
<span class="token label function">.text:</span>7816CBF0 width           <span class="token operator">=</span> dword ptr  <span class="token number">0Ch</span>
<span class="token label function">.text:</span>7816CBF0 comp            <span class="token operator">=</span> dword ptr  <span class="token number">10h</span>
<span class="token label function">.text:</span>7816CBF0
<span class="token label function">.text:</span>7816CBF0                 sub     <span class="token register variable">esp</span>, <span class="token number">100h</span>
„ÄÄ
 ‚Ä¶
„ÄÄ
<span class="token label function">.text:</span>7816CCE0 loc_7816CCE0:                      <span class="token comment">; CODE XREF: _qsort+B1</span>
<span class="token label function">.text:</span>7816CCE0                 shr      <span class="token register variable">eax</span>, <span class="token number">1</span>
<span class="token label function">.text:</span>7816CCE2                 imul     <span class="token register variable">eax</span>, <span class="token register variable">ebp</span>
<span class="token label function">.text:</span>7816CCE5                 add      <span class="token register variable">eax</span>, <span class="token register variable">ebx</span>
<span class="token label function">.text:</span>7816CCE7                 mov      <span class="token register variable">edi</span>, <span class="token register variable">eax</span>
<span class="token label function">.text:</span>7816CCE9                 push     <span class="token register variable">edi</span>
<span class="token label function">.text:</span>7816CCEA                 push     <span class="token register variable">ebx</span>
<span class="token label function">.text:</span>7816CCEB                 call     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">118h</span><span class="token operator">+</span>comp<span class="token operator">]</span><span class="token comment">;call comp</span>
<span class="token label function">.text:</span>7816CCF2                 add      <span class="token register variable">esp</span>, <span class="token number">8</span>
<span class="token label function">.text:</span>7816CCF5                 test     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
<span class="token label function">.text:</span>7816CCF7                 jle      short loc_7816CD04<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Âú®ÊâßË°åqsort()ÁöÑËøáÁ®ã‰∏≠ÔºåÁ≥ªÁªü‰ºöÊääÊéßÂà∂ÊùÉ‰º†ÈÄíÁªôcompÂèÇÊï∞ÊåáÂêëÁöÑÂáΩÊï∞ÊåáÈíàÁöÑÂú∞ÂùÄ„ÄÇÂú®Ë∞ÉÁî®ÂÆÉ‰πãÂâçÔºåcomp()ÂáΩÊï∞ÊâÄÈúÄÁöÑ‰∏§‰∏™ÂèÇÊï∞Â∑≤Áªè‰º†ÈÄíÂà∞‰Ωç„ÄÇÂú®ÊâßË°åÂÆÉ‰πãÂêéÔºåÊéíÂ∫èÂ∑≤ÁªèÂÆåÊàê„ÄÇ</code></p>
<h3 id="chap24-32‰ΩçÁ≥ªÁªüÂ§ÑÁêÜ64‰ΩçÊï∞ÊçÆ"><a class="markdownIt-Anchor" href="#chap24-32‰ΩçÁ≥ªÁªüÂ§ÑÁêÜ64‰ΩçÊï∞ÊçÆ"></a> Chap24 32‰ΩçÁ≥ªÁªüÂ§ÑÁêÜ64‰ΩçÊï∞ÊçÆ</h3>
<p>32‰ΩçÁ≥ªÁªüÁöÑÈÄöÁî®ÂØÑÂ≠òÂô®GPRÈÉΩÂè™ËÉΩÂÆπÁ∫≥32‰ΩçÊï∞ÊçÆÔºåÊâÄ‰ª•ËøôÁßçÂπ≥Âè∞ÂøÖÈ°ªÊää64‰ΩçÊï∞ÊçÆËΩ¨Êç¢‰∏∫‰∏ÄÂØπ32‰ΩçÊï∞ÊçÆÊâçËÉΩËøõË°åËøêÁÆó„ÄÇ</p>
<hr />
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token class-name">uint64_t</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
       <span class="token keyword">return</span> <span class="token number">0x1234567890ABCDEF</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_f         PROC
           mov      <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">1867788817</span>       <span class="token comment">; 90abcdefH</span>
           mov      <span class="token register variable">edx</span>, <span class="token number">305419896</span>         <span class="token comment">; 12345678H</span>
           ret      <span class="token number">0</span>
_f         ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><mark>32‰ΩçÁ≥ªÁªüÁî®ÂØÑÂ≠òÂô®ÁªÑÂêàEDX:EAXÊù•‰º†64‰ΩçÊï∞ÊçÆ</mark></p>
<h4 id="ÂèÇÊï∞‰º†ÈÄíÂèäÂä†ÂáèËøêÁÆó"><a class="markdownIt-Anchor" href="#ÂèÇÊï∞‰º†ÈÄíÂèäÂä†ÂáèËøêÁÆó"></a> ÂèÇÊï∞‰º†ÈÄíÂèäÂä†ÂáèËøêÁÆó</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token class-name">uint64_t</span> <span class="token function">f_add</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">,</span> <span class="token class-name">uint64_t</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f_add_test</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">__GNUC__</span></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%lld\n"</span><span class="token punctuation">,</span> <span class="token function">f_add</span><span class="token punctuation">(</span><span class="token number">12345678901234</span><span class="token punctuation">,</span> <span class="token number">23456789012345</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%I64d\n"</span><span class="token punctuation">,</span> <span class="token function">f_add</span><span class="token punctuation">(</span><span class="token number">12345678901234</span><span class="token punctuation">,</span> <span class="token number">23456789012345</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token class-name">uint64_t</span> <span class="token function">f_sub</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">,</span> <span class="token class-name">uint64_t</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>         <span class="token comment">; size = 8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>        <span class="token comment">; size = 8</span>
_f_add   PROC
         mov   <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
         add   <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
         mov   <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
         adc   <span class="token register variable">edx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
         ret        <span class="token number">0</span>
_f_add ENDP

_f_add_test PROC
        push   <span class="token number">5461</span>            <span class="token comment">; 00001555H</span>
        push   <span class="token number">1972608889</span>      <span class="token comment">; 75939f79H</span>
        push   <span class="token number">2874</span>            <span class="token comment">; 00000b3aH</span>
        push   <span class="token number">1942892530</span>      <span class="token comment">; 73ce2ff_subH</span>
        call   _f_add
        push   <span class="token register variable">edx</span>
        push   <span class="token register variable">eax</span>
        push   OFFSET <span class="token operator">$</span>SG1436  <span class="token comment">; ‚Äô%I64d‚Äô, 0aH, 00H</span>
        call   _printf
        add    <span class="token register variable">esp</span>, <span class="token number">28</span>
        ret    <span class="token number">0</span>
_f_add_test ENDP

_f_sub  PROC
        mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        sub    <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        mov    <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
        sbb    <span class="token register variable">edx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
        ret    <span class="token number">0</span>
_f_sub ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>Âú®<code>f1_test()</code>ÂáΩÊï∞ÔºåÊØè‰∏™64‰ΩçÊï∞ÊçÆË¢´ÊãÜÂàÜ‰∏∫‰∫Ü2‰∏™32‰ΩçÊï∞ÊçÆ„ÄÇÂú®ÂÜÖÂ≠ò‰∏≠ÔºåÈ´ò32‰ΩçÊï∞ÊçÆÂú®ÂâçÔºå‰Ωé32‰ΩçÂú®Âêé„ÄÇ</p>
<p>Âä†ÂáèÊ≥ïËøêÁÆóÁöÑÂ§ÑÁêÜÊñπÊ≥ï‰πüÂÆåÂÖ®Áõ∏Âêå</p>
<p>Âú®ËøõË°åÂä†Ê≥ïËøêÁÆóÊó∂ÔºåÂÖàÂØπ‰Ωé32‰ΩçÁõ∏Âä†„ÄÇÂ¶ÇÊûú‰∫ßÁîü‰∫ÜËøõ‰ΩçÔºåÂ∞±ËÆæÁΩÆCFÊ†áËØÜ‰Ωç„ÄÇÁÑ∂Âêé<code>ADC</code>Êåá‰ª§ÂØπÈ´ò32‰ΩçËøõË°åËøêÁÆóÔºåÂ¶ÇÊûúÊ≠§Êó∂<code>CF</code>Ê†áËØÜ‰ΩçÁöÑÂÄº‰∏∫1ÔºåÂàôÂÜçÊää32‰ΩçÁöÑËøêÁÆóÁªìÊûúÂä†‰∏ä1</p>
</li>
<li>
<p>ÂáèÊ≥ïËøêÁÆó‰πüÊòØÂàÜÊ≠•ËøõË°åÁöÑ„ÄÇÁ¨¨‰∏ÄÊ¨°ÁöÑÂáèÊ≥ïËøêÁÆóÂèØËÉΩÂΩ±ÂìçCFÊ†áËØÜ‰Ωç„ÄÇÁ¨¨‰∫åÊ¨°ÂáèÊ≥ïËøêÁÆó‰ºöÊ†πÊçÆCFÊ†áËØÜ‰ΩçÊääÂÄü‰Ωç‰ª£ÂÖ•ËÆ°ÁÆóÁªìÊûú„ÄÇ</p>
</li>
</ul>
<p><mark>Âú®32‰ΩçÁ≥ªÁªü‰∏≠ÔºåÂáΩÊï∞Âú®ËøîÂõû64‰ΩçÊï∞ÊçÆÊó∂ÈÉΩ‰ΩøÁî®EDX:EAXÂØÑÂ≠òÂô®ÂØπ„ÄÇ</mark></p>
<h4 id="‰πòÊ≥ïÂíåÈô§Ê≥ïËøêÁÆó"><a class="markdownIt-Anchor" href="#‰πòÊ≥ïÂíåÈô§Ê≥ïËøêÁÆó"></a> ‰πòÊ≥ïÂíåÈô§Ê≥ïËøêÁÆó</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token class-name">uint64_t</span> <span class="token function">f_mul</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">,</span> <span class="token class-name">uint64_t</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a<span class="token operator">*</span>b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token class-name">uint64_t</span> <span class="token function">f_div</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">,</span> <span class="token class-name">uint64_t</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a<span class="token operator">/</span>b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token class-name">uint64_t</span> <span class="token function">f_rem</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">,</span> <span class="token class-name">uint64_t</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a <span class="token operator">%</span> b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>msvs x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">; size = 8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span> <span class="token comment">; size = 8</span>
_f_mul  PROC
        push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">ecx</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        push    <span class="token register variable">edx</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        call    __allmul <span class="token comment">; long long multiplication</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_f_mul  ENDP

_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">; size = 8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span> <span class="token comment">; size = 8</span>
_f_div  PROC
        push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">ecx</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        push    <span class="token register variable">edx</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        call    __aulldiv <span class="token comment">; unsigned long long division</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_f_div ENDP

_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">; size = 8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span> <span class="token comment">; size = 8</span>
_f_rem  PROC
        push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">ecx</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        push    <span class="token register variable">edx</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        call    __aullrem <span class="token comment">; unsigned long long remainder</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_f_rem   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><mark>‰πòÈô§ËøêÁÆóÂ§çÊùÇÂæàÂ§ö„ÄÇÊâÄ‰ª•ÁºñËØëÂô®ÈÄöÂ∏∏ÂÄüÂä©Ê†áÂáÜÂ∫ìÂáΩÊï∞Êù•Â§ÑÁêÜ‰πòÈô§ËøêÁÆó„ÄÇ</mark></p>
<p>‰ΩÜËøòÊòØÈÉΩÁî®<code>EDX:EAX</code>‰º†ÈÄíÊï∞ÊçÆÔºåÊú¨Êù•‰πòÈô§Áî®Ê±áÁºñÊåá‰ª§ËøõË°åÔºåÊîπ‰∏∫Áî®ÂáΩÊï∞Â§ÑÁêÜ</p>
<p>ËÄå<code>gcc</code>‰ºöÊää‰πòÊ≥ïËøêÁÆóËøõË°åÂÜÖÈÉ®Â§ÑÁêÜÂ±ïÂºÄ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">_f_mul:</span>
        push    <span class="token register variable">ebx</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>
        mov     <span class="token register variable">ebx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">]</span>
        imul    <span class="token register variable">ebx</span>, <span class="token register variable">eax</span>
        imul    <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>
        mul     <span class="token register variable">edx</span>
        add     <span class="token register variable">ecx</span>, <span class="token register variable">ebx</span>
        add     <span class="token register variable">edx</span>, <span class="token register variable">ecx</span>
        pop     <span class="token register variable">ebx</span>
        ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Âè≥Áßª"><a class="markdownIt-Anchor" href="#Âè≥Áßª"></a> Âè≥Áßª</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token class-name">uint64_t</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">>></span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>optimizing msvs x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>         <span class="token comment">; size = 8</span>
_f      PROC
        mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
        shrd    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>, <span class="token number">7</span>
        shr     <span class="token register variable">edx</span>, <span class="token number">7</span>
        ret     <span class="token number">0</span>
_f      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>optimizing gcc</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">_f:</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        shrd    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>, <span class="token number">7</span>
        shr     <span class="token register variable">edx</span>, <span class="token number">7</span>
        ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>SHRDÊåá‰ª§„ÄÇËøô‰∏™Êåá‰ª§‰∏ç‰ªÖÂèØ‰ª•ÊääEAXÈáåÁöÑ‰Ωé32‰ΩçÊï∞ÊçÆÂè≥Áßª7‰ΩçËøêÁÆóÔºåËÄå‰∏îËøòËÉΩ‰ªéEDXÂØÑÂ≠òÂô®ÈáåËØªÂèñÈ´ò32‰Ωç‰∏≠ÁöÑ‰Ωé7‰Ωç„ÄÅÁî®ÂÆÉÂ°´Ë°•Âà∞‰Ωé32‰ΩçÊï∞ÊçÆÁöÑÈ´ò‰Ωç„ÄÇ</code><br />
ÂèØ‰ª•ÂèëÁé∞Ôºå32‰ΩçÂ§ÑÁêÜ64‰ΩçÊï∞ÊçÆÂè≥ÁßªÂä®Êó∂ÂàÜ‰∏∫‰∏§Ê≠•</p>
<ol>
<li>ÂÖàÂ§ÑÁêÜ‰Ωé‰ΩçÔºåÂà©Áî®<code>SHRD</code>Êåá‰ª§</li>
<li>ÂÜçÂ§ÑÁêÜÈ´ò‰Ωç,<code>SHR EDX,7</code>ÔºåÊääÈ´ò32‰ΩçÊï∞ÊçÆÂè≥Áßª</li>
</ol>
<h4 id="32‰ΩçÊï∞ÊçÆËΩ¨Êç¢‰∏∫64‰ΩçÊï∞ÊçÆ"><a class="markdownIt-Anchor" href="#32‰ΩçÊï∞ÊçÆËΩ¨Êç¢‰∏∫64‰ΩçÊï∞ÊçÆ"></a> 32‰ΩçÊï∞ÊçÆËΩ¨Êç¢‰∏∫64‰ΩçÊï∞ÊçÆ</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token class-name">int64_t</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_f        PROC
          mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
          cdq
          ret     <span class="token number">0</span>
_f        ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>CDQ</code>ÔºàConvert Doubleword to QuadwordÔºâÊòØ x86 Ê±áÁºñËØ≠Ë®Ä‰∏≠ÁöÑ‰∏ÄÊù°Êåá‰ª§ÔºåÁî®‰∫éÁ¨¶Âè∑Êâ©Â±ïÂØÑÂ≠òÂô® <code>EAX</code> Âà∞ÂØÑÂ≠òÂô® <code>EDX:EAX</code>„ÄÇÂÆÉÈÄöÂ∏∏Áî®‰∫éÂ∞Ü‰∏Ä‰∏™32‰ΩçÊúâÁ¨¶Âè∑Êï¥Êï∞Êâ©Â±ï‰∏∫64‰ΩçÊúâÁ¨¶Âè∑Êï¥Êï∞„ÄÇ</p>
<p><code>CDQ</code> Êåá‰ª§Â∞ÜÂØÑÂ≠òÂô® <code>EAX</code> ÁöÑÊúÄÈ´òÊúâÊïà‰ΩçÔºàÂç≥Á¨¶Âè∑‰ΩçÔºâÂ§çÂà∂Âà∞ <code>EDX</code> ÁöÑÊâÄÊúâ‰ΩçÔºö</p>
<ul>
<li>Â¶ÇÊûú <code>EAX</code> ÁöÑÊúÄÈ´òÊúâÊïà‰ΩçÊòØ0ÔºàË°®Á§∫Ê≠£Êï∞ÔºâÔºåÈÇ£‰πà <code>EDX</code> ÁöÑÊâÄÊúâ‰ΩçÈÉΩË¢´ËÆæÁΩÆ‰∏∫0„ÄÇ</li>
<li>Â¶ÇÊûú <code>EAX</code> ÁöÑÊúÄÈ´òÊúâÊïà‰ΩçÊòØ1ÔºàË°®Á§∫Ë¥üÊï∞ÔºâÔºåÈÇ£‰πà <code>EDX</code> ÁöÑÊâÄÊúâ‰ΩçÈÉΩË¢´ËÆæÁΩÆ‰∏∫1„ÄÇ</li>
</ul>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">if <span class="token register variable">EAX</span> <span class="token operator">></span><span class="token operator">=</span> <span class="token number">0</span> then
    <span class="token register variable">EDX</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token comment">;</span>
else
    <span class="token register variable">EDX</span> :<span class="token operator">=</span> <span class="token number">0xFFFFFFFF</span><span class="token comment">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰ªéËÄåËææÂà∞‰∫ÜËÆæÁΩÆÁ¨¶Âè∑‰ΩçÁöÑÊïàÊûú</p>
<h3 id="chap25-simd"><a class="markdownIt-Anchor" href="#chap25-simd"></a> *Chap25 SIMD</h3>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240610211849193.png" class="" alt="image-20240610211849193" loading="lazy">
<ul>
<li>
<p><code>SIMDÊÑè‰∏∫‚ÄúÂçïÊåá‰ª§ÊµÅÂ§öÊï∞ÊçÆÊµÅ</code>‚ÄùÔºåÂÖ∂ÂÖ®Áß∞ÊòØ‚Äú<code>Single Instruction, Multiple Data</code>‚Äù„ÄÇÈ°æÂêçÊÄù‰πâÔºåËøôÁ±ªÊåá‰ª§ÂèØ‰ª•‰∏ÄÊ¨°Â§ÑÁêÜÂ§ö‰∏™Êï∞ÊçÆ„ÄÇÂú®x86ÁöÑCPUÈáåÔºåSIMDÂ≠êÁ≥ªÁªüÂíåFPUÈÉΩÁî±‰∏ìÁî®Ê®°ÂùóÂÆûÁé∞</p>
</li>
<li>
<p><code>-x86 CPU</code>ÈÄöËøá<code>MMXÊåá‰ª§</code>ÁéáÂÖàÊï¥Âêà‰∫Ü<code>SIMDÁöÑËøêÁÆóÂäüËÉΩ</code>„ÄÇÊîØÊåÅËøôÁßçÊäÄÊúØÁöÑCPUÈáåÈÉΩÊúâ<code>8‰∏™64‰ΩçÂØÑÂ≠òÂô®</code>ÔºåÂç≥<code>MM0ÔΩûMM7</code>„ÄÇÊØè‰∏™<code>MMXÂØÑÂ≠òÂô®ÈÉΩÊòØ8Â≠óËäÇÂØÑÂ≠òÂô®</code>ÔºåÂèØ‰ª•ÂÆπÁ∫≥<code>2‰∏™32‰ΩçÊï∞ÊçÆ</code>ÔºåÊàñËÄÖ<code>4‰∏™16‰ΩçÊï∞ÊçÆ</code>„ÄÇ‰ΩøÁî®SIMDÊåá‰ª§ËøõË°åÊìç‰ΩúÊï∞ÁöÑËÆ°ÁÆóÊó∂ÔºåÂÆÉÂèØ‰ª•Êää<code>8‰∏™8‰ΩçÊï∞ÊçÆÂàÜ‰∏∫4ÁªÑÊï∞ÊçÆ</code>ÂêåÊó∂ËøêÁÆó„ÄÇ</p>
</li>
<li>
<p>Âπ≥Èù¢ÂõæÂÉèÂèØËßÜ‰∏∫‰∏ÄÁßçÁî±‰∫åÁª¥Êï∞ÁªÑÊûÑÊàêÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇÂú®ÁæéÂ∑•‰∫∫ÂëòË∞ÉÊï¥ÂõæÂÉè‰∫ÆÂ∫¶ÁöÑÊó∂ÂÄôÔºåÂõæÂÉèÁºñËæëÁ®ãÂ∫èÂæóÂØπÊØè‰∏™ÂÉèÁ¥†ÁöÑ‰∫ÆÂ∫¶Á≥ªÊï∞ËøõË°åÂä†ÂáèÊ≥ïÁöÑËøêÁÆó„ÄÇÁÆÄÂçïÂú∞ËØ¥ÔºåÂõæÂÉèÁöÑÊØè‰∏™ÂÉèÁ¥†ÈÉΩÊúâÁÅ∞Â∫¶Á≥ªÊï∞ÔºåËÄå‰∏îÁÅ∞Â∫¶Á≥ªÁªüÊòØ8‰ΩçÊï∞ÊçÆÔºà1‰∏™Â≠óËäÇÔºâ„ÄÇÂõ†ËÄåÔºåÊØèÊâßË°å‰∏Ä‰∏™SIMDÊåá‰ª§Â∞±ËÉΩÂ§üÂêåÊó∂Ë∞ÉÊï¥8‰∏™ÂÉèÁ¥†ÁöÑÁÅ∞Â∫¶ÔºàÂç≥‰∫ÆÂ∫¶Ôºâ„ÄÇ‰∏∫‰∫ÜÊª°Ë∂≥ËøôÁßçÈúÄË¶ÅÔºåÂ§ÑÁêÜÂô®ÂéÇÂïÜÂêéÊù•‰∏ìÈó®Êé®Âá∫‰∫ÜÂü∫‰∫éSIMDÊäÄÊúØÁöÑÈ•±ÂíåÂ∫¶Ë∞ÉÊï¥Êåá‰ª§„ÄÇËøôÁßçÈ•±ÂíåÂ∫¶Ë∞ÉÊï¥Êåá‰ª§ÁîöËá≥ÊúâË∂äÁïå‰øùÊä§ÂäüËÉΩÔºåËÉΩÂ§üÈÅøÂÖç‰∫ÆÂ∫¶Ë∞ÉÊï¥Êó∂ÂèØËÉΩ‰ºö‰∫ßÁîüÁöÑÂõ†Â≠ê‰∏äÊ∫¢ÔºàoverflowÔºâÂíå‰∏ãÊ∫¢ÔºàunderflowÔºâÁ≠âÈóÆÈ¢ò„ÄÇ</p>
</li>
<li>
<p>SSEÊäÄÊúØÊòØSIMDÁöÑÊâ©Â±ïÊäÄÊúØÔºåÂÆÉÊääSIMDÂØÑÂ≠òÂô®Êâ©Â±ï‰∏∫128‰ΩçÂØÑÂ≠òÂô®„ÄÇÊîØÊåÅSSEÊäÄÊúØÁöÑCPUÂ∑≤ÁªèÊúâ‰∫ÜÂçïÁã¨ÁöÑSIMDÈÄöÁî®ÂØÑÂ≠òÂô®Ôºå‰∏çÂÜçÂ§çÁî®FPUÁöÑÂØÑÂ≠òÂô®„ÄÇAVXÊòØÂè¶Â§ñ‰∏ÄÁßçSIMDÊäÄÊúØÔºåÂÆÉÁöÑÈÄöÁî®ÂØÑÂ≠òÂô®ÈÉΩÊòØ256‰ΩçÂØÑÂ≠òÂô®„ÄÇ</p>
</li>
<li>
<p><code>SIMD</code>ÂÖ∑‰ΩìÂ∫îÁî®</p>
<ol>
<li>ÂÜÖÂ≠òÂ§çÂà∂ÂíåÂÜÖÂ≠òÊØîËæÉÁ≠âÁî®ÈÄî</li>
<li>Áî®‰∫éDESÁöÑËøêÁÆó„ÄÇ<code>DES(Data Encryption Standard)</code>ÊòØÂàÜÁªÑÂØπÁß∞ÂØÜÁ†ÅÁÆóÊ≥ïÔºåÈááÁî®‰∫Ü64‰ΩçÁöÑÂàÜÁªÑÂíå56‰ΩçÁöÑÂØÜÈí•ÔºåÂ∞Ü64‰ΩçÁöÑËæìÂÖ•ÁªèËøá‰∏ÄÁ≥ªÂàóÂèòÊç¢ÂæóÂà∞64‰ΩçÁöÑËæìÂá∫„ÄÇÂ¶ÇÊûúÂú®ÁîµË∑ØÁöÑ‰∏é„ÄÅÊàñ„ÄÅÈùûÈó®ÂíåÂØºÁ∫øÂÆûÁé∞DESÊ®°ÂùóÔºåÁîµË∑ØËßÑÊ®°Â∞Ü‰ºöÊòØÈùûÂ∏∏Â∫ûÂ§ß„ÄÇÂü∫‰∫éÂπ∂Ë°åÂàÜÁªÑÂØÜÁ†ÅÁÆóÊ≥ïÁöÑBitslice DES[<a href="#anchor251">1]</a>Â∫îËøêËÄåÁîü„ÄÇËøôÁßçÁÆóÊ≥ïÂèØÁî±ÂçïÊåá‰ª§Âπ∂Ë°åÂ§ÑÁêÜÊäÄÊúØ/SIMDÂÆûÁé∞„ÄÇÊàë‰ª¨Â∑≤ÁªèÁü•ÈÅìÔºåx86Âπ≥Âè∞ÁöÑunsigned intÂûãÊï∞ÊçÆÂç†Áî®32‰ΩçÁ©∫Èó¥„ÄÇÂõ†Ê≠§ÔºåÂú®ËøõË°åunsigned intÂûãÊï∞ÊçÆÁöÑ64‰ΩçÊï∞ÊçÆÂíå56‰ΩçÂØÜÈí•ÁöÑÊºîÁÆóÊó∂ÔºåÂèØ‰ª•‰ª•Êää64‰Ωç‰∏≠Èó¥ËøêÁÆóÁªìÊûúÂíåËøêÁÆóÂØÜÈí•ÈÉΩÂàÜ‰∏∫2‰∏™32‰ΩçÊï∞ÊçÆÔºåÂÜçËøõË°åÂàÜÊ≠•ÁöÑÂπ∂Ë°åÂ§ÑÁêÜ„ÄÇ</li>
</ol>
</li>
</ul>
<h4 id="Áü¢ÈáèÂåñ"><a class="markdownIt-Anchor" href="#Áü¢ÈáèÂåñ"></a> Áü¢ÈáèÂåñ</h4>
<p>Áü¢ÈáèÂåñÊ≥õÊåáÂ∞ÜÂ§ö‰∏™Ê†áÈáèÊï∞ÁªÑËÆ°ÁÆó‰∏∫ÔºàËΩ¨Êç¢ÊàêÔºâ‰∏Ä‰∏™Áü¢ÈáèÊï∞ÁªÑÁöÑÊäÄÊúØ„ÄÇËøõË°åËøôÁßçËÆ°ÁÆóÊó∂ÔºåÂæ™ÁéØ‰Ωì‰ªéËæìÂÖ•Êï∞ÁªÑ‰∏≠ÂèñÂÄºÔºåËøõË°åÊüêÁßçËøêÁÆóÂêéÁîüÊàêÊúÄÁªàÊï∞ÁªÑ„ÄÇËøôÁßçÁÆóÊ≥ïÂè™ÂØπÊï∞ÁªÑ‰∏≠ÁöÑÂçï‰∏™ÂÖÉÁ¥†ËøõË°å‰∏ÄÊ¨°ËøêÁÆó„ÄÇ‚ÄúÔºàÂπ∂Ë°åÔºâÁü¢ÈáèÂåñÊäÄÊúØ‚ÄùÊòØÁü¢ÈáèÂåñÂ§ÑÁêÜÁöÑÂπ∂Ë°åËÆ°ÁÆóÊäÄÊúØ„ÄÇ</p>
<ul>
<li>Áî®‰∫éÂä†Ê≥ïËøêÁÆó</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">f</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sz<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>ar1<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>ar2<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>ar3<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>sz<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                  ar3<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>ar1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>ar2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>icl intel.cpp /QaxSSE2 /Faintel.asm /Ox</code>‰ΩøÁî®win32 intelÁºñËØëÂô®</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂáΩÊï∞Â£∞ÊòéÂèäÂÖ∂ÂèÇÊï∞</span>
<span class="token comment">; int __cdecl f(int, int *, int *, int *)</span>
public ?f@@YAHHPAH00@Z
?f@@YAHHPAH00@Z proc near

var_10 <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">10h</span> <span class="token comment">; ‰∏¥Êó∂ÂèòÈáèÔºåÁî®‰∫éÂ≠òÊîæ‰∏¥Êó∂Êï∞ÊçÆ</span>
sz     <span class="token operator">=</span> dword ptr  <span class="token number">4</span>   <span class="token comment">; ÂèÇÊï∞1ÔºåÊï¥Êï∞ size</span>
ar1    <span class="token operator">=</span> dword ptr  <span class="token number">8</span>   <span class="token comment">; ÂèÇÊï∞2ÔºåÊï¥Êï∞ÊåáÈíà ar1</span>
ar2    <span class="token operator">=</span> dword ptr  <span class="token number">0Ch</span> <span class="token comment">; ÂèÇÊï∞3ÔºåÊï¥Êï∞ÊåáÈíà ar2</span>
ar3    <span class="token operator">=</span> dword ptr  <span class="token number">10h</span> <span class="token comment">; ÂèÇÊï∞4ÔºåÊï¥Êï∞ÊåáÈíà ar3</span>

push    <span class="token register variable">edi</span>             <span class="token comment">; ‰øùÂ≠òÂØÑÂ≠òÂô® edi ÁöÑÁä∂ÊÄÅ</span>
push    <span class="token register variable">esi</span>             <span class="token comment">; ‰øùÂ≠òÂØÑÂ≠òÂô® esi ÁöÑÁä∂ÊÄÅ</span>
push    <span class="token register variable">ebx</span>             <span class="token comment">; ‰øùÂ≠òÂØÑÂ≠òÂô® ebx ÁöÑÁä∂ÊÄÅ</span>
push    <span class="token register variable">esi</span>             <span class="token comment">; ÂÜçÊ¨°‰øùÂ≠òÂØÑÂ≠òÂô® esi ÁöÑÁä∂ÊÄÅ</span>

mov     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>sz<span class="token operator">]</span> <span class="token comment">; Â∞ÜÂèÇÊï∞ sz ËµãÂÄºÁªô edx</span>
test    <span class="token register variable">edx</span>, <span class="token register variable">edx</span>           <span class="token comment">; Ê£ÄÊü• sz ÊòØÂê¶‰∏∫Èõ∂ÊàñË¥ü</span>
jle     loc_15B            <span class="token comment">; Â¶ÇÊûú sz &lt;= 0ÔºåË∑≥ËΩ¨Âà∞ loc_15B ÁªìÊùüÂáΩÊï∞</span>
mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar3<span class="token operator">]</span> <span class="token comment">; Â∞ÜÂèÇÊï∞ ar3 ËµãÂÄºÁªô eax</span>

cmp     <span class="token register variable">edx</span>, <span class="token number">6</span>             <span class="token comment">; Ê£ÄÊü• sz ÊòØÂê¶Â∞è‰∫éÁ≠â‰∫é 6</span>
jle     loc_143            <span class="token comment">; Â¶ÇÊûúÊòØÔºåË∑≥ËΩ¨Âà∞ loc_143</span>
cmp     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span> <span class="token comment">; ÊØîËæÉ ar3 Âíå ar2</span>
jbe     short loc_36       <span class="token comment">; Â¶ÇÊûú ar3 &lt;= ar2ÔºåË∑≥ËΩ¨Âà∞ loc_36</span>

<span class="token comment">; Â¶ÇÊûú ar3 > ar2 Âπ∂‰∏î sz > 6ÔºåËøõË°åËøõ‰∏ÄÊ≠•ÁöÑËÆ°ÁÆóÂíåÊù°‰ª∂ÂàÜÊîØ</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span> <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô esi</span>
sub     <span class="token register variable">esi</span>, <span class="token register variable">eax</span>           <span class="token comment">; esi = ar2 - ar3</span>
lea     <span class="token register variable">ecx</span>, <span class="token register variable">ds</span>:<span class="token number">0</span><span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>   <span class="token comment">; ecx = sz * 4</span>
neg     <span class="token register variable">esi</span>                <span class="token comment">; esi = -(ar2 - ar3)</span>
cmp     <span class="token register variable">ecx</span>, <span class="token register variable">esi</span>           <span class="token comment">; ÊØîËæÉ ecx Âíå esi</span>
jbe     short loc_55       <span class="token comment">; Â¶ÇÊûú ecx &lt;= esiÔºåË∑≥ËΩ¨Âà∞ loc_55</span>

<span class="token label function">loc_36:</span>
cmp     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span> <span class="token comment">; ÊØîËæÉ ar3 Âíå ar2</span>
jnb     loc_143            <span class="token comment">; Â¶ÇÊûú ar3 >= ar2ÔºåË∑≥ËΩ¨Âà∞ loc_143</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span> <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô esi</span>
sub     <span class="token register variable">esi</span>, <span class="token register variable">eax</span>           <span class="token comment">; esi = ar2 - ar3</span>
lea     <span class="token register variable">ecx</span>, <span class="token register variable">ds</span>:<span class="token number">0</span><span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>   <span class="token comment">; ecx = sz * 4</span>
cmp     <span class="token register variable">esi</span>, <span class="token register variable">ecx</span>           <span class="token comment">; ÊØîËæÉ esi Âíå ecx</span>
jb      loc_143            <span class="token comment">; Â¶ÇÊûú esi &lt; ecxÔºåË∑≥ËΩ¨Âà∞ loc_143</span>

<span class="token label function">loc_55:</span>
cmp     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span> <span class="token comment">; ÊØîËæÉ ar3 Âíå ar1</span>
jbe     short loc_67       <span class="token comment">; Â¶ÇÊûú ar3 &lt;= ar1ÔºåË∑≥ËΩ¨Âà∞ loc_67</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span> <span class="token comment">; Â∞Ü ar1 ËµãÂÄºÁªô esi</span>
sub     <span class="token register variable">esi</span>, <span class="token register variable">eax</span>           <span class="token comment">; esi = ar1 - ar3</span>
neg     <span class="token register variable">esi</span>                <span class="token comment">; esi = -(ar1 - ar3)</span>
cmp     <span class="token register variable">ecx</span>, <span class="token register variable">esi</span>           <span class="token comment">; ÊØîËæÉ ecx Âíå esi</span>
jbe     short loc_7F       <span class="token comment">; Â¶ÇÊûú ecx &lt;= esiÔºåË∑≥ËΩ¨Âà∞ loc_7F</span>

<span class="token label function">loc_67:</span>
cmp     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span> <span class="token comment">; ÊØîËæÉ ar3 Âíå ar1</span>
jnb     loc_143            <span class="token comment">; Â¶ÇÊûú ar3 >= ar1ÔºåË∑≥ËΩ¨Âà∞ loc_143</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span> <span class="token comment">; Â∞Ü ar1 ËµãÂÄºÁªô esi</span>
sub     <span class="token register variable">esi</span>, <span class="token register variable">eax</span>           <span class="token comment">; esi = ar1 - ar3</span>
cmp     <span class="token register variable">esi</span>, <span class="token register variable">ecx</span>           <span class="token comment">; ÊØîËæÉ esi Âíå ecx</span>
jb      loc_143            <span class="token comment">; Â¶ÇÊûú esi &lt; ecxÔºåË∑≥ËΩ¨Âà∞ loc_143</span>

<span class="token label function">loc_7F:</span>
mov     <span class="token register variable">edi</span>, <span class="token register variable">eax</span>             <span class="token comment">; Â∞Ü ar3 ËµãÂÄºÁªô edi</span>
and     <span class="token register variable">edi</span>, <span class="token number">0Fh</span>             <span class="token comment">; Ê£ÄÊü• ar3 ÊòØÂê¶ÊòØ16Â≠óËäÇÂØπÈΩê</span>
jz      short loc_9A         <span class="token comment">; Â¶ÇÊûúÂØπÈΩêÔºåË∑≥ËΩ¨Âà∞ loc_9A</span>
test    <span class="token register variable">edi</span>, <span class="token number">3</span>               <span class="token comment">; Ê£ÄÊü• edi ÊòØÂê¶ÊòØ4Â≠óËäÇÂØπÈΩê</span>
jnz     loc_162              <span class="token comment">; Â¶ÇÊûú‰∏çÊòØÔºåË∑≥ËΩ¨Âà∞ loc_162</span>
neg     <span class="token register variable">edi</span>                  <span class="token comment">; edi = -edi</span>
add     <span class="token register variable">edi</span>, <span class="token number">10h</span>             <span class="token comment">; edi += 16</span>
shr     <span class="token register variable">edi</span>, <span class="token number">2</span>               <span class="token comment">; edi /= 4</span>

<span class="token label function">loc_9A:</span>
lea     <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">edi</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>         <span class="token comment">; ecx = edi + 4</span>
cmp     <span class="token register variable">edx</span>, <span class="token register variable">ecx</span>             <span class="token comment">; ÊØîËæÉ sz Âíå ecx</span>
jl      loc_162              <span class="token comment">; Â¶ÇÊûú sz &lt; ecxÔºåË∑≥ËΩ¨Âà∞ loc_162</span>
mov     <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>             <span class="token comment">; ecx = sz</span>
sub     <span class="token register variable">ecx</span>, <span class="token register variable">edi</span>             <span class="token comment">; ecx -= edi</span>
and     <span class="token register variable">ecx</span>, <span class="token number">3</span>               <span class="token comment">; ecx &amp;= 3</span>
neg     <span class="token register variable">ecx</span>                  <span class="token comment">; ecx = -ecx</span>
add     <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>             <span class="token comment">; ecx += sz</span>
test    <span class="token register variable">edi</span>, <span class="token register variable">edi</span>             <span class="token comment">; Ê£ÄÊü• edi ÊòØÂê¶‰∏∫Èõ∂</span>
jbe     short loc_D6         <span class="token comment">; Â¶ÇÊûú edi &lt;= 0ÔºåË∑≥ËΩ¨Âà∞ loc_D6</span>
mov     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span>   <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô ebx</span>
mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token register variable">ecx</span><span class="token comment">; Â∞Ü ecx ËµãÂÄºÁªô‰∏¥Êó∂ÂèòÈáè</span>
mov     <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span>   <span class="token comment">; Â∞Ü ar1 ËµãÂÄºÁªô ecx</span>
xor     <span class="token register variable">esi</span>, <span class="token register variable">esi</span>             <span class="token comment">; Ê∏ÖÁ©∫ esi</span>

<span class="token label function">loc_C1:</span>
mov     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token register variable">esi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>     <span class="token comment">; Â∞Ü ar1[esi] ËµãÂÄºÁªô edx</span>
add     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token register variable">esi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>     <span class="token comment">; Â∞Ü ar2[esi] Âä†Âà∞ edx</span>
mov     <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">esi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>     <span class="token comment">; Â∞ÜÁªìÊûúÂ≠òÂà∞ ar3[esi]</span>
inc     <span class="token register variable">esi</span>                  <span class="token comment">; esi++</span>
cmp     <span class="token register variable">esi</span>, <span class="token register variable">edi</span>             <span class="token comment">; ÊØîËæÉ esi Âíå edi</span>
jb      short loc_C1         <span class="token comment">; Â¶ÇÊûú esi &lt; ediÔºåË∑≥ËΩ¨Âà∞ loc_C1</span>
mov     <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>var_10<span class="token operator">]</span><span class="token comment">; Â∞Ü‰∏¥Êó∂ÂèòÈáèËµãÂÄºÂõû ecx</span>
mov     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>sz<span class="token operator">]</span>    <span class="token comment">; Â∞Ü sz ËµãÂÄºÁªô edx</span>

<span class="token label function">loc_D6:</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span>   <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô esi</span>
lea     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>     <span class="token comment">; esi += edi * 4</span>
test    <span class="token register variable">esi</span>, <span class="token number">0Fh</span>             <span class="token comment">; Ê£ÄÊü• esi ÊòØÂê¶16Â≠óËäÇÂØπÈΩê</span>
jz      short loc_109        <span class="token comment">; Â¶ÇÊûúÂØπÈΩêÔºåË∑≥ËΩ¨Âà∞ loc_109</span>
mov     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span>   <span class="token comment">; Â∞Ü ar1 ËµãÂÄºÁªô ebx</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span>   <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô esi</span>

<span class="token label function">loc_ED:</span>
movdqu  <span class="token register variable">xmm1</span>, xmmword ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; Â∞Ü ar1[edi] ËµãÂÄºÁªô xmm1</span>
movdqu  <span class="token register variable">xmm0</span>, xmmword ptr <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; Â∞Ü ar2[edi] ËµãÂÄºÁªô xmm0</span>
paddd   <span class="token register variable">xmm1</span>, <span class="token register variable">xmm0</span>                   <span class="token comment">; xmm1 += xmm0</span>
movdqa  xmmword ptr <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">xmm1</span> <span class="token comment">; Â∞ÜÁªìÊûúÂ≠òÂà∞ ar3[edi]</span>
add     <span class="token register variable">edi</span>, <span class="token number">4</span>                      <span class="token comment">; edi += 4</span>
cmp     <span class="token register variable">edi</span>, <span class="token register variable">ecx</span>                    <span class="token comment">; ÊØîËæÉ edi Âíå ecx</span>
jb      short loc_ED                <span class="token comment">; Â¶ÇÊûú edi &lt; ecxÔºåË∑≥ËΩ¨Âà∞ loc_ED</span>
jmp     short loc_127               <span class="token comment">; Ë∑≥ËΩ¨Âà∞ loc_127</span>

<span class="token label function">loc_109:</span>
mov     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span>          <span class="token comment">; Â∞Ü ar1 ËµãÂÄºÁªô ebx</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span>          <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô esi</span>

<span class="token label function">loc_111:</span>
movdqu  <span class="token register variable">xmm0</span>, xmmword ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; Â∞Ü ar1[edi] ËµãÂÄºÁªô xmm0</span>
paddd   <span class="token register variable">xmm0</span>, xmmword ptr <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; xmm0 += ar2[edi]</span>
movdqa  xmmword ptr <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">xmm0</span> <span class="token comment">; Â∞ÜÁªìÊûúÂ≠òÂà∞ ar3[edi]</span>
add     <span class="token register variable">edi</span>, <span class="token number">4</span>                      <span class="token comment">; edi += 4</span>
cmp     <span class="token register variable">edi</span>, <span class="token register variable">ecx</span>                    <span class="token comment">; ÊØîËæÉ edi Âíå ecx</span>
jb      short loc_111               <span class="token comment">; Â¶ÇÊûú edi &lt; ecxÔºåË∑≥ËΩ¨Âà∞ loc_111</span>

<span class="token label function">loc_127:</span>
cmp     <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>                    <span class="token comment">; ÊØîËæÉ ecx Âíå edx</span>
jnb     short loc_15B               <span class="token comment">; Â¶ÇÊûú ecx >= edxÔºåË∑≥ËΩ¨Âà∞ loc_15B</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span>          <span class="token comment">; Â∞Ü ar1 ËµãÂÄºÁªô esi</span>
mov     <span class="token register variable">edi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span>          <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô edi</span>

<span class="token label function">loc_133:</span>
mov     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>            <span class="token comment">; Â∞Ü ar1[ecx] ËµãÂÄºÁªô ebx</span>
add     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">edi</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>            <span class="token comment">; Â∞Ü ar2[ecx] Âä†Âà∞ ebx</span>
mov     <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>            <span class="token comment">; Â∞ÜÁªìÊûúÂ≠òÂà∞ ar3[ecx]</span>
inc     <span class="token register variable">ecx</span>                         <span class="token comment">; ecx++</span>
cmp     <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>                    <span class="token comment">; ÊØîËæÉ ecx Âíå edx</span>
jb      short loc_133               <span class="token comment">; Â¶ÇÊûú ecx &lt; edxÔºåË∑≥ËΩ¨Âà∞ loc_133</span>
jmp     short loc_15B               <span class="token comment">; Ë∑≥ËΩ¨Âà∞ loc_15B</span>

<span class="token label function">loc_143:</span>
mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar1<span class="token operator">]</span>          <span class="token comment">; Â∞Ü ar1 ËµãÂÄºÁªô esi</span>
mov     <span class="token register variable">edi</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">+</span>ar2<span class="token operator">]</span>          <span class="token comment">; Â∞Ü ar2 ËµãÂÄºÁªô edi</span>
xor     <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>                    <span class="token comment">; Ê∏ÖÁ©∫ ecx</span>

<span class="token label function">loc_14D:</span>
mov     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>            <span class="token comment">; Â∞Ü ar1[ecx] ËµãÂÄºÁªô ebx</span>
add     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">edi</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>            <span class="token comment">; Â∞Ü ar2[ecx] Âä†Âà∞ ebx</span>
mov     <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>            <span class="token comment">; Â∞ÜÁªìÊûúÂ≠òÂà∞ ar3[ecx]</span>
inc     <span class="token register variable">ecx</span>                         <span class="token comment">; ecx++</span>
cmp     <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>                    <span class="token comment">; ÊØîËæÉ ecx Âíå edx</span>
jb      short loc_14D               <span class="token comment">; Â¶ÇÊûú ecx &lt; edxÔºåË∑≥ËΩ¨Âà∞ loc_14D</span>

<span class="token label function">loc_15B:</span>
xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>                    <span class="token comment">; eax = 0ÔºåËøîÂõû0</span>
pop     <span class="token register variable">ecx</span>                         <span class="token comment">; ÊÅ¢Â§çÂØÑÂ≠òÂô® ecx</span>
pop     <span class="token register variable">ebx</span>                         <span class="token comment">; ÊÅ¢Â§çÂØÑÂ≠òÂô® ebx</span>
pop     <span class="token register variable">esi</span>                         <span class="token comment">; ÊÅ¢Â§çÂØÑÂ≠òÂô® esi</span>
pop     <span class="token register variable">edi</span>                         <span class="token comment">; ÊÅ¢Â§çÂØÑÂ≠òÂô® edi</span>
retn                                <span class="token comment">; ËøîÂõû</span>

<span class="token label function">loc_162:</span>
xor     <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>                    <span class="token comment">; ecx = 0</span>
jmp     short loc_127               <span class="token comment">; Ë∑≥ËΩ¨Âà∞ loc_127</span>
?f@@YAHHPAH00@Z endp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>MOVDQUÔºàMove Unaligned Double QuadwordÔºâ</code>‰ªéÂÜÖÂ≠òÂä†ËΩΩ16Â≠óËäÇÊï∞ÊçÆÔºåÂπ∂Â§çÂà∂Âà∞XMMÂØÑÂ≠òÂô®ÁöÑÊåá‰ª§</li>
<li><code>PADDDÔºàAdd Packed IntegersÔºâ</code>ÊòØÂØπ4ÂØπ32‰ΩçÊï∞ËøõË°åÂä†Ê≥ïËøêÁÆóÔºåÂπ∂ÊääËøêÁÆóÁªìÊûúÂ≠òÂÇ®Âà∞Á¨¨‰∏Ä‰∏™Êìç‰ΩúÁ¨¶ÁöÑÊåá‰ª§„ÄÇÊ≠§Â§ñÔºåËØ•Êåá‰ª§‰∏ç‰ºöËÆæÁΩÆ‰ªª‰ΩïÊ†áÂøó‰ΩçÔºåÂú®Ê∫¢Âá∫Êó∂Âè™‰øùÁïôËøêÁÆóÁªìÊûúÁöÑ‰Ωé32‰ΩçÔºå‰πü‰∏ç‰ºöÊä•Èîô„ÄÇÂ¶ÇÊûúPADDDÁöÑÊüê‰∏™Êìç‰ΩúÊï∞ÊòØÂÜÖÂ≠ò‰∏≠ÁöÑÊüê‰∏™ÂÄºÔºåÈÇ£‰πàËøô‰∏™ÂÄºÁöÑÂú∞ÂùÄÂøÖÈ°ª‰∏é16Â≠óËäÇËæπÁïåÂØπÈΩêÔºåÂê¶ÂàôÂ∞ÜÊä•Èîô</li>
<li><code>MOVDQAÔºàMove Aligned Double QuadwordÔºâ</code>ÁöÑÂäüËÉΩMOVDQUÁõ∏ÂêåÔºåÂè™ÊòØË¶ÅÊ±ÇÂ≠òÂÇ®Êìç‰ΩúÊï∞ÁöÑÂÜÖÂ≠òÂú∞ÂùÄÂøÖÈ°ªÂêë16Â≠óËäÇËæπÁïåÂØπÈΩêÔºåÂê¶ÂàôÊä•Èîô„ÄÇÈô§‰∫ÜËøôÁÇπÂå∫Âà´‰πãÂ§ñÔºå‰∏§‰∏™Êåá‰ª§ÂÆåÂÖ®Áõ∏Âêå„ÄÇÊ≠§Â§ñÔºåMOVDQAÁöÑËøêË°åÈÄüÂ∫¶Ë¶ÅÊØîMOVDQUÂø´„ÄÇ</li>
</ul>
<hr />
<ul>
<li>
<p>Áî®‰∫éÂÜÖÂ≠òÂ§çÂà∂</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">my_memcpy</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> dst<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">,</span> <span class="token class-name">size_t</span> cnt<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
     <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
          dst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>src<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÁîüÊàêÁöÑ‰ª£Á†ÅÂ±ûÂÆûÊô¶Ê∂©ÈöæÊáÇÔºåÁúã‰∏çÊáÇ</p>
</li>
</ul>
<h4 id="simdÂÆûÁé∞strlen"><a class="markdownIt-Anchor" href="#simdÂÆûÁé∞strlen"></a> SIMDÂÆûÁé∞strlen()</h4>
<p>Âú®C/C++Ê∫êÁ®ãÂ∫è‰∏≠ÊèíÂÖ•ÁâπÂÆöÁöÑÂÆèÂç≥ÂèØË∞ÉÁî®SIMDÊåá‰ª§„ÄÇÂú®MSVCÁºñËØëÂô®ÁöÑÂ∫ìÊñá‰ª∂‰πã‰∏≠Ôºåintrin.hÊñá‰ª∂Â∞±‰ΩøÁî®‰∫ÜËøôÁßçÂÆè„ÄÇ</p>
<p>Êàë‰ª¨ÂèØ‰ª•ÊääÂ≠óÁ¨¶‰∏≤ËøõË°åÂàÜÁªÑÂ§ÑÁêÜÔºå‰ΩøÁî®SIMDÊåá‰ª§ÂÆûÁé∞strlen()ÂáΩÊï∞„ÄÇËøôÁßçÁÆóÊ≥ïÊØîÂ∏∏ËßÑÂÆûÁé∞ÁÆóÊ≥ïÂø´2ÔΩû2.5ÂÄç„ÄÇÂÆÉÊØèÊ¨°Êää16‰∏™Â≠óÁ¨¶Âä†ËΩΩÂà∞1‰∏™XMMÂØÑÂ≠òÂô®ÈáåÔºåÁÑ∂ÂêéÊ£ÄÊµãÂ≠óÁ¨¶‰∏≤ÁöÑÁªìÊùüÊ†áÂøó‚ÄîÊï∞ÂÄº‰∏∫Èõ∂ÁöÑÁªìÊùüÁ¨¶</p>
<h3 id="chap26-64‰ΩçÂπ≥Âè∞"><a class="markdownIt-Anchor" href="#chap26-64‰ΩçÂπ≥Âè∞"></a> Chap26 64‰ΩçÂπ≥Âè∞</h3>
<p>x86-64Ê°ÜÊû∂ÊòØ‰∏ÄÁßçÂÖºÂÆπx86Êåá‰ª§ÈõÜÁöÑ64‰ΩçÂæÆÂ§ÑÁêÜÂô®Êû∂ÊûÑ„ÄÇ</p>
<p>‰ªéÈÄÜÂêëÂ∑•Á®ãÁöÑËßíÂ∫¶Êù•ËØ¥ÔºåËøôÁßçÊ°ÜÊû∂ÁöÑ‰∏ªË¶ÅÂå∫Âà´Âú®‰∫éÔºö</p>
<ul>
<li>
<p>Èô§‰∫Ü‰Ωç‰∫éFPUÂíåSIMDÁöÑÂØÑÂ≠òÂô®‰πãÂ§ñÔºåÂá†‰πéÊâÄÊúâÁöÑÂØÑÂ≠òÂô®ÈÉΩÂèò‰∏∫64‰ΩçÂØÑÂ≠òÂô®„ÄÇÊâÄÊúâÊåá‰ª§ÈÉΩÂèØ‰ª•ÈÄöËøáR-Â≠óÂ§¥ÁöÑÂä©ËÆ∞Á¨¶ÔºàÂØÑÂ≠òÂô®ÂêçÁß∞ÔºâË∞ÉÁî®64‰ΩçÂØÑÂ≠òÂô®„ÄÇËÄå‰∏îx86-64Ê°ÜÊû∂ÁöÑCPUË¶ÅÊØîx86Ê°ÜÊû∂ÁöÑCPUÂ§öÂá∫8‰∏™ÈÄöÁî®ÂØÑÂ≠òÂô®„ÄÇËøô‰∫õÈÄöÁî®ÂØÑÂ≠òÂô®ÂàÜÂà´ÊòØÔºöRAX„ÄÅRBX„ÄÅRCX„ÄÅRDX„ÄÅRBP„ÄÅRSP„ÄÅRSI„ÄÅRDI„ÄÅR8„ÄÅR9„ÄÅR10„ÄÅR11„ÄÅR12„ÄÅR13„ÄÅR14„ÄÅR15„ÄÇ</p>
</li>
<li>
<p>ÂÆÉÂêë‰∏ãÂÖºÂÆπÔºåÂÖÅËÆ∏Á®ãÂ∫è‰ΩøÁî®GPRÁöÑ32‰ΩçÂØÑÂ≠òÂô®ÁöÑÂä©ËÆ∞Á¨¶„ÄÅÊìç‰ΩúËØ•ÂØÑÂ≠òÂô®ÁöÑ‰Ωé32‰ΩçÊï∞ÊçÆ„ÄÇ‰æãÂ¶ÇËØ¥ÔºåÁ®ãÂ∫èÂèØ‰ª•ÈÄöËøáÂä©ËÆ∞Á¨¶EAXËÆøÈóÆRAXÂØÑÂ≠òÂô®ÁöÑ‰Ωé32‰Ωç„ÄÇ</p>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240610144056548.png" class="" alt="image-20240610144056548" loading="lazy">
</li>
<li>
<p>64‰ΩçÂØÑÂ≠òÂô®ÁâπÊúâÁöÑR8ÔΩûR15ÂØÑÂ≠òÂô®‰∏ç‰ªÖÊúâÁõ∏Â∫îÁöÑÔºà‰ΩéÔºâ32‰ΩçÂä©ËÆ∞Á¨¶ÔºåÂç≥R8DÔΩûR15DÔºà‰Ωé32‰ΩçÔºâÔºåËÄå‰∏îËøòÊúâÁõ∏Â∫îÁöÑÔºà‰ΩéÔºâ16‰ΩçÂä©ËÆ∞Á¨¶R8WÔΩûR15W„ÄÇ</p>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240610144124263.png" class="" alt="image-20240610144124263" loading="lazy">
</li>
<li>
<p>x86-64Ê°ÜÊû∂ÁöÑCPUÊúâ16‰∏™SIMDÂØÑÂ≠òÂô®ÔºåÂç≥XMM0ÔΩûXMM15„ÄÇÂÆÉÁöÑSIMDÂØÑÂ≠òÂô®ÊØîx86 CPUÂ§öÂá∫‰∏ÄÂÄç„ÄÇ</p>
</li>
</ul>
<h3 id="chap27-simd‰∏éÊµÆÁÇπÊï∞ÁöÑÂπ∂Ë°åËøêÁÆó"><a class="markdownIt-Anchor" href="#chap27-simd‰∏éÊµÆÁÇπÊï∞ÁöÑÂπ∂Ë°åËøêÁÆó"></a> *Chap27 SIMD‰∏éÊµÆÁÇπÊï∞ÁöÑÂπ∂Ë°åËøêÁÆó</h3>
<h3 id="chap28-armÊåá‰ª§ËØ¶Ëß£"><a class="markdownIt-Anchor" href="#chap28-armÊåá‰ª§ËØ¶Ëß£"></a> *Chap28 ARMÊåá‰ª§ËØ¶Ëß£</h3>
<h3 id="chap29-mipsÁöÑÁâπÁÇπ"><a class="markdownIt-Anchor" href="#chap29-mipsÁöÑÁâπÁÇπ"></a> *Chap29 MIPSÁöÑÁâπÁÇπ</h3>
<h2 id="part3-Á°¨‰ª∂Âü∫Á°Ä"><a class="markdownIt-Anchor" href="#part3-Á°¨‰ª∂Âü∫Á°Ä"></a> Part.3 Á°¨‰ª∂Âü∫Á°Ä</h2>
<h3 id="chap30-ÊúâÁ¨¶Âè∑Êï∞ÁöÑË°®Á§∫ÊñπÊ≥ï"><a class="markdownIt-Anchor" href="#chap30-ÊúâÁ¨¶Âè∑Êï∞ÁöÑË°®Á§∫ÊñπÊ≥ï"></a> Chap30 ÊúâÁ¨¶Âè∑Êï∞ÁöÑË°®Á§∫ÊñπÊ≥ï</h3>
<ul>
<li>
<p>ÊúâÁ¨¶Âè∑Êï∞ÈÄöÂ∏∏‰ª•‰∫åËøõÂà∂Ë°•Á†Å[<a href="#anchor301">1]</a>ÁöÑÂΩ¢ÂºèÂ≠òÂÇ®‰∫éÂ∫îÁî®Á®ãÂ∫èÈáå„ÄÇ</p>
</li>
<li>
<p>‰∏∫‰∫ÜÊ≠£Á°ÆÊìç‰ΩúÊúâÁ¨¶Âè∑Êï∞ÂíåÊó†Á¨¶Âè∑Êï∞ÔºåÊù°‰ª∂ËΩ¨ÁßªÊåá‰ª§ÔºàÂèÇËßÅÊú¨‰π¶Á¨¨12Á´†ÔºâÁâπÂú∞ÂàÜ‰∏∫JG/JLÁ≥ªÂàóÔºàsignedÂûãÔºâÂíåJA/JBEÁ≥ªÂàóÔºàunsignedÂûãÔºâ‰∏§Â•óÊåá‰ª§</p>
</li>
<li>
<p>Âêå‰∏Ä‰∏™Êï∞ÂÄºÂç≥ÂèØ‰ª•Ë°®Á§∫ÊúâÁ¨¶Âè∑Êï∞Ôºå‰πüÂèØ‰ª•Ë°®Á§∫Êó†Á¨¶Âè∑Êï∞„ÄÇ</p>
</li>
<li>
<p>C/C++ÁöÑÊúâÁ¨¶Âè∑ÂûãÊï∞ÊçÆÊúâÔºö</p>
<ul>
<li>int64_tÔºà‰ªé‚àí9223372036854775806Ëá≥9223372036854775807ÔºâÔºåÂç≥‰ªé0x8000000000000000Ëá≥0x7FFFFFFFFFFFFFFFÔºâ</li>
<li>intÔºàÂèñÂÄºËåÉÂõ¥‰ªé‚àí2147483646Ëá≥2147483647ÔºåÂç≥0x80000000Ëá≥0x7FFFFFFFÔºâ„ÄÇ</li>
<li>charÔºàÂèñÂÄºËåÉÂõ¥‰ªé‚àí127Ëá≥128ÔºåÂç≥‰ªé0x7FËá≥0x80Ôºâ„ÄÇ</li>
<li>ssize_t„ÄÇ</li>
</ul>
<p>Êó†Á¨¶Âè∑ÂûãÊï∞ÊçÆÊúâÔºö</p>
<ul>
<li>uint64_tÔºà‰ªé0Ëá≥18446744073709551615/0xFFFFFFFFFFFFFFFFÔºâÔºö</li>
<li>unsigned intÔºàÂèñÂÄºËåÉÂõ¥‰ªé0Ëá≥4294967295ÔºåÂç≥‰ªé0Ëá≥0xFFFFFFFFÔºâ„ÄÇ</li>
<li>unsigned charÔºàÂèñÂÄºËåÉÂõ¥‰ªé0Ëá≥255ÔºåÂç≥‰ªé0Ëá≥0xFFÔºâ„ÄÇ</li>
<li>size_t„ÄÇ</li>
</ul>
</li>
<li>
<p>ÊúâÁ¨¶Âè∑Êï∞ÁöÑÊúÄÈ´òÊï∞ÊùÉ‰ΩçÊòØÁ¨¶Âè∑‰ΩçÔºö1‰ª£Ë°®Ë¥üÊï∞Ôºå0‰ª£Ë°®Ê≠£Êï∞„ÄÇ</p>
</li>
<li>
<p>‰ªéÊï∞ÊçÆÂÆΩÂ∫¶ËæÉÂ∞èÁöÑÊï∞ÊçÆËΩ¨Êç¢‰∏∫Êï∞ÊçÆÂÆΩÂ∫¶ËæÉÂ§ßÁöÑÊï∞ÊçÆÊòØÂèØË°åÁöÑ„ÄÇ</p>
</li>
<li>
<p>Ë¥üÊï∞ÁöÑË°•Á†ÅÂíåÂéüÁ†ÅÁöÑÂèåÂêëËΩ¨Êç¢ËøáÁ®ãÊòØÁõ∏ÂêåÁöÑÔºåÈÉΩÊòØÈÄê‰ΩçÊ±ÇÈùûÂÜçÂä†1„ÄÇËøôÁßçËøêÁÆóËøáÁ®ãÁÆÄÂçïÊòìËÆ∞ÔºöÂêå‰∏Ä‰∏™ÂÄºÁöÑÊ≠£Ë¥üÊï∞ÊòØÁõ∏ÂèçÁöÑÂÄºÔºåÊâÄ‰ª•Ë¶ÅÊ±ÇÈùûÔºõÊ±ÇÈùû‰πãÂêéÂÜçÂä†1ÂàôÊòØÂõ†‰∏∫‰∏≠Èó¥ÁöÑ‚ÄúÈõ∂‚ÄùÂç†‰∫Ü‰∏Ä‰∏™Êï∞ÁöÑ‰ΩçÁΩÆ„ÄÇ</p>
</li>
<li>
<p>Âä†ÂáèËøêÁÆó‰∏çÂå∫ÂàÜÊúâÁ¨¶Âè∑Êï∞ÂíåÊó†Á¨¶Âè∑Êï∞ÔºåÂÆÉ‰ª¨ÁöÑÂä†ÂáèËøêÁÆóÊåá‰ª§ÂÆåÂÖ®Áõ∏Âêå„ÄÇ‰ΩÜÊòØ‰πòÈô§Ê≥ïËøêÁÆóËøòÊòØÊúâÂå∫Âà´ÁöÑÔºöÂú®x86Êåá‰ª§ÈõÜÈáåÔºåÊúâÁ¨¶Âè∑Êï∞ÁöÑ‰πòÈô§Êåá‰ª§ÊòØIMUL/IDIVÔºåËÄåÊó†Á¨¶Âè∑Êï∞ÁöÑÊåá‰ª§ÊòØMUL/DIV„ÄÇ</p>
</li>
<li>
<p>Ê≠§Â§ñÔºåÊúâÁ¨¶Âè∑Êï∞ÁöÑÊìç‰ΩúÊåá‰ª§Êõ¥Â§ö‰∏Ä‰∫õ„ÄÇ‰æãÂ¶ÇCBW/CWD/CWDE/CDQ/CDQEÔºàÈôÑÂΩïA.6.3Ôºâ„ÄÅMOVSXÔºà15.1.1ËäÇÔºâÔºåSARÔºàÈôÑÂΩïA.6.3Ôºâ„ÄÇ</p>
</li>
</ul>
<h3 id="chap31-Â≠óËäÇÂ∫è"><a class="markdownIt-Anchor" href="#chap31-Â≠óËäÇÂ∫è"></a> Chap31 Â≠óËäÇÂ∫è</h3>
<ul>
<li>Â∞èÁ´ØÂ≠óËäÇÂ∫è(Little-Endian)Êåá‰ΩéÊï∞ÊùÉÂ≠óËäÇÊï∞ÊçÆÂ≠òÊîæÂú®ÂÜÖÂ≠ò‰ΩéÂú∞ÂùÄÔºåÈ´òÊï∞ÊùÉÂ≠óËäÇÊï∞ÊçÆÂ≠òÊîæÂú®È´òÂú∞ÂùÄ</li>
<li>Â§ßÁ´ØÂ≠óËäÇÂ∫è(Big-Endian)ÊåáÈ´òÊï∞ÊùÉÂ≠óËäÇÊï∞ÊçÆÂ≠òÊîæÂú®‰ΩéÂú∞ÂùÄÔºå‰ΩéÂ≠óËäÇÊï∞ÊçÆÂ≠òÊîæÂú®È´òÂú∞ÂùÄÂ§ÑÁöÑÂÜÖÂ≠òÂàÜÂ∏ÉÊñπÂºè</li>
</ul>
<hr />
<h4 id="Â§ßÁ´ØÂ≠óËäÇÂ∫è"><a class="markdownIt-Anchor" href="#Â§ßÁ´ØÂ≠óËäÇÂ∫è"></a> Â§ßÁ´ØÂ≠óËäÇÂ∫è</h4>
<p>Âú®ÈááÁî®Â§ßÁ´ØÂ≠óËäÇÂ∫èÊó∂Ôºå0x12345678Âú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂ≠òÂÇ®ÊñπÂºèÂ¶Ç‰∏ãÊâÄÁ§∫„ÄÇ</p>
<table>
<thead>
<tr>
<th>ÂÜÖÂ≠òÂú∞ÂùÄ</th>
<th>Â≠óËäÇÂÄº</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td>0x12</td>
</tr>
<tr>
<td>+1</td>
<td>0x34</td>
</tr>
<tr>
<td>+2</td>
<td>0x56</td>
</tr>
<tr>
<td>+3</td>
<td>0x78</td>
</tr>
</tbody>
</table>
<p>Motorola 68k„ÄÅIBM POWERÁ≥ªÂàóCPUÈááÁî®Â§ßÁ´ØÂ≠óËäÇÂ∫è„ÄÇ</p>
<h4 id="Â∞èÁ´ØÂ≠óËäÇÂ∫è"><a class="markdownIt-Anchor" href="#Â∞èÁ´ØÂ≠óËäÇÂ∫è"></a> Â∞èÁ´ØÂ≠óËäÇÂ∫è</h4>
<p>Âú®ÈááÁî®Â∞èÁ´ØÂ≠óËäÇÂ∫èÊó∂Ôºå0x12345678Âú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂ≠òÂÇ®ÊñπÂºèÂ¶Ç‰∏ãÊâÄÁ§∫„ÄÇ</p>
<table>
<thead>
<tr>
<th>ÂÜÖÂ≠òÂú∞ÂùÄ</th>
<th>Â≠óËäÇÂÄº</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td>0x78</td>
</tr>
<tr>
<td>+1</td>
<td>0x56</td>
</tr>
<tr>
<td>+2</td>
<td>0x34</td>
</tr>
<tr>
<td>+3</td>
<td>0x12</td>
</tr>
</tbody>
</table>
<p>Intel x86Á≥ªÂàóCPUÈááÁî®Â∞èÁ´ØÂ≠óËäÇÂ∫è„ÄÇ</p>
<p><em>Ê≠£ÊòØÂõ†‰∏∫MIPSÁöÑÁ°¨‰ª∂Âπ≥Âè∞ÂèØËÉΩÈááÁî®‰∏§Áßç‰∏çÂêåÁöÑÂ≠óËäÇÂ∫èÔºåÊâÄ‰ª•MIPS LinuxÂèàÂàÜ‰∏∫ÈááÁî®Â§ßÁ´ØÂ≠óËäÇÂ∫èÁöÑMIPS LinuxÂíåÈááÁî®Â∞èÁ´ØÂ≠óËäÇÂ∫èÁöÑmipsel Linux„ÄÇÂú®ÈááÂèñ‰∏ÄÁßçÂ≠óËäÇÂ∫èÁöÑÂπ≥Âè∞‰∏äÁºñËØëÂá∫Êù•ÁöÑÁ®ãÂ∫èÔºå‰∏çÂèØËÉΩÂú®Âè¶‰∏ÄÁßçÂ≠óËäÇÂ∫èÁöÑÂπ≥Âè∞‰∏äËøêË°å„ÄÇ</em></p>
<hr />
<h4 id="ÂèåÊ®°‰∫åÂÖÉÊï∞ÊçÆÊ†ºÂºè"><a class="markdownIt-Anchor" href="#ÂèåÊ®°‰∫åÂÖÉÊï∞ÊçÆÊ†ºÂºè"></a> ÂèåÊ®°‰∫åÂÖÉÊï∞ÊçÆÊ†ºÂºè</h4>
<p><em>ARM„ÄÅPowerPC„ÄÅSPARC„ÄÅMIPS„ÄÅIA64Á≠âCPUÈááÁî®ÂèåÊ®°‰∫åÂÖÉÊï∞ÊçÆÊ†ºÂºèÔºàBi-endianÔºâÔºåÂÆÉ‰ª¨Âç≥ÂèØ‰ª•Â∑•‰Ωú‰∫éÂ∞èÁ´ØÂ≠óËäÇÂ∫è‰πüÂèØ‰ª•ÂàáÊç¢Âà∞Â§ßÁ´ØÂ≠óËäÇÂ∫è„ÄÇ</em></p>
<h4 id="ËΩ¨Êç¢Â≠óËäÇÂ∫è"><a class="markdownIt-Anchor" href="#ËΩ¨Êç¢Â≠óËäÇÂ∫è"></a> ËΩ¨Êç¢Â≠óËäÇÂ∫è</h4>
<p><em>BSWAPÊåá‰ª§ÂèØÂú®Ê±áÁºñÂ±ÇÈù¢ËΩ¨Êç¢Êï∞ÊçÆÁöÑÂ≠óËäÇÂ∫è</em></p>
<p><code>TCP/IP</code>Êï∞ÊçÆÂ∫èÁöÑÂ∞ÅË£ÖËßÑËåÉÈááÁî®Â§ßÁ´ØÂ≠óËäÇÂ∫èÔºåÊâÄ‰ª•ÈááÁî®Â∞èÁ´ØÂ≠óËäÇÂ∫èÂπ≥Âè∞ÁöÑÁ≥ªÁªüÂ∞±ÈúÄË¶Å‰ΩøÁî®‰∏ìÈó®ÁöÑËΩ¨Êç¢Â≠óËäÇÂ∫èÁöÑÂáΩÊï∞</p>
<p>Â∏∏Áî®ÁöÑÂ≠óËäÇÂ∫èËΩ¨Êç¢ÂáΩÊï∞ÊòØ<code>htonl()</code>Âíå<code>htons()</code>„ÄÇ<code>htonl()</code>Ôºàhost-to-network longÔºâÂíå<code>htons()</code>Ôºàhost-to-network shortÔºâ(Êää‰∏ªÊú∫Â≠óËäÇÈ°∫Â∫èËΩ¨‰∏∫ÁΩëÁªúÂ≠óËäÇÈ°∫Â∫è)</p>
<p><em>Âú®TCP/IPÁöÑÊúØËØ≠ÈáåÔºå<code>Â§ßÁ´ØÂ≠óËäÇÂ∫è</code>ÂèàÁß∞‰∏∫‚Äú<code>ÁΩëÁªúÂ≠óËäÇÈ°∫Â∫èÔºàNetwork Byte OrderÔºâ</code>‚ÄùÔºåÁΩëÁªú‰∏ªÊú∫ÈááÁî®ÁöÑÂ≠óËäÇÂ∫èÂè´‰Ωú‚Äú‰∏ªÊú∫Â≠óËäÇÈ°∫Â∫è‚Äù„ÄÇx86ÂíåÂÖ∂‰ªñ‰∏Ä‰∫õÂπ≥Âè∞ÁöÑ‰∏ªÊú∫Â≠óËäÇÂ∫èÊòØÂ∞èÁ´ØÂ≠óËäÇÂ∫èÔºå‰ΩÜÊòØIBM POWERÁ≠âËëóÂêçÊúçÂä°Âô®Á≥ªÂàóÂùáÈááÁî®Â§ßÁ´ØÂ≠óËäÇÂ∫è„ÄÇÂõ†Ê≠§<code>ÔºåÂú®‰∏ªÊú∫Â≠óËäÇÈ°∫Â∫è‰∏∫Â§ßÁ´ØÂ≠óËäÇÂ∫èÁöÑÂπ≥Âè∞‰∏ä‰ΩøÁî®htonl()Êàñhtons()ÂáΩÊï∞ËΩ¨Êç¢Â≠óËäÇÂ∫èÔºåÂÖ∂ÂÆû‰∏ç‰ºöËøõË°åÁúüÊ≠£ÊÑè‰πâ‰∏äÁöÑÂ≠óËäÇÈáçÊéí</code>„ÄÇ</em></p>
<h3 id="chap32-ÂÜÖÂ≠òÂ∏ÉÂ±Ä"><a class="markdownIt-Anchor" href="#chap32-ÂÜÖÂ≠òÂ∏ÉÂ±Ä"></a> Chap32 ÂÜÖÂ≠òÂ∏ÉÂ±Ä</h3>
<p>C/C++ÊääÂÜÖÂ≠òÂàíÂàÜ‰∏∫ËÆ∏Â§öÂå∫ÂüüÔºå‰∏ªË¶ÅÁöÑÂÜÖÂ≠òÂå∫ÂüüÊúâ:</p>
<ul>
<li>ÂÖ®Â±ÄÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂèàÁß∞‰∏∫‚Äú<code>ÔºàÂÖ®Â±ÄÔºâÈùôÊÄÅÂ≠òÂÇ®Âå∫</code>static memory allocation‚ÄùÁºñÁ®ã‰∫∫Âëò‰∏çÈúÄË¶Å‰∏∫ÂÖ®Â±ÄÂèòÈáèÂíåÈùôÊÄÅÂèòÈáèÊòéÁ°ÆÂàíÂàÜ<code>Â≠òÂÇ®Á©∫Èó¥Âá°ÊòØÁî±Ê∫êÁ®ãÂ∫èÂ£∞ÊòéÁöÑÂÖ®Â±ÄÂèòÈáè„ÄÅÂÖ®Â±ÄÊï∞ÁªÑÔºåÁºñËØëÂô®ÈÉΩËÉΩÂ§üÂú®Êï∞ÊçÆÊÆµÊàñÂ∏∏ÈáèÊÆµ‰∏∫ÂÖ∂ÂàÜÈÖçÈÄÇÂΩìÁöÑÂ≠òÂÇ®Á©∫Èó¥</code>„ÄÇÁî±‰∫éÊï¥‰∏™Á®ãÂ∫èÈÉΩÂèØ‰ª•ËÆøÈóÆËøô‰∏™Âå∫ÂüüÁöÑÊï∞ÊçÆÔºåÊâÄ‰ª•‰∫∫‰ª¨ËÆ§‰∏∫‰ΩøÁî®ËøôÁßçÂ≠òÂÇ®Á©∫Èó¥Êï∞ÊçÆ‰ºöÁ†¥ÂùèÁ®ãÂ∫èÁöÑÁªìÊûÑÂåñ‰ΩìÁ≥ª„ÄÇÊ≠§Â§ñÔºåÂú®ÂÖ®Â±ÄÂÜÖÂ≠òÂå∫Â≠òÂÇ®Êï∞ÊçÆ‰πãÂâçÔºåÂøÖÈ°ª‰∫ãÂÖàÂ£∞ÊòéÂÖ∂Á°ÆÂàáÁöÑÂÆπÈáè„ÄÇÂõ†ËÄåËøô‰∏™Á©∫Èó¥‰∏çÈÄÇÁî®‰∫éÂ≠òÂÇ®ÁºìÂ≠òÊàñÂä®ÊÄÅÊï∞ÁªÑ„ÄÇÂú®ÂÖ®Â±ÄÂÜÖÂ≠òÁ©∫Èó¥Âá∫Áé∞ÁöÑÁºìÂÜ≤Âå∫Ê∫¢Âá∫ÈóÆÈ¢òÔºåÂæÄÂæÄÂ∞ÜË¶ÜÁõñÂú®ÂÜÖÂ≠ò‰∏≠Áõ∏ÈÇª‰ΩçÁΩÆÁöÑÂèòÈáèÊàñÁºìÂ≠òÔºàËØ∑ÂèÇÈòÖÊú¨‰π¶7.2ËäÇÁöÑÊ°à‰æãÔºâ„ÄÇ</li>
<li><code>Ê†àÁ©∫Èó¥ÔºåÂç≥ÂàÜÈÖçÁªôÊ†àÁöÑÂ≠òÂÇ®Âå∫Âüü„ÄÇÂÆÉÊòØÁî±ÁºñËØëÂô®Ëá™Âä®ÂàÜÈÖç„ÄÅÈáäÊîæÁöÑÂ≠òÂÇ®Âå∫ÂüüÔºåÂ∏∏Áî®‰∫éÂ≠òÊîæÂáΩÊï∞ÁöÑÂèÇÊï∞ÂíåÂ±ÄÈÉ®ÂèòÈáè„ÄÇ</code>Âú®ÁâπÂÆöÊÉÖÂÜµ‰∏ãÔºåÂ±ÄÈÉ®ÂèòÈáèÂèØË¢´ÂÖ∂‰ªñÂáΩÊï∞ËÆøÈóÆÔºàÂ±ÄÈÉ®ÂèòÈáèÁöÑÊåáÈíà‰Ωú‰∏∫ÂèÇÊï∞‰º†ÈÄíÁªôË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞Ôºâ„ÄÇÂú®Êåá‰ª§Â±ÇÈù¢Ôºå‚ÄúÂàÜÈÖçÂíåÈáäÊîæÊ†àÁ©∫Èó¥ÁöÑ<code>ÂÆûË¥®Â∞±ÊòØË∞ÉÊï¥SPÂØÑÂ≠òÂô®ÁöÑÂÄº</code>ÔºåÂõ†ËÄå<code>ÂàÜÈÖçÂíåÈáäÊîæÊ†àÁ©∫Èó¥ÁöÑÊìç‰ΩúÈÄüÂ∫¶ÈùûÂ∏∏Âø´</code>„ÄÇÁºñËØëÂô®Âè™ËÉΩ‰∏∫ÈÇ£‰∫õÂú®ÁºñËØëÈò∂ÊÆµÁ°ÆÂÆöÂ≠òÂÇ®Á©∫Èó¥ÁöÑÂ±ÄÈÉ®ÂèòÈáèÂàÜÈÖçÊ†àÁ©∫Èó¥„ÄÇÂõ†Ê≠§ÔºåÊó†Ê≥ï‰∫ãÂÖàÈ¢ÑÂà§Â≠òÂÇ®Á©∫Èó¥ÁöÑÁºìÂÜ≤ÂûãÊï∞ÊçÆÁ±ªÂûãÔºåÂç≥ÁºìÂÜ≤Âå∫ÂíåÂä®ÊÄÅÊï∞ÁªÑ(Èô§Èùû‰ΩøÁî®<code>alloc()</code>ÂáΩÊï∞)‰∏ç‰ºöË¢´ÂàÜÈÖçÂà∞Ê†àÁ©∫Èó¥Èáå„ÄÇÂú®Ê†àÁ©∫Èó¥ÂèëÁîüÁöÑÁºìÂÜ≤Âå∫Ê∫¢Âá∫ÈóÆÈ¢òÔºåÈÄöÂ∏∏‰ºöÁØ°ÊîπÊ†àÈáåÁöÑÈáçË¶ÅÊï∞ÊçÆ</li>
<li><code>Â†ÜÁ©∫Èó¥ÔºåÂç≥‚ÄúÂä®ÊÄÅÂÜÖÂ≠òÂàÜÈÖçÂå∫„ÄÇCËØ≠Ë®ÄÁöÑmalloc()/free()ÂáΩÊï∞ÊàñC++ÁöÑnew/deleteËØ≠Âè•Âç≥ÂèØÂàÜÈÖç„ÄÅÈáäÊîæÂ†ÜÁ©∫Èó¥Ôºâ</code>„ÄÇ‚Äú‰∏çÂøÖ‰∫ãÂÖàÂ£∞ÊòéÂ†ÜÁ©∫Èó¥ÁöÑÂ§ßÂ∞è‚ÄùÂç≥‚ÄúÂèØÂú®Á®ãÂ∫èÂêØÂä®‰ª•ÂêéÂÜçÁ°ÆÂÆöÊï∞ÊçÆÂùóÁöÑÂÆπÈáè‚ÄùËøô‰∏ÄÁâπÂæÅÊûÑÊàê‰∫ÜÂÖ∂Áã¨ÁâπÁöÑ‰æøÂà©ÊÄß„ÄÇÂè¶Â§ñÔºåÁ®ãÂ∫èÂëòËøòÂèØ‰ª•Âä®ÊÄÅË∞ÉÊï¥Ôºàrealloc()ÂáΩÊï∞ÔºâÂÜÖÂ≠òÂùóÁöÑÂ§ßÂ∞èÔºåÂè™ÊòØË∞ÉÊï¥Â†ÜÁ©∫Èó¥ÁöÑÊìç‰ΩúÈÄüÂ∫¶‰∏çÂæàÁêÜÊÉ≥„ÄÇ<code>Âú®ÂÜÖÂ≠òÂàÜÈÖçÊìç‰Ωú‰∏≠ÔºåÁî≥ËØ∑„ÄÅÈáäÊîæÂ†ÜÁ©∫Èó¥ÁöÑÊìç‰ΩúÊòØÈÄüÂ∫¶ÊúÄÊÖ¢ÁöÑÊìç‰Ωú</code>Ôºö<code>Âú®ÂàÜÈÖç„ÄÅÈáäÊîæÂ†ÜÁ©∫Èó¥Êó∂ÔºåËøõË°åËøôÁßçÊìç‰ΩúÁöÑÁ®ãÂ∫èÂøÖÈ°ªÊîØÊåÅÂπ∂‰∏îÊõ¥Êñ∞ÊâÄÊúâÊéßÂà∂ÁªìÊûÑ</code>„ÄÇ<code>Âú®Ëøô‰∏™Âå∫ÂüüÂèëÁîüÁöÑÁºìÂÜ≤Âå∫Ê∫¢Âá∫ÁªèÂ∏∏‰ºöË¶ÜÁõñÂ†ÜÁ©∫Èó¥ÁöÑÊï∞ÊçÆÁªìÊûÑ‰Ωì„ÄÇÂ†ÜÁ©∫Èó¥ÁÆ°ÁêÜ‰∏çÂΩìËøò‰ºöÂèëÁîüÂÜÖÂ≠òÊ≥ÑÈú≤ÈóÆÈ¢òÔºöÊâÄÊúâË¢´ÂàÜÈÖçÁöÑÂ†ÜÁ©∫Èó¥ÈÉΩÂ∫îÂΩìË¢´ÊòéÁ°ÆÂú∞ÈáäÊîæÔºåÂê¶ÂàôÂ∞±‰ºöÂá∫Áé∞ÂÜÖÂ≠òÊ≥ÑÈú≤ÈóÆÈ¢ò„ÄÇ‰ΩÜÊòØÁ®ãÂ∫èÂëòÂèØËÉΩ‰ºöÂá∫Áé∞‚ÄúÂøòËÆ∞ÈáäÊîæÂ†ÜÁ©∫Èó¥‚ÄùÁöÑÈóÆÈ¢òÔºåËøòÊúâÂèëÁîüÈáäÊîæ‰∏çÂΩªÂ∫ïÁöÑÈóÆÈ¢ò</code>„ÄÇÂè¶Â§ñÔºå‚Äú<code>Âú®Ë∞ÉÁî®free()ÂáΩÊï∞ÈáäÊîæÁ©∫Èó¥‰πãÂêéÂÜçÊ¨°Áõ¥Êé•‰ΩøÁî®ËøôÂùóÂÜÖÂ≠òÂå∫Âüü‚ÄùÁöÑÊåá‰ª§ÂêåÊ†∑‰ºöÂ∏¶Êù•ÈùûÂ∏∏‰∏•ÈáçÁöÑÂÆâÂÖ®ÈóÆÈ¢ò</code>ÔºàËØ∑ÂèÇÈòÖÊú¨‰π¶21.2ËäÇÁöÑÊ°à‰æãÔºâ„ÄÇ</li>
</ul>
<h3 id="chap33-cpu"><a class="markdownIt-Anchor" href="#chap33-cpu"></a> Chap33 CPU</h3>
<h4 id="ÂàÜÊîØÈ¢ÑÊµã"><a class="markdownIt-Anchor" href="#ÂàÜÊîØÈ¢ÑÊµã"></a> ÂàÜÊîØÈ¢ÑÊµã</h4>
<p><em>Áé∞Âú®ÁöÑ‰∏ªÊµÅÁºñËØëÂô®Âü∫Êú¨ÈÉΩ‰∏çÊÄé‰πàÂàÜÈÖçÊù°‰ª∂ËΩ¨ÁßªÊåá‰ª§‰∫Ü(Âõ†‰∏∫ÊïàÁéá‰Ωé)„ÄÇ</em></p>
<p>ËôΩÁÑ∂ÁõÆÂâçÁöÑÂàÜÊîØÈ¢ÑÊµãÂäüËÉΩÂπ∂‰∏çÂÆåÁæéÔºå‰ΩÜÊòØÁºñËØëÂô®ËøòÊòØÂú®ÂêëËøô‰∏ÄÊñπÂêëÂèëÂ±ï„ÄÇ</p>
<p>ARMÂπ≥Âè∞Âá∫Áé∞ÁöÑÊù°‰ª∂ÊâßË°åÊåá‰ª§Ôºà‰æãÂ¶ÇADRccÔºâÂèäx86Âπ≥Âè∞Âá∫Áé∞ÁöÑCMOVccÊåá‰ª§ÔºåÈÉΩÊòØËøô‰∏ÄË∂ãÂäøÁöÑÊòéËØÅ„ÄÇ</p>
<ul>
<li><code>CMOVcc</code> Êåá‰ª§ÈõÜÔºàConditional Move InstructionsÔºâÊòØ x86 Ê±áÁºñËØ≠Ë®Ä‰∏≠ÁöÑ‰∏ÄÁ±ªÊù°‰ª∂‰º†ÈÄÅÊåá‰ª§„ÄÇËøô‰∫õÊåá‰ª§Áî®‰∫éÊ†πÊçÆÊù°‰ª∂‰ª£Á†ÅÂØÑÂ≠òÂô®ÔºàÈÄöÂ∏∏ÊòØCPUÁöÑÊ†áÂøóÂØÑÂ≠òÂô®ÔºâÁöÑÁä∂ÊÄÅÊù•ÂÜ≥ÂÆöÊòØÂê¶ÊâßË°åÂØÑÂ≠òÂô®‰πãÈó¥ÁöÑÊù°‰ª∂Êï∞ÊçÆÁßªÂä®„ÄÇ<code>cc</code> Ë°®Á§∫‰∏çÂêåÁöÑÊù°‰ª∂‰ª£Á†ÅÔºå‰æãÂ¶Ç<code>E</code>Ë°®Á§∫Á≠â‰∫éÔºå<code>NE</code>Ë°®Á§∫‰∏çÁ≠â‰∫éÁ≠â„ÄÇ</li>
</ul>
<h4 id="Êï∞ÊçÆÁõ∏ÂÖ≥ÊÄß"><a class="markdownIt-Anchor" href="#Êï∞ÊçÆÁõ∏ÂÖ≥ÊÄß"></a> Êï∞ÊçÆÁõ∏ÂÖ≥ÊÄß</h4>
<p>ÂΩì‰ª£ÁöÑCPUÂ§öÊï∞ÈÉΩËÉΩ<code>Âπ∂Ë°åÊâßË°åÊåá‰ª§ÔºàOOE/‰π±Â∫èÊâßË°åÊäÄÊúØ</code>Ôºâ„ÄÇ‰ΩÜÊòØÔºå<mark>Ë¶ÅÂÖÖÂàÜÂà©Áî®CPVÁöÑ‰π±Â∫èÊâßË°åÂäüËÉΩ„ÄÅÂ∞ΩÂèØËÉΩÈ¢ëÁπÅÂú∞ÂêåÊúüÊâßË°åÂ§öÊù°Êåá‰ª§ÔºåÈ¶ñÂÖàÂ∞±Ë¶ÅÈôç‰ΩéÂêÑÊåá‰ª§‰πãÈó¥ÁöÑÊï∞ÊçÆÁõ∏ÂÖ≥ÊÄß</mark>„ÄÇÊâÄ‰ª•ÔºåÁºñËØëÂô®<code>Â∞ΩÂèØËÉΩÂú∞ÂàÜÈÖçÈÇ£‰∫õ‰∏çÊÄé‰πàÂΩ±ÂìçCPUÊ†áËØÜÁöÑÊåá‰ª§„ÄÇ</code></p>
<p>Âõ†‰∏∫<mark>LEAÊåá‰ª§Âπ∂‰∏çÂÉèÂÖ∂‰ªñÊï∞Â≠¶ËøêÁÆóÊåá‰ª§ÈÇ£Ê†∑ÂΩ±ÂìçÊ†áËØÜ‰ΩçÔºåÊâÄ‰ª•ÁºñËØëÂô®Ë∂äÊù•Ë∂äÂ§öÂú∞‰ΩøÁî®ËøôÁßçÊåá‰ª§</mark>„ÄÇ</p>
<h3 id="chap34-hash"><a class="markdownIt-Anchor" href="#chap34-hash"></a> Chap34 hash</h3>
<ul>
<li>ÂìàÂ∏åÔºàhashÔºâÂáΩÊï∞ËÉΩÂ§üÁîüÊàêÂèØÈù†Á®ãÂ∫¶ËæÉÈ´òÁöÑÊ†°È™åÂíåÔºàChecksumÔºâÔºåÂèØÂÖÖÂàÜÊª°Ë∂≥Êï∞ÊçÆÊ£ÄÈ™åÁöÑÈúÄË¶Å„ÄÇ</li>
<li>CRC32ÁÆóÊ≥ïÂ∞±ÊòØ‰∏ÄÁßç‰∏çÂ§™Â§çÊùÇÁöÑÂìàÂ∏åÁÆóÊ≥ï„ÄÇ</li>
<li>ÂìàÂ∏åÂÄºÊòØ‰∏ÄÁßçÂõ∫ÂÆöÈïøÂ∫¶ÁöÑ‰ø°ÊÅØÊëòË¶ÅÔºå‰∏çÂèØËÉΩÊ†πÊçÆÂìàÂ∏åÂÄºÈÄÜÂêë‚ÄúÊé®Êµã‚ÄùÂá∫‰ø°ÊÅØÂéüÊñá„ÄÇÊâÄ‰ª•ÔºåÊó†ËÆ∫CRC32ÁÆóÊ≥ïËÆ°ÁÆóÁöÑ‰ø°ÊÅØÂéüÊñáÊúâÂ§öÈïøÔºåÂÆÉÂè™ËÉΩÁîüÊàê32‰ΩçÁöÑÊ†°È™åÂíå„ÄÇ</li>
<li>‰ΩÜÊòØ‰ªéÂä†ÂØÜÂ≠¶ÁöÑËßíÂ∫¶ÁúãÔºåÊàë‰ª¨ÂèØ‰ª•ËΩªÊòìÂú∞‰º™ÈÄ†Âá∫Êª°Ë∂≥Âêå‰∏ÄCRC32ÂìàÂ∏åÂÄºÁöÑÂ§ö‰∏™‰ø°ÊÅØÂéüÊñá„ÄÇÂΩìÁÑ∂ÔºåÈò≤Ê≠¢‰º™ÈÄ†Â∞±ÊòØÂä†ÂØÜÂìàÂ∏åÂáΩÊï∞ÔºàCryptographic hash functionÔºâÁöÑ‰ªªÂä°‰∫Ü„ÄÇ</li>
<li>Ê≠§Â§ñÔºå‰∫∫‰ª¨ÊôÆÈÅç‰ΩøÁî®MD5„ÄÅSHA1Á≠âÂìàÂ∏åÁÆóÊ≥ïÁîüÊàêÁî®Êà∑ÂØÜÁ†ÅÁöÑÊëòË¶ÅÔºàÂìàÂ∏åÂÄºÔºâÔºåÁÑ∂ÂêéÂÜçÊääÂØÜÁ†ÅÊëòË¶ÅÂ≠òÂÇ®Âú®Êï∞ÊçÆÂ∫ìÈáå„ÄÇ<code>ÂÆûÈôÖ‰∏äÁΩë‰∏äËÆ∫ÂùõÁ≠âÊ∂âÂèäÁî®Êà∑ÂØÜÁ†ÅÁöÑÊï∞ÊçÆÂ∫ìÔºåÂ≠òÂÇ®ÁöÑÂØÜÁ†Å‰ø°ÊÅØÂ∑Æ‰∏çÂ§öÈÉΩÊòØÁî®Êà∑ÂØÜÁ†ÅÁöÑÂìàÂ∏åÂÄºÔºõÂê¶Âàô‰∏ÄÊó¶ÂèëÁîüÊï∞ÊçÆÂ∫ìÊ≥ÑÈú≤Á≠âÈóÆÈ¢òÔºåÂÖ•‰æµ‰∫∫ÂëòÂ∞ÜËÉΩÂ§üËΩªÊòìÂú∞Ëé∑ÂèñÂØÜÁ†ÅÂéüÊñá</code>„ÄÇ‰∏ç‰ªÖÂ¶ÇÊ≠§ÔºåÂΩìÁî®Êà∑ÁôªÂΩïÁΩëÁ´ôÁöÑÊó∂ÂÄôÔºåÁΩëÁªúËÆ∫ÂùõÁ≠âÂ∫îÁî®Á®ãÂ∫èÊ£ÄÈ™åÁöÑ‰πü‰∏çÊòØÂØÜÁ†ÅÂéüÊñáÔºåÂÆÉ‰ª¨Ê£ÄÈ™åÁöÑËøòÊòØÂØÜÁ†ÅÂìàÂ∏åÂÄºÔºöÂ¶ÇÊûúÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅÂìàÂ∏åÂÄº‰∏éÊï∞ÊçÆÂ∫ìÈáåÁöÑËÆ∞ÂΩïÂåπÈÖçÔºåÂÆÉÂ∞ÜÊéà‰∫àÁôªÂΩïÁî®Êà∑Áõ∏Â∫îÁöÑËÆøÈóÆÊùÉÈôê„ÄÇÂè¶Â§ñÔºå<code>Â∏∏ËßÅÁöÑÂØÜÁ†ÅÁ†¥Ëß£Â∑•ÂÖ∑ÈÄöÂ∏∏ÈÉΩÊòØÈÄöËøáÁ©∑‰∏æÂØÜÁ†ÅÁöÑÊñπÊ≥ïÔºåÊü•ÊâæÁ¨¶ÂêàÂØÜÁ†ÅÂìàÂ∏åÂÄºÁöÑÂØÜÁ†ÅÂéüÊñáËÄåÂ∑≤</code>„ÄÇÂÖ∂‰ªñÁ±ªÂûãÁöÑÂØÜÁ†ÅÁ†¥Ëß£Â∑•ÂÖ∑Â∞±Ë¶ÅÂ§çÊùÇÂæóÂ§ö„ÄÇ</li>
</ul>
<hr />
<ul>
<li>ÂçïÂêëÂáΩÊï∞Ôºàone-way functionÔºâ)ÊòØ‰∏ÄÁßçÂÖ∑Êúâ‰∏ãËø∞ÁâπÁÇπÁöÑÂçïÂ∞ÑÂáΩÊï∞ÔºöÂØπ‰∫éÊØè‰∏Ä‰∏™ËæìÂÖ•ÔºåÂáΩÊï∞ÂÄºÈÉΩÂÆπÊòìËÆ°ÁÆóÔºàÂ§öÈ°πÂºèÊó∂Èó¥ÔºâÔºõ‰ΩÜÊòØÊ†πÊçÆÂáΩÊï∞ÂÄºÂØπÂéüÂßãËæìÂÖ•ËøõË°åÈÄÜÂêëÊé®ÁÆóÂç¥ÊØîËæÉÂõ∞ÈöæÔºàÊó†Ê≥ïÂú®Â§öÈ°πÂºèÊó∂Èó¥ÂÜÖ‰ΩøÁî®Á°ÆÂÆöÊÄßÂõæÁÅµÊú∫ËÆ°ÁÆóÔºâ„ÄÇ</li>
</ul>
<h2 id="part4-‰∏Ä‰∫õÈ´òÁ∫ßÁöÑ‰æãÂ≠ê"><a class="markdownIt-Anchor" href="#part4-‰∏Ä‰∫õÈ´òÁ∫ßÁöÑ‰æãÂ≠ê"></a> Part.4 ‰∏Ä‰∫õÈ´òÁ∫ßÁöÑ‰æãÂ≠ê</h2>
<h3 id="chap35-Ê∏©Â∫¶ËΩ¨Êç¢"><a class="markdownIt-Anchor" href="#chap35-Ê∏©Â∫¶ËΩ¨Êç¢"></a> Chap35 Ê∏©Â∫¶ËΩ¨Êç¢</h3>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mo>=</mo><mfrac><mrow><mn>5</mn><mo>‚àó</mo><mo stretchy="false">(</mo><mi>F</mi><mo>‚àí</mo><mn>32</mn><mo stretchy="false">)</mo></mrow><mn>9</mn></mfrac></mrow><annotation encoding="application/x-tex">C=\frac{5*(F-32)}{9}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">9</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">‚àó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>ËøôÊòØ‰ªéÂçéÊ∞èÂ∫¶ËΩ¨Êç¢ÊàêÊëÑÊ∞èÂ∫¶ÁöÑËÆ°ÁÆóÂÖ¨ÂºèÔºåÂÜçÂä†‰∏ä‰∏Ä‰∫õÁÆÄÂçïÁöÑÂá∫ÈîôÂ§ÑÁêÜ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">int</span> celsius<span class="token punctuation">,</span> fahr<span class="token punctuation">;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Enter temperature in Fahrenheit:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">scanf</span> <span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fahr<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
                    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Error while parsing your input\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

          celsius <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fahr<span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">9</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>celsius<span class="token operator">&lt;</span><span class="token operator">-</span><span class="token number">273</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
                    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Error: incorrect temperature!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Celsius: %d\n"</span><span class="token punctuation">,</span> celsius<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>x86 ÊûÑÊû∂‰∏ãmsvs 2012‰ºòÂåñ</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG4228 DB      <span class="token string">'Enter temperature in Fahrenheit:'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4230 DB      <span class="token string">'%d'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4231 DB      <span class="token string">'Error while parsing your input'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4233 DB      <span class="token string">'Error: incorrect temperature!'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4234 DB      <span class="token string">'Celsius: %d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

_fahr<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>                                            <span class="token comment">; size = 4</span>
_main   PROC
        push    <span class="token register variable">ecx</span>
        push    <span class="token register variable">esi</span>
        mov     <span class="token register variable">esi</span>, DWORD PTR __imp__printf
        push    OFFSET <span class="token operator">$</span>SG4228            <span class="token comment">; 'Enter temperature in Fahrenheit:'</span>
        call    <span class="token register variable">esi</span>                       <span class="token comment">; call printf()</span>
        lea     <span class="token register variable">eax</span>, DWORD PTR _fahr<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
        push    <span class="token register variable">eax</span>
        push    OFFSET <span class="token operator">$</span>SG4230            <span class="token comment">; '%d'</span>
        call    DWORD PTR __imp__scanf
        add     <span class="token register variable">esp</span>, <span class="token number">12</span>                                <span class="token comment">; 0000000cH</span>
        cmp     <span class="token register variable">eax</span>, <span class="token number">1</span>
        je      SHORT <span class="token operator">$</span>LN2@main
        push    OFFSET <span class="token operator">$</span>SG4231             <span class="token comment">; 'Error while parsing your input'</span>
        call    <span class="token register variable">esi</span>                        <span class="token comment">; call printf()</span>
        add     <span class="token register variable">esp</span>, <span class="token number">4</span>
        push    <span class="token number">0</span>
        call    DWORD PTR __imp__exit
<span class="token label function">$LN9@main:</span>
<span class="token label function">$LN2@main:</span>
        mov    <span class="token register variable">eax</span>, DWORD PTR _fahr<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
        add    <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">32</span>                                 <span class="token comment">; ffffffe0H</span>
        lea    <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
        mov    <span class="token register variable">eax</span>, <span class="token number">954437177</span>                           <span class="token comment">; 38e38e39H</span>
        imul   <span class="token register variable">ecx</span>
        sar    <span class="token register variable">edx</span>, <span class="token number">1</span>
        mov    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
        shr    <span class="token register variable">eax</span>, <span class="token number">31</span>                                  <span class="token comment">; 0000001fH</span>
        add    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>  			<span class="token comment">;eax/9</span>
        cmp    <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">273</span>                                <span class="token comment">; fffffeefH</span>
        jge    SHORT <span class="token operator">$</span>LN1@main
        push   OFFSET <span class="token operator">$</span>SG4233             <span class="token comment">; 'Error: incorrect temperature!'</span>
        call   <span class="token register variable">esi</span>                        <span class="token comment">; call printf()</span>
        add    <span class="token register variable">esp</span>, <span class="token number">4</span>
        push   <span class="token number">0</span>
        call   DWORD PTR __imp__exit
<span class="token label function">$LN10@main:</span>
<span class="token label function">$LN1@main:</span>
        push   <span class="token register variable">eax</span>
        push   OFFSET <span class="token operator">$</span>SG4234             <span class="token comment">; 'Celsius: %d'</span>
        call   <span class="token register variable">esi</span>                        <span class="token comment">; call printf()</span>
        add    <span class="token register variable">esp</span>, <span class="token number">8</span>
        <span class="token comment">; return 0 - by C99 standard</span>
        xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        pop    <span class="token register variable">esi</span>
        pop    <span class="token register variable">ecx</span>
        ret    <span class="token number">0</span>
<span class="token label function">$LN8@main:</span>
_main   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Á®ãÂ∫èÈ¶ñÂÖàÊää<code>printf()</code>ÂáΩÊï∞ÁöÑÂÜÖÂ≠òÂú∞ÂùÄ‰øùÂ≠òÂà∞<code>ESI</code>ÂØÑÂ≠òÂô®,Êñπ‰æøÂêéÁª≠Ë∞ÉÁî®</li>
<li>‰ΩøÁî®Âä†Ê≥ï<code>ADD EAX,-32</code>Êù•‰ª£ÊõøÂáèÊ≥ï</li>
<li>ËøôÈáåÁî®‰πòÊ≥ïÊù•‰ª£Êõø‰∫ÜÈô§9ÔºåÂèØ‰ª•ÊèêÈ´òÊïàÁéáÔºåÂèÇËßÅchap41</li>
<li>Â¶ÇÊûú‰∏ªÂáΩÊï∞<code>main()</code>Ê≤°ÊúâÊòéÁ°ÆÁöÑËøîÂõûÂÄºÔºåÂú®Á®ãÂ∫èÈÄÄÂá∫Êó∂ÈªòËÆ§‰∏∫0</li>
</ul>
<hr />
<p><code>x64 ÊûÑÊû∂‰∏ãÁöÑmsvs2012‰ºòÂåñ</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">xor      <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>
call     QWORD PTR __imp_exit
int      <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Âú®x64‰∏≠ÔºåÊØèÊ¨°Ë∞ÉÁî®<code>exit()</code>ÂáΩÊï∞‰πãÂêéÈÉΩÊúâ‰∏Ä‰∏™<code>int 3</code>Êåá‰ª§</p>
<p><code>INT 3</code>ÊòØË∞ÉËØïÂô®debuggerÁöÑÊñ≠ÁÇπËÆæÁΩÆÊåá‰ª§„ÄÇ</p>
<p><em>ÂΩìÁ®ãÂ∫èÊâßË°åexit()ÂáΩÊï∞‰πãÂêéÔºåÂÆÉÂ∞±‰∏ç‰ºöÂÜçËøîÂõûÂà∞ÂéüÁ®ãÂ∫èÔºåËÄåÊòØÁõ¥Êé•ÈÄÄÂá∫‰∫Ü„ÄÇÁºñËØëÂô®Â§ßÊ¶ÇËÆ§‰∏∫ÔºåÂú®ÂèëÁîüÂºÇÂ∏∏ÈÄÄÂá∫ÁöÑÊÉÖÂÜµ‰∏ãÔºåÈÄöÂ∏∏‰∫∫‰ª¨Â∫îÂΩì‰ΩøÁî®Ë∞ÉËØïÂô®ÂàÜÊûêÂºÇÂ∏∏ÊÉÖÂÜµÂêß„ÄÇ</em></p>
<hr />
<p><code>ÊµÆÁÇπÊï∞ËøêÁÆó</code></p>
<p>Â∞Ü‰ª•‰∏ä‰ª£Á†ÅÊîπ‰∏∫ÊµÆÁÇπÊï∞ËÆ°ÁÆóÁâàÊú¨</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">double</span> celsius<span class="token punctuation">,</span> fahr<span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Enter temperature in Fahrenheit:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">scanf</span> <span class="token punctuation">(</span><span class="token string">"%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fahr<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Error while parsing your input\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

         celsius <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fahr<span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">9</span><span class="token punctuation">;</span>

         <span class="token keyword">if</span> <span class="token punctuation">(</span>celsius<span class="token operator">&lt;</span><span class="token operator">-</span><span class="token number">273</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Error: incorrect temperature!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Celsius: %lf\n"</span><span class="token punctuation">,</span> celsius<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs 2010 x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG4038 DB     <span class="token string">'Enter temperature in Fahrenheit:'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4040 DB     <span class="token string">'%lf'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4041 DB     <span class="token string">'Error while parsing your input'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4043 DB     <span class="token string">'Error: incorrect temperature!'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4044 DB     <span class="token string">'Celsius: %lf'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

__real@c071100000000000 DQ 0c071100000000000r     <span class="token comment">; -273</span>
__real@<span class="token number">4022000000000000</span> DQ 04022000000000000r     <span class="token comment">; 9</span>
__real@<span class="token number">4014000000000000</span> DQ 04014000000000000r     <span class="token comment">; 5</span>
__real@<span class="token number">4040000000000000</span> DQ 04040000000000000r     <span class="token comment">; 32</span>

_fahr<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span>                                       <span class="token comment">; size = 8</span>
_main PROC
      sub     <span class="token register variable">esp</span>, <span class="token number">8</span>
      push    <span class="token register variable">esi</span>
      mov     <span class="token register variable">esi</span>, DWORD PTR __imp__printf
      push    OFFSET <span class="token operator">$</span>SG4038          <span class="token comment">; 'Enter temperature in Fahrenheit:'</span>
      call    <span class="token register variable">esi</span>                     <span class="token comment">; call printf()</span>
      lea     <span class="token register variable">eax</span>, DWORD PTR _fahr<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span><span class="token comment">;eax=fahr</span>
      push    <span class="token register variable">eax</span>
      push    OFFSET <span class="token operator">$</span>SG4040          <span class="token comment">; '%lf'</span>
      call    DWORD PTR __imp__scanf
      add     <span class="token register variable">esp</span>, <span class="token number">12</span>                                    <span class="token comment">; 0000000cH</span>
      cmp     <span class="token register variable">eax</span>, <span class="token number">1</span>
      je      SHORT <span class="token operator">$</span>LN2@main
      push    OFFSET <span class="token operator">$</span>SG4041          <span class="token comment">; 'Error while parsing your input'</span>
      call    <span class="token register variable">esi</span>                     <span class="token comment">; call printf()</span>
      add     <span class="token register variable">esp</span>, <span class="token number">4</span>
      push    <span class="token number">0</span>
      call    DWORD PTR __imp__exit
<span class="token label function">$LN2@main:</span>
      fld     QWORD PTR _fahr<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span><span class="token comment">;st[0]=fahr</span>
      fsub    QWORD PTR __real@<span class="token number">4040000000000000</span> <span class="token comment">; 32</span>
      fmul    QWORD PTR __real@<span class="token number">4014000000000000</span> <span class="token comment">; 5</span>
      fdiv    QWORD PTR __real@<span class="token number">4022000000000000</span> <span class="token comment">; 9</span>
      fld     QWORD PTR __real@c071100000000000 <span class="token comment">; -273</span>
      fcomp   ST(<span class="token number">1</span>)<span class="token comment">;ÊØîËæÉst[0] [1]</span>
      fnstsw  <span class="token register variable">ax</span>
      test    <span class="token register variable">ah</span>, <span class="token number">65</span>                                     <span class="token comment">; 00000041H</span>
      jne     SHORT <span class="token operator">$</span>LN1@main
      push    OFFSET <span class="token operator">$</span>SG4043         <span class="token comment">; 'Error: incorrect temperature!'</span>
      fstp    ST(<span class="token number">0</span>)
      call    <span class="token register variable">esi</span>                    <span class="token comment">; call printf()</span>
      add     <span class="token register variable">esp</span>, <span class="token number">4</span>
      push    <span class="token number">0</span>
      call    DWORD PTR __imp__exit
<span class="token label function">$LN1@main:</span>
      sub     <span class="token register variable">esp</span>, <span class="token number">8</span>
      fstp    QWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
      push    OFFSET <span class="token operator">$</span>SG4044         <span class="token comment">; 'Celsius: %lf'</span>
      call    <span class="token register variable">esi</span>
      add     <span class="token register variable">esp</span>, <span class="token number">12</span>                                    <span class="token comment">; 0000000cH</span>
      <span class="token comment">; return 0 - by C99 standard</span>
      xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
      pop     <span class="token register variable">esi</span>
      add     <span class="token register variable">esp</span>, <span class="token number">8</span>
      ret     <span class="token number">0</span>
<span class="token label function">$LN10@main:</span>
_main ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>fcomp ST(1)</code>‰∏é<code>cmp</code>Á±ª‰ººÔºåST(1)ÂíåST(0)ÊØîËæÉÂêé‰ºöËÆæÁΩÆ<code>status word</code></p>
<p><code>test ah 65‰∏éjneÁªìÂêà</code>ÂèØ‰ª•ËææÂà∞Âà§Êñ≠<code>&gt;=</code>ÁöÑÊÉÖÂÜµ</p>
</li>
</ul>
<hr />
<p>ÁÑ∂ËÄå<code>MSVS 2012</code>ÂàÜÈÖçÁöÑÂç¥ÊòØ<code>SIMD</code>Êåá‰ª§</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG4228 DB      <span class="token string">'Enter temperature in Fahrenheit:'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4230 DB      <span class="token string">'%lf'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4231 DB      <span class="token string">'Error while parsing your input'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4233 DB      <span class="token string">'Error: incorrect temperature!'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG4234 DB      <span class="token string">'Celsius: %lf'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>
__real@c071100000000000 DQ 0c071100000000000r   <span class="token comment">; -273</span>
__real@<span class="token number">4040000000000000</span> DQ 04040000000000000r   <span class="token comment">; 32</span>
__real@<span class="token number">4022000000000000</span> DQ 04022000000000000r   <span class="token comment">; 9</span>
__real@<span class="token number">4014000000000000</span> DQ 04014000000000000r   <span class="token comment">; 5</span>

_fahr<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span>                                         <span class="token comment">; size = 8</span>
_main    PROC
         sub     <span class="token register variable">esp</span>, <span class="token number">8</span>
         push    <span class="token register variable">esi</span>
         mov     <span class="token register variable">esi</span>, DWORD PTR __imp__printf
         push    OFFSET <span class="token operator">$</span>SG4228           <span class="token comment">; 'Enter temperature in Fahrenheit:'</span>
         call    <span class="token register variable">esi</span>                      <span class="token comment">; call printf()</span>
         lea     <span class="token register variable">eax</span>, DWORD PTR _fahr<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>
         push    <span class="token register variable">eax</span>
         push    OFFSET <span class="token operator">$</span>SG4230           <span class="token comment">; '%lf'</span>
         call    DWORD PTR __imp__scanf
         add     <span class="token register variable">esp</span>, <span class="token number">12</span>                             <span class="token comment">; 0000000cH</span>
         cmp     <span class="token register variable">eax</span>, <span class="token number">1</span>
         je      SHORT <span class="token operator">$</span>LN2@main
         push    OFFSET <span class="token operator">$</span>SG4231           <span class="token comment">; 'Error while parsing your input'</span>
         call    <span class="token register variable">esi</span>                      <span class="token comment">; call printf()</span>
         add     <span class="token register variable">esp</span>, <span class="token number">4</span>
         push    <span class="token number">0</span>
         call    DWORD PTR __imp__exit
<span class="token label function">$LN9@main:</span>
<span class="token label function">$LN2@main:</span>
         movsd   <span class="token register variable">xmm1</span>, QWORD PTR _fahr<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
         subsd   <span class="token register variable">xmm1</span>, QWORD PTR __real@<span class="token number">4040000000000000</span> <span class="token comment">; 32</span>
         movsd   <span class="token register variable">xmm0</span>, QWORD PTR __real@c071100000000000 <span class="token comment">; -273</span>
         mulsd   <span class="token register variable">xmm1</span>, QWORD PTR __real@<span class="token number">4014000000000000</span> <span class="token comment">; 5</span>
         divsd   <span class="token register variable">xmm1</span>, QWORD PTR __real@<span class="token number">4022000000000000</span> <span class="token comment">; 9</span>
         comisd  <span class="token register variable">xmm0</span>, <span class="token register variable">xmm1</span>
         jbe     SHORT <span class="token operator">$</span>LN1@main
         push    OFFSET <span class="token operator">$</span>SG4233           <span class="token comment">; 'Error: incorrect temperature!'</span>
         call    <span class="token register variable">esi</span>                      <span class="token comment">; call printf()</span>
         add     <span class="token register variable">esp</span>, <span class="token number">4</span>
         push    <span class="token number">0</span>
         call    DWORD PTR __imp__exit
<span class="token label function">$LN10@main:</span>
<span class="token label function">$LN1@main:</span>
         sub     <span class="token register variable">esp</span>, <span class="token number">8</span>
         movsd   QWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">xmm1</span>
         push    OFFSET <span class="token operator">$</span>SG4234           <span class="token comment">; 'Celsius: %lf'</span>
         call    <span class="token register variable">esi</span>                      <span class="token comment">; call printf()</span>
         add     <span class="token register variable">esp</span>, <span class="token number">12</span>                                <span class="token comment">; 0000000cH</span>
         <span class="token comment">; return 0 - by C99 standard</span>
         xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
         pop     <span class="token register variable">esi</span>
         add     <span class="token register variable">esp</span>, <span class="token number">8</span>
         ret     <span class="token number">0</span>
<span class="token label function">$LN8@main:</span>
_main ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ËøôÈáåÊØîËæÉÁÆÄÂçïÔºåÂ∞±ÊòØÊää<code>xmm1</code>ÂΩìÂÅö‰∏Ä‰∏™ÊôÆÈÄöÁöÑÂØÑÂ≠òÂô®(ÂèØ‰ª•ÁúãÂÅöÊòØÂ§ö‰∏™fpu)Â∞±ÂèØ‰ª•‰∫Ü</p>
<p>x86ÁöÑÊåá‰ª§ÈõÜÁ°ÆÂÆûÊîØÊåÅSIMDÊåá‰ª§ÔºåÊµÆÁÇπÊï∞ËøêÁÆó‰πüÊØ´Êó†ÈóÆÈ¢ò„ÄÇÂ§ßÊ¶ÇÊòØËøôÁßçÊñπÂºèÁöÑËÆ°ÁÆóÊåá‰ª§ÊØîËæÉÁÆÄÂçïÔºåÊâÄ‰ª•ÂæÆËΩØÁöÑÁºñËØëÂô®ÂàÜÈÖç‰∫ÜSIMDÊåá‰ª§„ÄÇ</p>
</li>
</ul>
<h3 id="chap36-ÊñêÊ≥¢ÈÇ£Â•ëÊï∞Âàó"><a class="markdownIt-Anchor" href="#chap36-ÊñêÊ≥¢ÈÇ£Â•ëÊï∞Âàó"></a> Chap36 ÊñêÊ≥¢ÈÇ£Â•ëÊï∞Âàó</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">fib</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> limit<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">+</span>b <span class="token operator">></span> limit<span class="token punctuation">)</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token function">fib</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token operator">+</span>b<span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"0\n1\n1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">fib</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs 2010 x86 asm</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_TEXT    SEGMENT
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>         <span class="token comment">; size = 4</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>        <span class="token comment">; size = 4</span>
_limit<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>    <span class="token comment">; size = 4</span>
_fib    PROC<span class="token comment">;fib(a,b)</span>
        push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">;eax=a</span>
        add     <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">;eax=a+b</span>
        push    <span class="token register variable">eax</span><span class="token comment">;a+b,ÂÖ•Ê†à</span>
        push    OFFSET <span class="token operator">$</span>SG2750 <span class="token comment">; "%d"</span>
        call    DWORD PTR __imp__printf
        add     <span class="token register variable">esp</span>, <span class="token number">8</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _limit<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">;ecx=limits</span>
        push    <span class="token register variable">ecx</span>
        mov     <span class="token register variable">edx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        add     <span class="token register variable">edx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
        push    <span class="token register variable">edx</span><span class="token comment">;a+bÂÖ•Ê†à</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span><span class="token comment">;eax=b</span>
        push    <span class="token register variable">eax</span>
        call    _fib,fib(b,a<span class="token operator">+</span>b)
        add     <span class="token register variable">esp</span>, <span class="token number">12</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_fib    ENDP

_main   PROC
        push    <span class="token register variable">ebp</span>
        mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
        push    OFFSET <span class="token operator">$</span>SG2753 <span class="token comment">; "0\n1\n1\n"</span>
        call    DWORD PTR __imp__printf
        add     <span class="token register variable">esp</span>, <span class="token number">4</span>
        push    <span class="token number">20</span>
        push    <span class="token number">1</span>
        push    <span class="token number">1</span>
        call    _fib
        add     <span class="token register variable">esp</span>, <span class="token number">12</span>
        xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
        pop     <span class="token register variable">ebp</span>
        ret     <span class="token number">0</span>
_main   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p>ÂàÜÊûêÊ†àÈáåÁöÑÂÜÖÂÆπ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">0035F940     00FD1039   RETURN to fib.00FD1039 from fib.00FD1000
0035F944     <span class="token number">00000008</span>   1st argument: a
0035F948     <span class="token number">0000000D</span>   2nd argument: b
0035F94C     <span class="token number">00000014</span>   3rd argument: limit
0035F950    <span class="token operator">/</span>0035F964   saved <span class="token register variable">EBP</span> register
0035F954    <span class="token operator">|</span>00FD1039   RETURN to fib.00FD1039 from fib.00FD1000
0035F958    <span class="token operator">|</span><span class="token number">00000005</span>   1st argument: a
0035F95C    <span class="token operator">|</span><span class="token number">00000008</span>   2nd argument: b
0035F960    <span class="token operator">|</span><span class="token number">00000014</span>   3rd argument: limit
0035F964    <span class="token operator">]</span>0035F978   saved <span class="token register variable">EBP</span> register
0035F968    <span class="token operator">|</span>00FD1039   RETURN to fib.00FD1039 from fib.00FD1000
0035F96C    <span class="token operator">|</span><span class="token number">00000003</span>   1st argument: a
0035F970    <span class="token operator">|</span><span class="token number">00000005</span>   2nd argument: b
0035F974    <span class="token operator">|</span><span class="token number">00000014</span>   3rd argument: limit
0035F978    <span class="token operator">]</span>0035F98C   saved <span class="token register variable">EBP</span> register
0035F97C    <span class="token operator">|</span>00FD1039   RETURN to fib.00FD1039 from fib.00FD1000
0035F980    <span class="token operator">|</span><span class="token number">00000002</span>   1st argument: a
0035F984    <span class="token operator">|</span><span class="token number">00000003</span>   2nd argument: b
0035F988    <span class="token operator">|</span><span class="token number">00000014</span>   3rd argument: limit
0035F98C    <span class="token operator">]</span>0035F9A0   saved <span class="token register variable">EBP</span> register
0035F990    <span class="token operator">|</span>00FD1039   RETURN to fib.00FD1039 from fib.00FD1000
0035F994    <span class="token operator">|</span><span class="token number">00000001</span>   1st argument: a
0035F998    <span class="token operator">|</span><span class="token number">00000002</span>   2nd argument: b
0035F99C    <span class="token operator">|</span><span class="token number">00000014</span>   3rd argument: limit
0035F9A0    <span class="token operator">]</span>0035F9B4   saved <span class="token register variable">EBP</span> register
0035F9A4    <span class="token operator">|</span>00FD105C   RETURN to fib.00FD105C from fib.00FD1000
0035F9A8    <span class="token operator">|</span><span class="token number">00000001</span>   1st argument: a              \
0035F9AC    <span class="token operator">|</span><span class="token number">00000001</span>   2nd argument: b              <span class="token operator">|</span> prepared in main() for f1()
0035F9B0    <span class="token operator">|</span><span class="token number">00000014</span>   3rd argument: limit         <span class="token operator">/</span>
0035F9B4    <span class="token operator">]</span>0035F9F8   saved <span class="token register variable">EBP</span> register
0035F9B8    <span class="token operator">|</span>00FD11D0   RETURN to fib.00FD11D0 from fib.00FD1040
0035F9BC    <span class="token operator">|</span><span class="token number">00000001</span>   main() 1st argument: argc  \
0035F9C0    <span class="token operator">|</span>006812C8   main() 2nd argument: argv  <span class="token operator">|</span> prepared in CRT for main()
0035F9C4    <span class="token operator">|</span><span class="token number">00682940</span>   main() 3rd argument: envp  <span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Êú¨‰æãÂ±û‰∫éÈÄíÂΩíÂáΩÊï∞„ÄÇÈÄíÂΩíÂáΩÊï∞ÁöÑÊ†à‰∏ÄËà¨ÊòØËøôÊ†∑ÁöÑ&quot;‰∏âÊòéÊ≤ªÁªìÊûÑ&quot;</li>
<li>Ê†àÁöÑÊúÄÂ∫ïÈÉ®,‰∏Ä‰∏™ÊòØ<code>main()</code>‰∏∫<code>f1()</code>‰ΩúÂáÜÂ§áÔºåÂè¶Â§ñ‰∏Ä‰∏™ÊòØ<code>CRT</code>‰∏∫<code>main()</code>ÂÅöÂáÜÂ§á</li>
<li>Âú®‰∏äËø∞Á®ãÂ∫è‰∏≠ÔºålimitÔºàÈòàÂÄºÔºâÂèÇÊï∞ÊÄªÊòØ‰øùÊåÅ‰∏çÂèòÔºàÂçÅÂÖ≠ËøõÂà∂ÁöÑ14Ôºå‰πüÂ∞±ÊòØÂçÅËøõÂà∂ÁöÑ20ÔºâÔºåËÄå‰∏§‰∏™ÂèÇÊï∞<em>a</em>Âíå<em>b</em>Âú®ÊØèÊ¨°Ë∞ÉÁî®ÂáΩÊï∞ÁöÑÊó∂ÂÄôÈÉΩÊòØ‰∏çÂêåÁöÑÂÄº„ÄÇ</li>
<li>Ê≠§Â§ñÊ†à‰πüÂ≠òÂÇ®‰∫ÜRAÂíå‰øùÂ≠òEBPÔºàÊâ©Â±ïÂ†ÜÊ†àÊåáÈíàÔºâÁöÑÂÄº„ÄÇOllyDbgËÉΩÂü∫‰∫éEBPÁöÑÂÄºÂà§Êñ≠Ê†àÁöÑÂ≠òÂÇ®ÁªìÊûÑÔºåÂõ†Ê≠§ÂÆÉËÉΩÂ§üÁî®Êã¨ÂºßÊ†áÊ≥®Ê†àÂ∏ß„ÄÇÊç¢ËÄåË®Ä‰πãÔºåÂú®ÊØè‰∏™Êã¨ÂºßÈáåÁöÑ‰∏ÄÁªÑÊï∞ÂÄºÈÉΩÂΩ¢Êàê‰∫Ü‰∏Ä‰∏™Áõ∏ÂØπÁã¨Á´ãÁöÑÊ†àÁªìÊûÑÔºåÂç≥Ê†àÂ∏ßÔºàstack frameÔºâ„ÄÇÊ†àÂ∏ßÂ∞±ÊòØÊØèÊ¨°ÂáΩÊï∞Ë∞ÉÁî®ÊúüÈó¥ÁöÑÊï∞ÊçÆÂÆû‰Ωì„ÄÇ</li>
<li>Âè¶‰∏ÄÊñπÈù¢ÔºåÂç≥‰Ωø‰ªéÊäÄÊúØÊñπÈù¢ÁúãÊØè‰∏™Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞Á°ÆÂÆûÂèØ‰ª•ËÆøÈóÆÊ†àÂ∏ß‰πãÂ§ñÁöÑÊ†àÂ≠òÂÇ®Á©∫Èó¥Ôºå‰ΩÜÊòØÊ≠£Â∏∏ÊÉÖÂÜµ‰∏ã‰∏çÂ∫îÂΩìËÆøÈóÆÊ†àÂ∏ß‰πãÂ§ñÁöÑÊï∞ÊçÆÔºàÂΩìÁÑ∂Èô§‰∫ÜËé∑ÂèñÂáΩÊï∞ÂèÇÊï∞ÁöÑÊìç‰Ωú‰ª•Â§ñÔºâ„ÄÇÂØπ‰∫éÊ≤°ÊúâbugÔºàÁº∫Èô∑ÔºâÁöÑÂáΩÊï∞Êù•ËØ¥Ôºå‰∏äËø∞ÂëΩÈ¢òÁöÑÁ°ÆÊàêÁ´ã„ÄÇÊØè‰∏Ä‰∏™ EBPÂÄºÈÉΩÊòØÂâç‰∏Ä‰∏™Ê†àÂ∏ßÁöÑÂú∞ÂùÄ„ÄÇÂõ†Ê≠§Ë∞ÉËØïÁ®ãÂ∫èËÉΩÂ§üÊääÊï∞ÊçÆÊ†àËØÜÂà´‰∏∫Ê†àÂ∏ßÔºåÂπ∂ËÉΩËØÜÂà´Âá∫ÊØèÊ¨°Ë∞ÉÁî®ÂáΩÊï∞Êó∂‰º†ÈÄíÁöÑÂèÇÊï∞ÂÄº„ÄÇ</li>
<li><code>Á®ãÂ∫èÁöÑÊúÄÂêéÈÉ®ÂàÜÔºåmain()Êúâ3‰∏™ÂèÇÊï∞„ÄÇÂÖ∂‰∏≠argcÔºàÂèÇÊï∞ÊÄªÊï∞Ôºâ‰∏∫1</code></li>
</ul>
<h3 id="chap37-crc32"><a class="markdownIt-Anchor" href="#chap37-crc32"></a> Chap37 CRC32</h3>
<p>ËøôÊòØ‰∏Ä‰∏™Âü∫‰∫éË°®Êü•ËØ¢ÊäÄÊúØÂÆûÁé∞ÁöÑ<code>CRC32</code>Ê†°È™åÂÄºÁöÑËÆ°ÁÆóÁ®ãÂ∫è:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* By Bob Jenkins, (c) 2006, Public Domain */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stddef.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">typedef</span>  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> ub4<span class="token punctuation">;</span>
<span class="token keyword">typedef</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> ub1<span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">const</span> ub4 crctab<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token number">0x00000000</span><span class="token punctuation">,</span> <span class="token number">0x77073096</span><span class="token punctuation">,</span> <span class="token number">0xee0e612c</span><span class="token punctuation">,</span> <span class="token number">0x990951ba</span><span class="token punctuation">,</span> <span class="token number">0x076dc419</span><span class="token punctuation">,</span> <span class="token number">0x706af48f</span><span class="token punctuation">,</span>
  <span class="token number">0xe963a535</span><span class="token punctuation">,</span> <span class="token number">0x9e6495a3</span><span class="token punctuation">,</span> <span class="token number">0x0edb8832</span><span class="token punctuation">,</span> <span class="token number">0x79dcb8a4</span><span class="token punctuation">,</span> <span class="token number">0xe0d5e91e</span><span class="token punctuation">,</span> <span class="token number">0x97d2d988</span><span class="token punctuation">,</span>
  <span class="token number">0x09b64c2b</span><span class="token punctuation">,</span> <span class="token number">0x7eb17cbd</span><span class="token punctuation">,</span> <span class="token number">0xe7b82d07</span><span class="token punctuation">,</span> <span class="token number">0x90bf1d91</span><span class="token punctuation">,</span> <span class="token number">0x1db71064</span><span class="token punctuation">,</span> <span class="token number">0x6ab020f2</span><span class="token punctuation">,</span>
  <span class="token number">0xf3b97148</span><span class="token punctuation">,</span> <span class="token number">0x84be41de</span><span class="token punctuation">,</span> <span class="token number">0x1adad47d</span><span class="token punctuation">,</span> <span class="token number">0x6ddde4eb</span><span class="token punctuation">,</span> <span class="token number">0xf4d4b551</span><span class="token punctuation">,</span> <span class="token number">0x83d385c7</span><span class="token punctuation">,</span>
  <span class="token number">0x136c9856</span><span class="token punctuation">,</span> <span class="token number">0x646ba8c0</span><span class="token punctuation">,</span> <span class="token number">0xfd62f97a</span><span class="token punctuation">,</span> <span class="token number">0x8a65c9ec</span><span class="token punctuation">,</span> <span class="token number">0x14015c4f</span><span class="token punctuation">,</span> <span class="token number">0x63066cd9</span><span class="token punctuation">,</span>
  <span class="token number">0xfa0f3d63</span><span class="token punctuation">,</span> <span class="token number">0x8d080df5</span><span class="token punctuation">,</span> <span class="token number">0x3b6e20c8</span><span class="token punctuation">,</span> <span class="token number">0x4c69105e</span><span class="token punctuation">,</span> <span class="token number">0xd56041e4</span><span class="token punctuation">,</span> <span class="token number">0xa2677172</span><span class="token punctuation">,</span>
  <span class="token number">0x3c03e4d1</span><span class="token punctuation">,</span> <span class="token number">0x4b04d447</span><span class="token punctuation">,</span> <span class="token number">0xd20d85fd</span><span class="token punctuation">,</span> <span class="token number">0xa50ab56b</span><span class="token punctuation">,</span> <span class="token number">0x35b5a8fa</span><span class="token punctuation">,</span> <span class="token number">0x42b2986c</span><span class="token punctuation">,</span>
  <span class="token number">0xdbbbc9d6</span><span class="token punctuation">,</span> <span class="token number">0xacbcf940</span><span class="token punctuation">,</span> <span class="token number">0x32d86ce3</span><span class="token punctuation">,</span> <span class="token number">0x45df5c75</span><span class="token punctuation">,</span> <span class="token number">0xdcd60dcf</span><span class="token punctuation">,</span> <span class="token number">0xabd13d59</span><span class="token punctuation">,</span>
  <span class="token number">0x26d930ac</span><span class="token punctuation">,</span> <span class="token number">0x51de003a</span><span class="token punctuation">,</span> <span class="token number">0xc8d75180</span><span class="token punctuation">,</span> <span class="token number">0xbfd06116</span><span class="token punctuation">,</span> <span class="token number">0x21b4f4b5</span><span class="token punctuation">,</span> <span class="token number">0x56b3c423</span><span class="token punctuation">,</span>
  <span class="token number">0xcfba9599</span><span class="token punctuation">,</span> <span class="token number">0xb8bda50f</span><span class="token punctuation">,</span> <span class="token number">0x2802b89e</span><span class="token punctuation">,</span> <span class="token number">0x5f058808</span><span class="token punctuation">,</span> <span class="token number">0xc60cd9b2</span><span class="token punctuation">,</span> <span class="token number">0xb10be924</span><span class="token punctuation">,</span>
  <span class="token number">0x2f6f7c87</span><span class="token punctuation">,</span> <span class="token number">0x58684c11</span><span class="token punctuation">,</span> <span class="token number">0xc1611dab</span><span class="token punctuation">,</span> <span class="token number">0xb6662d3d</span><span class="token punctuation">,</span> <span class="token number">0x76dc4190</span><span class="token punctuation">,</span> <span class="token number">0x01db7106</span><span class="token punctuation">,</span>
  <span class="token number">0x98d220bc</span><span class="token punctuation">,</span> <span class="token number">0xefd5102a</span><span class="token punctuation">,</span> <span class="token number">0x71b18589</span><span class="token punctuation">,</span> <span class="token number">0x06b6b51f</span><span class="token punctuation">,</span> <span class="token number">0x9fbfe4a5</span><span class="token punctuation">,</span> <span class="token number">0xe8b8d433</span><span class="token punctuation">,</span>
  <span class="token number">0x7807c9a2</span><span class="token punctuation">,</span> <span class="token number">0x0f00f934</span><span class="token punctuation">,</span> <span class="token number">0x9609a88e</span><span class="token punctuation">,</span> <span class="token number">0xe10e9818</span><span class="token punctuation">,</span> <span class="token number">0x7f6a0dbb</span><span class="token punctuation">,</span> <span class="token number">0x086d3d2d</span><span class="token punctuation">,</span>
  <span class="token number">0x91646c97</span><span class="token punctuation">,</span> <span class="token number">0xe6635c01</span><span class="token punctuation">,</span> <span class="token number">0x6b6b51f4</span><span class="token punctuation">,</span> <span class="token number">0x1c6c6162</span><span class="token punctuation">,</span> <span class="token number">0x856530d8</span><span class="token punctuation">,</span> <span class="token number">0xf262004e</span><span class="token punctuation">,</span>
  <span class="token number">0x6c0695ed</span><span class="token punctuation">,</span> <span class="token number">0x1b01a57b</span><span class="token punctuation">,</span> <span class="token number">0x8208f4c1</span><span class="token punctuation">,</span> <span class="token number">0xf50fc457</span><span class="token punctuation">,</span> <span class="token number">0x65b0d9c6</span><span class="token punctuation">,</span> <span class="token number">0x12b7e950</span><span class="token punctuation">,</span>
  <span class="token number">0x8bbeb8ea</span><span class="token punctuation">,</span> <span class="token number">0xfcb9887c</span><span class="token punctuation">,</span> <span class="token number">0x62dd1ddf</span><span class="token punctuation">,</span> <span class="token number">0x15da2d49</span><span class="token punctuation">,</span> <span class="token number">0x8cd37cf3</span><span class="token punctuation">,</span> <span class="token number">0xfbd44c65</span><span class="token punctuation">,</span>
  <span class="token number">0x4db26158</span><span class="token punctuation">,</span> <span class="token number">0x3ab551ce</span><span class="token punctuation">,</span> <span class="token number">0xa3bc0074</span><span class="token punctuation">,</span> <span class="token number">0xd4bb30e2</span><span class="token punctuation">,</span> <span class="token number">0x4adfa541</span><span class="token punctuation">,</span> <span class="token number">0x3dd895d7</span><span class="token punctuation">,</span>
  <span class="token number">0xa4d1c46d</span><span class="token punctuation">,</span> <span class="token number">0xd3d6f4fb</span><span class="token punctuation">,</span> <span class="token number">0x4369e96a</span><span class="token punctuation">,</span> <span class="token number">0x346ed9fc</span><span class="token punctuation">,</span> <span class="token number">0xad678846</span><span class="token punctuation">,</span> <span class="token number">0xda60b8d0</span><span class="token punctuation">,</span>
  <span class="token number">0x44042d73</span><span class="token punctuation">,</span> <span class="token number">0x33031de5</span><span class="token punctuation">,</span> <span class="token number">0xaa0a4c5f</span><span class="token punctuation">,</span> <span class="token number">0xdd0d7cc9</span><span class="token punctuation">,</span> <span class="token number">0x5005713c</span><span class="token punctuation">,</span> <span class="token number">0x270241aa</span><span class="token punctuation">,</span>
  <span class="token number">0xbe0b1010</span><span class="token punctuation">,</span> <span class="token number">0xc90c2086</span><span class="token punctuation">,</span> <span class="token number">0x5768b525</span><span class="token punctuation">,</span> <span class="token number">0x206f85b3</span><span class="token punctuation">,</span> <span class="token number">0xb966d409</span><span class="token punctuation">,</span> <span class="token number">0xce61e49f</span><span class="token punctuation">,</span>
  <span class="token number">0x5edef90e</span><span class="token punctuation">,</span> <span class="token number">0x29d9c998</span><span class="token punctuation">,</span> <span class="token number">0xb0d09822</span><span class="token punctuation">,</span> <span class="token number">0xc7d7a8b4</span><span class="token punctuation">,</span> <span class="token number">0x59b33d17</span><span class="token punctuation">,</span> <span class="token number">0x2eb40d81</span><span class="token punctuation">,</span>
  <span class="token number">0xb7bd5c3b</span><span class="token punctuation">,</span> <span class="token number">0xc0ba6cad</span><span class="token punctuation">,</span> <span class="token number">0xedb88320</span><span class="token punctuation">,</span> <span class="token number">0x9abfb3b6</span><span class="token punctuation">,</span> <span class="token number">0x03b6e20c</span><span class="token punctuation">,</span> <span class="token number">0x74b1d29a</span><span class="token punctuation">,</span>
  <span class="token number">0xead54739</span><span class="token punctuation">,</span> <span class="token number">0x9dd277af</span><span class="token punctuation">,</span> <span class="token number">0x04db2615</span><span class="token punctuation">,</span> <span class="token number">0x73dc1683</span><span class="token punctuation">,</span> <span class="token number">0xe3630b12</span><span class="token punctuation">,</span> <span class="token number">0x94643b84</span><span class="token punctuation">,</span>
  <span class="token number">0x0d6d6a3e</span><span class="token punctuation">,</span> <span class="token number">0x7a6a5aa8</span><span class="token punctuation">,</span> <span class="token number">0xe40ecf0b</span><span class="token punctuation">,</span> <span class="token number">0x9309ff9d</span><span class="token punctuation">,</span> <span class="token number">0x0a00ae27</span><span class="token punctuation">,</span> <span class="token number">0x7d079eb1</span><span class="token punctuation">,</span>
  <span class="token number">0xf00f9344</span><span class="token punctuation">,</span> <span class="token number">0x8708a3d2</span><span class="token punctuation">,</span> <span class="token number">0x1e01f268</span><span class="token punctuation">,</span> <span class="token number">0x6906c2fe</span><span class="token punctuation">,</span> <span class="token number">0xf762575d</span><span class="token punctuation">,</span> <span class="token number">0x806567cb</span><span class="token punctuation">,</span>
  <span class="token number">0x196c3671</span><span class="token punctuation">,</span> <span class="token number">0x6e6b06e7</span><span class="token punctuation">,</span> <span class="token number">0xfed41b76</span><span class="token punctuation">,</span> <span class="token number">0x89d32be0</span><span class="token punctuation">,</span> <span class="token number">0x10da7a5a</span><span class="token punctuation">,</span> <span class="token number">0x67dd4acc</span><span class="token punctuation">,</span>
  <span class="token number">0xf9b9df6f</span><span class="token punctuation">,</span> <span class="token number">0x8ebeeff9</span><span class="token punctuation">,</span> <span class="token number">0x17b7be43</span><span class="token punctuation">,</span> <span class="token number">0x60b08ed5</span><span class="token punctuation">,</span> <span class="token number">0xd6d6a3e8</span><span class="token punctuation">,</span> <span class="token number">0xa1d1937e</span><span class="token punctuation">,</span>
  <span class="token number">0x38d8c2c4</span><span class="token punctuation">,</span> <span class="token number">0x4fdff252</span><span class="token punctuation">,</span> <span class="token number">0xd1bb67f1</span><span class="token punctuation">,</span> <span class="token number">0xa6bc5767</span><span class="token punctuation">,</span> <span class="token number">0x3fb506dd</span><span class="token punctuation">,</span> <span class="token number">0x48b2364b</span><span class="token punctuation">,</span>
  <span class="token number">0xd80d2bda</span><span class="token punctuation">,</span> <span class="token number">0xaf0a1b4c</span><span class="token punctuation">,</span> <span class="token number">0x36034af6</span><span class="token punctuation">,</span> <span class="token number">0x41047a60</span><span class="token punctuation">,</span> <span class="token number">0xdf60efc3</span><span class="token punctuation">,</span> <span class="token number">0xa867df55</span><span class="token punctuation">,</span>
  <span class="token number">0x316e8eef</span><span class="token punctuation">,</span> <span class="token number">0x4669be79</span><span class="token punctuation">,</span> <span class="token number">0xcb61b38c</span><span class="token punctuation">,</span> <span class="token number">0xbc66831a</span><span class="token punctuation">,</span> <span class="token number">0x256fd2a0</span><span class="token punctuation">,</span> <span class="token number">0x5268e236</span><span class="token punctuation">,</span>
  <span class="token number">0xcc0c7795</span><span class="token punctuation">,</span> <span class="token number">0xbb0b4703</span><span class="token punctuation">,</span> <span class="token number">0x220216b9</span><span class="token punctuation">,</span> <span class="token number">0x5505262f</span><span class="token punctuation">,</span> <span class="token number">0xc5ba3bbe</span><span class="token punctuation">,</span> <span class="token number">0xb2bd0b28</span><span class="token punctuation">,</span>
  <span class="token number">0x2bb45a92</span><span class="token punctuation">,</span> <span class="token number">0x5cb36a04</span><span class="token punctuation">,</span> <span class="token number">0xc2d7ffa7</span><span class="token punctuation">,</span> <span class="token number">0xb5d0cf31</span><span class="token punctuation">,</span> <span class="token number">0x2cd99e8b</span><span class="token punctuation">,</span> <span class="token number">0x5bdeae1d</span><span class="token punctuation">,</span>
  <span class="token number">0x9b64c2b0</span><span class="token punctuation">,</span> <span class="token number">0xec63f226</span><span class="token punctuation">,</span> <span class="token number">0x756aa39c</span><span class="token punctuation">,</span> <span class="token number">0x026d930a</span><span class="token punctuation">,</span> <span class="token number">0x9c0906a9</span><span class="token punctuation">,</span> <span class="token number">0xeb0e363f</span><span class="token punctuation">,</span>
  <span class="token number">0x72076785</span><span class="token punctuation">,</span> <span class="token number">0x05005713</span><span class="token punctuation">,</span> <span class="token number">0x95bf4a82</span><span class="token punctuation">,</span> <span class="token number">0xe2b87a14</span><span class="token punctuation">,</span> <span class="token number">0x7bb12bae</span><span class="token punctuation">,</span> <span class="token number">0x0cb61b38</span><span class="token punctuation">,</span>
  <span class="token number">0x92d28e9b</span><span class="token punctuation">,</span> <span class="token number">0xe5d5be0d</span><span class="token punctuation">,</span> <span class="token number">0x7cdcefb7</span><span class="token punctuation">,</span> <span class="token number">0x0bdbdf21</span><span class="token punctuation">,</span> <span class="token number">0x86d3d2d4</span><span class="token punctuation">,</span> <span class="token number">0xf1d4e242</span><span class="token punctuation">,</span>
  <span class="token number">0x68ddb3f8</span><span class="token punctuation">,</span> <span class="token number">0x1fda836e</span><span class="token punctuation">,</span> <span class="token number">0x81be16cd</span><span class="token punctuation">,</span> <span class="token number">0xf6b9265b</span><span class="token punctuation">,</span> <span class="token number">0x6fb077e1</span><span class="token punctuation">,</span> <span class="token number">0x18b74777</span><span class="token punctuation">,</span>
  <span class="token number">0x88085ae6</span><span class="token punctuation">,</span> <span class="token number">0xff0f6a70</span><span class="token punctuation">,</span> <span class="token number">0x66063bca</span><span class="token punctuation">,</span> <span class="token number">0x11010b5c</span><span class="token punctuation">,</span> <span class="token number">0x8f659eff</span><span class="token punctuation">,</span> <span class="token number">0xf862ae69</span><span class="token punctuation">,</span>
  <span class="token number">0x616bffd3</span><span class="token punctuation">,</span> <span class="token number">0x166ccf45</span><span class="token punctuation">,</span> <span class="token number">0xa00ae278</span><span class="token punctuation">,</span> <span class="token number">0xd70dd2ee</span><span class="token punctuation">,</span> <span class="token number">0x4e048354</span><span class="token punctuation">,</span> <span class="token number">0x3903b3c2</span><span class="token punctuation">,</span>
  <span class="token number">0xa7672661</span><span class="token punctuation">,</span> <span class="token number">0xd06016f7</span><span class="token punctuation">,</span> <span class="token number">0x4969474d</span><span class="token punctuation">,</span> <span class="token number">0x3e6e77db</span><span class="token punctuation">,</span> <span class="token number">0xaed16a4a</span><span class="token punctuation">,</span> <span class="token number">0xd9d65adc</span><span class="token punctuation">,</span>
  <span class="token number">0x40df0b66</span><span class="token punctuation">,</span> <span class="token number">0x37d83bf0</span><span class="token punctuation">,</span> <span class="token number">0xa9bcae53</span><span class="token punctuation">,</span> <span class="token number">0xdebb9ec5</span><span class="token punctuation">,</span> <span class="token number">0x47b2cf7f</span><span class="token punctuation">,</span> <span class="token number">0x30b5ffe9</span><span class="token punctuation">,</span>
  <span class="token number">0xbdbdf21c</span><span class="token punctuation">,</span> <span class="token number">0xcabac28a</span><span class="token punctuation">,</span> <span class="token number">0x53b39330</span><span class="token punctuation">,</span> <span class="token number">0x24b4a3a6</span><span class="token punctuation">,</span> <span class="token number">0xbad03605</span><span class="token punctuation">,</span> <span class="token number">0xcdd70693</span><span class="token punctuation">,</span>
  <span class="token number">0x54de5729</span><span class="token punctuation">,</span> <span class="token number">0x23d967bf</span><span class="token punctuation">,</span> <span class="token number">0xb3667a2e</span><span class="token punctuation">,</span> <span class="token number">0xc4614ab8</span><span class="token punctuation">,</span> <span class="token number">0x5d681b02</span><span class="token punctuation">,</span> <span class="token number">0x2a6f2b94</span><span class="token punctuation">,</span>
  <span class="token number">0xb40bbe37</span><span class="token punctuation">,</span> <span class="token number">0xc30c8ea1</span><span class="token punctuation">,</span> <span class="token number">0x5a05df1b</span><span class="token punctuation">,</span> <span class="token number">0x2d02ef8d</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">/* how to derive the values in crctab[] from polynomial 0xedb88320 */</span>
<span class="token keyword">void</span> <span class="token function">build_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  ub4 i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    j <span class="token operator">=</span> i<span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0xedb88320</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0x%.8lx, "</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">6</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* the hash function */</span>
ub4 <span class="token function">crc</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> ub4 len<span class="token punctuation">,</span> ub4 hash<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  ub4 i<span class="token punctuation">;</span>
  <span class="token keyword">const</span> ub1 <span class="token operator">*</span>k <span class="token operator">=</span> key<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>hash<span class="token operator">=</span>len<span class="token punctuation">,</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    hash <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">^</span> crctab<span class="token punctuation">[</span><span class="token punctuation">(</span>hash <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">^</span> k<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* To use, try "gcc -O crc.c -o crc; crc &lt; crc.c" */</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">gets</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.8lx\n"</span><span class="token punctuation">,</span> <span class="token function">crc</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ÂØπ‰∫éÂä†ÂØÜÁÆóÊ≥ïÁöÑÂÆûÁé∞ÔºåÊàë‰ª¨ÂæÄÂæÄÂè™ÂÖ≥Ê≥®ÂÖ≥ÈîÆÂáΩÊï∞ÁöÑËØ¶ÁªÜÁªÜËäÇ„ÄÇÂØπ‰∫éCRC32ÊïàÈ™åÁÆóÊ≥ïÔºåÊàë‰ª¨Â∞±Ë¶ÅÁâπÂà´ÂÖ≥Ê≥®<code>crc()</code>ÁöÑÂÆûÁé∞„ÄÇÊ≥®ÊÑè<code>for()</code>ËØ≠Âè•ÁöÑ‰∏§‰∏™ÂàùÂßãÊåá‰ª§<code>hash=len</code>Âíå<code>i=0</code>„ÄÇÂΩìÁÑ∂ÔºåÂú®<code>C/C++</code>ËØ≠Ë®ÄÈáåÔºåÊàë‰ª¨ÂèØ‰ª•‰∏ÄÊ¨°ÊåáÂÆö‰∏§Êù°Âæ™ÁéØÂàùÂßãÊåá‰ª§ÔºåËÄåÂú®ÊúÄÁªàÁöÑÊ±áÁºñÊåá‰ª§Â±ÇÈù¢ÔºåÂ∞±‰ºöÂá∫Áé∞‰∏§Êù°ÂàùÂßãÂåñÊåá‰ª§</li>
</ul>
<hr />
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_key<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>             <span class="token comment">; size = 4</span>
_len<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>            <span class="token comment">; size = 4</span>
_hash<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>           <span class="token comment">; size = 4</span>
_crc    PROC
    mov    <span class="token register variable">edx</span>, DWORD PTR _len<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
    xor    <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span> <span class="token comment">; ecx=0,,,i will be stored in ECX</span>
    mov    <span class="token register variable">eax</span>, <span class="token register variable">edx</span><span class="token comment">;eax=len</span>
    test   <span class="token register variable">edx</span>, <span class="token register variable">edx</span>
    jbe    SHORT <span class="token operator">$</span>LN1@crc<span class="token comment">;edx&lt;=len?</span>
    push   <span class="token register variable">ebx</span>
    push   <span class="token register variable">esi</span>
    mov    <span class="token register variable">esi</span>, DWORD PTR _key<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; ESI = key</span>
    push   <span class="token register variable">edi</span>
<span class="token label function">$LL3@crc:</span>

<span class="token comment">; work with bytes using only 32-bit registers. byte from address key+i we store into EDI</span>

    movzx  <span class="token register variable">edi</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token register variable">esi</span><span class="token operator">]</span><span class="token comment">;;edi=key[i]</span>
    mov    <span class="token register variable">ebx</span>, <span class="token register variable">eax</span> <span class="token comment">; EBX = (hash = len)</span>
    and    <span class="token register variable">ebx</span>, <span class="token number">255</span> <span class="token comment">; EBX = hash &amp; 0xff</span>

<span class="token comment">; XOR EDI, EBX (EDI=EDI^EBX) - this operation uses all 32 bits of each register</span>
<span class="token comment">; but other bits (8-31) are cleared all time, so its OK'</span>
<span class="token comment">; these are cleared because, as for EDI, it was done by MOVZX instruction above</span>
<span class="token comment">; high bits of EBX was cleared by AND EBX, 255 instruction above (255 = 0xff)</span>

    xor    <span class="token register variable">edi</span>, <span class="token register variable">ebx</span><span class="token comment">;edi=key[i]^(hash&amp;0xff)</span>

<span class="token comment">; EAX=EAX>>8; bits 24-31 taken "from nowhere" will be cleared</span>
    shr    <span class="token register variable">eax</span>, <span class="token number">8</span><span class="token comment">;eax=len=hash>>8</span>

<span class="token comment">; EAX=EAX^crctab[EDI*4] - choose EDI-th element from crctab[] table</span>
    xor    <span class="token register variable">eax</span>, DWORD PTR _crctab<span class="token operator">[</span><span class="token register variable">edi</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=(hash>>8)^crctab[(hash&amp;0xff)^key[i]]</span>
    inc    <span class="token register variable">ecx</span>            <span class="token comment">; i++</span>
    cmp    <span class="token register variable">ecx</span>, <span class="token register variable">edx</span>       <span class="token comment">; i&lt;len ?</span>
    jb     SHORT <span class="token operator">$</span>LL3@crc <span class="token comment">; yes</span>
    pop    <span class="token register variable">edi</span>
    pop    <span class="token register variable">esi</span>
    pop    <span class="token register variable">ebx</span>
<span class="token label function">$LN1@crc:</span>
    ret    <span class="token number">0</span>
_crc    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ÈááÁî®‰ºòÂåñÁöÑÊñπÂºè(/Ox)Êù•ÁºñËØë</code>ÔºåËøôÈáåÂè™ÂàóÂá∫<code>crc()</code>ÂáΩÊï∞</p>
<hr />
<p><code>gcc 4.4.1 -O3</code>ÁºñËØë</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">                 public crc
crc              proc near

key              <span class="token operator">=</span> dword ptr <span class="token number">8</span>
hash             <span class="token operator">=</span> dword ptr <span class="token number">0Ch</span>

                 push    <span class="token register variable">ebp</span>
                 xor     <span class="token register variable">edx</span>, <span class="token register variable">edx</span><span class="token comment">;edx=i;i=0</span>
                 mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                 push    <span class="token register variable">esi</span>
                 mov     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>key<span class="token operator">]</span><span class="token comment">;esi=key</span>
                 push    <span class="token register variable">ebx</span>
                 mov     <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>hash<span class="token operator">]</span><span class="token comment">;ebx=hash</span>
                 test    <span class="token register variable">ebx</span>, <span class="token register variable">ebx</span>
                 mov     <span class="token register variable">eax</span>, <span class="token register variable">ebx</span><span class="token comment">;eax=ebx=hash</span>
                 jz      short loc_80484D3<span class="token comment">;ebx=0?</span>
                 nop                       <span class="token comment">; padding</span>
                 lea     <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">]</span>      <span class="token comment">; padding; works as NOP (ESI does not changing here)</span>

<span class="token label function">loc_80484B8:</span>
                 mov     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span> <span class="token comment">;ecx=hash         ; save previous state of hash to ECX</span>
                 xor     <span class="token register variable">al</span>, <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">]</span>     <span class="token comment">; AL=(hash&amp;0xff)^key[i]</span>
                 add     <span class="token register variable">edx</span>, <span class="token number">1</span>            <span class="token comment">; i++</span>
                 shr     <span class="token register variable">ecx</span>, <span class="token number">8</span>            <span class="token comment">; ECX=hash>>8</span>
                 movzx   <span class="token register variable">eax</span>, <span class="token register variable">al</span>           <span class="token comment">; EAX=*(key+i)&amp;0xff</span>
                 mov     <span class="token register variable">eax</span>, dword ptr <span class="token register variable">ds</span>:crctab<span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; EAX=crctab[EAX]</span>
                 xor     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>          <span class="token comment">; hash=EAX^ECX</span>
                 cmp     <span class="token register variable">ebx</span>, <span class="token register variable">edx</span><span class="token comment">;len>=i?</span>
                 ja      short loc_80484B8<span class="token comment">;</span>
<span class="token label function">loc_80484D3:</span>
                 pop     <span class="token register variable">ebx</span>
                 pop     <span class="token register variable">esi</span>
                 pop     <span class="token register variable">ebp</span>
                 retn
crc              endp
\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÈÅáÂà∞ËøôÁßçÔºåÊ±áÁºñ‰∏çÁÆóÂ§çÊùÇÔºåËÄêÂøÉÂàÜÊûêÂç≥ÂèØ</p>
<hr />
<h3 id="chap38-ÁΩëÁªúÂú∞ÂùÄËÆ°ÁÆó"><a class="markdownIt-Anchor" href="#chap38-ÁΩëÁªúÂú∞ÂùÄËÆ°ÁÆó"></a> Chap38 ÁΩëÁªúÂú∞ÂùÄËÆ°ÁÆó</h3>
<ul>
<li>
<p>IPv4‰∏ãÁöÑTCP/IPÂú∞ÂùÄÁî±4‰∏™Êï∞Â≠óÁªÑÊàêÔºåÊØè‰∏™Êï∞Â≠óÈÉΩÂú®0ÔΩû255ÔºàÂçÅËøõÂà∂Ôºâ‰πãÈó¥„ÄÇÊâÄ‰ª•IPv4ÁöÑÂú∞ÂùÄÂèØ‰ª•Ë°®Á§∫‰∏∫4Â≠óËäÇÊï∞ÊçÆ„ÄÇÂõ†Ê≠§IPv4ÁöÑ‰∏ªÊú∫Âú∞ÂùÄ„ÄÅÂ≠êÁΩëÊé©Á†ÅÂíåÁΩëÁªúÂú∞ÂùÄÈÉΩÂèØ‰ª•Ë°®Á§∫‰∏∫‰∏Ä‰∏™32‰ΩçÁöÑÊï¥Êï∞„ÄÇ</p>
</li>
<li>
<p><code>‰ΩøÁî®ËÄÖÁöÑËßíÂ∫¶Êù•ÁúãÔºåÂ≠êÁΩëÊé©Á†ÅÁî±4‰ΩçÊï∞Â≠óÁªÑÊàêÔºåÂÜôÂá∫Êù•Â§ßËá¥Â∞±ÊòØ255.255.255.0ËøôÁ±ªÂΩ¢ÂºèÁöÑÊï∞Â≠ó</code>„ÄÇ‰ΩÜ<code>ÊòØÁΩëÁªúÂ∑•Á®ãÂ∏àÊàñËÄÖÁ≥ªÁªüÁÆ°ÁêÜÂëòÊõ¥ÂñúÊ¨¢‰ΩøÁî®Êõ¥‰∏∫Á¥ßÂáëÁöÑË°®Á§∫ÊñπÊ≥ï</code>Ôºå‰πüÂ∞±ÊòØCIDR[<a href="#anchor381">1]</a>ËßÑËåÉÁöÑ‚Äú/8‚Äù‚Äú/16‚Äù‰∏ÄÁ±ªÁöÑË°®Á§∫ÊñπÊ≥ï„ÄÇ<code>CIDRÊ†ºÂºèÁöÑÂ≠êÁΩëÊé©Á†Å‰ªéÂ≠êÁΩëÊé©Á†ÅÁöÑMSBÔºàÊúÄÈ´òÊï∞ÊùÉ‰ΩçÔºâÂºÄÂßãËÆ°Êï∞ÔºåÁªüËÆ°Â≠êÁΩëÊé©Á†ÅÈáåÈù¢ÊúâÂ§öÂ∞ë‰∏™1Âπ∂Â∞ÜÁªüËÆ°Êï∞Â≠óËΩ¨Êç¢‰∏∫10ËøõÂà∂Êï∞</code>„ÄÇ</p>
<table>
<thead>
<tr>
<th>CIDKËßÑËåÉÁöÑÊé©Á†Å</th>
<th>Êï∞Â≠óÁ©∫Èó¥</th>
<th>ÂèØÁî®Âú∞ÂùÄÔºà‰∏™Ôºâ</th>
<th>ÂçÅËøõÂà∂Â≠êÁΩëÊé©Á†Å</th>
<th>ÂçÅÂÖ≠ËøõÂà∂Â≠êÁΩëÊé©Á†Å</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>/30</td>
<td>4</td>
<td>2</td>
<td>255.255.255.252</td>
<td>fffffffc</td>
<td></td>
</tr>
<tr>
<td>/29</td>
<td>8</td>
<td>6</td>
<td>255.255.255.248</td>
<td>fffffff8</td>
<td></td>
</tr>
<tr>
<td>/28</td>
<td>16</td>
<td>14</td>
<td>255.255.255.240</td>
<td>fffffff0</td>
<td></td>
</tr>
<tr>
<td>/27</td>
<td>32</td>
<td>30</td>
<td>255.255.255.224</td>
<td>ffffffe0</td>
<td></td>
</tr>
<tr>
<td>/26</td>
<td>64</td>
<td>62</td>
<td>255.255.255.192</td>
<td>ffffffc0</td>
<td></td>
</tr>
<tr>
<td>/24</td>
<td>256</td>
<td>254</td>
<td>255.255.255.0</td>
<td>ffffff00</td>
<td>CÁ±ªÁΩëÊÆµ</td>
</tr>
<tr>
<td>/23</td>
<td>512</td>
<td>510</td>
<td>255.255.254.0</td>
<td>fffffe00</td>
<td></td>
</tr>
<tr>
<td>/22</td>
<td>1024</td>
<td>1022</td>
<td>255.255.252.0</td>
<td>fffffc00</td>
<td></td>
</tr>
<tr>
<td>/21</td>
<td>2048</td>
<td>2046</td>
<td>255.255.248.0</td>
<td>fffff800</td>
<td></td>
</tr>
<tr>
<td>/20</td>
<td>4096</td>
<td>4094</td>
<td>255.255.240.0</td>
<td>fffff000</td>
<td></td>
</tr>
<tr>
<td>/19</td>
<td>8192</td>
<td>8190</td>
<td>255.255.224.0</td>
<td>ffffe000</td>
<td></td>
</tr>
<tr>
<td>/18</td>
<td>16384</td>
<td>16382</td>
<td>255.255.192.0</td>
<td>ffffc000</td>
<td></td>
</tr>
<tr>
<td>/17</td>
<td>32768</td>
<td>32766</td>
<td>255.255.128.0</td>
<td>ffff8000</td>
<td></td>
</tr>
<tr>
<td>/16</td>
<td>65536</td>
<td>65534</td>
<td>255.255.0.0</td>
<td>ffff0000</td>
<td>BÁ±ªÁΩëÊÆµ</td>
</tr>
<tr>
<td>/8</td>
<td>16777216</td>
<td>16777214</td>
<td>255.0.0.0</td>
<td>ff000000</td>
<td>AÁ±ªÁΩëÊÆµ</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr />
<p>ËøôÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠êÔºåÂ∞ÜÂ≠êÁΩëÊé©Á†ÅÂ∫îÁî®Âà∞‰∏ªÊú∫Âú∞ÂùÄ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token class-name">uint32_t</span> <span class="token function">form_IP</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span> ip1<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> ip2<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> ip3<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> ip4<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>ip1<span class="token operator">&lt;&lt;</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>ip2<span class="token operator">&lt;&lt;</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>ip3<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> ip4<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">print_as_IP</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d.%d.%d.%d\n"</span><span class="token punctuation">,</span>
                   <span class="token punctuation">(</span>a<span class="token operator">>></span><span class="token number">24</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">,</span>
                   <span class="token punctuation">(</span>a<span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">,</span>
                   <span class="token punctuation">(</span>a<span class="token operator">>></span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">,</span>
                   <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// bit=31..0</span>
<span class="token class-name">uint32_t</span> <span class="token function">set_bit</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span> input<span class="token punctuation">,</span> <span class="token keyword">int</span> bit<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> input<span class="token operator">=</span>input<span class="token operator">|</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span>bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token class-name">uint32_t</span> <span class="token function">form_netmask</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span> netmask_bits<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token class-name">uint32_t</span> netmask<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token class-name">uint8_t</span> i<span class="token punctuation">;</span>

          <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>netmask_bits<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    netmask<span class="token operator">=</span><span class="token function">set_bit</span><span class="token punctuation">(</span>netmask<span class="token punctuation">,</span> <span class="token number">31</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">return</span> netmask<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">calc_network_address</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span> ip1<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> ip2<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> ip3<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span>  ip4<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> netmask_bits<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token class-name">uint32_t</span> netmask<span class="token operator">=</span><span class="token function">form_netmask</span><span class="token punctuation">(</span>netmask_bits<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">uint32_t</span> ip<span class="token operator">=</span><span class="token function">form_IP</span><span class="token punctuation">(</span>ip1<span class="token punctuation">,</span> ip2<span class="token punctuation">,</span> ip3<span class="token punctuation">,</span> ip4<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">uint32_t</span> netw_adr<span class="token punctuation">;</span>

          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"netmask="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">print_as_IP</span> <span class="token punctuation">(</span>netmask<span class="token punctuation">)</span><span class="token punctuation">;</span>

          netw_adr<span class="token operator">=</span>ip<span class="token operator">&amp;</span>netmask<span class="token punctuation">;</span>

          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"network address="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">print_as_IP</span> <span class="token punctuation">(</span>netw_adr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">calc_network_address</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 10.1.2.4, /24</span>
          <span class="token function">calc_network_address</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 10.1.2.4, /8</span>
          <span class="token function">calc_network_address</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 10.1.2.4, /25</span>
          <span class="token function">calc_network_address</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 10.1.2.4, /26</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs 2012 /Ob0‰ºòÂåñ</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"> <span class="token number">1</span>  _ip1<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>              <span class="token comment">; size = 1</span>
 <span class="token number">2</span>  _ip2<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>             <span class="token comment">; size = 1</span>
 <span class="token number">3</span>  _ip3<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>             <span class="token comment">; size = 1</span>
 <span class="token number">4</span>  _ip4<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">20</span>             <span class="token comment">; size = 1</span>
 <span class="token number">5</span>  _netmask_bits<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">24</span>    <span class="token comment">; size = 1</span>
 <span class="token number">6</span>  _calc_network_address PROC
 <span class="token number">7</span>         push     <span class="token register variable">edi</span>
 <span class="token number">8</span>         push     DWORD PTR _netmask_bits<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
 <span class="token number">9</span>         call     _form_netmask
<span class="token number">10</span>         push     OFFSET <span class="token operator">$</span>SG3045   <span class="token comment">; 'netmask='</span>
<span class="token number">11</span>         mov      <span class="token register variable">edi</span>, <span class="token register variable">eax</span>
<span class="token number">12</span>         call     DWORD PTR __imp__printf
<span class="token number">13</span>         push     <span class="token register variable">edi</span>
<span class="token number">14</span>         call     _print_as_IP
<span class="token number">15</span>         push     OFFSET <span class="token operator">$</span>SG3046   <span class="token comment">; 'network address='</span>
<span class="token number">16</span>         call     DWORD PTR __imp__printf
<span class="token number">17</span>         push     DWORD PTR _ip4<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>
<span class="token number">18</span>         push     DWORD PTR _ip3<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">]</span>
<span class="token number">19</span>         push     DWORD PTR _ip2<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>
<span class="token number">20</span>         push     DWORD PTR _ip1<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">]</span>
<span class="token number">21</span>         call     _form_IP
<span class="token number">22</span>         and      <span class="token register variable">eax</span>, <span class="token register variable">edi</span>         <span class="token comment">; network address = host address &amp; netmask</span>
<span class="token number">23</span>         push     <span class="token register variable">eax</span>
<span class="token number">24</span>         call     _print_as_IP
<span class="token number">25</span>         add      <span class="token register variable">esp</span>, <span class="token number">36</span>
<span class="token number">26</span>         pop      <span class="token register variable">edi</span>
<span class="token number">27</span>         ret      <span class="token number">0</span>
<span class="token number">28</span>  _calc_network_address ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Á¨¨22Ë°åÔºå<code>and eaxÔºåedi</code>ÊòØÂÖ≥ÈîÆËøêÁÆóÔºåÂç≥<code> network address = host address &amp; netmask</code></li>
</ul>
<hr />
<p>``form_IP()`Â∞ÜIPÁöÑÂõõ‰∏™Â≠óËäÇËΩ¨Êç¢Êàê‰∏Ä‰∏™32‰ΩçÊï∞ÂÄº</p>
<ol>
<li>ÁªôËøîÂõûÂÄºÂàÜÈÖç‰∏Ä‰∏™ÂèòÈáèÂπ∂ËµãÂÄº‰∏∫0</li>
<li>ÂèñÊï∞ÊùÉÊúÄ‰ΩéÁöÑÁ¨¨4‰∏™Â≠óËäÇÔºå‰∏éËøîÂõûÂÄº0ËøõË°å<code>or</code>Êìç‰ΩúÂç≥ÂèØÂæóÂà∞Âê´Á¨¨4Â≠óËäÇ‰ø°ÊÅØÁöÑ32‰ΩçÁΩÆ</li>
<li>ÂèñÁ¨¨3‰∏™Â≠óËäÇÔºåÂ∑¶Áßª8‰ΩçÔºå‰ª•ÁîüÊàê0x0000bb00ÔºàÂÖ∂‰∏≠bbÂ∞±ÊòØËøôÊ≠•ËØªÂèñÁöÑÁ¨¨‰∏âÂ≠óËäÇÔºâËøôÁßçÂΩ¢ÂºèÁöÑÊï∞ÂÄº„ÄÇÊ≠§Âêé‰∏éËøîÂõûÂÄºËøõË°åOR/ÊàñËøêÁÆó„ÄÇÂ¶ÇÊûú‰∏ä‰∏ÄÊ≠•ÁöÑÂÄºÂ¶ÇÊûúÊòØ0x000000aaÁöÑËØùÔºåÂú®ÊâßË°åORÊàñÊìç‰ΩúÂêéÔºåÂ∞±‰ºöÂæóÂà∞0x0000bbaaËøôÊ†∑ÁöÑËøîÂõûÂÄº„ÄÇ</li>
<li>‰æùÊ≠§Á±ªÊé®„ÄÇÂèñÁ¨¨2‰∏™Â≠óËäÇÔºåÂ∑¶Áßª16‰ΩçÔºåÁîüÊàê0x00cc0000ËøôÊ†∑‰∏Ä‰∏™Âê´ÊúâÁ¨¨2Â≠óËäÇÁöÑ32‰ΩçÂÄºÔºåÂÜçËøõË°åOR/ÊàñËøêÁÆó„ÄÇÁî±‰∫é‰ª•‰∏ä‰∏ÄÊ≠•ÁöÑËøîÂõûÂÄºÂ∫îÂΩìÊòØ0x0000bbaaÔºåÂõ†Ê≠§Êú¨Ê¨°ËøêÁÆóÁöÑÁªìÊûú‰ºöÊòØ0x00ccbbaa„ÄÇ</li>
<li>ÂêåÁêÜ„ÄÇÂèñÊúÄÈ´ò‰ΩçÔºåÂ∑¶Áßª24‰ΩçÔºå‰ª•ÁîüÊàê0xdd000000ËøôÊ†∑‰∏Ä‰∏™Âê´ÊúâÁ¨¨‰∏ÄÂ≠óËäÇ‰ø°ÊÅØÁöÑ32‰ΩçÂÄºÔºåÂÜçËøõË°åOR/ÊàñËøêÁÆó„ÄÇÁî±‰∫é‰∏ä‰∏ÄÊ≠•ÁöÑËøîÂõûÂÄºÊòØ0x00ccbbaaÔºåÂõ†Ê≠§ÊúÄÁªàÁöÑÁªìÊûúÁöÑÂÄºÂ∞±ÊòØ0xddccbbaaËøôÊ†∑ÁöÑ32‰ΩçÂÄº‰∫Ü„ÄÇ</li>
</ol>
<hr />
<p><code>msvs 2012 /Ox</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; denote ip1 as "dd", ip2 as "cc", ip3 as "bb", ip4 as "aa".</span>
_ip1<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>        <span class="token comment">; size = 1</span>
_ip2<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>       <span class="token comment">; size = 1</span>
_ip3<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>       <span class="token comment">; size = 1</span>
_ip4<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">20</span>       <span class="token comment">; size = 1</span>
_form_IP PROC
        movzx   <span class="token register variable">eax</span>, BYTE PTR _ip1<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        <span class="token comment">; EAX=000000dd</span>
        movzx   <span class="token register variable">ecx</span>, BYTE PTR _ip2<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        <span class="token comment">; ECX=000000cc</span>
        shl     <span class="token register variable">eax</span>, <span class="token number">8</span>
        <span class="token comment">; EAX=0000dd00</span>
        or      <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
        <span class="token comment">; EAX=0000ddcc</span>
        movzx   <span class="token register variable">ecx</span>, BYTE PTR _ip3<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        <span class="token comment">; ECX=000000bb</span>
        shl     <span class="token register variable">eax</span>, <span class="token number">8</span>
        <span class="token comment">; EAX=00ddcc00</span>
        or      <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
        <span class="token comment">; EAX=00ddccbb</span>
        movzx   <span class="token register variable">ecx</span>, BYTE PTR _ip4<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        <span class="token comment">; ECX=000000aa</span>
        shl     <span class="token register variable">eax</span>, <span class="token number">8</span>
        <span class="token comment">; EAX=ddccbb00</span>
        or      <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
        <span class="token comment">; EAX=ddccbbaa</span>
        ret     <span class="token number">0</span>
_form_IP ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ËøôÈáåËøõË°å‰∫Ü‰ºòÂåñÔºå‰∏éÂ∏∏ËßÑËøáÁ®ãÁï•Êúâ‰∏ÄÁÇπ‰∏çÂêå</li>
<li>Ëøô‰∏™ÂÆûÁé∞ËøáÁ®ãÂèØ‰ª•ÊèèËø∞‰∏∫:ÊØè‰∏™Â≠óËäÇÈÉΩÂÜôÂÖ•Âà∞ÂÖ∂ËøîÂõûÂÄºÁöÑÊúÄ‰Ωé8‰∏™ÊØîÁâπ‰ΩçÔºåÂπ∂‰∏îEAXÊØèÊ¨°Â∑¶Áßª‰∏Ä‰∏™Â≠óËäÇÔºåÂπ∂‰∏éÂÖ∂ÂÅöÂºÇÊàñÊìç‰ΩúÔºåÈáçÂ§ç4Ê¨°</li>
</ul>
<hr />
<p><code>print_as_IP()</code></p>
<p><code>MSVS 2010 /Ob0</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>          <span class="token comment">; size = 4</span>
_print_as_IP PROC
         mov     <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
         <span class="token comment">; ECX=ddccbbaa</span>
         movzx   <span class="token register variable">eax</span>, <span class="token register variable">cl</span>
         <span class="token comment">; EAX=000000aa</span>
         push    <span class="token register variable">eax</span>
         mov     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
         <span class="token comment">; EAX=ddccbbaa</span>
         shr     <span class="token register variable">eax</span>, <span class="token number">8</span>
         <span class="token comment">; EAX=00ddccbb</span>
         and     <span class="token register variable">eax</span>, <span class="token number">255</span>
         <span class="token comment">; EAX=000000bb</span>
         push    <span class="token register variable">eax</span>
         mov     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
         <span class="token comment">; EAX=ddccbbaa</span>
         shr     <span class="token register variable">eax</span>, <span class="token number">16</span>
         <span class="token comment">; EAX=0000ddcc</span>
         and     <span class="token register variable">eax</span>, <span class="token number">255</span>
         <span class="token comment">; EAX=000000cc</span>
         push    <span class="token register variable">eax</span>
         <span class="token comment">; ECX=ddccbbaa</span>
         shr     <span class="token register variable">ecx</span>, <span class="token number">24</span>
         <span class="token comment">; ECX=000000dd</span>
         push    <span class="token register variable">ecx</span>
         push    OFFSET <span class="token operator">$</span>SG3020 <span class="token comment">; '%d.%d.%d.%d'</span>
         call    DWORD PTR __imp__printf
         add     <span class="token register variable">esp</span>, <span class="token number">20</span>
         ret     <span class="token number">0</span>
_print_as_IP ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>‰∏é‰∏äÊñáÁõ∏ÂèçÔºåÂ∞Ü‰∏Ä‰∏™32‰ΩçÁöÑÊï∞ÂÄºÂàáÂàÜÁß∞4‰∏™Â≠óËäÇÔºåÂè™ÈúÄË¶ÅÂ∞ÜËæìÂÖ•ÁöÑÊï∞ÂÄºÂàÜÂà´‰ΩçÁßª24‰ΩçÔºå16‰ΩçÔºå8‰ΩçÔºå0‰Ωç</li>
<li>ËøôÈáå‰∏éÈùû‰ºòÂåñËøáÁ®ãÁöÑÂå∫Âà´Âú®‰∫é<mark>‰∏ç‰ºöÈáçÊñ∞Âä†ËΩΩËæìÂÖ•ÂÄº</mark></li>
</ul>
<hr />
<p><code>form_netmask()ÂáΩÊï∞Âíåset_bit()ÂáΩÊï∞</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_input<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>          <span class="token comment">; size = 4</span>
_bit<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>           <span class="token comment">; size = 4</span>
_set_bit PROC
        mov     <span class="token register variable">ecx</span>, DWORD PTR _bit<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        mov     <span class="token register variable">eax</span>, <span class="token number">1</span>
        shl     <span class="token register variable">eax</span>, <span class="token register variable">cl</span>
        or      <span class="token register variable">eax</span>, DWORD PTR _input<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        ret     <span class="token number">0</span>
_set_bit ENDP

_netmask_bits<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                <span class="token comment">; size = 1</span>
_form_netmask PROC
        push    <span class="token register variable">ebx</span>
        push    <span class="token register variable">esi</span>
        movzx   <span class="token register variable">esi</span>, BYTE PTR _netmask_bits<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
        xor     <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>
        xor     <span class="token register variable">bl</span>, <span class="token register variable">bl</span>
        test    <span class="token register variable">esi</span>, <span class="token register variable">esi</span>
        jle     SHORT <span class="token operator">$</span>LN9@form_netma
        xor     <span class="token register variable">edx</span>, <span class="token register variable">edx</span>
<span class="token label function">$LL3@form_netma:</span>
        mov     <span class="token register variable">eax</span>, <span class="token number">31</span>
        sub     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
        push    <span class="token register variable">eax</span>
        push    <span class="token register variable">ecx</span>
        call    _set_bit
        inc     <span class="token register variable">bl</span>
        movzx   <span class="token register variable">edx</span>, <span class="token register variable">bl</span>
        add     <span class="token register variable">esp</span>, <span class="token number">8</span>
        mov     <span class="token register variable">ecx</span>, <span class="token register variable">eax</span>
        cmp     <span class="token register variable">edx</span>, <span class="token register variable">esi</span>
        jl      SHORT <span class="token operator">$</span>LL3@form_netma
<span class="token label function">$LN9@form_netma:</span>
        pop     <span class="token register variable">esi</span>
        mov     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
        pop     <span class="token register variable">ebx</span>
        ret     <span class="token number">0</span>
_form_netmask ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>set_bit()ÂáΩÊï∞ÁöÑÂäüËÉΩÂçÅÂàÜÂçï‰∏Ä„ÄÇÂÆÉÂ∞ÜËæìÂÖ•ÂÄºÂ∑¶ÁßªÊó¢ÂÆöÁöÑÊØîÁâπ‰ΩçÔºåÊé•ÁùÄÂ∞Ü‰ΩçÁßªËøêÁÆóÁöÑÁªìÊûú‰∏éËæìÂÖ•ÂÄºËøõË°åÊàñORËøêÁÆó„ÄÇËÄåÂêéform_mask()ÂáΩÊï∞ÈÄöËøáÂæ™ÁéØËØ≠Âè•ÈáçÂ§çË∞ÉÁî®set_bit()ÂáΩÊï∞ÔºåÂÄüÂä©Âæ™ÁéØÊéßÂà∂ÂèòÈáènetmask_bitsËÆæÁΩÆÂ≠êÁΩëÊé©Á†ÅÈáåÊï∞ÂÄº‰∏∫1ÁöÑÂêÑ‰∏™ÊØîÁâπ‰Ωç„ÄÇ</p>
<h3 id="chap39-Âæ™ÁéØÂá†‰∏™Ëø≠‰ª£"><a class="markdownIt-Anchor" href="#chap39-Âæ™ÁéØÂá†‰∏™Ëø≠‰ª£"></a> Chap39 Âæ™ÁéØÔºöÂá†‰∏™Ëø≠‰ª£Ôºü</h3>
<p><em>Â§öÊï∞Âæ™ÁéØËØ≠Âè•Âè™Êúâ‰∏Ä‰∏™Ëø≠‰ª£Âô®Ôºå‰ΩÜÊòØÂú®Ê±áÁºñÂ±ÇÈù¢Ôºå‰∏Ä‰∏™Ëø≠‰ª£Âô®‰πüÂèØËÉΩÂØπÂ∫îÂ§ö‰∏™Êï∞ÊçÆÂÆû‰Ωì</em></p>
<p>‰æãÂ¶Ç</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>a1<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token class-name">size_t</span> cnt<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
       <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>

       <span class="token comment">// copy from one array to another in some weird scheme</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
              a1<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>a2<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊØèÊ¨°Ëø≠‰ª£ÈÉΩÊúâ‰∏§Ê¨°‰πòÊ≥ïÔºåËøôÊòØÂæàËÄóÊó∂ÁöÑËÆ°ÁÆóÔºåÂ¶ÇÊûúÁªÜÁúãÁ®ãÂ∫è‰ª£Á†ÅÔºåÂèØ‰ª•ÂèëÁé∞Á®ãÂ∫è‰∏≠ÁöÑÁü©ÈòµÁöÑÂèÇÊï∞ÊòØË∑≥Ë∑ÉÁöÑÔºåÊàë‰ª¨ËÉΩÊØîËæÉÂÆπÊòìÂú∞‰∏çÁî®‰πòÊ≥ïÂ∞ÜÂÆÉËÆ°ÁÆóÂá∫Êù•</p>
<hr />
<p><code>msvs 2013 x64</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">f        PROC
<span class="token comment">; RDX=a1</span>
<span class="token comment">; RCX=a2</span>
<span class="token comment">; R8=cnt</span>
         test      <span class="token register variable">r8</span>, <span class="token register variable">r8</span>         <span class="token comment">; cnt==0? exit then</span>
         je        SHORT <span class="token operator">$</span>LN1@f
         npad      <span class="token number">11</span>
<span class="token label function">$LL3@f:</span>
         mov       <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">]</span><span class="token comment">;eax=a1</span>
         lea       <span class="token register variable">rcx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span><span class="token comment">;a2=a2[i+3]</span>
         lea       <span class="token register variable">rdx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">]</span><span class="token comment">;a1=a1[i+7]</span>
         mov       DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token register variable">eax</span><span class="token comment">;a2=a1</span>
         dec       <span class="token register variable">r8</span><span class="token comment">;r8--</span>
         jne       SHORT <span class="token operator">$</span>LL3@f
<span class="token label function">$LN1@f:</span>
         ret       <span class="token number">0</span>
f        ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÈáåÊúâ‰∏â‰∏™Ëø≠‰ª£ÂèòÈáèÔºåÂàÜÂà´ÊòØ<code>cnt</code>ÂèòÈáèÔºå‰ª•Âèä‰∏§‰∏™Êï∞ÂàóÂèÇÊï∞ÔºåÊï∞ÂàóÂèÇÊï∞ÊØèÊ¨°Ëø≠‰ª£ÈÉΩÂ¢ûÂä†<code>12</code>ÊàñËÄÖ<code>28</code></p>
<p>ÂèØ‰ª•Áî®CËØ≠Ë®ÄÈáçÂÜô‰ª£Á†Å</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>a1<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token class-name">size_t</span> cnt<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>
        <span class="token class-name">size_t</span> idx1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> idx2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">// copy from one array to another in some weird scheme</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
               a1<span class="token punctuation">[</span>idx1<span class="token punctuation">]</span><span class="token operator">=</span>a2<span class="token punctuation">[</span>idx2<span class="token punctuation">]</span><span class="token punctuation">;</span>
               idx1<span class="token operator">+=</span><span class="token number">3</span><span class="token punctuation">;</span>
               idx2<span class="token operator">+=</span><span class="token number">7</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Ëøô‰∏™Á®ãÂ∫èÂèØÂú®ÊØèÊ¨°Ëø≠‰ª£Êõ¥Êñ∞3‰∏™Ëø≠‰ª£ÂèÇÊï∞ÔºåËÄå‰∏çÊòØ1‰∏™„ÄÇÂè¶Â§ñÔºåÁºñËØëÂô®ÂèòÁõ∏ÂÆûÁé∞‰∫Ü‰∏§‰∏™‰πòÊ≥ïÊìç‰Ωú„ÄÇ</code></p>
<hr />
<p><code>GCC 4.9</code>ÂÅöÁöÑÊõ¥Â•ΩÔºåÂè™Êúâ‰∏§‰∏™Ëø≠‰ª£</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; RDI=a1</span>
<span class="token comment">; RSI=a2</span>
<span class="token comment">; RDX=cnt</span>
<span class="token label function">f:</span>
        test     <span class="token register variable">rdx</span>, <span class="token register variable">rdx</span> <span class="token comment">; cnt==0? exit then</span>
        je       .L1
<span class="token comment">; calculate last element address in "a2" and leave it in RDX</span>
        lea      <span class="token register variable">rax</span>, <span class="token operator">[</span><span class="token number">0</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; RAX=RDX*4=cnt*4</span>
        sal      <span class="token register variable">rdx</span>, <span class="token number">5</span>
<span class="token comment">; RDX=RDX&lt;&lt;5=cnt*32</span>
        sub      <span class="token register variable">rdx</span>, <span class="token register variable">rax</span>
<span class="token comment">; RDX=RDX-RAX=cnt*32-cnt*4=cnt*28</span>
        add      <span class="token register variable">rdx</span>, <span class="token register variable">rsi</span>
<span class="token comment">; RDX=RDX+RSI=a2+cnt*28</span>
<span class="token label function">.L3:</span>
        mov      <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">]</span>
        add      <span class="token register variable">rsi</span>, <span class="token number">28</span>
        add      <span class="token register variable">rdi</span>, <span class="token number">12</span>
        mov      DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
        cmp      <span class="token register variable">rsi</span>, <span class="token register variable">rdx</span>
        jne      .L3
<span class="token label function">.L1:</span>
        rep ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ËøôÈáå<code>counter</code>Áõ¥Êé•Ê≤°‰∫Ü</li>
<li>Êï∞ÁªÑ<code>a2</code>ÁöÑÊúÄÂêé‰∏Ä‰∏™ÂèÇÊï∞Âú®Âæ™ÁéØÂºÄÂßãÂâçÂ∞±Â∑≤ÁªèËÆ°ÁÆóÂ•Ω‰∫Ü(cnt*7)</li>
<li>Âæ™ÁéØÁªìÊùüÁöÑÊù°‰ª∂Áõ¥Êé•ÊòØÂèØÈ¢ÑÂÖàËÆ°ÁÆóÁöÑ‰∏¥ÁïåÁ¥¢Âºï</li>
</ul>
<p>ÈáçÂÜôÂêéÁöÑC‰ª£Á†ÅÂ¶Ç‰∏ã</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>a1<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token class-name">size_t</span> cnt<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>
        <span class="token class-name">size_t</span> idx1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> idx2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">size_t</span> last_idx2<span class="token operator">=</span>cnt<span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">;</span>

        <span class="token comment">// copy from one array to another in some weird scheme</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
                a1<span class="token punctuation">[</span>idx1<span class="token punctuation">]</span><span class="token operator">=</span>a2<span class="token punctuation">[</span>idx2<span class="token punctuation">]</span><span class="token punctuation">;</span>
                idx1<span class="token operator">+=</span><span class="token number">3</span><span class="token punctuation">;</span>
                idx2<span class="token operator">+=</span><span class="token number">7</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>idx2<span class="token operator">==</span>last_idx2<span class="token punctuation">)</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>INTEL C++ 2011ÂÆû‰æã</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">f        PROC
<span class="token comment">; parameter 1: rcx = a1</span>
<span class="token comment">; parameter 2: rdx = a2</span>
<span class="token comment">; parameter 3: r8 = cnt</span>
<span class="token label function">.B1.1:</span>:                               <span class="token comment">; Preds .B1.0</span>
         test        <span class="token register variable">r8</span>, <span class="token register variable">r8</span>                                       <span class="token comment">;8.14</span>
         jbe         exit             <span class="token comment">; Prob 50%                  ;8.14</span>
                                      <span class="token comment">; LOE rdx rcx rbx rbp rsi rdi r8 r12 r13 r14 r15 xmm6 xmm7 xmm8 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">.B1.2:</span>:                               <span class="token comment">; Preds .B1.1</span>
         cmp         <span class="token register variable">r8</span>, <span class="token number">6</span>                                        <span class="token comment">;8.2</span>
         jbe         just_copy        <span class="token comment">; Prob 50%                  ;8.2</span>
                                      <span class="token comment">; LOE rdx rcx rbx rbp rsi rdi r8 r12 r13 r14 r15 xmm6 xmm7 xmm8 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">.B1.3:</span>:                              <span class="token comment">; Preds .B1.2</span>
         cmp         <span class="token register variable">rcx</span>, <span class="token register variable">rdx</span>                                     <span class="token comment">;9.11</span>
         jbe         .B1<span class="token number">.5</span>„ÄÄ         <span class="token comment">; Prob 50%                   ;9.11</span>
                                     <span class="token comment">; LOE rdx rcx rbx rbp rsi rdi r8 r12 r13 r14 r15 xmm6 xmm7 xmm8 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">.B1.4:</span>:                              <span class="token comment">; Preds .B1.3</span>
         mov         <span class="token register variable">r10</span>, <span class="token register variable">r8</span>                                      <span class="token comment">;9.11</span>
         mov         <span class="token register variable">r9</span>, <span class="token register variable">rcx</span>                                      <span class="token comment">;9.11</span>
         shl         <span class="token register variable">r10</span>, <span class="token number">5</span>                                       <span class="token comment">;9.11</span>
         lea         <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>                        <span class="token comment">;9.11</span>
         sub         <span class="token register variable">r9</span>, <span class="token register variable">rdx</span>                                      <span class="token comment">;9.11</span>
         sub         <span class="token register variable">r10</span>, <span class="token register variable">rax</span>                                     <span class="token comment">;9.11</span>
         cmp         <span class="token register variable">r9</span>, <span class="token register variable">r10</span>                                      <span class="token comment">;9.11</span>
         jge         just_copy2      <span class="token comment">; Prob 50%                   ;9.11</span>
                                     <span class="token comment">; LOE rdx rcx rbx rbp rsi rdi r8 r12 r13 r14 r15 xmm6 xmm7 xmm8 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">.B1.5:</span>:                              <span class="token comment">; Preds .B1.3 .B1.4</span>
         cmp         <span class="token register variable">rdx</span>, <span class="token register variable">rcx</span>                                     <span class="token comment">;9.11</span>
         jbe         just_copy       <span class="token comment">; Prob 50%                   ;9.11</span>
                                     <span class="token comment">; LOE rdx rcx rbx rbp rsi rdi r8 r12 r13 r14 r15 xmm6 xmm7 xmm8 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">.B1.6:</span>:                              <span class="token comment">; Preds .B1.5</span>
         mov         <span class="token register variable">r9</span>, <span class="token register variable">rdx</span>                                      <span class="token comment">;9.11</span>
         lea         <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>                        <span class="token comment">;9.11</span>
         sub         <span class="token register variable">r9</span>, <span class="token register variable">rcx</span>                                      <span class="token comment">;9.11</span>
         lea         <span class="token register variable">r10</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">r8</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>                    <span class="token comment">;9.11</span>
         cmp         <span class="token register variable">r9</span>, <span class="token register variable">r10</span>                                      <span class="token comment">;9.11</span>
         jl          just_copy       <span class="token comment">; Prob 50%                   ;9.11</span>
                                     <span class="token comment">; LOE rdx rcx rbx rbp rsi rdi r8 r12 r13 r14 r15 xmm6 xmm7 xmm8 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">just_copy2:</span>:                         <span class="token comment">; Preds .B1.4 .B1.6</span>
<span class="token comment">; R8 = cnt</span>
<span class="token comment">; RDX = a2</span>
<span class="token comment">; RCX = a1</span>
         xor        <span class="token register variable">r10d</span>, <span class="token register variable">r10d</span>                                    <span class="token comment">;8.2</span>
         xor        <span class="token register variable">r9d</span>, <span class="token register variable">r9d</span>                                      <span class="token comment">;</span>
         xor        <span class="token register variable">eax</span>, <span class="token register variable">eax</span>                                      <span class="token comment">;</span>
                                     <span class="token comment">; LOE rax rdx rcx rbx rbp rsi rdi r8 r9 r10 r12 r13 r14 r15 xmm6 xmm7 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm8</span> <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">.B1.8:</span>:                              <span class="token comment">; Preds .B1.8 just_copy2</span>
         mov        <span class="token register variable">r11d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">]</span>                     <span class="token comment">;3.6</span>
         inc        <span class="token register variable">r10</span>                                           <span class="token comment">;8.2</span>
         mov        DWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">+</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token register variable">r11d</span>                      <span class="token comment">;3.6</span>
         add        <span class="token register variable">r9</span>, <span class="token number">12</span>                                        <span class="token comment">;8.2</span>
         add        <span class="token register variable">rax</span>, <span class="token number">28</span>                                       <span class="token comment">;8.2</span>
         cmp        <span class="token register variable">r10</span>, <span class="token register variable">r8</span>                                       <span class="token comment">;8.2</span>
         jb         .B1<span class="token number">.8</span>             <span class="token comment">; Prob 82%                  ;8.2</span>
         jmp        exit              <span class="token comment">; Prob 100%                 ;8.2</span>
                                      <span class="token comment">; LOE rax rdx rcx rbx rbp rsi rdi r8 r9 r10 r12 r13 r14 r15 xmm6 xmm7 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm8</span> <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">just_copy:</span>:                           <span class="token comment">; Preds .B1.2 .B1.5 .B1.6</span>
<span class="token comment">; R8 = cnt</span>
<span class="token comment">; RDX = a2</span>
<span class="token comment">; RCX = a1</span>
         xor        <span class="token register variable">r10d</span>, <span class="token register variable">r10d</span>                                    <span class="token comment">;8.2</span>
         xor        <span class="token register variable">r9d</span>, <span class="token register variable">r9d</span>                                      <span class="token comment">;</span>
         xor        <span class="token register variable">eax</span>, <span class="token register variable">eax</span>                                      <span class="token comment">;</span>
                                      <span class="token comment">; LOE rax rdx rcx rbx rbp rsi rdi r8 r9 r10 r12 r13 r14 r15 xmm6 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm7</span> <span class="token register variable">xmm8</span> <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">.B1.11:</span>:                              <span class="token comment">; Preds .B1.11 just_copy</span>
         mov        <span class="token register variable">r11d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">]</span>                     <span class="token comment">;3.6</span>
         inc        <span class="token register variable">r10</span>                                           <span class="token comment">;8.2</span>
         mov        DWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">+</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token register variable">r11d</span>                      <span class="token comment">;3.6</span>
         add        <span class="token register variable">r9</span>, <span class="token number">12</span>                                        <span class="token comment">;8.2</span>
         add        <span class="token register variable">rax</span>, <span class="token number">28</span>                                       <span class="token comment">;8.2</span>
         cmp        <span class="token register variable">r10</span>, <span class="token register variable">r8</span>                                       <span class="token comment">;8.2</span>
         jb         .B1<span class="token number">.11</span>             <span class="token comment">; Prob 82%                 ;8.2</span>
                                       <span class="token comment">; LOE rax rdx rcx rbx rbp rsi rdi r8 r9 r10 r12 r13 r14 r15 xmm6 ‚Üô</span>
    ‚Üò <span class="token register variable">xmm7</span> <span class="token register variable">xmm8</span> <span class="token register variable">xmm9</span> <span class="token register variable">xmm10</span> <span class="token register variable">xmm11</span> <span class="token register variable">xmm12</span> <span class="token register variable">xmm13</span> <span class="token register variable">xmm14</span> <span class="token register variable">xmm15</span>
<span class="token label function">exit:</span>:                                 <span class="token comment">; Preds .B1.11 .B1.8 .B1.1</span>
         ret                                                      <span class="token comment">;10.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>‰∏äËø∞Á®ãÂ∫èÈ¶ñÂÖàÊ†πÊçÆËæìÂÖ•ÂèÇÊï∞Á°ÆÂÆöÂàÜÊîØÔºåÊé•ÁùÄÊâßË°åÁõ∏Â∫îÁöÑ‰æãÁ®ã„ÄÇËôΩÁÑ∂ÂÆÉÁúãËµ∑Êù•Â∞±ÂÉèÊòØÊ£ÄÊü•Êï∞ÁªÑ‰∫§ÂèâÂàÜÂèâÔºå‰ΩÜÊòØÁºñËØëÂô®ÈááÁî®ÁöÑÊòØ‰∏ÄÁßçÈùûÂ∏∏ËëóÂêçÁöÑÂÜÖÂ≠òÂùóÂ§çÂà∂‰æãÁ®ã(ÂÖ∂ÂÆûÊØèÂùóÂÆûÁé∞ÁöÑÂäüËÉΩË≤å‰ººÊòØ‰∏ÄÊ†∑ÁöÑÔºå‰ΩÜÊòØÂÆûÁé∞ÊñπÊ≥ï‰∏çÂ§™‰∏ÄÊ†∑ÔºåËøôÈáåËÆ°ÁÆó‰∫ÜÊ¶ÇÁéá)ÁöÑ‰ºòÂåñÊñπÊ≥ï„ÄÇ‰ªîÁªÜÂàÜÊûêÂ∞±‰ºöÂèëÁé∞ÔºåÂÆÉÊâÄÂ§çÂà∂ÁöÑ‰æãÁ®ãÂ±ÖÁÑ∂ÂÆåÂÖ®Áõ∏Âêå„ÄÇËøôÊàñËÆ∏ÊòØIntel C++ÁºñËØëÂô®ÁöÑÊüêÁßç‰∏çË∂≥Âêß„ÄÇÁÑ∂ËÄåÊó†ËÆ∫ÊÄéÊ†∑ÔºåÊúÄÂêéÁîüÊàêÁöÑÁ®ãÂ∫èÂäüËÉΩÊ≠£Â∏∏„ÄÇ</li>
<li>ËôΩÁÑ∂ÂæàÂ§çÊùÇÔºå‰ΩÜÊòØËøòÊòØËÉΩÂÆûÁé∞ÂäüËÉΩ(Âü∫Êú¨‰∏äÂè™Áî®ÂàÜÊûê‰∏Ä‰∏™ÂùóÂ∞±ËÉΩÂ§ßÊ¶ÇÁü•ÈÅìÂäüËÉΩ‰∫Ü)</li>
</ul>
<h3 id="chap40-ËææÂ§´Ë£ÖÁΩÆ"><a class="markdownIt-Anchor" href="#chap40-ËææÂ§´Ë£ÖÁΩÆ"></a> Chap40 ËææÂ§´Ë£ÖÁΩÆ</h3>
<p>ËææÂ§´Ë£ÖÁΩÆÊòØ‰∏ÄÁßçÁªºÂêà‰∫ÜÂ§öÁßçÊéßÂà∂ËØ≠Âè•ÁöÑÂæ™ÁéØÂ±ïÂºÄÊäÄÊúØÔºåÂèØÂ§ßÂπÖÂ∫¶Âú∞ÂáèÂ∞ë‰ª£Á†ÅÁöÑÂàÜÊîØÊÄªÊï∞„ÄÇ</p>
<p>ËøôÁßçÂæ™ÁéØÂ±ïÂºÄÊäÄÊúØÂ∑ßÂ¶ôÂú∞Âà©Áî®‰∫ÜswtichËØ≠Âè•ÁöÑÊªëÊ¢ØÔºàfallthroughÔºâÊïàÂ∫î„ÄÇ</p>
<p>Êú¨Á´†ÂØπTom DuffÁöÑÂéüÂßãÁ®ãÂ∫èËøõË°å‰∫ÜËΩªÂ∫¶ÁÆÄÂåñ„ÄÇ</p>
<p><em>Áé∞Âú®ÂÅáËÆæÊàë‰ª¨Ë¶ÅÁºñÂÜô‰∏Ä‰∏™Ê∏ÖÈô§‰∏ÄÂùóËøûÁª≠ÂÜÖÂ≠òÁöÑÂáΩÊï∞„ÄÇÂΩìÁÑ∂ÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®Âæ™ÁéØËØ≠Âè•„ÄÅÈÄê‰∏™Â≠óËäÇÁöÑÂ§çÂÜôÊï∞ÊçÆ„ÄÇ‰ΩÜÊòØÁé∞‰ª£ÁöÑËÆ°ÁÆóÊú∫ÂÜÖÂ≠òÊÄªÁ∫øÈÉΩÂæàÂÆΩÔºå‰ª•Â≠óËäÇ‰∏∫Âçï‰ΩçÂú∞Ê∏ÖÈô§ÊïàÁéá‰ºöÈùûÂ∏∏‰Ωé„ÄÇËã•‰ª•4Â≠óËäÇÊàñ8Â≠óËäÇ‰∏∫Êìç‰ΩúÂçï‰ΩçËøõË°åioÊìç‰ΩúÔºåÈÇ£‰πàÊìç‰ΩúÊïàÁéá‰ºöÈ´ò‰∏Ä‰∫õ„ÄÇÁî±‰∫éÊú¨‰æãÊºîÁ§∫ÁöÑÊòØ64‰ΩçÂ∫îÁî®Á®ãÂ∫èÔºåÊâÄ‰ª•Êàë‰ª¨Â∞±‰ª•8Â≠óËäÇ‰∏∫Âçï‰ΩçËøõË°åÊìç‰ΩúÔºå‰∏çËøáÔºåÊàë‰ª¨ÂèàÂΩìÂ¶Ç‰ΩïÂ∫îÂØπÈÇ£‰∫õ‰∏çË∂≥8Â≠óËäÇÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºüÊØïÁ´üÊàë‰ª¨ÁöÑÂáΩÊï∞‰πüÂèØËÉΩÊ∏ÖÈô§ÂÆπÈáè‰∏çË∂≥8Â≠óËäÇÁöÑÂÜÖÂ≠òÁ©∫Èó¥</em></p>
<p>ÂêàÁêÜÁöÑÁÆóÊ≥ï</p>
<ul>
<li>È¶ñÂÖàÁªüËÆ°ÁõÆÊ†áÁ©∫Èó¥Âê´ÊúâÂ§öÂ∞ë‰∏™ËøûÁª≠ÁöÑ8Â≠óËäÇÁ©∫Èó¥ÔºåÁªßËÄå‰ª•8Â≠óËäÇ‰∏∫Êìç‰ΩúÂçï‰ΩçÂ∞ÜÂÖ∂Ê∏ÖÈô§</li>
<li>ÁÑ∂ÂêéÁªüËÆ°ÈÇ£‰∫õÂ§ßÂ∞è‰∏çË∂≥8Â≠óËäÇÁöÑÂ∞æÊï∞ÔºåÂç≥‰∏ä‰∏ÄÊ≠•Èô§Ê≥ïËÆ°ÁÆóÁöÑ‰ΩôÊï∞ÔºåÁÑ∂ÂêéÈÄêÂ≠óËäÇÂú∞Â∞Ü‰πãÊ∏ÖÈõ∂</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span> dst<span class="token punctuation">,</span> <span class="token class-name">size_t</span> count<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">int</span> i<span class="token punctuation">;</span>

         <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token comment">// work out 8-byte blocks</span>
                  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>count<span class="token operator">>></span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                  <span class="token punctuation">&#123;</span>
                           <span class="token operator">*</span><span class="token punctuation">(</span><span class="token class-name">uint64_t</span><span class="token operator">*</span><span class="token punctuation">)</span>dst<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                           dst<span class="token operator">=</span>dst<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">;</span>
                  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

         <span class="token comment">// work out the tail</span>
         <span class="token keyword">switch</span><span class="token punctuation">(</span>count <span class="token operator">&amp;</span> <span class="token number">7</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
         <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token operator">*</span>dst<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token operator">*</span>dst<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token operator">*</span>dst<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token operator">*</span>dst<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token operator">*</span>dst<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token operator">*</span>dst<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token operator">*</span>dst<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token comment">// do nothing</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Á¨¨‰∏ÄÈÉ®ÂàÜÊØîËæÉÁÆÄÂçïÔºåÂ∞±ÊòØÁî®64‰ΩçÁöÑÈõ∂Â°´ÂÖÖÊâÄÊúâ8Â≠óËäÇÁöÑÂÜÖÂ≠òÂùó</li>
<li>Á¨¨‰∫åÈÉ®ÂàÜÁöÑÈöæÁÇπÂú®‰∫éÂÖ∂Âæ™ÁéØÂ±ïÂºÄÊäÄÊúØÔºåÂà©Áî®‰∫Ü<code>Switch</code>ÂáΩÊï∞ÁöÑÊªëÊ¢ØÊïàÂ∫îÔºåÂäüËÉΩÂ∞±ÊòØÂ∞ÜÂèòÈáè<code>count</code>‰∏éÊï∞Â≠ó7ËøõË°åÈÄªËæë‰∏éËøêÁÆóÔºåÂæóÂà∞Â∞æÊï∞ÔºåÁÑ∂ÂêéÊää‰ªñ‰ª¨ÈÄê‰∏™Ê∏ÖÈõ∂„ÄÇÂ¶ÇÊûúÂ∞æÊï∞‰∏∫0ÔºåÈÇ£‰πàÁõ¥Êé•Ë∑≥ËΩ¨Ëá≥ÂáΩÊï∞Â∞æÂ£∞</li>
<li>ËææÂ§´Ë£ÖÁΩÆÂ∞±ÊòØÂæ™ÁéØÂ±ïÂºÄÊäÄÊúØÁöÑ‰∏ÄÁßçÁâπ‰æã„ÄÇÂú®ËÄÅÂºèËÆæÂ§á‰∏äÔºåÂÆÉÊòæÁÑ∂ÊØîÊôÆÈÄöÂæ™ÁéØÁöÑËøêË°åÈÄüÂ∫¶Êõ¥È´ò„ÄÇÁÑ∂ËÄåÔºåÂØπ‰∫éÁé∞‰ª£ÁöÑÂ§ßÂ§öÊï∞CPUÊù•ËØ¥Ôºå‰∏Ä‰∫õ‰ΩìÁßØÁü≠Â∞èÁöÑÂæ™ÁéØËØ≠Âè•ÂèçËÄå‰ºöÊØîÂæ™ÁéØÂ±ïÂºÄ‰ΩìÁöÑÊâßË°åÈÄüÂ∫¶Êõ¥Âø´„ÄÇ‰πüËÆ∏ÂØπ‰∫éÁõÆÂâç‰ΩéÊàêÊú¨ÁöÑÂµåÂÖ•ÂºèMCUÔºàÂæÆÊéßÂçïÂÖÉÔºå‰æãÂ¶ÇÂçïÁâáÊú∫ÔºâÂ§ÑÁêÜÂô®ËÄåË®ÄÔºåËææÂ§´ËÆæÂ§áÊõ¥ÊúâÊÑè‰πâ‰∏Ä‰∫õ„ÄÇ</li>
</ul>
<hr />
<p><code>Optimizing msvs 2012</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">dst<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
count<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>
bzero    PROC
         test    <span class="token register variable">rdx</span>, <span class="token operator">-</span><span class="token number">8</span><span class="token comment">;rdx=count;&amp;(~7)ÂêéËÆæÁΩÆÊ†áÂøó‰Ωç</span>
         je      SHORT <span class="token operator">$</span>LN11@bzero
<span class="token comment">; work out 8-byte blocks</span>
         xor     <span class="token register variable">r10d</span>, r10dlÔºõ<span class="token register variable">r10</span><span class="token operator">=</span><span class="token number">0</span>
         mov     <span class="token register variable">r9</span>, <span class="token register variable">rdx</span><span class="token comment">;r9==count</span>
         shr     <span class="token register variable">r9</span>, <span class="token number">3</span><span class="token comment">;r9=count>>3</span>
         mov     <span class="token register variable">r8d</span>, <span class="token register variable">r10d</span><span class="token comment">;r8d:i=0</span>
         test    <span class="token register variable">r9</span>, <span class="token register variable">r9</span><span class="token comment">;if count ==0 ?</span>
         je      SHORT <span class="token operator">$</span>LN11@bzero
         npad    <span class="token number">5</span>
<span class="token label function">$LL19@bzero:</span>
         inc     <span class="token register variable">r8d</span><span class="token comment">;i++</span>
         mov     QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token register variable">r10</span>
         add     <span class="token register variable">rcx</span>, <span class="token number">8</span><span class="token comment">;rcx:dst+8</span>
         movsxd  <span class="token register variable">rax</span>, <span class="token register variable">r8d</span><span class="token comment">;rax</span>
         cmp     <span class="token register variable">rax</span>, <span class="token register variable">r9</span><span class="token comment">;if i == count ?</span>
         jb      SHORT <span class="token operator">$</span>LL19@bzero n? jmp
<span class="token label function">$LN11@bzero:</span>
<span class="token comment">; work out the tail</span>
         and     <span class="token register variable">edx</span>, <span class="token number">7</span>
         dec     <span class="token register variable">rdx</span>
         cmp     <span class="token register variable">rdx</span>, <span class="token number">6</span>
         ja      SHORT <span class="token operator">$</span>LN9@bzero
         lea     <span class="token register variable">r8</span>, OFFSET FLAT:__ImageBase
         mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">$</span>LN22@bzero<span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
         add     <span class="token register variable">rax</span>, <span class="token register variable">r8</span>
         jmp     <span class="token register variable">rax</span>
<span class="token label function">$LN8@bzero:</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">0</span>
         inc     <span class="token register variable">rcx</span>
<span class="token label function">$LN7@bzero:</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">0</span>
         inc     <span class="token register variable">rcx</span>
<span class="token label function">$LN6@bzero:</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">0</span>
         inc     <span class="token register variable">rcx</span>
<span class="token label function">$LN5@bzero:</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">0</span>
         inc     <span class="token register variable">rcx</span>
<span class="token label function">$LN4@bzero:</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">0</span>
         inc     <span class="token register variable">rcx</span>
<span class="token label function">$LN3@bzero:</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">0</span>
         inc     <span class="token register variable">rcx</span>
<span class="token label function">$LN2@bzero:</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">0</span>
<span class="token label function">$LN9@bzero:</span>
         fatret  <span class="token number">0</span>
         npad    <span class="token number">1</span>
<span class="token label function">$LN22@bzero:</span>
         DD      <span class="token operator">$</span>LN2@bzero
         DD      <span class="token operator">$</span>LN3@bzero
         DD      <span class="token operator">$</span>LN4@bzero
         DD      <span class="token operator">$</span>LN5@bzero
         DD      <span class="token operator">$</span>LN6@bzero
         DD      <span class="token operator">$</span>LN7@bzero
         DD      <span class="token operator">$</span>LN8@bzero
bzero    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>Á¨¨‰∏ÄÈÉ®ÂàÜ‰∏éÊ∫êÁ®ãÂ∫èÂØπÂ∫î</p>
</li>
<li>
<p>Á¨¨‰∫åÈÉ®ÂàÜÁöÑÂæ™ÁéØÂ±ïÂºÄ‰Ωì:<code>switch</code>ËØ≠Âè•ÈÄöËøáËΩ¨ÁßªÊåá‰ª§Áõ¥Êé•Ë∑≥Âà∞ÂêàÈÄÇÁöÑ‰ΩçÁΩÆÔºåÁî±‰∫é<code>mov/inc</code>Êåá‰ª§ÂØπ‰πãÈó¥Ê≤°ÊúâÂÖ∂‰ªñ‰ª£Á†ÅÔºåÊâÄ‰ª•<code>switch</code>ËØ≠Âè•Âú®ËΩ¨ÁßªÂà∞ÊåáÂÆöÊ†áÁ≠æÂêé‰∏ç‰ºöË∂äËøáÂêéÁª≠ÁöÑËΩ¨ÁßªÊ†áÁ≠æÔºå‰ºöÊâßË°åÂÆåÂêéÁª≠ÁöÑËΩ¨ÁßªÊ†áÁ≠æ</p>
</li>
<li>
<p>Âè¶Â§ñÔºåÊàë‰ª¨ÂèØ‰ª•ÁªßÁª≠‰ºòÂåñËøô‰∏™Á®ãÂ∫èÔºå<code>MOV/INC</code>Êåá‰ª§ÂØπÊòØÂç†Áî®Âõ∫ÂÆöÁöÑÂ≠óËäÇÊï∞(3+3=6Â≠óËäÇ),Âõ†Ê≠§Êàë‰ª¨ÂèØ‰ª•ËàçÂéª<code>switch</code>ËØ≠Âè•ÁöÑËΩ¨ÁßªË°®ÁªìÊûÑÔºåÁõ¥Êé•Ë∑≥ËΩ¨Âà∞Â¶Ç‰∏ãÂú∞ÂùÄ<code>ÁõÆÂâçÁöÑRIPÂú∞ÂùÄ+ËæìÂÖ•ÂÄº*6</code>ÔºåËøôÊ†∑Â∞±ÁúÅÊéâ‰∫Ü‰ªéËΩ¨ÁßªË°®ÁöÑÊü•ËØ¢Êìç‰ΩúÔºåÊâßË°åÈÄüÂ∫¶Êõ¥Âø´</p>
<p>‰ΩÜÊòØÂØπ‰∫é‰πòÊ≥ïÊù•ËØ¥Ôºå<code>6</code>‰∏çÊòØ‰∏Ä‰∏™ËÆ°ÁÆóÊïàÁéáÈ´òÁöÑÂõ†Â≠êÔºåÂèØËÉΩÊØîË°®Êü•ËØ¢ÁöÑËΩ¨ÁßªÊåá‰ª§Êõ¥ÊÖ¢</p>
</li>
</ul>
<h3 id="chap41-Èô§‰ª•9"><a class="markdownIt-Anchor" href="#chap41-Èô§‰ª•9"></a> Chap41 Èô§‰ª•9</h3>
<h4 id="ÂÆû‰æã"><a class="markdownIt-Anchor" href="#ÂÆû‰æã"></a> ÂÆû‰æã</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a<span class="token operator">/</span><span class="token number">9</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>               <span class="token comment">; size = 4</span>
_f     PROC
     push   <span class="token register variable">ebp</span>
     mov    <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
     mov    <span class="token register variable">eax</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     cdq              <span class="token comment">; sign extend EAX to EDX:EAX</span>
     mov    <span class="token register variable">ecx</span>, <span class="token number">9</span>
     idiv   <span class="token register variable">ecx</span>
     pop    <span class="token register variable">ebp</span>
     ret    <span class="token number">0</span>
_f   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>CDQÔºàConvert Double-word to Quad-wordÔºâÊòØ‰∏Ä‰∏™Âú®x86Ê±áÁºñËØ≠Ë®Ä‰∏≠‰ΩøÁî®ÁöÑÊåá‰ª§ÔºåÈÄÇÁî®‰∫éIntel 80386ÂèäÂêéÁª≠ÁöÑÂ§ÑÁêÜÂô®„ÄÇÂÆÉÁöÑ‰∏ªË¶ÅÂäüËÉΩÊòØÂ∞Ü<code>‰∏Ä‰∏™32‰ΩçÁöÑÂ∏¶Á¨¶Âè∑ÂèåÂ≠óÔºàDouble-wordÔºåÈÄöÂ∏∏ÊåáÁöÑÊòØEAXÂØÑÂ≠òÂô®ÁöÑÂÜÖÂÆπÔºâÊâ©Â±ï‰∏∫‰∏Ä‰∏™64‰ΩçÁöÑÂ∏¶Á¨¶Âè∑Quad-wordÔºåÁî®‰∫éÂ≠òÂÇ®Âú®EDX:EAXÂØÑÂ≠òÂô®ÂØπ‰∏≠Ôºå</code>‰ª•ÊîØÊåÅÊüê‰∫õÈúÄË¶Å64‰ΩçÊìç‰ΩúÁöÑÊìç‰ΩúÔºåÊØîÂ¶ÇÈô§Ê≥ïÂíå‰∏Ä‰∫õ‰πòÊ≥ïËøêÁÆó„ÄÇ</p>
<ul>
<li>
<p>ÂÆÉÊ£ÄÊü•EAXÂØÑÂ≠òÂô®ÁöÑÊúÄÈ´ò‰ΩçÔºàÁ¨¨31‰ΩçÔºâÔºåËøôÊòØ‰∏Ä‰ΩçÊ†áÂøóÊï∞Â≠óÁöÑÊ≠£Ë¥üÔºàÊ≠£Êï∞‰∏∫0ÔºåË¥üÊï∞‰∏∫1Ôºâ„ÄÇ</p>
</li>
<li>
<p>Ê†πÊçÆEAXÁöÑÊúÄÈ´ò‰ΩçÔºåCDQ‰ºöÊääËØ•‰ΩçÁöÑÂÄºÂ§çÂà∂Âà∞EDXÂØÑÂ≠òÂô®ÁöÑÊâÄÊúâ‰Ωç‰∏ä„ÄÇÂ¶ÇÊûúEAXÁöÑÊúÄÈ´ò‰ΩçÊòØ0ÔºåÈÇ£‰πàEDX‰ºöË¢´Ê∏ÖÈõ∂Ôºà00000000Ôºâ„ÄÇÂ¶ÇÊûúEAXÁöÑÊúÄÈ´ò‰ΩçÊòØ1ÔºàË°®Á§∫‰∏Ä‰∏™Ë¥üÊï∞ÔºâÔºåÈÇ£‰πàEDX‰ºöË¢´Â°´ÂÖÖ‰∏∫FFFFFFFFÔºàÊâÄÊúâ‰ΩçÈÉΩÊòØ1ÔºâÔºåËøôÁõ∏ÂΩì‰∫éÂú®Êï∞Â≠¶‰∏≠ÂØπË¥üÊï∞ËøõË°åÁ¨¶Âè∑Êâ©Â±ïÔºå‰øùÊåÅ‰∫ÜÊï∞ÂÄºÁöÑÊ≠£Á°ÆÊÄß„ÄÇ</p>
<p>eg.   8----&gt; 0000 1000  -8-----&gt; 1111 1000</p>
</li>
</ul>
</li>
<li>
<p><code>iDIV</code>Êåá‰ª§ÊòØ(Â∏¶Á¨¶Âè∑ÁöÑÔºâÈô§Ê≥ïÊåá‰ª§„ÄÇÂÆÉ‰ºö‰ªéÂØÑÂ≠òÂô®ÂØπ<code>EDX:EAX</code>‰∏≠ÊèêÂèñË¢´Èô§Êï∞Ôºå‰ªé<code>ECX</code>ÂØÑÂ≠òÂô®‰∏≠ÊèêÂèñÈô§Êï∞„ÄÇËÆ°ÁÆóÁªìÊùü‰ª•ÂêéÔºåÂÆÉÊääËÆ°ÁÆóÁªìÊûú/ÂïÜÂ≠òÂÇ®Âú®<code>EAX</code>ÂØÑÂ≠òÂô®ÈáåÔºåÊää‰ΩôÊï∞Â≠òÂÇ®Âú®<code>EDX</code>ÂØÑÂ≠òÂô®„ÄÇÈô§Ê≥ïËÆ°ÁÆó‰πãÂêéÔºåÂïÜÂ∞±‰Ωç‰∫é<code>EAX</code>ÂØÑÂ≠òÂô®ÈáåÔºåÁõ¥Êé•Êàê‰∏∫<code>f()</code>ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºõÂõ†Ê≠§Ê≤°ÊúâÂÖ∂‰ªñÂÄº‰º†ÈÄíÁöÑÊìç‰Ωú„ÄÇ‰∏∫‰∫ÜÈÄöÁü•<code>IDIV</code>Êåá‰ª§‰ªé<code>EDX:EAX</code>ÂØÑÂ≠òÂô®ÂØπ‰∏≠ÊèêÂèñ<code>64‰ΩçË¢´Èô§Êï∞¬∑</code>,‰∏∫‰∫ÜÈÄöÁü•<code>IDIV</code>‰ªé<code>EDX:EAX</code>ÂØÑÂ≠òÂô®ÂØπ‰∏≠ÊèêÂèñ64‰ΩçË¢´Èô§Êï∞ÔºåÁºñËØëÂô®Âú®<code>IDIV</code>Êåá‰ª§‰πãÂâçÂàÜÈÖç‰∫Ü<code>CDQ</code>Êåá‰ª§„ÄÇ<code>IDIV</code>Êåá‰ª§Â∞±‰ºöËøõË°å<code>MOVSX</code>ÈÇ£Ê†∑ÁöÑÁ¨¶Âè∑‰ΩçÂ§ÑÁêÜÂíåÊï∞ÊçÆÊãìÂ±ïÂ§ÑÁêÜ</p>
</li>
</ul>
<hr />
<p><code>ÂºÄÂêØ‰ºòÂåñÂêé</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                       <span class="token comment">; size = 4</span>
_f     PROC
     mov     <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
     mov     <span class="token register variable">eax</span>, <span class="token number">954437177</span>   <span class="token comment">; 38e38e39H</span>
     imul    <span class="token register variable">ecx</span>
     sar     <span class="token register variable">edx</span>, <span class="token number">1</span>
     mov     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
     shr     <span class="token register variable">eax</span>, <span class="token number">31</span>          <span class="token comment">; 0000001fH</span>
     add     <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
     ret     <span class="token number">0</span>
_f     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>sar </code>Êåá‰ª§‰ª£Ë°® ‚ÄúShift Arithmetic Right‚ÄùÔºåÂç≥ÁÆóÊúØÂè≥Áßª„ÄÇËøôÊòØ‰∏Ä‰∏™Áî®‰∫éÂ§ÑÁêÜÂ∏¶Á¨¶Âè∑Êï¥Êï∞ÁöÑÊï∞ÊçÆÁßªÂä®Êìç‰Ωú„ÄÇÂΩìÊâßË°å <code>sar</code> Êåá‰ª§Êó∂</li>
<li>ÁºñËØëÂô®Áî®‰πòÊ≥ïÊåá‰ª§Êù•ÂèòÁõ∏ÂÆûÁé∞Èô§Ê≥ïËøêÁÆó(‰πòÊ≥ïÁöÑÊïàÁéáÈ´ò‰∫éÈô§Ê≥ï)(Ëøô‰∏™ÊòØÊúâÁõ∏Â∫îÁöÑËΩ¨Êç¢ÂÖ¨ÂºèÁöÑ)</li>
</ul>
<p>Âú®ÁºñËØë‰ºòÂåñ‰∏≠ÔºåÊàë‰ª¨Â∏∏Â∏∏Â∞ÜÂÖ∂Áß∞‰∏∫&quot;Âº∫Â∫¶ÂáèËΩª&quot;ÁöÑÂäûÊ≥ï</p>
<hr />
<h4 id="ÂéüÁêÜ"><a class="markdownIt-Anchor" href="#ÂéüÁêÜ"></a> ÂéüÁêÜ</h4>
<p>ÂºïÂÖ•<code>2ÁöÑnÊ¨°Êñπ‰πãÂêé</code>ÔºåÈô§Ê≥ïËøêÁÆóÂèØËΩ¨Êç¢‰∏∫‰πòÊ≥ïËøêÁÆó:</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>u</mi><mi>l</mi><mi>t</mi><mo>=</mo><mfrac><mrow><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi></mrow><mrow><mi>d</mi><mi>i</mi><mi>v</mi><mi>i</mi><mi>s</mi><mi>o</mi><mi>r</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>‚àó</mo><mfrac><msup><mn>2</mn><mi>n</mi></msup><mrow><mi>d</mi><mi>i</mi><mi>v</mi><mi>i</mi><mi>s</mi><mi>o</mi><mi>r</mi></mrow></mfrac></mrow><msup><mn>2</mn><mi>n</mi></msup></mfrac><mo>=</mo><mfrac><mrow><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>‚àó</mo><mi>M</mi></mrow><msup><mn>2</mn><mi>n</mi></msup></mfrac></mrow><annotation encoding="application/x-tex">result=\frac{input}{divisor}=\frac{input*\frac{2^n}{divisor}}{2^n}=\frac{input*M}{2^n}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.02252em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.33198em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6459800000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.590392em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7350000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">‚àó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.91098em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0463299999999998em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603299999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.590392em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">‚àó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>
<p>ËøôÈáåÁöÑ<code>M</code>ÊòØÈ≠îÊúØÂõ†Â≠ê(Magic coefficient)</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mfrac><msup><mn>2</mn><mi>n</mi></msup><mrow><mi>d</mi><mi>i</mi><mi>v</mi><mi>i</mi><mi>s</mi><mi>o</mi><mi>r</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">M=\frac{2^n}{divisor}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.25598em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.91098em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
</li>
<li>
<p>Èô§‰ª•2<sup>n</sup>ÁöÑËøêÁÆóÂèØ‰ª•Áõ¥Êé•ÈÄöËøáÂè≥ÁßªÊìç‰ΩúÂÆûÁé∞„ÄÇÂ¶ÇÊûúnÂ∞è‰∫é32ÔºåÈÇ£‰πà‰∏≠Èó¥ËøêÁÆóÁöÑÁßØÁöÑ‰Ωén‰Ωç,ÈÄöÂ∏∏‰Ωç‰∫éEAXÊàñRAXÂØÑÂ≠òÂô®Â∞±‰ºöË¢´‰ΩçÁßªËøêÁÆóÁõ¥Êé•ÊäπÂéªÔºõÂ¶ÇÊûú<em>n</em>Â§ß‰∫éÊàñÁ≠â‰∫é32ÔºåÈÇ£‰πàÁßØÁöÑÈ´òÂçäÈÉ®ÂàÜÔºàÈÄöÂ∏∏‰Ωç‰∫éEDXÊàñËÄÖRDXÂØÑÂ≠òÂô®ÔºâÁöÑÊï∞ÂÄºÈÉΩ‰ºöÂèóÂà∞ÂΩ±Âìç„ÄÇ</p>
</li>
<li>
<p>ÂèØËßÅÔºåÂèÇÊï∞<em>n</em>ÁöÑÂèñÂÄºÁõ¥Êé•ÂÜ≥ÂÆö‰∫ÜËΩ¨Êç¢ËøêÁÆóÁöÑËÆ°ÁÆóÁ≤æÂ∫¶„ÄÇ</p>
</li>
<li>
<p>Âú®ËøõË°åÊúâÁ¨¶Âè∑Êï∞ÁöÑÈô§Ê≥ïËøêÁÆóÊó∂ÔºåÁ¨¶Âè∑‰Ωç‰πüÂØπËÆ°ÁÆóÁ≤æÂ∫¶Âèä<em>n</em>ÁöÑÂèñÂÄº‰∫ßÁîü‰∫ÜÊòæËëóÂΩ±Âìç„ÄÇ</p>
</li>
</ul>
<p>‰æãÂ¶Ç:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">f3_32_signed</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">f3_32_unsigned</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>Âú®Êó†Á¨¶Âè∑Êï∞ÁöÑËÆ°ÁÆóËøáÁ®ã‰∏≠ÔºåÈ≠îÊúØÂõ†Â≠êÊòØ<code>0xaaaaaaab</code>Ôºå‰πòÊ≥ïÁöÑ‰∏≠Èó¥ÁªìÊûúË¶Å<code>Èô§‰ª•2ÁöÑ33Ê¨°Êñπ„ÄÇ</code></p>
</li>
<li>
<p>ËÄåÂú®ÊúâÁ¨¶Âè∑Êï∞ÁöÑËÆ°ÁÆóËøáÁ®ã‰∏≠ÔºåÈ≠îÊúØÂõ†Â≠êÂàôÊòØ<code>0x55555556</code>Ôºå‰πòÊ≥ïÁöÑ‰∏≠Èó¥ÁªìÊûúË¶ÅÈô§‰ª•2ÁöÑ<code>32Ê¨°Êñπ</code>„ÄÇËôΩÁÑ∂ËøôÈáåÊ≤°ÊúâËøõË°åÈô§Ê≥ïËøêÁÆóÔºå‰ΩÜÊòØÊ†πÊçÆÂâçÈù¢ÁöÑËÆ®ËÆ∫ÂèØÁü•ÔºöÂïÜÁöÑÊúâÊïà‰ΩçÂèñËá™‰∫éEDXÂØÑÂ≠òÂô®„ÄÇ</p>
</li>
<li>
<p>‰∏≠Èó¥‰∏ÄÊ≠•ÁöÑ‰πòÊ≥ïËÆ°ÁÆóÂêåÊ†∑Â≠òÂú®Á¨¶Âè∑‰ΩçÁöÑÈóÆÈ¢òÔºöÁßØÁöÑÈ´ò32‰ΩçÂè≥Áßª31‰ΩçÔºåÂ∞ÜÂú®EAXÂØÑÂ≠òÂô®ÁöÑÊúÄ‰ΩéÊï∞ÊùÉ‰Ωç‰øùÁïôÊúâÁ¨¶Âè∑Êï∞ÁöÑÁ¨¶Âè∑‰ΩçÔºàÊ≠£Êï∞‰∏∫0ÔºåË¥üÊï∞‰∏∫1Ôºâ„ÄÇÂ∞ÜÁ¨¶Âè∑‰ΩçÂä†ÂÖ•ÁßØÁöÑÈ´ò32‰ΩçÂÄºÔºåÂèØÂÆûÁé∞Ë¥üÊï∞Ë°•Á†ÅÁöÑ‚ÄúÔºã1‚Äù‰øÆÊ≠£</p>
</li>
</ul>
<hr />
<p><code>optimizing msvs 2012</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_f3_32_unsigned PROC
         mov      <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">1431655765</span>     <span class="token comment">; aaaaaaabH</span>
         mul      DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; unsigned multiply</span>
<span class="token comment">; EDX=(input*0xaaaaaaab)/2^32</span>
         shr      <span class="token register variable">edx</span>, <span class="token number">1</span>
<span class="token comment">; EDX=(input*0xaaaaaaab)/2^33</span>
         mov      <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
         ret      <span class="token number">0</span>
_f3_32_unsigned ENDP

_f3_32_signed PROC
         mov      <span class="token register variable">eax</span>, <span class="token number">1431655766</span>              <span class="token comment">; 55555556H</span>
         imul     DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; signed multiply</span>
<span class="token comment">; take high part of product</span>
<span class="token comment">; it is just the same as if to shift product by 32 bits right or to divide it by 2^32</span>
         mov      <span class="token register variable">eax</span>, <span class="token register variable">edx</span>       <span class="token comment">; EAX=EDX=(input*0x55555556)/2^32</span>
         shr      <span class="token register variable">eax</span>, <span class="token number">31</span>        <span class="token comment">; 0000001fH</span>
         add      <span class="token register variable">eax</span>, <span class="token register variable">edx</span>       <span class="token comment">; add 1 if sign is negative</span>
         ret      <span class="token number">0</span>
_f3_32_signed ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>EAX‰πòÁ´ãÂç≥Êï∞ÂêéÔºåÈ´ò‰ΩçÂ≠òÂÇ®Âú®<code>EDX</code>Ôºå‰Ωé‰ΩçÂ≠òÂÇ®Âú®<code>EAX</code>‰∏≠</li>
<li>EDX<code>‰∏≠ÁöÑÂÄºËøë‰ººÁ≠â‰∫é</code>(input * 0xAAAAAAAB) &gt;&gt; 32 Why?</li>
<li>Â∏∏Êï∞ <code>0xAAAAAAAB</code> ÔºàÂç≥ <code>-1431655765</code>ÔºâÊòØ‰∏Ä‰∏™ÁâπÂà´ËÆæËÆ°ÁöÑÊï∞ÔºåÂÆÉÂú®‰∫åËøõÂà∂Ë°®Á§∫‰∏äÂÖ∑ÊúâÁâπÂÆöÁöÑÊÄßË¥®Ôºå‰ΩøÂæóÂΩìÂÆÉ‰∏é‰∏Ä‰∏™32‰ΩçÊó†Á¨¶Âè∑Êï¥Êï∞Áõ∏‰πòÊó∂ÔºåÂÖ∂‰πòÁßØÁöÑÈ´ò32‰ΩçËÉΩÂ§üÊèê‰æõËØ•Êï¥Êï∞ÂÄíÊï∞ÁöÑ‰∏Ä‰∏™Ëøë‰ººÂÄº„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåËøô‰∏™Êï∞Ë¢´ËÆæËÆ°Áî®Êù•ÈÖçÂêà32‰ΩçÊï¥Êï∞ÁöÑ‰πòÊ≥ïËøêÁÆóÔºå‰∫ßÁîü‰∏Ä‰∏™È´ò‰ΩçÂåÖÂê´ÁõÆÊ†áÂÄíÊï∞‰ø°ÊÅØÁöÑÁªìÊûú„ÄÇ</li>
<li>‰πüÂ∞±ÊòØËØ¥<code>EAX</code>ÁöÑÂÄº‰∏é<code> aaaaaaabH</code>Áõ∏‰πòÔºå‰∫ßÁîüÁöÑÈ´ò‰Ωç‰ø°ÊÅØÂ≠òÂÇ®Âú®<code>EDX</code>ÂØÑÂ≠òÂô®‰∏≠ÔºåËÄåËøô‰∏™È´ò‰Ωç‰ø°ÊÅØÂåÖÂê´‰∫ÜÈô§Êï∞ÂÄíÊï∞ÁöÑ‰ø°ÊÅØ</li>
</ul>
<h4 id="more"><a class="markdownIt-Anchor" href="#more"></a> More</h4>
<p>ÂÖ∂ÂÆûÔºåÊàë‰ª¨ÈÉΩÁü•ÈÅìÔºå‰πòÊ≥ïÂíåÈô§Ê≥ï‰∫í‰∏∫ÈÄÜËøêÁÆó„ÄÇÂõ†Ê≠§‰∏ãÈù¢ÁöÑÈô§Ê≥ïÂèØ‰ª•Áî®‰πòÊ≥ïÊù•‰ª£Êõø„ÄÇÊàë‰ª¨ÂèØ‰ª•Ë°®Ëø∞‰∏∫</p>
<p>x/c=x*(1/c)</p>
<p>1/<em>c</em>ÂèØ‰ª•Áß∞‰∏∫‰πòÊ≥ïÁöÑÈÄÜËøêÁÆóÔºåÊòØ<em>c</em>ÁöÑÂÄíÊï∞„ÄÇÂèØ‰ª•Áî®ÁºñËØëÂô®Êù•ÂÅöÊèêÂâçËøêÁÆó„ÄÇ</p>
<hr />
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">mov        <span class="token register variable">eax</span>, MAGICAL CONSTANT
      imul       input value
      sar        <span class="token register variable">edx</span>, SHIFTING COEFFICIENT <span class="token comment">; signed division by 2xusing arithmetic shift right ;Â∑≤Áªè‰ΩçÁßª‰∫Ü32‰ΩçÂêéÔºåÂèàÁßªÂä®‰∫ÜÂ§öÂ∞ë‰ΩçÁß∞‰∏∫Âèò‰ΩçÁ≥ªÊï∞</span>
      mov        <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
      shr        <span class="token register variable">eax</span>, <span class="token number">31</span>
      add        <span class="token register variable">eax</span>, <span class="token register variable">edx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êàë‰ª¨Â¶ÇÊûúÊ†πÊçÆËøô‰∏™Âèò‰ΩçÁ≥ªÊï∞Ê±ÇËß£<code>Èô§Êï∞</code>Âë¢Ôºü</p>
<ul>
<li>
<p>ËÆ∞Âèò‰ΩçÁ≥ªÊï∞‰∏∫<code>C</code>ÔºåÈô§Êï∞ËÆ∞‰∏∫<code>D</code></p>
<p>Èô§Êï∞ÂèØ‰ª•Ë°®Á§∫‰∏∫</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mo>=</mo><mfrac><msup><mn>2</mn><mrow><mn>32</mn><mo>+</mo><mi>c</mi></mrow></msup><mi>M</mi></mfrac></mrow><annotation encoding="application/x-tex">D=\frac{2^{32+c}}{M}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
</li>
<li>
<p>‰æãÂ¶Ç</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">mov        <span class="token register variable">eax</span>, <span class="token number">2021161081</span>                      <span class="token comment">; 78787879H</span>
     imul       DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
     sar        <span class="token register variable">edx</span>, <span class="token number">3</span>
     mov        <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
     shr        <span class="token register variable">eax</span>, <span class="token number">31</span>                              <span class="token comment">; 0000001fH</span>
     add        <span class="token register variable">eax</span>, <span class="token register variable">edx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âà©Áî®ÂÖ¨ÂºèÂèØ‰ª•ËÆ°ÁÆóÈô§Êï∞Âæó:</p>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240612161235490.png" class="" alt="image-20240612161235490" loading="lazy">
</li>
</ul>
<p>‚Äã	ÂèñÊï¥‰∏∫<code>17</code>ÔºåÈô§Êï∞Â∞±ÊòØ<code>17</code></p>
<ul>
<li>
<p>Á±ª‰ººÁöÑÔºåÂú®<mark>64‰ΩçÊï∞ÊçÆÁöÑÈô§Ê≥ïËøêÁÆó‰∏≠</mark>ÔºåÂè™ÊòØ‰∏çÂÜçÈááÁî®2ÁöÑ32Ê¨°ÊñπÔºåËÄåÈááÁî®‰∫Ü2ÁöÑ64Ê¨°Êñπ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">uint64_t</span> <span class="token function">f1234</span><span class="token punctuation">(</span><span class="token class-name">uint64_t</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> a<span class="token operator">/</span><span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-masm" data-language="masm"><code class="language-masm">f1234    PROC
         mov     rax, 7653754429286296943              ; 6a37991a23aead6fH
         mul     rcx
         shr     rdx, 9
         mov     rax, rdx
         ret     0
f1234    ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20240612161445800.png" class="" alt="image-20240612161445800" loading="lazy">
</li>
</ul>
<h3 id="chap42-str2numatoiÂáΩÊï∞"><a class="markdownIt-Anchor" href="#chap42-str2numatoiÂáΩÊï∞"></a> Chap42 str2numÔºåatoi()ÂáΩÊï∞</h3>
<p>Êú¨Á´†ÈáçÊñ∞ÂÆûÁé∞‰∫ÜÊ†áÂáÜÁöÑCÂáΩÊï∞<code>atoi()</code>ÔºåÂ∞ÜÂ≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫Êï¥Êï∞</p>
<h4 id="exmaple1"><a class="markdownIt-Anchor" href="#exmaple1"></a> exmaple1</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">int</span> rt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

         <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
                  rt<span class="token operator">=</span>rt<span class="token operator">*</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token operator">-</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  s<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

         <span class="token keyword">return</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

         <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token string">"1234567890"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Ëøô‰∏™ÁÆóÊ≥ïÂÆûÁé∞ÁöÑÊòØ‰ªéÂ∑¶Âà∞Âè≥ËØªÂèñÊï∞Â≠óÔºåÂπ∂Â∞ÜÊØè‰∏™ËØªÂèñÁöÑÂ≠óÁ¨¶ÂáèÂéªÊï∞Â≠ó0ÁöÑASCIIÂÄºÔºåÂÜç‰πò‰ª•ÊùÉÂÄº</li>
</ul>
<hr />
<p><code>optimizing msvs x64</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">my_atoi PROC
<span class="token comment">; Âä†ËΩΩÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶Âà∞ R8D ÂØÑÂ≠òÂô®‰∏≠</span>
    movzx   <span class="token register variable">r8d</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>   <span class="token comment">; ÊäärcxÊåáÂêëÁöÑÂ≠óËäÇÊâ©Â±ï‰∏∫ÂèåÂ≠óÊîæÂÖ•r8d</span>

<span class="token comment">; EAX Áî®‰∫éÂ≠òÊîæÁªìÊûúÔºàÂàùÂßã‰∏∫0Ôºâ</span>
    xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>              <span class="token comment">; Â∞ÜeaxÊ∏ÖÈõ∂Ôºå‰Ωú‰∏∫Á¥ØÂä†ÁªìÊûúÁöÑËµ∑ÂßãÂÄº</span>

<span class="token comment">; Ê£ÄÊü•Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶ÊòØÂê¶‰∏∫Â≠óÁ¨¶‰∏≤ÁªìÊùüÁ¨¶ÔºàÁ©∫Â≠óÁ¨¶Ôºâ</span>
    test    <span class="token register variable">r8b</span>, <span class="token register variable">r8b</span>              <span class="token comment">; ÊµãËØïr8bÊòØÂê¶‰∏∫0</span>
    je      SHORT <span class="token operator">$</span>LN9@my_atoi     <span class="token comment">; Â¶ÇÊûúÊòØÔºåË∑≥ËΩ¨Âà∞ÁªìÊùüÊ†áÁ≠æÔºåÂõ†‰∏∫Ê≤°ÊúâÊúâÊïàÊï∞Â≠ó</span>

<span class="token label function">$LL2@my_atoi:</span>                         <span class="token comment">; Âæ™ÁéØÂºÄÂßãÊ†áÁ≠æ</span>
<span class="token comment">; ËÆ°ÁÆóÂΩìÂâçÁªìÊûúÁöÑ‰∫îÂÄçÔºà‰∏∫ÂêéÁª≠‰∏éÊñ∞Êï∞Â≠óÁõ∏Âä†ÂÅöÂáÜÂ§áÔºâ</span>
    lea     <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>   <span class="token comment">; edx = eax * 5</span>

<span class="token comment">; Êää‰∏ã‰∏Ä‰∏™Â≠óÁ¨¶Âä†ËΩΩÂà∞ R8D ‰∏≠</span>
    movzx   <span class="token register variable">r8d</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>        <span class="token comment">; Âèñ‰∏ã‰∏Ä‰∏™Â≠óËäÇÂπ∂Êâ©Â±ï‰∏∫ÂèåÂ≠óÊîæÂÖ•r8d</span>

<span class="token comment">; ÊåáÈíà RCX ÁßªÂä®Âà∞Â≠óÁ¨¶‰∏≤ÁöÑ‰∏ã‰∏Ä‰∏™Â≠óÁ¨¶</span>
    lea     <span class="token register variable">rcx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>       <span class="token comment">; rcx ÊåáÂêë‰∏ã‰∏Ä‰∏™Â≠óÁ¨¶</span>

<span class="token comment">; ÁªìÊûúÔºàeaxÔºâÂä†‰∏äÊñ∞ËØªÂèñÂ≠óÁ¨¶ÁöÑÂÄºÔºàËΩ¨Êç¢‰∏∫Êï∞Â≠óÔºåÂáèÂéª'0'ÁöÑASCIIÁ†Å48Ôºâ</span>
    lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">]</span>   <span class="token comment">; eax = eax + edx * 2ÔºåËøôÈáåÂÆûÈôÖÊòØeax = rt * 10 + input_char</span>
    add     <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">48</span>                      <span class="token comment">; ÊääÂ≠óÁ¨¶ËΩ¨Êç¢‰∏∫Êï∞Â≠óÔºàÂáèÂéª'0'ÁöÑASCIIÂÄºÔºâ</span>

<span class="token comment">; Ê£ÄÊü•ÊòØÂê¶Âà∞ËææÂ≠óÁ¨¶‰∏≤Êú´Â∞æ</span>
    test    <span class="token register variable">r8b</span>, <span class="token register variable">r8b</span>                      <span class="token comment">; ÂÜçÊ¨°ÊµãËØïr8bÔºåÁúãÊòØÂê¶‰∏∫0</span>
    jne     SHORT <span class="token operator">$</span>LL2@my_atoi             <span class="token comment">; ‰∏çÊòØÂàôË∑≥ÂõûÂæ™ÁéØÂºÄÂßãÁªßÁª≠Â§ÑÁêÜ</span>

<span class="token label function">$LN9@my_atoi:</span>                         <span class="token comment">; Âæ™ÁéØÁªìÊùüÊ†áÁ≠æ</span>
<span class="token comment">; ÂáΩÊï∞ËøîÂõûÔºåÁªìÊûúÂú®EAX‰∏≠</span>
    ret     <span class="token number">0</span>                            <span class="token comment">; ËøîÂõûÔºå‰∏çÂ∏¶ÂèÇÊï∞</span>
my_atoi ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåMSVCÁºñËØëÂô®‰ºöÂàªÊÑèÈÅøÂºÄÂáèÊ≥ïËøêÁÆóÁöÑSUBÊåá‰ª§„ÄÅËΩ¨ËÄåÂàÜÈÖç‚ÄúADDÊüê‰∏™Ë¥üÊï∞‚ÄùÁöÑÊåá‰ª§Êù•ÂÆûÁé∞ÂáèÊ≥ïËøêÁÆó„ÄÇ</code></p>
<hr />
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">my_atoi:</span>
<span class="token comment">; load input character into EDX</span>
          movsx   <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>
<span class="token comment">; EAX is allocated for "rt" variable</span>
          xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
<span class="token comment">; exit, if loaded character is null byte</span>
          test    <span class="token register variable">dl</span>, <span class="token register variable">dl</span>
          je      .L4
<span class="token label function">.L3:</span>
          lea     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token comment">; EAX=RAX*5=rt*5</span>
<span class="token comment">; shift pointer to the next character:</span>
          add     <span class="token register variable">rdi</span>, <span class="token number">1</span>
          lea     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">-</span><span class="token number">48</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">]</span>
<span class="token comment">; EAX=input character - 48 + RAX*2 = input character - '0' + rt*10</span>
<span class="token comment">; load next character:</span>
          movsx   <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>
<span class="token comment">; goto loop begin, if loaded character is not null byte</span>
          test    <span class="token register variable">dl</span>, <span class="token register variable">dl</span>
          jne     .L3
          rep ret
<span class="token label function">.L4:</span>
          rep ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="example2"><a class="markdownIt-Anchor" href="#example2"></a> example2</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">int</span> negative<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token keyword">int</span> rt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token operator">==</span><span class="token char">'-'</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
                    negative<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
                    s<span class="token operator">++</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

          <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token operator">&lt;</span><span class="token char">'0'</span> <span class="token operator">||</span> <span class="token operator">*</span>s<span class="token operator">></span><span class="token char">'9'</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                              <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"Error! Unexpected char: '%c'\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                              <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
                    rt<span class="token operator">=</span>rt<span class="token operator">*</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token operator">-</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    s<span class="token operator">++</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>negative<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token operator">-</span>rt<span class="token punctuation">;</span>
          <span class="token keyword">return</span> rt<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token string">"1234567890"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token string">"-1234"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token string">"-1234567890"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_atoi</span> <span class="token punctuation">(</span><span class="token string">"-a1234567890"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Ê∑ªÂä†‰∫ÜËΩ¨Êç¢Ë¥üÊï∞ÁöÑÂäüËÉΩ</li>
</ul>
<hr />
<p><code>optimizing gcc x64</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">.LC0:</span>
          .string <span class="token string">"Error! Unexpected char: '%c'\n"</span>

<span class="token label function">my_atoi:</span>
          sub     <span class="token register variable">rsp</span>, <span class="token number">8</span>
          movsx   <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>
<span class="token comment">; check for minus sign</span>
          cmp     <span class="token register variable">dl</span>, <span class="token number">45</span> <span class="token comment">; '-'</span>
          je      .L22
          xor     <span class="token register variable">esi</span>, <span class="token register variable">esi</span>
          test    <span class="token register variable">dl</span>, <span class="token register variable">dl</span>
          je      .L20
<span class="token label function">.L10:</span>
<span class="token comment">; ESI=0 here if there was no minus sign and 1 if it was</span>
          lea     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">-</span><span class="token number">48</span><span class="token operator">]</span>
<span class="token comment">; any character other than digit will result unsigned number greater than 9 after subtraction</span>
<span class="token comment">; so if it is not digit, jump to L4, where error will be reported:</span>
          cmp     <span class="token register variable">al</span>, <span class="token number">9</span>
          ja      .L4
          xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          jmp     .L6
<span class="token label function">.L7:</span>
          lea     <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">-</span><span class="token number">48</span><span class="token operator">]</span>
          cmp     <span class="token register variable">cl</span>, <span class="token number">9</span>
          ja      .L4
<span class="token label function">.L6:</span>
          lea     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
          add     <span class="token register variable">rdi</span>, <span class="token number">1</span>
          lea     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">-</span><span class="token number">48</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">]</span>
          movsx   <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>
          test    <span class="token register variable">dl</span>, <span class="token register variable">dl</span>
          jne     .L7
<span class="token comment">; if there was no minus sign, skip NEG instruction</span>
<span class="token comment">; if it was, execute it.</span>
          test    <span class="token register variable">esi</span>, <span class="token register variable">esi</span>
          je      .L18
          neg     <span class="token register variable">eax</span>
<span class="token label function">.L18:</span>
          add     <span class="token register variable">rsp</span>, <span class="token number">8</span>
          ret
<span class="token label function">.L22:</span>
          movsx   <span class="token register variable">edx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>
          lea     <span class="token register variable">rax</span>, <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span><span class="token comment">;Ë∑≥Ëøá'-'</span>
          test    <span class="token register variable">dl</span>, <span class="token register variable">dl</span><span class="token comment">;'Ê£ÄÊµãÊòØÂê¶ÊòØ''</span>
          je      .L20
          mov     <span class="token register variable">rdi</span>, <span class="token register variable">rax</span>
          mov     <span class="token register variable">esi</span>, <span class="token number">1</span>
          jmp     .L10
<span class="token label function">.L20:</span>
          xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          jmp     .L18
<span class="token label function">.L4:</span>
<span class="token comment">; report error. character is in EDX</span>
          mov     <span class="token register variable">edi</span>, <span class="token number">1</span>
          mov     <span class="token register variable">esi</span>, OFFSET FLAT:.LC0 <span class="token comment">; "Error! Unexpected char: '%c'\n"</span>
          xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          call    __printf_chk
          xor     <span class="token register variable">edi</span>, <span class="token register variable">edi</span>
          call    exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Â¶ÇÊûúÂ≠óÁ¨¶‰∏≤ÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶ÊòØË¥üÂè∑ÔºåÈÇ£‰πàÂ∞±Ë¶ÅÂú®ËΩ¨Êç¢ÁöÑÊúÄÂêéÈò∂ÊÆµÊâßË°å<code>neg</code>Êåá‰ª§ÔºåÊääÁªìÊûúËΩ¨Êç¢‰∏∫Ë¥üÊï∞</li>
<li>ÁºñËØëÂô®ÂØπ‰∫é<code>if(\*s&lt;'0'||\*s&gt;'9')</code>ÁöÑÂ§ÑÁêÜÊØîËæÉÂ∑ßÂ¶ôÔºåËøôÊòØ‰∏§‰∏™ÊØîËæÉÊìç‰ΩúÔºå‰ΩÜÊòØÊàë‰ª¨ÂèØ‰ª•Âè™Áî®‰∏Ä‰∏™ÊØîËæÉÊåá‰ª§Â∞±ËÉΩÂÆåÊàêËøô‰∏§Ê≠•ÊØîËæÉÊìç‰ΩúÔºåÂ∞ÜËæìÂÖ•Â≠óÁ¨¶ÁöÑÂÄºÂáèÂéª‚Äô0‚ÄôÂ≠óÁ¨¶ÁöÑÂÄºÔºåÂ∞ÜÁªìÊûúËßÜ‰∏∫Êó†Á¨¶Âè∑Êï∞Ôºå‰∏é9ËøõË°åÊØîËæÉÔºåÂ¶ÇÊûúÂ§ß‰∫éÂ∞±‰∏çÁ¨¶Âêà</li>
</ul>
<hr />
<p><code>ËøôÈáåÈ°∫‰æøÊèê‰∏Ä‰∏ãÔºåÂÆâÂÖ®Á†îÁ©∂‰∫∫ÂëòÁªèÂ∏∏Á†îÁ©∂ÂêÑÁßçÂºÇÂ∏∏ÊÉÖÂÜµ„ÄÇ‰ªñ‰ª¨ÈáçÁÇπÂÖ≥Ê≥®‰∏çÂêà‰πéÈ¢ÑÊúüÁöÑËæìÂÖ•ÂÄºÔºåÈÄöËøáËøôÁßçÊï∞ÊçÆËØ±‰ΩøÁ®ãÂ∫èËøõË°åÊüêÁßç‰∏éËÆæËÆ°ÊÄùË∑ØÁõ∏Â∑¶ÁöÑË°å‰∏∫„ÄÇÂõ†Ê≠§Ôºå‰ªñ‰ª¨‰πü‰ºöÂÖ≥Ê≥®Ê®°Á≥äÊµãËØïÊñπÊ≥ï„ÄÇ</code></p>
<h3 id="chap43-ÂÜÖËÅîÂáΩÊï∞"><a class="markdownIt-Anchor" href="#chap43-ÂÜÖËÅîÂáΩÊï∞"></a> Chap43 ÂÜÖËÅîÂáΩÊï∞</h3>
<p><em>Âú®ÁºñËØëÈò∂ÊÆµÔºåÂ∞Ü‰ºöË¢´ÁºñËØëÂô®ÊääÂáΩÊï∞‰ΩìÂ±ïÂºÄÂπ∂ÂµåÂÖ•Âà∞ÊØè‰∏Ä‰∏™Ë∞ÉÁî®ÁÇπÁöÑÂáΩÊï∞ÔºåÂ∞±ÊòØÂÜÖËÅîÂáΩÊï∞„ÄÇ</em></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">celsius_to_fahrenheit</span> <span class="token punctuation">(</span><span class="token keyword">int</span> celsius<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> celsius <span class="token operator">*</span> <span class="token number">9</span> <span class="token operator">/</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> celsius<span class="token operator">=</span><span class="token function">atol</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">celsius_to_fahrenheit</span> <span class="token punctuation">(</span>celsius<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>optimizing gcc 4.8.1</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">_main:</span>
          push    <span class="token register variable">ebp</span>
          mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
          and     <span class="token register variable">esp</span>, <span class="token operator">-</span><span class="token number">16</span>
          sub     <span class="token register variable">esp</span>, <span class="token number">16</span>
          call    ___main
          mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
          mov     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
          mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
          call    _atol
          mov     <span class="token register variable">edx</span>, <span class="token number">1717986919</span>
          mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, OFFSET FLAT:LC2 <span class="token comment">; "%d\12\0"</span>
          lea     <span class="token register variable">ecx</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>
          mov     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
          imul    <span class="token register variable">edx</span>
          sar     <span class="token register variable">ecx</span>, <span class="token number">31</span>
          sar     <span class="token register variable">edx</span>
          sub     <span class="token register variable">edx</span>, <span class="token register variable">ecx</span>
          add     <span class="token register variable">edx</span>, <span class="token number">32</span>
          mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
          call    _printf
          leave
          ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ËøôÈáåÂà©Áî®‰∫Ü41Á´†ÊèêÂà∞ÁöÑÂà©Áî®‰πòÊ≥ïÊåá‰ª§ÂÆûÁé∞‰∫ÜÈô§Ê≥ïËøêÁÆóÔºåËøô‰∏™ÊòØÊúâÁ¨¶Âè∑Êï∞</li>
<li><mark>ËøôÈáåÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÊ∏©Â∫¶ËΩ¨Êç¢ÂáΩÊï∞ÁöÑÂáΩÊï∞‰ΩìË¢´Áõ¥Êé•Â±ïÂºÄ‰∫ÜÔºåÊîæÂú®‰∫ÜÂáΩÊï∞printf()ÁöÑÂâçÈù¢</mark></li>
<li>ËøôÊ†∑‰∏çÈúÄË¶ÅÂ§ÑÁêÜÂ§ö‰ΩôÁöÑÂáΩÊï∞Ë∞ÉÁî®ÂíåËøîÂõûÊåá‰ª§„ÄÇÊõ¥Âø´</li>
<li><mark>Áé∞Âú®ÂÖ∑Êúâ‰ºòÂåñÂäüËÉΩÁöÑÁºñËØëÂô®‰∏ÄËà¨ÈÉΩËÉΩËá™Âä®ÁöÑÊääÂ∞èÂûãÂáΩÊï∞ÁöÑÂáΩÊï∞‰ΩìÁõ¥Êé•‚ÄúÂµåÂÖ•‚ÄùÂà∞Ë∞ÉÁî®ÊñπÂáΩÊï∞ÁöÑ‰ª£Á†ÅÈáå„ÄÇÂΩìÁÑ∂Êàë‰ª¨‰πüÂèØ‰ª•ÂÄüÂä©ÂÖ≥ÈîÆÂ≠ó‚Äúinline‚ÄùÂº∫Âà∂ÁºñËØëÂô®ËøõË°åËøôÁßç‚ÄúÂµåÂÖ•‚ÄùÂ§ÑÁêÜ„ÄÇ</mark></li>
</ul>
<h4 id="strcmp"><a class="markdownIt-Anchor" href="#strcmp"></a> strcmp</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bool <span class="token function">is_bool</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
                   <span class="token keyword">return</span> true<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
                   <span class="token keyword">return</span> false<span class="token punctuation">;</span>
          <span class="token function">assert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂÆö‰πâ‰∏§‰∏™Â≠óÁ¨¶‰∏≤Â∏∏Èáè</span>
<span class="token label function">.LC0:</span>          .string <span class="token string">"true"</span>     <span class="token comment">; Â≠óÁ¨¶‰∏≤ "true"</span>
<span class="token label function">.LC1:</span>          .string <span class="token string">"false"</span>    <span class="token comment">; Â≠óÁ¨¶‰∏≤ "false"</span>

<span class="token label function">is_bool:</span>       <span class="token comment">; ÂáΩÊï∞ÂÖ•Âè£</span>
<span class="token label function">.LFB0:</span>
          push    <span class="token register variable">edi</span>           <span class="token comment">; ‰øùÂ≠òediÂØÑÂ≠òÂô®</span>
          mov     <span class="token register variable">ecx</span>, <span class="token number">5</span>         <span class="token comment">; ËÆæÁΩÆÊØîËæÉÈïøÂ∫¶‰∏∫5Ôºà"true"ÁöÑÈïøÂ∫¶Ôºâ</span>
          push    <span class="token register variable">esi</span>           <span class="token comment">; ‰øùÂ≠òesiÂØÑÂ≠òÂô®</span>
          mov     <span class="token register variable">edi</span>, OFFSET FLAT:.LC0  <span class="token comment">; ediÊåáÂêëÂ≠óÁ¨¶‰∏≤"true"</span>

          sub     <span class="token register variable">esp</span>, <span class="token number">20</span>        <span class="token comment">; ‰∏∫Â±ÄÈÉ®ÂèòÈáèÂàÜÈÖçÁ©∫Èó¥</span>
          mov     <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>  <span class="token comment">; esiÊåáÂêëÂæÖÊ£ÄÊü•ÁöÑËæìÂÖ•Â≠óÁ¨¶‰∏≤</span>

          <span class="token comment">; ÊØîËæÉËæìÂÖ•Â≠óÁ¨¶‰∏≤‰∏é"true"</span>
          repz cmpsb             <span class="token comment">; ÊØîËæÉecx‰∏™Â≠óËäÇÔºåÁõ¥Âà∞ÂèëÁé∞Â∑ÆÂºÇÊàñecxÂáèÂà∞0</span>
          je      .L3            <span class="token comment">; Â¶ÇÊûúÂ≠óÁ¨¶‰∏≤ÂåπÈÖçÔºàÂç≥ËæìÂÖ•‰∏∫"true"ÔºâÔºåË∑≥ËΩ¨Âà∞.L3</span>

          <span class="token comment">; Â¶ÇÊûúÊ≤°ÂåπÈÖç"true"ÔºåÂàôÂ∞ùËØïÂåπÈÖç"false"</span>
          mov     <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>  <span class="token comment">; ÈáçÁΩÆesiÊåáÂêëËæìÂÖ•Â≠óÁ¨¶‰∏≤</span>
          mov     <span class="token register variable">ecx</span>, <span class="token number">6</span>         <span class="token comment">; ËÆæÁΩÆÊØîËæÉÈïøÂ∫¶‰∏∫6Ôºà"false"ÁöÑÈïøÂ∫¶Ôºâ</span>
          mov     <span class="token register variable">edi</span>, OFFSET FLAT:.LC1  <span class="token comment">; ediÊåáÂêëÂ≠óÁ¨¶‰∏≤"false"</span>
          repz cmpsb             <span class="token comment">; ÂÜçÊ¨°ÊØîËæÉ</span>
          <span class="token comment">; ‰ΩøÁî®setaÂíåsetbËÆæÁΩÆclÂíådlÔºåÁî®‰∫éÂêéÁª≠ÈÄªËæëÂà§Êñ≠</span>
          seta    <span class="token register variable">cl</span>             <span class="token comment">; Â¶ÇÊûúediÔºà"false"ÔºâÂú®ÂâçÈù¢Ôºåcl=1ÔºõÂê¶Âàôcl=0</span>
          setb    <span class="token register variable">dl</span>             <span class="token comment">; dlÊÄªÊòØËÆæ‰∏∫1ÔºåÂõ†‰∏∫setbÊÄªÊòØËÆæÁΩÆ‰Ωç‰∏∫1</span>
          xor     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>       <span class="token comment">; eaxÊ∏ÖÈõ∂</span>
          cmp     <span class="token register variable">cl</span>, <span class="token register variable">dl</span>         <span class="token comment">; ÊØîËæÉclÂíådl</span>
          jne     .L8            <span class="token comment">; Â¶ÇÊûúcl‰∏çÁ≠â‰∫édlÔºàÊÑèÂë≥ÁùÄËæìÂÖ•Êó¢‰∏çÊòØ"true"‰πü‰∏çÊòØ"false"ÔºâÔºåË∑≥ËΩ¨Âà∞.L8</span>

<span class="token label function">.L8:</span>          <span class="token comment">; ËæìÂÖ•‰∏çÁ¨¶ÂêàÈ¢ÑÊúüÔºåË∞ÉÁî®assertÊñ≠Ë®ÄÂ§±Ë¥•</span>
          mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>, <span class="token number">0</span>   <span class="token comment">; ÂáÜÂ§áassertÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÔºàÈÄöÂ∏∏‰∏∫0Ôºâ</span>
          call    assert           <span class="token comment">; Ë∞ÉÁî®assertÂáΩÊï∞</span>
          add     <span class="token register variable">esp</span>, <span class="token number">20</span>          <span class="token comment">; ÈáäÊîæÂ±ÄÈÉ®ÂèòÈáèÁ©∫Èó¥</span>
          pop     <span class="token register variable">esi</span>             <span class="token comment">; ÊÅ¢Â§çesi</span>
          pop     <span class="token register variable">edi</span>             <span class="token comment">; ÊÅ¢Â§çedi</span>
          ret                     <span class="token comment">; ËøîÂõûÔºåË°®Á§∫ÈîôËØØ</span>

<span class="token label function">.L3:</span>          <span class="token comment">; ËæìÂÖ•Â≠óÁ¨¶‰∏≤‰∏∫"true"</span>
          add     <span class="token register variable">esp</span>, <span class="token number">20</span>          <span class="token comment">; ÈáäÊîæÂ±ÄÈÉ®ÂèòÈáèÁ©∫Èó¥</span>
          mov     <span class="token register variable">eax</span>, <span class="token number">1</span>           <span class="token comment">; ËÆæÁΩÆeax‰∏∫1ÔºåË°®Á§∫true</span>
          pop     <span class="token register variable">esi</span>             <span class="token comment">; ÊÅ¢Â§çesi</span>
          pop     <span class="token register variable">edi</span>             <span class="token comment">; ÊÅ¢Â§çedi</span>
          ret                     <span class="token comment">; ËøîÂõûÔºåË°®Á§∫ÊàêÂäü</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>seta</code>Âç≥set above.Ê†πÊçÆ‰πãÂâçÊåá‰ª§ÊâßË°åÁöÑÁªìÊûúËÆæÁΩÆÂØÑÂ≠òÂô®ÁöÑÂÄº„ÄÇ‰æãÂ¶ÇÔºåÂú®Êüê‰∫õÂ§ÑÁêÜÂô®ÁöÑÊ±áÁºñËØ≠Ë®Ä‰∏≠Ôºå<code>seta</code> ÂèØËÉΩÊÑèÂë≥ÁùÄÂ¶ÇÊûúÂÖàÂâçÁöÑÊØîËæÉÊåá‰ª§ÁªìÊûúÊòØÂ§ß‰∫éÔºàAboveÔºâÔºåÂàôËÆæÁΩÆÊüê‰∏™ÂØÑÂ≠òÂô®ÁöÑÊúÄ‰Ωé‰Ωç‰∏∫1ÔºàÁúüÔºâÔºåÂê¶Âàô‰∏∫0ÔºàÂÅáÔºâ„ÄÇ‰ΩÜËøôÂπ∂‰∏çÊòØÊ†áÂáÜÁöÑ x86 Ê±áÁºñÊåá‰ª§ÈõÜÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ</li>
<li><code>SETB</code> ÊòØÊ±áÁºñËØ≠Ë®Ä‰∏≠ÁöÑÊåá‰ª§ÔºåÁî®‰∫éËÆæÁΩÆÔºàSetÔºâ‰∏Ä‰∏™ÊØîÁâπ‰ΩçÔºàBitÔºâ‰∏∫1„ÄÇËøô‰∏™Êåá‰ª§ÈÄöÂ∏∏‰æùÊçÆÊüê‰∫õÊù°‰ª∂ÊâßË°åÔºåÊØîÂ¶ÇÂú®Êù°‰ª∂ËΩ¨ÁßªÊåá‰ª§‰πãÂêéÔºåÊ†πÊçÆÂ§ÑÁêÜÂô®ÁöÑÁä∂ÊÄÅÊ†áÂøóÔºàÂ¶ÇZero Flag, Carry FlagÁ≠âÔºâÊù•ÂÜ≥ÂÆöÊòØÂê¶ËÆæÁΩÆÁõÆÊ†á‰ΩçÁΩÆÁöÑÊØîÁâπ‰Ωç„ÄÇ</li>
<li><code>REPZ</code> ÊòØ x86 Ê±áÁºñËØ≠Ë®Ä‰∏≠ÁöÑ‰∏Ä‰∏™ÂâçÁºÄÊåá‰ª§ÔºåÂÆÉÊòØ <code>REPE</code>ÔºàRepeat While EqualÔºåÂΩì ZF Ê†áÂøó‰Ωç‰∏∫1Êó∂ÈáçÂ§çÔºâÁöÑÂêå‰πâËØç„ÄÇÂú®ÈÖçÂêàÊüê‰∫õÊåá‰ª§ÔºàÂ¶Ç <code>CMPSB</code>„ÄÅ<code>CMPSW</code>„ÄÅ<code>CMPSD</code>„ÄÅ<code>CMPSQ</code> Á≠âÔºâ‰ΩøÁî®Êó∂ÔºåÂÆÉ‰ºöÊ†πÊçÆ Zero Flag (ZF) ÁöÑÁä∂ÊÄÅÊù•ÊéßÂà∂Âæ™ÁéØÁöÑÊâßË°å„ÄÇ
<ul>
<li><code>CMPSB</code> Êåá‰ª§‰ºöÊØîËæÉ<code>EDI</code>Âíå<code>ESI</code>ÊâÄÊåáÂêëÁöÑÂ≠óËäÇÊòØÂê¶Áõ∏Á≠âÔºåÂπ∂Êõ¥Êñ∞Áõ∏ÂÖ≥Ê†áÂøó‰ΩçÔºàÂåÖÊã¨ZFÔºåÂç≥Èõ∂Ê†áÂøó‰ΩçÔºåÂ¶ÇÊûú‰∏§‰∏™Â≠óËäÇÁõ∏Á≠âÂàôZFË¢´ÁΩÆ‰∏∫1ÔºåÂê¶Âàô‰∏∫0Ôºâ„ÄÇ</li>
<li><code>REPZ</code> ‰ºöÊ£ÄÊü•ZFÊ†áÂøó‰ΩçÔºåÂ¶ÇÊûúZF‰∏∫1ÔºàÂç≥Ââç‰∏ÄÊ¨°ÊØîËæÉÁªìÊûú‰∏∫Áõ∏Á≠âÔºâÔºåÂàôÁªßÁª≠ÊâßË°å‰∏ã‰∏ÄÊ¨°ÊØîËæÉÔºåÂêåÊó∂Ëá™Âä®ÈÄíÂáèECXÂØÑÂ≠òÂô®Ôºà‰Ωú‰∏∫Âæ™ÁéØËÆ°Êï∞Âô®Ôºâ„ÄÇ</li>
<li>Âæ™ÁéØ‰ºö‰∏ÄÁõ¥ÊâßË°åÔºåÁõ¥Âà∞ECXÂáèÂà∞0ÊàñËÄÖZFÂèò‰∏∫0ÔºàÂç≥ÈÅáÂà∞‰∏çÁõ∏Á≠âÁöÑÂ≠óËäÇÔºâ‰∏∫Ê≠¢„ÄÇ</li>
</ul>
</li>
<li><code>ËøôÈáåÁöÑstrcmpË¢´Â±ïÂºÄ‰∫Ü</code></li>
</ul>
<hr />
<p><code>msvs 2010 optimizing</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG3454 DB       <span class="token string">'true'</span>, <span class="token number">00H</span>
<span class="token operator">$</span>SG3456 DB       <span class="token string">'false'</span>, <span class="token number">00H</span>

_s<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>          <span class="token comment">; size = 4</span>
?is_bool@@YA_NPAD@Z PROC <span class="token comment">; is_bool</span>
          push   <span class="token register variable">esi</span>
          mov    <span class="token register variable">esi</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span><span class="token comment">;esi: address of s</span>
          mov    <span class="token register variable">ecx</span>, OFFSET <span class="token operator">$</span>SG3454 <span class="token comment">; 'true';ecx:address of true</span>
          mov    <span class="token register variable">eax</span>, <span class="token register variable">esi</span><span class="token comment">;eax=esi  eax:s</span>
          npad   <span class="token number">4</span> <span class="token comment">; align next label</span>
<span class="token label function">$LL6@is_bool:</span>
          mov    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span><span class="token comment">;dl:s[i];ÊØîËæÉÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶</span>
          cmp    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span><span class="token comment">;s[i]==true[i]?</span>
          jne    SHORT <span class="token operator">$</span>LN7@is_bool
          test   <span class="token register variable">dl</span>, <span class="token register variable">dl</span>
          je     SHORT <span class="token operator">$</span>LN8@is_bool<span class="token comment">;ÂåπÈÖçÊàêÂäü</span>
          mov    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span><span class="token comment">;ÊØîËæÉÁ¨¨‰∫å‰∏™Â≠óÁ¨¶</span>
          cmp    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>
          jne    SHORT <span class="token operator">$</span>LN7@is_bool
          add    <span class="token register variable">eax</span>, <span class="token number">2</span><span class="token comment">;Ë∑≥Âà∞‰∏§‰∏™‰ª•Âêé </span>
          add    <span class="token register variable">ecx</span>, <span class="token number">2</span>
          test   <span class="token register variable">dl</span>, <span class="token register variable">dl</span><span class="token comment">;ÂÜçÊ¨°Â§ÑÁêÜÁ©∫Â≠óÁ¨¶</span>
          jne    SHORT <span class="token operator">$</span>LL6@is_bool<span class="token comment">;ËøõÂÖ•‰∏ã‰∏ÄÊ¨°Âæ™ÁéØ</span>
<span class="token label function">$LN8@is_bool:</span><span class="token comment">;ÂåπÈÖçÊàêÂäü</span>
          xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          jmp    SHORT <span class="token operator">$</span>LN9@is_bool
<span class="token label function">$LN7@is_bool:</span><span class="token comment">;ÁªìÊùüÔºåË∑≥ËΩ¨Âà∞ÂåπÈÖçfalseÔºåËÆæÁΩÆeax=1</span>
          sbb    <span class="token register variable">eax</span>, <span class="token register variable">eax</span><span class="token comment">;eax=0</span>
          sbb    <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">1</span><span class="token comment">;eax=1</span>
<span class="token label function">$LN9@is_bool:</span>
          test   <span class="token register variable">eax</span>, <span class="token register variable">eax</span><span class="token comment">;eax=0?</span>
          jne    SHORT <span class="token operator">$</span>LN2@is_bool

          mov    <span class="token register variable">al</span>, <span class="token number">1</span>
          pop    <span class="token register variable">esi</span>

          ret    <span class="token number">0</span>
<span class="token label function">$LN2@is_bool:</span><span class="token comment">;Â§ÑÁêÜfalseÁöÑÈÉ®ÂàÜ</span>

          mov    <span class="token register variable">ecx</span>, OFFSET <span class="token operator">$</span>SG3456 <span class="token comment">; 'false'</span>
          mov    <span class="token register variable">eax</span>, <span class="token register variable">esi</span>
<span class="token label function">$LL10@is_bool:</span>
          mov    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>
          cmp    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
          jne    SHORT <span class="token operator">$</span>LN11@is_bool<span class="token comment">;Â¶ÇÊûúÂåπÈÖçÂ§±Ë¥•</span>
          test   <span class="token register variable">dl</span>, <span class="token register variable">dl</span>
          je     SHORT <span class="token operator">$</span>LN12@is_bool
          mov    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>
          cmp    <span class="token register variable">dl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>
          jne    SHORT <span class="token operator">$</span>LN11@is_bool
          add    <span class="token register variable">eax</span>, <span class="token number">2</span>
          add    <span class="token register variable">ecx</span>, <span class="token number">2</span>
          test   <span class="token register variable">dl</span>, <span class="token register variable">dl</span>
          jne    SHORT <span class="token operator">$</span>LL10@is_bool
<span class="token label function">$LN12@is_bool:</span>
          xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          jmp    SHORT <span class="token operator">$</span>LN13@is_bool
<span class="token label function">$LN11@is_bool:</span><span class="token comment">;</span>
          sbb    <span class="token register variable">eax</span>, <span class="token register variable">eax</span><span class="token comment">;eax=0</span>
          sbb    <span class="token register variable">eax</span>, <span class="token operator">-</span><span class="token number">1</span><span class="token comment">;eax=1</span>
<span class="token label function">$LN13@is_bool:</span>
          test   <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          jne    SHORT <span class="token operator">$</span>LN1@is_bool<span class="token comment">;Â¶ÇÊûúeax!=0</span>

          xor    <span class="token register variable">al</span>, <span class="token register variable">al</span>
          pop    <span class="token register variable">esi</span>

          ret    <span class="token number">0</span>
<span class="token label function">$LN1@is_bool:</span><span class="token comment">;assert(0)</span>

          push   <span class="token number">11</span>
          push   OFFSET <span class="token operator">$</span>SG3458
          push   OFFSET <span class="token operator">$</span>SG3459
          call   DWORD PTR __imp___wassert
          add    <span class="token register variable">esp</span>, <span class="token number">12</span>
          pop    <span class="token register variable">esi</span>

          ret    <span class="token number">0</span>
?is_bool@@YA_NPAD@Z ENDP <span class="token comment">; is_bool</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>sbb</code> Êåá‰ª§‰ª£Ë°® ‚ÄúSubtract with Borrow‚ÄùÔºàÂ∏¶ÂÄü‰ΩçÂáèÊ≥ïÔºâÔºåÊòØ‰∏Ä‰∏™ÁÆóÊúØËøêÁÆóÊåá‰ª§„ÄÇËØ•Êåá‰ª§ÊâßË°åÊó∂‰ºö‰ªé‰∏§‰∏™Êìç‰ΩúÊï∞ÁöÑÂ∑ÆÂÄº‰∏≠ÂÜçÂáèÂéªÂÄü‰ΩçÊ†áÂøóÔºàCarry FlagÔºåÁÆÄÁß∞ CFÔºâÁöÑÂÄº„ÄÇÂÄü‰ΩçÊ†áÂøóÈÄöÂ∏∏Áî®‰∫éË°®Á§∫Ââç‰∏Ä‰∏™Êìç‰ΩúÊòØÂê¶‰∫ßÁîü‰∫ÜÂÄü‰ΩçÔºàÂú®Êó†Á¨¶Âè∑Êï∞ËøêÁÆó‰∏≠ÔºâÊàñËøõ‰ΩçÔºàÂú®ÊúâÁ¨¶Âè∑Êï∞ËøêÁÆó‰∏≠Ë°®Á§∫Ë¥üÊï∞Ê∫¢Âá∫Ôºâ„ÄÇCF‰Ωç‰∏∫1Ë°®Á§∫ÊúâÂÄü‰ΩçÊàñËøõ‰ΩçÔºå‰∏∫0Ë°®Á§∫Ê≤°Êúâ„ÄÇ</p>
<p><code>sbb 1,2</code>ÂÖ∂‰∏≠1ÊòØÂ≠òÊîæÁªìÊûúÁöÑÁõÆÊ†á‰ΩçÁΩÆÔºåÂÄº‰ºöÂú®ÊâßË°åÂêéË¢´Êõ¥Êñ∞;2ÊòØË¢´ÂáèÊï∞ÔºåÂÄº‰∏éCFÁöÑÂÄº‰∏ÄËµ∑‰ªé1‰∏≠ÂáèÂéªÂç≥<code>Êìç‰ΩúÂØπË±°1 = Êìç‰ΩúÂØπË±°1 - Êìç‰ΩúÂØπË±°2 - CF</code></p>
</li>
<li>
<p>Âú®Êú¨‰æã‰∏≠:ÈÄöËøáËøô‰∏§Êù°Êåá‰ª§ÔºåÂØπ‰∫é‰∏çÂêåÁöÑCFÂÄºÔºåÂ∞ÜEAXÂØÑÂ≠òÂô®ËÆæÁΩÆÊàê‰∏çÂêåÁöÑÂÄºÔºö</p>
<ul>
<li>CF ‰∏∫ 0Ôºö <code>EAX = 0 - 0 = 0</code> Âíå <code>EAX -(-1) = 0+1 = 1</code>Ôºõ</li>
<li>CF ‰∏∫ 1Ôºö <code>EAX = 0 - 1 = -1</code> Âíå <code>EAX -(-1) = -1 -(-1)= -1+1 = 0</code>„ÄÇ</li>
</ul>
</li>
<li>
<p>ÂèØ‰ª•ÂèëÁé∞ËøôÊÆµ‰ª£Á†ÅÁöÑ<code>strcmp</code>ÊòØÊØè‰∏§‰∏™Â≠óÁ¨¶‰∏∫‰∏ÄÁªÑËøõË°åÂ§ÑÁêÜÁöÑ</p>
</li>
</ul>
<hr />
<h4 id="strlen-2"><a class="markdownIt-Anchor" href="#strlen-2"></a> strlen</h4>
<hr />
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">strlen_test</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_s1<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">; size = 4</span>
_strlen_test PROC
          mov    <span class="token register variable">eax</span>, DWORD PTR _s1<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax=s[i]</span>
          lea    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span><span class="token comment">;edx=s[i+1]</span>
<span class="token label function">$LL3@strlen_tes:</span>
          mov    <span class="token register variable">cl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span><span class="token comment">;cl:s[i]</span>
          inc    <span class="token register variable">eax</span><span class="token comment">;eax++</span>
          test   <span class="token register variable">cl</span>, <span class="token register variable">cl</span><span class="token comment">;ÁªìÊùüÔºü</span>
          jne    SHORT <span class="token operator">$</span>LL3@strlen_tes
          sub    <span class="token register variable">eax</span>, <span class="token register variable">edx</span><span class="token comment">;eax-edx</span>
          ret    <span class="token number">0</span>
_strlen_test ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>strlen</code>Âπ∂Ê≤°Êúâ‰∏ìÈó®ËÆæÁΩÆ‰∏Ä‰∏™ÂèòÈáèÊù•ËÆ°ÁÆóÈïøÂ∫¶ÔºåËÄåÊòØÂà©Áî®‰∫ÜÂú∞ÂùÄËÆ°ÁÆó</li>
<li>Â¶ÇÊûúËØªÂèñÂà∞‰∫ÜÁ©∫Â≠óÁ¨¶Ôºå<code>eax</code>ÊòØ<code>s[len+1]ÁöÑÂú∞ÂùÄ</code>,ËÄå<code>edxÊòØs[1]ÁöÑÂú∞ÂùÄ</code>,Áõ∏ÂáèÊÅ∞Â•ΩÊòØÈïøÂ∫¶</li>
</ul>
<h4 id="strcpy"><a class="markdownIt-Anchor" href="#strcpy"></a> strcpy</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">strcpy_test</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s1<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>outbuf<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">strcpy</span><span class="token punctuation">(</span>outbuf<span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_s1<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>         <span class="token comment">; size = 4</span>
_outbuf<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>    <span class="token comment">; size = 4</span>
_strcpy_test PROC
          mov    <span class="token register variable">eax</span>, DWORD PTR _s1<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax:s1</span>
          mov    <span class="token register variable">edx</span>, DWORD PTR _outbuf<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;edx:outbuf</span>
          sub    <span class="token register variable">edx</span>, <span class="token register variable">eax</span><span class="token comment">;edx=outbuf-s1</span>
          npad   <span class="token number">6</span> <span class="token comment">; align next label</span>
<span class="token label function">$LL3@strcpy_tes:</span>
          mov    <span class="token register variable">cl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>
          mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">cl</span>
          inc    <span class="token register variable">eax</span>
          test   <span class="token register variable">cl</span>, <span class="token register variable">cl</span>
          jne    SHORT <span class="token operator">$</span>LL3@strcpy_tes
          ret    <span class="token number">0</span>
_strcpy_test ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ËøôÈáåÂè™Áî®‰∫Ü‰∏Ä‰∏™ÊåáÈíàÂ∞±ÂÆûÁé∞‰∫Ü<code>strcpy</code></li>
<li>È¶ñÂÖàËÆ°ÁÆó‰∏§‰∏™Â≠óÁ¨¶‰∏≤‰ΩçÁΩÆÁöÑÂÅèÁßª,ÁÑ∂Âêé‰ª§<code>s1[ptr+offset]=s1[ptr]</code>‰ªéËÄåÂÆûÁé∞‰∫ÜÂ≠óÁ¨¶‰∏≤ÁöÑÂ§çÂà∂</li>
</ul>
<h4 id="memset"><a class="markdownIt-Anchor" href="#memset"></a> memset</h4>
<ul>
<li>
<p>64Â≠óËäÇÁöÑÊìç‰Ωú</p>
<p>Âú®ÁºñËØëÈÇ£‰∫õÊìç‰ΩúÂ∞è‰ΩìÁßØÂÜÖÂ≠òÂùóÁöÑmemset()ÂáΩÊï∞Êó∂ÔºåÂ§öÊï∞ÁºñËØëÂô®‰∏ç‰ºöÂàÜÈÖçÊ†áÂáÜÁöÑÂáΩÊï∞Ë∞ÉÁî®Êåá‰ª§ÔºàcallÔºâÔºåÂèçËÄå‰ºöÂàÜÈÖç‰∏ÄÂ†ÜÁöÑMOVÊåá‰ª§ÔºåÁõ¥Êé•ËµãÂÄº„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">f:</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>, <span class="token number">0</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token number">0</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token number">0</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>, <span class="token number">0</span>
          ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âç≥‰∏ÄÊ¨°Ê∏ÖÁ©∫8‰∏™Â≠óËäÇ<code>QWORD</code>quad word  4‰∏™word,8‰∏™Â≠óËäÇ</p>
</li>
<li>
<p>67Â≠óËäÇÁöÑÊìç‰Ωú</p>
<p>Âç≥‰∏äÊñá‰ªãÁªçÁöÑÂæ™ÁéØÂ±ïÂºÄÊäÄÊúØ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>out<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token function">memset</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">out<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
f         PROC
          xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">40</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">48</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">56</span><span class="token operator">]</span>, <span class="token register variable">rax</span>
          mov    WORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">64</span><span class="token operator">]</span>, <span class="token register variable">ax</span>
          mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">66</span><span class="token operator">]</span>, <span class="token register variable">al</span>
          ret    <span class="token number">0</span>
f         ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ÊúÄÂêéÁöÑ3‰∏™Â≠óËäÇË¢´ÂàÜÊàê‰∫Ü‰∏Ä‰∏™wordÂíå‰∏Ä‰∏™byte</p>
</li>
<li>
<p>GCCËøò‰ºöÂàÜÈÖçREP STOSQÊåá‰ª§„ÄÇËøôÂèØËÉΩÊØî‰∏ÄÂ†ÜÁöÑMOVËµãÂÄºÊåá‰ª§Êõ¥Áü≠ÔºåÊïàÁéáÊõ¥È´ò„ÄÇ</p>
</li>
</ul>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂáΩÊï∞ÂºÄÂßã</span>
<span class="token label function">f:</span>
          <span class="token comment">; Â∞Ü rdi ÊåáÂêëÁöÑÂÜÖÂ≠òÂå∫ÂüüÁöÑÂâç 8 Â≠óËäÇÔºà64 ‰ΩçÔºâÁΩÆ‰∏∫ 0;Ââç8Â≠óËäÇÊ∏Ö0</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>, <span class="token number">0</span>      
          <span class="token comment">; Â∞Ü rdi+59 Â§ÑÁöÑ 8 Â≠óËäÇÔºà64 ‰ΩçÔºâÁΩÆ‰∏∫ 0</span>
          mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">59</span><span class="token operator">]</span>, <span class="token number">0</span>        <span class="token comment">;Âêé8Â≠óËäÇÊ∏ÖÈõ∂</span>
          <span class="token comment">; Â∞Ü rdi ÁöÑÂÄºÂ§çÂà∂Âà∞ rcx</span>
          mov    <span class="token register variable">rcx</span>, <span class="token register variable">rdi</span>      <span class="token comment">;rcx=rdi  rdi:Á¨¨‰∏Ä‰∏™Â≠óËäÇÁöÑÂú∞ÂùÄ</span>
        <span class="token comment">; rdi = rdi + 8Ôºårdi Âú∞ÂùÄÂêëÂêéÁßªÂä® 8 Â≠óËäÇ</span>
          lea    <span class="token register variable">rdi</span>, <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>    <span class="token comment">;rdiÊåáÂêëÁ¨¨9‰∏™Â≠óËäÇ</span>
          <span class="token comment">; Â∞Ü eax Ê∏ÖÈõ∂Ôºàeax = 0Ôºâ</span>
          xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
          <span class="token comment">; rdi ÂØπÈΩêÂà∞ 8 Â≠óËäÇËæπÁïå,ÁõÆÁöÑÊòØ‰∏∫‰∫ÜÂ§ÑÁêÜÂÜÖÂ≠òÁöÑÊó∂ÂÄôÊïàÁéáÊõ¥È´ò</span>
          and    <span class="token register variable">rdi</span>, <span class="token operator">-</span><span class="token number">8</span><span class="token comment">;rdiÂè™ÂèØËÉΩÂáèÂ∞ë,ÊåáÂêëÁ¨¨1~9‰∏™Â≠óËäÇÁöÑÊüê‰∏™Â≠óËäÇÔºå‰∏é8Â≠óËäÇÂØπÈΩê</span>
          <span class="token comment">; ËÆ°ÁÆóÂπ∂‰∏îÂ∞Ü rcx ÂáèÂéª rdi ÁöÑÂÄº</span>
          sub    <span class="token register variable">rcx</span>, <span class="token register variable">rdi</span>
          <span class="token comment">; Â∞Ü ecx ÁöÑÂÄºÂä†‰∏ä 67</span>
          add    <span class="token register variable">ecx</span>, <span class="token number">67</span>
          
          <span class="token comment">; Â∞Ü ecx Âè≥Áßª 3 ‰ΩçÔºåÁõ∏ÂΩì‰∫éÈô§‰ª• 8</span>
          shr    <span class="token register variable">ecx</span>, <span class="token number">3</span><span class="token comment">;ËÆ°ÁÆóËøòË¶ÅÊ∏ÖÁ©∫Â§öÂ∞ë‰∏™8Â≠óËäÇ</span>
          
          <span class="token comment">; ‰ΩøÁî® rep stosq Êåá‰ª§ÔºåÂ∞Ü raxÔºàÂÄº‰∏∫ 0ÔºâÂ°´ÂÖÖÂà∞ rdi ÊåáÂêëÁöÑÂÜÖÂ≠òÔºåÈáçÂ§ç ecx Ê¨°</span>
          rep stosq<span class="token comment">;Ê∏ÖÁ©∫ÔºåÂè≥Áßª...</span>
          
          <span class="token comment">; ËøîÂõûË∞ÉÁî®ÂáΩÊï∞</span>
          ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>REP STOSQ</code> Êåá‰ª§ÊòØ‰∏ÄÊù° x86 Ê±áÁºñÊåá‰ª§ÔºåÁî®‰∫éÂú®ÂÜÖÂ≠ò‰∏≠Â°´ÂÖÖ‰∏Ä‰∏™ÊåáÂÆöÁöÑÂå∫Âüü„ÄÇ<code>REP</code> ÂâçÁºÄ‰∏é <code>STOSQ</code> Êåá‰ª§ÁªìÂêà‰ΩøÁî®ÔºåÁî®Êù•Âø´ÈÄüÂú∞Â∞Ü RAX ÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÄºÂ°´ÂÖÖÂà∞‰∏Ä‰∏™ÂÜÖÂ≠òÂå∫Âüü„ÄÇ</li>
<li><strong>STOSQ</strong>ÔºöËØ•Êåá‰ª§Â∞Ü RAX ÂØÑÂ≠òÂô®ÁöÑÂÄºÂ≠òÂÇ®Âà∞Áî± RDI ÂØÑÂ≠òÂô®ÊåáÂêëÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆÔºåÂπ∂Ê†πÊçÆ DFÔºàÊñπÂêëÊ†áÂøóÔºåDirection FlagÔºâÂÜ≥ÂÆöÊåáÈíàÁöÑÈÄíÂ¢ûÊàñÈÄíÂáè„ÄÇÊØèÊ¨°Â∞Ü 64 ‰ΩçÁöÑ RAX ÂÄºÂ≠òÂÇ®Âà∞ÂÜÖÂ≠ò‰∏≠„ÄÇ</li>
<li><strong>REP</strong>: <code>REP</code> ÂâçÁºÄÁî®Êù•ÊåáÁ§∫ <code>STOSQ</code> Êåá‰ª§Â∫îÈáçÂ§çÊâßË°åÔºåÁõ¥Âà∞ RCX ÂØÑÂ≠òÂô®ÁöÑÂÄºÂèò‰∏∫Èõ∂„ÄÇÂÖ∑‰ΩìÊù•ËØ¥Ôºå<code>REP</code> ÂâçÁºÄ‰ºöÂØπ <code>STOSQ</code> Êåá‰ª§ËøõË°åÂ¶Ç‰∏ãÊìç‰ΩúÔºö
<ul>
<li>ÂÖàÊ£ÄÊü• RCX ÊòØÂê¶‰∏∫Èõ∂„ÄÇÂ¶ÇÊûú RCX ‰∏∫Èõ∂ÔºåÊåá‰ª§ÁªìÊùü„ÄÇ</li>
<li>Â∞Ü RAX ÁöÑÂÄºÂ≠òÂÇ®Âà∞ RDI ÊâÄÊåáÂêëÁöÑ‰ΩçÁΩÆ„ÄÇ</li>
<li>Ê†πÊçÆ DF Ê†áÂøóÔºåRDI ÈÄíÂ¢ûÊàñÈÄíÂáè 8 ‰Ωç„ÄÇ</li>
<li>ÂáèÂ∞ë RCX ÁöÑÂÄº„ÄÇ</li>
<li>Âæ™ÁéØÁõ¥Âà∞ RCX ÂáèÂà∞Èõ∂„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="memcpy"><a class="markdownIt-Anchor" href="#memcpy"></a> memcpy</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">memcpy_7</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>inbuf<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>outbuf<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">memcpy</span><span class="token punctuation">(</span>outbuf<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span> inbuf<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Âú®ÁºñËØëÈÇ£‰∫õÂ§çÂà∂Â∞èÂ∞∫ÂØ∏ÂÜÖÂ≠òÂùóÁöÑ<code>memcpy()</code>ÂáΩÊï∞Êó∂ÔºåÂ§öÊï∞ÁºñËØëÂô®‰ºöÂàÜÈÖç‰∏ÄÁ≥ªÂàóÁöÑ<code>MOV</code>Êåá‰ª§„ÄÇ</li>
</ul>
<p><code>msvs optimize</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_inbuf<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>      <span class="token comment">; size = 4</span>
_outbuf<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>    <span class="token comment">; size = 4</span>
_memcpy_7 PROC
         mov     <span class="token register variable">ecx</span>, DWORD PTR _inbuf<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;ecx:inbuf</span>
         mov     <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span><span class="token comment">;edx:inbuf</span>
         mov     <span class="token register variable">eax</span>, DWORD PTR _outbuf<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;eax:outbuf</span>
         mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span>, <span class="token register variable">edx</span><span class="token comment">;outbuf+10=inbuf;Â§ÑÁêÜ4Â≠óËäÇ</span>
         mov     <span class="token register variable">dx</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;dx:inbuf->inbuf+4</span>
         mov     WORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">14</span><span class="token operator">]</span>, <span class="token register variable">dx</span><span class="token comment">;oubuf+14=inbuf+4;Â§ÑÁêÜÂâ©‰∏ãÁöÑ2‰∏™Â≠óËäÇ </span>
         mov     <span class="token register variable">cl</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span>  <span class="token comment">;</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">cl</span><span class="token comment">;Â§ÑÁêÜÂâ©‰∏ãÁöÑ‰∏Ä‰∏™Â≠óËäÇ</span>
         ret     <span class="token number">0</span>
_memcpy_7 ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>gcc optimize</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">memcpy_7:</span>
          push   <span class="token register variable">ebx</span>
          mov    <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span><span class="token comment">;eax:arg2,inbuf</span>
          mov    <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span><span class="token comment">;ecx:arg3,outbuf</span>
          mov    <span class="token register variable">ebx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span><span class="token comment">;ebx=eax:arg2</span>
          lea    <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span>
          mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>
          movzx  <span class="token register variable">ecx</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
          mov    WORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">cx</span>
          movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span>
          mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span>, <span class="token register variable">al</span>
          pop    <span class="token register variable">ebx</span>
          ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>È¶ñÂÖàÂ§çÂà∂4‰∏™Â≠óËäÇ</li>
<li>ÂÜçÂ§çÂà∂2‰∏™Â≠óËäÇ</li>
<li>ÊúÄÂêéÂ§çÂà∂1‰∏™Â≠óËäÇ</li>
</ul>
<hr />
<ul>
<li>ÁºñËØëÂô®Ëøò‰ºöÈÄöËøáËµãÂÄºÊåá‰ª§MOVÂ§çÂà∂ÁªìÊûÑ‰ΩìÔºàstructureÔºâÂûãÊï∞ÊçÆ„ÄÇ</li>
<li>Â§ßÂ∞∫ÂØ∏ÂÜÖÂ≠òÂùóÁöÑÊìç‰ΩúÔºö‰∏çÂêåÁöÑÁºñËØëÂô®‰ºöÊúâ‰∏çÂêåÁöÑÊåá‰ª§ÂàÜÈÖçÊñπÊ°à„ÄÇ</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">memcpy_128</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>inbuf<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>outbuf<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">memcpy</span><span class="token punctuation">(</span>outbuf<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span> inbuf<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">memcpy_123</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>inbuf<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>outbuf<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">memcpy</span><span class="token punctuation">(</span>outbuf<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span> inbuf<span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>optimize msvs</code></p>
<p><em>MSVCÂàÜÈÖç‰∫ÜÂçïÊù°MOVSDÊåá‰ª§„ÄÇÂú®Âæ™ÁéØÊéßÂà∂ÂèòÈáèECXÁöÑÈÖçÂêà‰∏ãÔºåMOVSDÂèØ‰∏ÄÊ≠•ÂÆåÊàê128‰∏™Â≠óËäÇÁöÑÊï∞ÊçÆÂ§çÂà∂„ÄÇÂÖ∂ÂéüÂõ†ÊòæÁÑ∂ÊòØ128ËÉΩË¢´4Êï¥Èô§„ÄÇ</em></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_inbuf<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>            <span class="token comment">; size = 4</span>
_outbuf<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>          <span class="token comment">; size = 4</span>
_memcpy_128 PROC
          push   <span class="token register variable">esi</span>
          mov    <span class="token register variable">esi</span>, DWORD PTR _inbuf<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
          push   <span class="token register variable">edi</span>
          mov    <span class="token register variable">edi</span>, DWORD PTR _outbuf<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
          add    <span class="token register variable">edi</span>, <span class="token number">10</span>
          mov    <span class="token register variable">ecx</span>, <span class="token number">32</span>
          rep movsd
          pop    <span class="token register variable">edi</span>
          pop    <span class="token register variable">esi</span>
          ret    <span class="token number">0</span>
_memcpy_128 ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ËøôÈáårep movsdËÅîÁî®</code></p>
<ul>
<li>
<p><strong>rep</strong> ÊòØ‰∏Ä‰∏™ÂâçÁºÄÊåá‰ª§ÔºåÊåáÁ§∫CPUÈáçÂ§çÊâßË°åÁ¥ßË∑üÂÖ∂ÂêéÁöÑÊåá‰ª§ÔºåÁõ¥Âà∞CXÔºà16‰ΩçÂíå32‰ΩçÊ®°ÂºèÔºâÊàñRCXÔºà64‰ΩçÊ®°ÂºèÔºâÂØÑÂ≠òÂô®ÁöÑÂÄºÂáèÂà∞Èõ∂„ÄÇÂú®ÊâßË°åËøáÁ®ã‰∏≠ÔºåCX/RCXÁöÑÂÄº‰ºöÂú®ÊØèÊ¨°Ëø≠‰ª£ÂêéËá™Âä®Âáè1„ÄÇ</p>
</li>
<li>
<p><strong>movsd</strong> ÊòØ‚Äúmove double word‚ÄùÁöÑÁº©ÂÜôÔºåÂÆÉÂ∞ÜDSÊÆµÂØÑÂ≠òÂô®ÊåáÂêëÁöÑÊ∫êÂú∞ÂùÄÔºàESI/RSIÔºâ‰∏≠ÁöÑ‰∏Ä‰∏™ÂèåÂ≠óÔºà4Â≠óËäÇÔºâÊï∞ÊçÆÂ§çÂà∂Âà∞ESÊÆµÂØÑÂ≠òÂô®ÊåáÂêëÁöÑÁõÆÊ†áÂú∞ÂùÄÔºàEDI/RDIÔºâ„ÄÇÂú®Â§çÂà∂‰πãÂêéÔºåÊ†πÊçÆÊñπÂêëÊ†áÂøóÔºàDFÔºâÁöÑÁä∂ÊÄÅÔºåESI/RSIÂíåEDI/RDI‰ºöËá™Âä®ÈÄíÂ¢ûÔºàÂ¶ÇÊûúDF‰∏∫0ÔºâÊàñÈÄíÂáèÔºàÂ¶ÇÊûúDF‰∏∫1ÔºâÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂ§ßÂ§öÊï∞Â≠óÁ¨¶‰∏≤Êìç‰ΩúÂâç‰ºöÂÖàÊâßË°å<code>cld</code>Êåá‰ª§Êù•Ê∏ÖÈõ∂DFÔºåÁ°Æ‰øùÂú∞ÂùÄÂêëÂâçÈÄíÂ¢û„ÄÇ</p>
</li>
<li>
<p>Âú®Â§çÂà∂123‰∏™Â≠óËäÇÁöÑÁ®ãÂ∫èÈáåÔºåÁºñËØëÂô®È¶ñÂÖàÈÄöËøáMOVSDÊåá‰ª§Â§çÂà∂30‰∏™32Â≠óËäÇÔºà‰πüÂ∞±ÊòØ120Â≠óËäÇÔºâÔºåÁÑ∂Âêé‰æùÊ¨°ÈÄöËøáMOVSWÊåá‰ª§ÂíåMOVSBÊåá‰ª§Â§çÂà∂2‰∏™Â≠óËäÇÂíå1‰∏™Â≠óËäÇ„ÄÇ</p>
</li>
</ul>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_inbuf<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>            <span class="token comment">; size = 4</span>
_outbuf<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>          <span class="token comment">; size = 4</span>
_memcpy_123 PROC
          push   <span class="token register variable">esi</span>
          mov    <span class="token register variable">esi</span>, DWORD PTR _inbuf<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
          push   <span class="token register variable">edi</span>
          mov    <span class="token register variable">edi</span>, DWORD PTR _outbuf<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
          add    <span class="token register variable">edi</span>, <span class="token number">10</span>
          mov    <span class="token register variable">ecx</span>, <span class="token number">30</span>
          rep movsd
          movsw
          movsb
          pop    <span class="token register variable">edi</span>
          pop    <span class="token register variable">esi</span>
          ret    <span class="token number">0</span>
_memcpy_123 ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>GCC</code></p>
<p>GCCÂàôÂàÜÈÖç‰∫Ü‰∏Ä‰∏™Â§ßÂûãÁöÑÈÄöÁî®ÁöÑÂáΩÊï∞„ÄÇËøô‰∏™ÂáΩÊï∞ÈÄÇÁî®‰∫é‰ªªÊÑèÂ§ßÂ∞èÁöÑÂÜÖÂ≠òÂùóÂ§çÂà∂Êìç‰Ωú„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; memcpy_123 ÂáΩÊï∞ÂºÄÂßã</span>
<span class="token label function">.LFB3:</span>
    <span class="token comment">; ‰øùÂ≠òediÂíåesiÂØÑÂ≠òÂô®ÔºåÂõ†‰∏∫ÂÆÉ‰ª¨Â∞ÜË¢´Áî®‰∫éÊï∞ÊçÆÂ§çÂà∂</span>
    push   <span class="token register variable">edi</span>
    push   <span class="token register variable">esi</span>

    <span class="token comment">; ËÆæÁΩÆ‰∏Ä‰∏™ËÆ°Êï∞Âô®eax = 123ÔºåÁî®‰∫éÊéßÂà∂Â§çÂà∂ÊàñÂÖ∂‰ªñÊìç‰ΩúÁöÑÂæ™ÁéØ</span>
    mov    <span class="token register variable">eax</span>, <span class="token number">123</span>

    <span class="token comment">; Ëé∑ÂèñÁõÆÊ†áÂú∞ÂùÄÔºàedxÔºâÂíåÊ∫êÂú∞ÂùÄÔºàesiÔºâ‰ªéÊ†à‰∏≠</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>  <span class="token comment">; ÁõÆÊ†áÂú∞ÂùÄ</span>
    mov    <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>  <span class="token comment">; Ê∫êÂú∞ÂùÄ</span>

    <span class="token comment">; Ë∞ÉÊï¥ÁõÆÊ†áÂú∞ÂùÄediÔºåÈ¢ÑÂÖàÂ¢ûÂä†10Â≠óËäÇÂÅèÁßª</span>
    lea    <span class="token register variable">edi</span>, <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span>

    <span class="token comment">; Ê£ÄÊü•ÁõÆÊ†áÂú∞ÂùÄediÊòØÂê¶‰∏∫Â•áÊï∞ÊàñÂÅ∂Êï∞ÂØπÈΩêÔºå‰ª•‰æøËøõË°åÁõ∏Â∫îÁöÑÂØπÈΩêÂ§ÑÁêÜ</span>
    test   <span class="token register variable">edi</span>, <span class="token number">1</span>  <span class="token comment">; Ê£ÄÊü•Â•áÊï∞ÂØπÈΩê</span>
    jne    .L24    <span class="token comment">; ‰∏çÊòØÂÅ∂Êï∞ÂØπÈΩêÂàôË∑≥ËΩ¨Â§ÑÁêÜ</span>
    test   <span class="token register variable">edi</span>, <span class="token number">2</span>  <span class="token comment">; Ê£ÄÊü•4Â≠óËäÇÂØπÈΩê</span>
    jne    .L25    <span class="token comment">; ‰∏çÊòØ4Â≠óËäÇÂØπÈΩêÂàôË∑≥ËΩ¨Â§ÑÁêÜ</span>

<span class="token label function">.L7:</span> <span class="token comment">; ‰∏ªÂ§çÂà∂Âæ™ÁéØÂºÄÂßã</span>
    <span class="token comment">; ËÆ°ÁÆóÈúÄË¶ÅÂ§çÂà∂ÁöÑÂèåÂ≠óÔºà4Â≠óËäÇÔºâÊï∞ÈáèÔºåÂπ∂Ê∏ÖÈô§edxÂáÜÂ§á‰Ωú‰∏∫ËÆ°Êï∞Âô®</span>
    mov    <span class="token register variable">ecx</span>, <span class="token register variable">eax</span>
    xor    <span class="token register variable">edx</span>, <span class="token register variable">edx</span>
    shr    <span class="token register variable">ecx</span>, <span class="token number">2</span>  <span class="token comment">; Â∞ÜeaxÈô§‰ª•4ÔºåÂæóÂà∞ÂèåÂ≠óÊï∞Èáè</span>

    <span class="token comment">; Â§çÂà∂ÂèåÂ≠óÊï∞ÊçÆÔºåÂ¶ÇÊûúÊúâÂâ©‰ΩôÂ≠óËäÇÂàôÂçïÁã¨Â§ÑÁêÜ</span>
    test   <span class="token register variable">al</span>, <span class="token number">2</span>  <span class="token comment">; Ê£ÄÊü•ÊòØÂê¶ÊúâÈúÄË¶ÅÂ§ÑÁêÜÁöÑÂâ©‰Ωô2Â≠óËäÇ</span>
    rep movsd   <span class="token comment">; ÊâπÈáèÂ§çÂà∂ÂèåÂ≠ó</span>
    je     .L8    <span class="token comment">; Â¶ÇÊûúÊ≤°ÊúâÂâ©‰ΩôÂ≠óËäÇÔºåË∑≥ËΩ¨Âà∞ÁªìÂ∞æ</span>

    <span class="token comment">; Â§ÑÁêÜÂâ©‰ΩôÁöÑ2Â≠óËäÇÊï∞ÊçÆ</span>
    movzx  <span class="token register variable">edx</span>, WORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">]</span>
    mov    WORD PTR <span class="token operator">[</span><span class="token register variable">edi</span><span class="token operator">]</span>, <span class="token register variable">dx</span>
    mov    <span class="token register variable">edx</span>, <span class="token number">2</span>

<span class="token label function">.L8:</span> <span class="token comment">; Ê£ÄÊü•Âπ∂Â§ÑÁêÜÂçïÂ≠óËäÇÂØπÈΩêÊÉÖÂÜµ</span>
    test   <span class="token register variable">al</span>, <span class="token number">1</span>  <span class="token comment">; Ê£ÄÊü•ÊòØÂê¶ÊúâÈúÄË¶ÅÂ§ÑÁêÜÁöÑÂâ©‰Ωô1Â≠óËäÇ</span>
    je     .L5    <span class="token comment">; Â¶ÇÊûúÊ≤°ÊúâÂâ©‰ΩôÂ≠óËäÇÔºåË∑≥ËΩ¨Âà∞ÊÅ¢Â§çÂØÑÂ≠òÂô®Âπ∂ËøîÂõû</span>

    <span class="token comment">; Â§ÑÁêÜÊúÄÂêé‰∏Ä‰∏™Â≠óËäÇ</span>
    movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">]</span>
    mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">edi</span><span class="token operator">+</span><span class="token register variable">edx</span><span class="token operator">]</span>, <span class="token register variable">al</span>

<span class="token label function">.L5:</span> <span class="token comment">; ÊÅ¢Â§çesiÂíåediÂØÑÂ≠òÂô®</span>
    pop    <span class="token register variable">esi</span>
    pop    <span class="token register variable">edi</span>

    <span class="token comment">; ÂáΩÊï∞ËøîÂõû</span>
    ret

<span class="token comment">; ‰ª•‰∏ã‰∏∫ÂØπÈΩêÂ§ÑÁêÜÂàÜÊîØ</span>
<span class="token label function">.L24:</span> 
    <span class="token comment">; ÂØπÁõÆÊ†áÂú∞ÂùÄedi‰∏∫Â•áÊï∞Êó∂ÁöÑÁâπÊÆäÂ§ÑÁêÜ</span>
    ...
<span class="token label function">.L25:</span>
    <span class="token comment">; ÂØπÁõÆÊ†áÂú∞ÂùÄedi‰∏∫Èùû4Â≠óËäÇÂØπÈΩêÊó∂ÁöÑÁâπÊÆäÂ§ÑÁêÜ</span>
    ...

<span class="token label function">.LFE3:</span> <span class="token comment">; ÂáΩÊï∞ÁªìÊùüÊ†áÁ≠æ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÈÄöÁî®ÂÜÖÂ≠òÂ§çÂà∂ÂáΩÊï∞ÈÄöÂ∏∏ÁöÑÂ∑•‰ΩúÂéüÁêÜÂ¶Ç‰∏ãÔºöÈ¶ñÂÖàËÆ°ÁÆóÂùóÊúâÂ§öÂ∞ë‰∏™Â≠óÔºà32‰ΩçÔºâÔºåÁÑ∂ÂêéÁî®MOVSDÊåá‰ª§Â§çÂà∂Ëøô‰∫õÂÜÖÂ≠òÂùóÔºåÁÑ∂ÂêéÈÄê‰∏ÄÂ§çÂà∂Ââ©‰ΩôÁöÑÂ≠óËäÇ„ÄÇ</p>
<p>Êõ¥‰∏∫Â§çÊùÇÁöÑÂÜÖÂ≠òÂ§çÂà∂ÂáΩÊï∞Âàô‰ºöÂà©Áî®<code>SIMDÊåá‰ª§ÈõÜËøõË°åÂ§çÂà∂</code>ÔºåËøôÁßçÂ§çÂà∂Ëøò‰ºö<code>Ê∂âÂèäÂÜÖÂ≠òÂú∞ÂùÄÂØπÈΩê</code>ÁöÑÈóÆÈ¢ò„ÄÇ</p>
<h4 id="memcmp"><a class="markdownIt-Anchor" href="#memcmp"></a> memcmp</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">memcpy_1235</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>inbuf<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>outbuf<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token function">memcmp</span><span class="token punctuation">(</span>outbuf<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span> inbuf<span class="token punctuation">,</span> <span class="token number">1235</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êó†ËÆ∫ÂÜÖÂ≠òÂùóÁöÑÂ∞∫ÂØ∏ÊòØÂ§öÂ§ßÔºåMSVC 2010ÈÉΩ‰ºöÊèíÂÖ•Áõ∏ÂêåÁöÑÈÄöÁî®ÊØîËæÉÂáΩÊï∞„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; ÂÆö‰πâËæìÂÖ•ÂèÇÊï∞‰ΩçÁΩÆ</span>
_buf1<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>       <span class="token comment">; _buf1$‰Ωç‰∫éÊ†à‰∏äÁöÑ‰ΩçÁΩÆÔºåÂ§ßÂ∞è‰∏∫4Â≠óËäÇ</span>
_buf2<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>      <span class="token comment">; _buf2$‰Ωç‰∫éÊ†à‰∏äÁöÑ‰ΩçÁΩÆÔºåÂ§ßÂ∞è‰∏∫4Â≠óËäÇ</span>

_memcmp_1235 PROC
    <span class="token comment">; Âä†ËΩΩÁºìÂÜ≤Âå∫2ÁöÑÂú∞ÂùÄÂà∞edx</span>
    mov    <span class="token register variable">edx</span>, DWORD PTR _buf2<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
    <span class="token comment">; Âä†ËΩΩÁºìÂÜ≤Âå∫1ÁöÑÂú∞ÂùÄÂà∞ecx</span>
    mov    <span class="token register variable">ecx</span>, DWORD PTR _buf1<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>

    <span class="token comment">; ‰øùÂ≠òediÂíåesiÔºå‰∏∫ÂêéÁª≠‰ΩøÁî®ÂáÜÂ§á</span>
    push   <span class="token register variable">esi</span>
    push   <span class="token register variable">edi</span>

    <span class="token comment">; ÂàùÂßãÂåñËÆ°Êï∞Âô®esi‰∏∫1235</span>
    mov    <span class="token register variable">esi</span>, <span class="token number">1235</span>

    <span class="token comment">; ÁõÆÊ†áÁºìÂÜ≤Âå∫Âú∞ÂùÄÈ¢ÑÂÅèÁßª10Â≠óËäÇ</span>
    add    <span class="token register variable">edx</span>, <span class="token number">10</span>

<span class="token label function">$LL4@memcmp_123:</span> <span class="token comment">; ‰∏ªÂæ™ÁéØÂºÄÂßã</span>
    <span class="token comment">; ÊØîËæÉÂΩìÂâç‰ΩçÁΩÆÁöÑÂèåÂ≠óÔºà4Â≠óËäÇÔºâ</span>
    mov    <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">]</span>   <span class="token comment">; eax = *buf2 + 10</span>
    cmp    <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>   <span class="token comment">; ÊØîËæÉeaxÂíå*buf1</span>
    jne    SHORT <span class="token operator">$</span>LN10@memcmp_123 <span class="token comment">; Ëã•‰∏çÂêåÔºåË∑≥ËΩ¨Âà∞Â∑ÆÂºÇÂ§ÑÁêÜ</span>

    <span class="token comment">; Â¶ÇÊûúÁõ∏Á≠âÔºåËÆ°Êï∞Âô®ÈÄíÂáèÔºåÊåáÈíàÂâçËøõ</span>
    sub    <span class="token register variable">esi</span>, <span class="token number">4</span>
    add    <span class="token register variable">ecx</span>, <span class="token number">4</span>
    add    <span class="token register variable">edx</span>, <span class="token number">4</span>

    <span class="token comment">; Ê£ÄÊü•ËÆ°Êï∞Âô®ÊòØÂê¶Â§ß‰∫éÁ≠â‰∫é4ÔºåËã•Â∞è‰∫éÂàôÁªìÊùüÂæ™ÁéØ</span>
    cmp    <span class="token register variable">esi</span>, <span class="token number">4</span>
    jae    SHORT <span class="token operator">$</span>LL4@memcmp_123

<span class="token label function">$LN10@memcmp_123:</span> <span class="token comment">; ÂèëÁé∞Â∑ÆÂºÇÂêéÁöÑÂ§ÑÁêÜ</span>
    <span class="token comment">; ÊØîËæÉÂâ©‰ΩôÂ≠óËäÇÔºåÈÄêÂ≠óËäÇÊØîËæÉÁõ¥Âà∞ÊâæÂà∞Â∑ÆÂºÇÊàñÁªìÊùü</span>
    movzx  <span class="token register variable">edi</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>   <span class="token comment">; ÊØîËæÉÁ¨¨‰∏Ä‰∏™Â≠óËäÇ</span>
    movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">]</span>
    sub    <span class="token register variable">eax</span>, <span class="token register variable">edi</span>
    jne    SHORT <span class="token operator">$</span>LN7@memcmp_123

    movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>   <span class="token comment">; ÊØîËæÉÁ¨¨‰∫å‰∏™Â≠óËäÇ</span>
    movzx  <span class="token register variable">edi</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>
    sub    <span class="token register variable">eax</span>, <span class="token register variable">edi</span>
    jne    SHORT <span class="token operator">$</span>LN7@memcmp_123

    movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span>   <span class="token comment">; ÊØîËæÉÁ¨¨‰∏â‰∏™Â≠óËäÇ</span>
    movzx  <span class="token register variable">edi</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span>
    sub    <span class="token register variable">eax</span>, <span class="token register variable">edi</span>
    jne    SHORT <span class="token operator">$</span>LN7@memcmp_123

    <span class="token comment">; Â¶ÇÊûúesi‰∏çÂ∞è‰∫é3ÔºåËØ¥ÊòéËá≥Â∞ëÊØîËæÉ‰∫Ü4Â≠óËäÇÔºåÊØîËæÉÁ¨¨Âõõ‰∏™Â≠óËäÇ</span>
    cmp    <span class="token register variable">esi</span>, <span class="token number">3</span>
    jbe    SHORT <span class="token operator">$</span>LN6@memcmp_123
    movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">]</span>
    movzx  <span class="token register variable">ecx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">]</span>
    sub    <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>

<span class="token label function">$LN7@memcmp_123:</span> <span class="token comment">; ÁªìÊûúÂ§ÑÁêÜ</span>
    sar    <span class="token register variable">eax</span>, <span class="token number">31</span>                 <span class="token comment">; ËÆæÁΩÆÁªìÊûúÊ≠£Ë¥üÔºàÈÄöËøáÁßª‰ΩçÂÆûÁé∞Ôºâ</span>
    pop    <span class="token register variable">edi</span>
    or     <span class="token register variable">eax</span>, <span class="token number">1</span>                  <span class="token comment">; Á°Æ‰øùÁªìÊûúÈùûÈõ∂</span>
    pop    <span class="token register variable">esi</span>
    ret    <span class="token number">0</span>                      <span class="token comment">; ËøîÂõûÁªìÊûú</span>

<span class="token label function">$LN6@memcmp_123:</span> <span class="token comment">; Êú™ÂèëÁé∞Â∑ÆÂºÇÔºåÊâÄÊúâÂ∑≤Ê£ÄÊü•Â≠óËäÇÂùáÁõ∏Âêå</span>
    pop    <span class="token register variable">edi</span>
    xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>               <span class="token comment">; eax = 0ÔºåË°®Á§∫Êó†Â∑ÆÂºÇ</span>
    pop    <span class="token register variable">esi</span>
    ret    <span class="token number">0</span>                      <span class="token comment">; ËøîÂõû0ÔºåË°®Á§∫‰∏§‰∏™ÁºìÂÜ≤Âå∫ÂÜÖÂÆπÁõ∏Âêå</span>
_memcmp_1235 ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap44-c99Ê†áÂáÜÁöÑÂèóÈôêÊåáÈíà"><a class="markdownIt-Anchor" href="#chap44-c99Ê†áÂáÜÁöÑÂèóÈôêÊåáÈíà"></a> Chap44 C99Ê†áÂáÜÁöÑÂèóÈôêÊåáÈíà</h3>
<ul>
<li>
<p>‰ªÄ‰πàÊòØ<em>ÂèóÈôêÊåáÈíà?</em></p>
<p><code>restrict</code> ÊòØ C99 Ê†áÂáÜÂºïÂÖ•ÁöÑ‰∏ÄÁßçÁ±ªÂûãÈôêÂÆöÁ¨¶ÔºåÁî®‰∫éÊåáÈíàÂ£∞Êòé‰∏≠„ÄÇÂÆÉÂëäËØâÁºñËØëÂô®Ôºå‰∏Ä‰∏™ÊåáÈíàÊòØÂîØ‰∏ÄËÆøÈóÆÊüê‰∏ÄÂØπË±°ÁöÑÊñπÂºè„ÄÇËøô‰∏ÄÈôêÂÆöÁ¨¶Êèê‰æõ‰∫ÜÊõ¥Â§öÁöÑ‰ºòÂåñÊú∫‰ºöÔºåÂ∞§ÂÖ∂ÊòØÂØπÁºñËØëÂô®ËÄåË®ÄÔºåÂõ†‰∏∫ÂÆÉÊ∂àÈô§‰∫ÜÊåáÈíàÂà´ÂêçÔºàpointer aliasingÔºâÁöÑÂèØËÉΩÊÄß„ÄÇ</p>
<p>Á§∫‰æã‰∏éËß£Èáä</p>
<p>ËÄÉËôë‰∏ÄÁßçÊÉÖÂÜµÔºåÊàë‰ª¨Â∏åÊúõÂØπ‰∏§‰∏™Êï∞ÁªÑËøõË°åÂÖÉÁ¥†Áõ∏Âä†Ôºö</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">add_arrays</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>c<span class="token punctuation">,</span> <span class="token class-name">size_t</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        c<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂÅáËÆæÂáΩÊï∞Ë∞ÉÁî®Êó∂ <code>a</code>„ÄÅ<code>b</code> Âíå <code>c</code> ÂèØËÉΩÊåáÂêëÂêå‰∏ÄÂÜÖÂ≠òÂå∫ÂüüÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇÁºñËØëÂô®Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÂøÖÈ°ªÂæàË∞®ÊÖéÂú∞ÁîüÊàê‰ª£Á†ÅÔºåÂõ†‰∏∫ÂÆÉÊó†Ê≥ïÁ°ÆÂÆöÂÜÖÂ≠òÂå∫ÂüüÊòØÂê¶ÈáçÂè†„ÄÇ</p>
<p>‰ΩøÁî® <code>restrict</code></p>
<p>ÈÄöËøá‰ΩøÁî® <code>restrict</code>ÔºåÊàë‰ª¨ÂëäËØâÁºñËØëÂô®ÔºåÊØè‰∏Ä‰∏™ÊåáÈíàÈÉΩÂàÜÂà´ÊåáÂêë‰∏çÂêåÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇËøôÂ∞ÜÂÖÅËÆ∏ÁºñËØëÂô®ËøõË°åÊõ¥ÁßØÊûÅÁöÑ‰ºòÂåñÔºå‰ªéËÄåÊèêÈ´òÊÄßËÉΩÔºö</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">add_arrays</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>restrict a<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>restrict b<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>restrict c<span class="token punctuation">,</span> <span class="token class-name">size_t</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        c<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏äËø∞‰ª£Á†ÅË°®Á§∫Ôºö<code>a</code> ÊåáÈíàÊåáÂêëÁöÑÂÜÖÂ≠ò„ÄÅ‰∏çË¢´ <code>b</code> Âíå <code>c</code> ÊåáÂêëÔºå<code>b</code> ÊåáÈíàÊåáÂêëÁöÑÂÜÖÂ≠ò„ÄÅ‰∏çË¢´ <code>a</code> Âíå <code>c</code> ÊåáÂêëÔºå<code>c</code> ÊåáÈíàÊåáÂêëÁöÑÂÜÖÂ≠ò‰πü‰∏çË¢´ <code>a</code> Âíå <code>b</code> ÊåáÂêë„ÄÇ</p>
<p>‰ΩúÁî®</p>
<ol>
<li><strong>Ê∂àÈô§ÊåáÈíàÂà´ÂêçÈóÆÈ¢ò</strong>ÔºöÈÄöËøá <code>restrict</code>ÔºåÁºñËØëÂô®ËÉΩÂ§üÁ°ÆÂÆöËøô‰∫õÊåáÈíà‰∏ç‰ºöÊåáÂêëÈáçÂè†ÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇËøôÂáèÂ∞ë‰∫ÜÂÜÖÂ≠òËÆøÈóÆÁöÑÂ§çÊùÇÊÄß„ÄÇ</li>
<li><strong>ÊèêÂçá‰ºòÂåñÊú∫‰ºö</strong>ÔºöÂú®Ê≤°Êúâ <code>restrict</code> ÁöÑÊÉÖÂÜµ‰∏ãÔºåÁºñËØëÂô®ÂøÖÈ°ªÂÅáËÆæËøô‰∫õÊåáÈíàÂèØËÉΩÊåáÂêëÂêå‰∏Ä‰∏™ÂÜÖÂ≠òÂå∫ÂüüÔºåËøô‰ºöÈôç‰Ωé‰ºòÂåñÁöÑÊú∫‰ºö„ÄÇËÄå‰ΩøÁî® <code>restrict</code> ‰πãÂêéÔºåÁºñËØëÂô®ÂèØ‰ª•Êõ¥Â•ΩÂú∞ËøõË°å‰ºòÂåñÔºåÊØîÂ¶ÇÂú®ÂØÑÂ≠òÂô®‰∏≠ÁºìÂ≠òÂÄºÁ≠â„ÄÇ</li>
</ol>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÂú∞Êñπ</p>
<ol>
<li><strong>ÂêàÊ≥ïÊÄßÁ∫¶Êùü</strong>Ôºö‰Ωú‰∏∫Á®ãÂ∫èÂëòÔºåÂú®‰ΩøÁî® <code>restrict</code> Êó∂ÔºåÂøÖÈ°ª‰øùËØÅËøô‰∫õÊåáÈíàÁ°ÆÂÆûÊåáÂêë‰∏çÂêåÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºåÂê¶Âàô‰ºöÂØºËá¥Êú™ÂÆö‰πâË°å‰∏∫„ÄÇ</li>
<li><strong>Â∫îÁî®Âú∫ÊôØ</strong>ÔºöÈÄÇÁî®‰∫éÈÇ£‰∫õÊÄßËÉΩÊïèÊÑü‰∏îÁ°ÆÂÆöÊåáÈíà‰∏ç‰ºöÈáçÂè†ÁöÑÂú∫ÊôØ„ÄÇ</li>
</ol>
<p>ÊÄªÁªì</p>
<p><code>restrict</code> ÂÖ≥ÈîÆÂ≠óÊèê‰æõ‰∫Ü‰∏ÄÁßçÊñπÊ≥ïÔºåËÆ©Á®ãÂ∫èÂëòËÉΩÂ§üÊòéÁ°ÆÂú∞ÂëäËØâÁºñËØëÂô®ÊåáÈíàÁöÑ‰ΩøÁî®Á∫¶ÊùüÔºåËøôÊ†∑ÁºñËØëÂô®ÂèØ‰ª•ËøõË°åÊõ¥ÊøÄËøõÁöÑ‰ºòÂåñÔºå‰ªéËÄåÊèêÈ´òÁ®ãÂ∫èÁöÑÊÄßËÉΩ„ÄÇ‰ΩÜËøô‰πüÈúÄË¶ÅÁ®ãÂ∫èÂëòÈÅµÂæ™ÂÖ∂Á∫¶ÂÆöÔºåÂê¶ÂàôÂèØËÉΩÂ∏¶Êù•‰∏çÂèØÈ¢ÑËßÅÁöÑÈóÆÈ¢ò„ÄÇ</p>
</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">f1</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> sum<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> product<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> sum_product<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> update_me<span class="token punctuation">,</span> <span class="token class-name">size_t</span> s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>s<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
                   sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                   product<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                   update_me<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token operator">*</span><span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// some dummy value</span>
                   sum_product<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>product<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>Ëøô‰∏™Á®ãÂ∫èÁöÑÂäüËÉΩÂçÅÂàÜÁÆÄÂçïÔºå‰ΩÜÊòØÈáåÈù¢ÁöÑÊåáÈíàÈóÆÈ¢òÂç¥Âèë‰∫∫Ê∑±ÊÄùÔºöÂêå‰∏ÄÂùóÂÜÖÂ≠òÂèØ‰ª•Áî±Â§ö‰∏™ÊåáÈíàÊù•ËÆøÈóÆÔºåÂõ†Ê≠§Âêå‰∏Ä‰∏™Âú∞ÂùÄÁöÑÊï∞ÊçÆÂèØËÉΩ‰ºöË¢´Â§ö‰∏™ÊåáÈíàËΩÆÁï™Â§çÂÜô„ÄÇ</em></p>
<p>CËØ≠Ë®ÄÁºñËØëÂô®ÂÆåÂÖ®ÂÖÅËÆ∏‰∏äËø∞ÊÉÖÂÜµ„ÄÇÂõ†Ê≠§ÔºåÂÆÉÂàÜÂõõ‰∏™Èò∂ÊÆµÂ§ÑÁêÜÊØèÊ¨°Ëø≠‰ª£ÁöÑÂêÑÁ±ªÊï∞ÁªÑÔºö</p>
<ul>
<li>Âà∂Â§ásum[i];</li>
<li>Âà∂Â§áproduct[i];</li>
<li>Âà∂Â§áupdate_me[i];</li>
<li>Âà∂Â§ásum_product[i]„ÄÇÂú®Ëøô‰∏™Èò∂ÊÆµÔºåËÆ°ÁÆóÊú∫Â∞Ü‰ªéÂÜÖÂ≠òÈáåÈáçÊñ∞Âä†ËΩΩsum[i]Âíåproduct[i]„ÄÇ</li>
</ul>
<p><em>Á¨¨Âõõ‰∏™Èò∂ÊÆµÊòØÂê¶Â≠òÂú®Ëøõ‰∏ÄÊ≠•‰ºòÂåñÁöÑÁ©∫Èó¥Âë¢ÔºüÊó¢ÁÑ∂ÂâçÈù¢Â∑≤ÁªèËÆ°ÁÆóÂ•Ω‰∫Üsum[i]Âíåproduct[i]ÔºåÈÇ£‰πàÂêéÈù¢Êàë‰ª¨Â∫îËØ•Â∞±‰∏çÂøÖÂÜç‰ªéÂÜÖÂ≠ò‰∏≠ËØªÂèñÂÆÉ‰ª¨ÁöÑÂÄº‰∫Ü„ÄÇ</em></p>
<p>Âè™ÊòØÁºñËØëÂô®Êú¨Ë∫´Âπ∂‰∏çËÉΩÂú®Á¨¨‰∏â‰∏™Èò∂ÊÆµÁ°ÆÂÆöÂâç‰∏§‰∏™Èò∂ÊÆµÁöÑËµãÂÄºÊ≤°ÊúâË¢´ÂÖ∂‰ªñÊåá‰ª§Ë¶ÜÁõñ„ÄÇÊç¢ËÄåË®Ä‰πãÔºåÂõ†‰∏∫ÁºñËØëÂô®‰∏çËÉΩÂà§Êñ≠ËØ•Á®ãÂ∫èÈáåÊòØÂê¶Â≠òÂú®ÊåáÂêëÁõ∏ÂêåÂÜÖÂ≠òÂå∫ÂüüÁöÑÊåáÈíà‚Äî‚ÄîÂç≥‚ÄúÊåáÈíàÂà´ÂêçÔºàpointer aliasingÔºâ‚ÄùÔºåÊâÄ‰ª•ÁºñËØëÂô®‰∏çËÉΩÁ°Æ‰øùËØ•ÊåáÈíàÊåáÂêëÁöÑÂÜÖÂ≠òÊ≤°Ë¢´ÊîπÂÜô„ÄÇ</p>
<p>C99Ê†áÂáÜ‰∏≠ÁöÑÂèóÈôêÊåáÈíàÔºªISO07Ôºå6.7.3ËäÇÔºΩÔºàÈÉ®ÂàÜÊñáÁåÆÂèàÁß∞‚Äú‰∏•Ê†ºÂà´Âêç‚ÄùÔºâÁöÑÂ∫îËøêËÄåÁîü„ÄÇÁºñÁ®ã‰∫∫ÂëòÂèØÈÄöËøáÂèóÈôêÊåáÈíàÁöÑstrict‰øÆÈ•∞Á¨¶ÂêëÁºñËØëÂô®ÊâøËØ∫Ôºö<mark>Ë¢´ËØ•ÂÖ≥ÈîÆÂ≠óÊ†áËÆ∞ÁöÑÊåáÈíàÊòØÊìç‰ΩúÁõ∏ÂÖ≥ÂÜÖÂ≠òÂå∫ÂüüÁöÑÂîØ‰∏ÄÊåáÈíàÔºåÊ≤°ÊúâÂÖ∂‰ªñÊåáÈíàÈáçÂ§çÊåáÂêëËøô‰∏™ÊåáÈíàÊâÄÊìç‰ΩúÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇ</mark></p>
<p>Áî®Êõ¥‰∏∫Á°ÆÂàá„ÄÅÊõ¥‰∏∫Ê≠£ÂºèÁöÑËØ≠Ë®ÄÊù•ËØ¥ÔºåÂÖ≥ÈîÆÂ≠ó‚Äúrestrict‚ÄùË°®Á§∫ËØ•ÊåáÈíàÊòØËÆøÈóÆÊó¢ÂÆöÂØπË±°ÁöÑÂîØ‰∏ÄÊåáÈíàÔºåÂÖ∂‰ªñÊåáÈíàÈÉΩ‰∏ç‰ºöÈáçÂ§çÊìç‰ΩúÊó¢ÂÆöÂØπË±°„ÄÇ‰ªéÂè¶‰∏Ä‰∏™ËßíÂ∫¶Êù•ÁúãÔºå‰∏ÄÊó¶Êüê‰∏™ÊåáÈíàË¢´Ê†áËÆ∞‰∏∫ÂèóÈôêÊåáÈíàÔºåÈÇ£‰πàÁºñËØëÂô®Â∞±ËÆ§ÂÆöÊó¢ÂÆöÂØπË±°Âè™‰ºöË¢´ÊåáÂÆöÁöÑÂèóÈôêÊåáÈíàÊìç‰Ωú„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">f2</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> restrict x<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> restrict y<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> restrict sum<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> restrict product<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> ‚Üô
    ‚Üò restrict sum_product<span class="token punctuation">,</span>
          <span class="token keyword">int</span><span class="token operator">*</span> restrict update_me<span class="token punctuation">,</span> <span class="token class-name">size_t</span> s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>s<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
                   sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                   product<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                   update_me<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token operator">*</span><span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// some dummy value</span>
                   sum_product<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>product<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>GCC X64 f1</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">f1:</span>
         push   <span class="token register variable">r15</span> <span class="token register variable">r14</span> <span class="token register variable">r13</span> <span class="token register variable">r12</span> <span class="token register variable">rbp</span> <span class="token register variable">rdi</span> <span class="token register variable">rsi</span> <span class="token register variable">rbx</span>
         mov    <span class="token register variable">r13</span>, QWORD PTR <span class="token number">120</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
         mov    <span class="token register variable">rbp</span>, QWORD PTR <span class="token number">104</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
         mov    <span class="token register variable">r12</span>, QWORD PTR <span class="token number">112</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
         test   <span class="token register variable">r13</span>, <span class="token register variable">r13</span>
         je     .L1
         add    <span class="token register variable">r13</span>, <span class="token number">1</span>
         xor    <span class="token register variable">ebx</span>, <span class="token register variable">ebx</span>
         mov    <span class="token register variable">edi</span>, <span class="token number">1</span>
         xor    <span class="token register variable">r11d</span>, <span class="token register variable">r11d</span>
         jmp    .L4
<span class="token label function">.L6:</span>
          mov   <span class="token register variable">r11</span>, <span class="token register variable">rdi</span>
          mov   <span class="token register variable">rdi</span>, <span class="token register variable">rax</span>
<span class="token label function">.L4:</span>
         lea    <span class="token register variable">rax</span>, <span class="token number">0</span><span class="token operator">[</span><span class="token number">0</span><span class="token operator">+</span><span class="token register variable">r11</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
         lea    <span class="token register variable">r10</span>, <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>
         lea    <span class="token register variable">r14</span>, <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>
         lea    <span class="token register variable">rsi</span>, <span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>
         add    <span class="token register variable">rax</span>, <span class="token register variable">r9</span>
         mov    <span class="token register variable">r15d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span><span class="token operator">]</span>
         add    <span class="token register variable">r15d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r14</span><span class="token operator">]</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">]</span>, <span class="token register variable">r15d</span>         <span class="token comment">; store to sum[]</span>
         mov    <span class="token register variable">r10d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r10</span><span class="token operator">]</span>
         imul   <span class="token register variable">r10d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">r14</span><span class="token operator">]</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">]</span>, <span class="token register variable">r10d</span>         <span class="token comment">; store to product[]</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span><span class="token operator">+</span><span class="token register variable">r11</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>    <span class="token comment">; store to update_me[]</span>
         add    <span class="token register variable">ebx</span>, <span class="token number">123</span>
         mov    <span class="token register variable">r10d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">]</span>         <span class="token comment">; reload sum[i]</span>
         add    <span class="token register variable">r10d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">]</span>         <span class="token comment">; reload product[i]</span>
         lea    <span class="token register variable">rax</span>, <span class="token number">1</span><span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>
         cmp    <span class="token register variable">rax</span>, <span class="token register variable">r13</span>
         mov    DWORD PTR <span class="token number">0</span><span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">+</span><span class="token register variable">r11</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">r10d</span>  <span class="token comment">; store to sum_product[]</span>
         jne    .L6
<span class="token label function">.L1:</span>
         pop    <span class="token register variable">rbx</span> <span class="token register variable">rsi</span> <span class="token register variable">rdi</span> <span class="token register variable">rbp</span> <span class="token register variable">r12</span> <span class="token register variable">r13</span> <span class="token register variable">r14</span> <span class="token register variable">r15</span>
         ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>GCC X64 f2</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">f2:</span>
         push   <span class="token register variable">r13</span> <span class="token register variable">r12</span> <span class="token register variable">rbp</span> <span class="token register variable">rdi</span> <span class="token register variable">rsi</span> <span class="token register variable">rbx</span>
         mov    <span class="token register variable">r13</span>, QWORD PTR <span class="token number">104</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
         mov    <span class="token register variable">rbp</span>, QWORD PTR <span class="token number">88</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
         mov    <span class="token register variable">r12</span>, QWORD PTR <span class="token number">96</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
         test   <span class="token register variable">r13</span>, <span class="token register variable">r13</span>
         je     .L7
         add    <span class="token register variable">r13</span>, <span class="token number">1</span>
         xor    <span class="token register variable">r10d</span>, <span class="token register variable">r10d</span>
         mov    <span class="token register variable">edi</span>, <span class="token number">1</span>
         xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
         jmp    .L10
<span class="token label function">.L11:</span>
         mov    <span class="token register variable">rax</span>, <span class="token register variable">rdi</span>
         mov    <span class="token register variable">rdi</span>, <span class="token register variable">r11</span>
<span class="token label function">.L10:</span>
         mov    <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
         mov    <span class="token register variable">r11d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">r12</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">r10d</span> <span class="token comment">; store to update_me[]</span>
         add    <span class="token register variable">r10d</span>, <span class="token number">123</span>
         lea    <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">+</span><span class="token register variable">r11</span><span class="token operator">]</span>
         imul   <span class="token register variable">r11d</span>, <span class="token register variable">esi</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">ebx</span> <span class="token comment">; store to sum[]</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">r9</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">r11d</span> <span class="token comment">; store to product[]</span>
         add    <span class="token register variable">r11d</span>, <span class="token register variable">ebx</span>
         mov    DWORD PTR <span class="token number">0</span><span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">r11d</span> <span class="token comment">; store to sum_product[]</span>
         lea    <span class="token register variable">r11</span>, <span class="token number">1</span><span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>
         cmp    <span class="token register variable">r11</span>, <span class="token register variable">r13</span>
         jne    .L11
<span class="token label function">.L7:</span>
         pop    <span class="token register variable">rbx</span> <span class="token register variable">rsi</span> <span class="token register variable">rdi</span> <span class="token register variable">rbp</span> <span class="token register variable">r12</span> <span class="token register variable">r13</span>
         ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><mark>f1()ÂáΩÊï∞Âíåf2()ÂáΩÊï∞ÁöÑ‰∏çÂêå‰πãÂ§ÑÂú®‰∫éÔºöÂú®f1()ÂáΩÊï∞‰∏≠Ôºåsum[i]Âíåproduct[i]Êï∞ÁªÑÂú®Âæ™ÁéØ‰∏≠‰ºöÂÜçÊ¨°Âä†ËΩΩÔºõËÄåÂáΩÊï∞f2()ÂàôÊ≤°ÊúâËøôÁßçÈáçÊñ∞Âä†ËΩΩÂÜÖÂ≠òÊï∞ÂÄºÁöÑÊìç‰Ωú„ÄÇÂú®ÊîπÂä®ÂêéÁöÑÁ®ãÂ∫èÈáåÔºåÂõ†‰∏∫Êàë‰ª¨ÂêëÁºñËØëÂô®‚ÄúÊâøËØ∫‚Äùsum[i]Âíåproduct[i]ÁöÑÂÄº‰∏ç‰ºöË¢´ÂÖ∂‰ªñÊåáÈíàÂ§çÂÜôÔºåÊâÄ‰ª•ËÆ°ÁÆóÊú∫‰ºöÈáçÂ§çÂà©Áî®ÂâçÂá†‰∏™Èò∂ÊÆµÂà∂Â§áÂ•ΩÁöÑÂêÑÈ°πÊï∞ÊçÆÔºå‰∏çÂÜç‰ªéÂÜÖÂ≠òÂä†ËΩΩÂÆÉ‰ª¨ÁöÑÂÄº‰∫Ü„ÄÇÂæàÊòéÊòæÔºåÊîπËøõÂêéÁöÑÁ®ãÂ∫èËøêË°åÈÄüÂ∫¶Êõ¥Âø´‰∏Ä‰∫õ„ÄÇ</mark></p>
<p>Â¶ÇÊûúÊàë‰ª¨Â£∞Êòé‰∫ÜÊüê‰∏™ÊåáÈíàÊòØÂèóÈôêÊåáÈíàÔºåËÄåÂÆûÈôÖÁöÑÁ®ãÂ∫èÂèàÊúâÂÖ∂‰ªñÊåáÈíàÊìç‰ΩúËøô‰∏™ÂèóÈôêÊåáÈíàÊìç‰ΩúÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºåÂ∞Ü‰ºöÂèëÁîü‰ªÄ‰πàÊÉÖÂÜµÔºüËøôÁúüÁöÑÂ∞±ÊòØÁ®ãÂ∫èÂëòÁöÑ‰∫ã‰∫ÜÔºå‰∏çËøáÁ®ãÂ∫èËøêË°åÁöÑÁªìÊûúËÇØÂÆöÊòØÈîôËØØÁöÑ„ÄÇ</p>
<p>FORTRANËØ≠Ë®ÄÁöÑÁºñËØëÂô®ÊääÊâÄÊúâÊåáÈíàÈÉΩËßÜ‰∏∫ÂèóÈôêÊåáÈíà„ÄÇÂõ†Ê≠§ÔºåÂú®CËØ≠Ë®Ä‰∏çÊîØÊåÅC99Ê†áÂáÜÁöÑrestrict‰øÆÈ•∞Á¨¶ËÄåÂÆûÈôÖÊåáÈíàÂ±û‰∫éÂèóÈôêÊåáÈíàÁöÑÊó∂ÂÄôÔºåÁî®FORTRANËØ≠Ë®ÄÁºñËØëÂá∫Êù•ÁöÑÂ∫îÁî®Á®ãÂ∫è‰ºöÊØîÁî®CËØ≠Ë®ÄÁºñËØëÂá∫Êù•ÁöÑÁ®ãÂ∫èËøêË°åÂæóÊõ¥Âø´„ÄÇ</p>
<p>ÂèóÈôêÊåáÈíà‰∏ªË¶ÅÁî®‰∫éÂì™‰∫õÈ¢ÜÂüüÔºüÂÆÉ‰∏ªË¶ÅÁî®‰∫éÊìç‰ΩúÂ§ö‰∏™Â§ßÂ∞∫ÂØ∏ÂÜÖÂ≠òÂùóÁöÑÂ∫îÁî®ÊñπÈù¢„ÄÇ‰æãÂ¶ÇÔºåÂú®Ë∂ÖÁ∫ßËÆ°ÁÆóÊú∫/HPCÂπ≥Âè∞‰∏äÁªèÂ∏∏ËøõË°åÁöÑÁ∫øÊÄßÊñπÁ®ãÁªÑÊ±ÇËß£Â∞±Â±û‰∫éËøôÁßçÁ±ªÂûãÁöÑÂ∫îÁî®„ÄÇÊàñËÆ∏ÔºåËøôÊ≠£ÊòØËøôÁßçÂπ≥Âè∞ÊôÆÈÅçÈááÁî®FORTRANËØ≠Ë®ÄÁöÑÂéüÂõ†‰πã‰∏ÄÂêß„ÄÇ</p>
<p>Âè¶‰∏ÄÊñπÈù¢ÔºåÂú®Âæ™ÁéØËØ≠Âè•ÁöÑËø≠‰ª£Ê¨°Êï∞‰∏çÊòØÈùûÂ∏∏È´òÁöÑÊÉÖÂÜµ‰∏ãÔºåÂèóÈôêÊåáÈíàÂ∏¶Êù•ÁöÑÊÄßËÉΩÊèêÂçáÂ∞±‰∏ç‰ºöÂçÅÂàÜÊòéÊòæ„ÄÇ</p>
<h3 id="chap45-ÊâìÈÄ†Êó†ÂàÜÊîØÁöÑabsÂáΩÊï∞"><a class="markdownIt-Anchor" href="#chap45-ÊâìÈÄ†Êó†ÂàÜÊîØÁöÑabsÂáΩÊï∞"></a> Chap45 ÊâìÈÄ†Êó†ÂàÜÊîØÁöÑabs()ÂáΩÊï∞</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">my_abs</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                   <span class="token keyword">return</span> <span class="token operator">-</span>i<span class="token punctuation">;</span>
          <span class="token keyword">else</span>
                   <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂõûÈ°æÁ¨¨12Á´†ÔºåÊàë‰ª¨ÂèØ‰ª•Áî®x86Ê±áÁºñÊåá‰ª§ÊâìÈÄ†‰∏Ä‰∏™Êó†ÂàÜÊîØÁöÑÁâàÊú¨</p>
<hr />
<p><code>x64 gcc optimizing</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">my_abs:</span>
         mov    <span class="token register variable">edx</span>, <span class="token register variable">edi</span><span class="token comment">;edx=edi:i</span>
         mov    <span class="token register variable">eax</span>, <span class="token register variable">edi</span><span class="token comment">;eax=edi:i</span>
         sar    <span class="token register variable">edx</span>, <span class="token number">31</span>
<span class="token comment">; EDX is 0xFFFFFFFF here if sign of input value is minus</span>
<span class="token comment">; EDX is 0 if sign of input value is plus (including 0)</span>
<span class="token comment">; the following two instructions have effect only if EDX is 0xFFFFFFFF</span>
<span class="token comment">; or idle if EDX is 0</span>
         xor    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
         sub    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
         ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>sar</code>ÁÆóÊúØÂè≥Áßª:ÁÆóÊúØÂè≥Áßª31‰ΩçÔºåÁÆóÊúØÂè≥ÁßªÊòØÂ∏¶Á¨¶Âè∑ÁöÑÊìç‰ΩúÔºåÊúâÁ¨¶Âè∑Êï∞ÁöÑÊúÄÈ´òÊúâÊïà‰Ωç<code>MSB</code>Â∞±ÊòØÂÖ∂Á¨¶Âè∑‰Ωç„ÄÇ‰πüÂ∞±ÊòØËØ¥Â¶ÇÊûúÊ∫êÊìç‰ΩúÊï∞ÊòØË¥üÊï∞ÔºåÈÇ£‰πàÂè≥Áßª31‰ΩçÂêéÂæóÂà∞ÁöÑÁªìÊûúÈÉΩ‰ºöÊòØ<code>0xffffffff</code></li>
<li>ÂΩìËæìÂÖ•ÂÄºÊòØË¥üÊï∞ÁöÑÊó∂ÂÄô,Áõ∏ÂΩì‰∫é<code>xorÔºå0xffffffff</code>ÔºåÁõ∏ÂΩì‰∫éÈÄê‰ΩçÊ±ÇÈùûÁöÑÈùûËøêÁÆóÔºåËÄåÂêéÈù¢ÁöÑ<code>sub</code>Êåá‰ª§ÂÆåÊàê‰∫ÜË°•Á†ÅËøêÁÆó(Âõ†‰∏∫Ê≠§Êó∂edxÁöÑÂÄºÊòØ-1)</li>
</ul>
<h3 id="chap46-ÂèòÈïøÂèÇÊï∞ÂáΩÊï∞"><a class="markdownIt-Anchor" href="#chap46-ÂèòÈïøÂèÇÊï∞ÂáΩÊï∞"></a> Chap46 ÂèòÈïøÂèÇÊï∞ÂáΩÊï∞</h3>
<p>Êú¨Á´†Êé¢Á©∂ÂÉè<code>printf</code>Âíå<code>scanf</code>‰∏ÄÁ±ªÁöÑÂáΩÊï∞ÂèØ‰ª•Â§ÑÁêÜÂ§ö‰∏™ÂèÇÊï∞ÔºåËøôÁ±ªÂáΩÊï∞ÊòØÂ¶Ç‰ΩïËÆøÈóÆÂèÇÊï∞ÁöÑ</p>
<h4 id="ËÆ°ÁÆóÁÆóÊúØÂπ≥ÂùáÂÄº"><a class="markdownIt-Anchor" href="#ËÆ°ÁÆóÁÆóÊúØÂπ≥ÂùáÂÄº"></a> ËÆ°ÁÆóÁÆóÊúØÂπ≥ÂùáÂÄº</h4>
<p>Â¶ÇÊûúË¶ÅÁºñÂÜô‰∏Ä‰∏™ËÆ°ÁÆóÁÆóÊúØÂπ≥ÂùáÂÄºÁöÑÂáΩÊï∞ÔºåÈÇ£‰πàÂ∞±ÈúÄË¶ÅÂú®ÂáΩÊï∞ÁöÑÂèÇÊï∞Â£∞ÊòéÈÉ®ÂàÜÊåáÂÆöÊâÄÊúâÁöÑÂ§ñÊù•ÂèÇÊï∞„ÄÇ‰ΩÜÊòØC/C++ÁöÑÂèòÈïøÂèÇÊï∞ÂáΩÊï∞Âç¥Êó†Ê≥ï‰∫ãÂÖàÁü•ÈÅìÂ§ñÊù•ÂèÇÊï∞ÁöÑÊï∞Èáè„ÄÇ‰∏∫‰∫ÜÊñπ‰æøËµ∑ËßÅÔºåÊàë‰ª¨Áî®‚Äú-1‚Äù‰Ωú‰∏∫ÊúÄÂêé‰∏Ä‰∏™ÂèÇÊï∞ÂÖºÂÖ∂‰ªñÂèÇÊï∞ÁöÑÁªàÊ≠¢Á¨¶„ÄÇ</p>
<p>CËØ≠Ë®ÄÊ†áÂáÜÂáΩÊï∞Â∫ìÁöÑÂ§¥Êñá‰ª∂<code>stdarg.h</code>ÂÆö‰πâ‰∫ÜÂèòÈïøÂèÇÊï∞ÁöÑÂ§ÑÁêÜÊñπÊ≥ïÔºàÂÆèÔºâ„ÄÇÂàöÊâçÊèêÂà∞ÁöÑ<code>printf()</code>ÂáΩÊï∞Âíå<code>scanf()</code>ÂáΩÊï∞ÈÉΩ‰ΩøÁî®‰∫ÜËøô‰∏™Êñá‰ª∂Êèê‰æõÁöÑÂÆè„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h></span></span>

<span class="token keyword">int</span> <span class="token function">arith_mean</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         va_list args<span class="token punctuation">;</span>
         <span class="token keyword">int</span> sum<span class="token operator">=</span>v<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">;</span>
         <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
                  i<span class="token operator">=</span><span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// terminator</span>
                           <span class="token keyword">break</span><span class="token punctuation">;</span>
                  sum<span class="token operator">=</span>sum<span class="token operator">+</span>i<span class="token punctuation">;</span>
                  count<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span>

         <span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> sum<span class="token operator">/</span>count<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">arith_mean</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* terminator */</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_v<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_arith_mean PROC NEAR
        mov     <span class="token register variable">eax</span>, DWORD PTR _v<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span> <span class="token comment">; load 1st argument into sum</span>
        push    <span class="token register variable">esi</span>
        mov     <span class="token register variable">esi</span>, <span class="token number">1</span>                    <span class="token comment">; count=1</span>
        lea     <span class="token register variable">edx</span>, DWORD PTR _v<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>   <span class="token comment">; address of the 1st argument</span>
<span class="token label function">$L838:</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>    <span class="token comment">; load next argument</span>
        add     <span class="token register variable">edx</span>, <span class="token number">4</span>                    <span class="token comment">; shift pointer to the next argument</span>
        cmp     <span class="token register variable">ecx</span>, <span class="token operator">-</span><span class="token number">1</span>                   <span class="token comment">; is it -1?</span>
        je      SHORT <span class="token operator">$</span>L856               <span class="token comment">; exit if so</span>
        add     <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>                  <span class="token comment">; sum = sum + loaded argument</span>
        inc     <span class="token register variable">esi</span>                       <span class="token comment">; count++</span>
        jmp     SHORT <span class="token operator">$</span>L838
<span class="token label function">$L856:</span>
<span class="token comment">; calculate quotient</span>

        cdq
        idiv    <span class="token register variable">esi</span><span class="token comment">;count</span>
        pop     <span class="token register variable">esi</span>
        ret     <span class="token number">0</span>
_arith_mean ENDP

<span class="token operator">$</span>SG851  DB      <span class="token string">'%d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

_main   PROC NEAR
        push    <span class="token operator">-</span><span class="token number">1</span>
        push    <span class="token number">15</span>
        push    <span class="token number">10</span>
        push    <span class="token number">7</span>
        push    <span class="token number">2</span>
        push    <span class="token number">1</span>
        call    _arith_mean
        push    <span class="token register variable">eax</span>
        push    OFFSET FLAT:<span class="token operator">$</span>SG851 <span class="token comment">; '%d'</span>
        call    _printf
        add     <span class="token register variable">esp</span>, <span class="token number">32</span>
        ret     <span class="token number">0</span>
_main   ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>CDQ</code>ÔºàConvert Doubleword to QuadwordÔºâÊåá‰ª§,Â∞Ü32‰ΩçÁöÑ<code>EAX</code>ÂØÑÂ≠òÂô®‰∏≠ÁöÑÊúâÁ¨¶Âè∑Êï¥Êï∞ÁöÑÁ¨¶Âè∑‰ΩçÊâ©Â±ïÂà∞64‰ΩçÁöÑ<code>EDX:EAX</code>ÂØÑÂ≠òÂô®ÂØπ‰∏≠„ÄÇ</p>
</li>
<li>
<p><code>main()</code>ÂáΩÊï∞ÈáåÔºåÂêÑÈ°πÂèÇÊï∞‰ªéÂè≥Âà∞Â∑¶‰æùÊ¨°ÈÄÜÂ∫è‰º†ÈÄíÂÖ•Ê†à„ÄÇÁ¨¨‰∏Ä‰∏™ÂÖ•Ê†àÁöÑÊòØÊúÄÂêé‰∏ÄÈ°πÂèÇÊï∞‚Äú-1‚ÄùÔºåËÄåÊúÄÂêéÂÖ•Ê†àÁöÑÊòØÁ¨¨‰∏ÄÈ°πÂèÇÊï∞‚Äî‚ÄîÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤„ÄÇ</p>
</li>
<li>
<p>ÂáΩÊï∞<code>arith_mean()</code>ÂèñÂá∫Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÁöÑÂÄºÔºåÂπ∂Â∞ÜÂÖ∂‰øùÂ≠òÂú®ÂèòÈáèsum‰∏≠„ÄÇÊé•ÁùÄÔºåÂ∞ÜÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÁöÑÂú∞ÂùÄ‰øùÂ≠òÂú®ÂØÑÂ≠òÂô®EDX‰∏≠ÔºåÂπ∂ÂèñÂá∫ÂÖ∂ÂÄºÔºå‰∏éÂâçÈù¢ÁöÑsumÁõ∏Âä†„ÄÇÂ¶ÇÊ≠§Âæ™ÁéØÂæÄÂ§çÔºåÁõ¥Âà∞ÂèÇÊï∞ÁöÑÁªàÊ≠¢Á¨¶<code>‚àí1„ÄÇ</code></p>
</li>
<li>
<p>ÂΩìÊâæÂà∞‰∫ÜÂèÇÊï∞‰∏≤ÁöÑÁªìÂ∞æÂêéÔºåÁ®ãÂ∫èÂÜçÂ∞ÜÊâÄÊúâÊï∞ÁöÑÁÆóÊúØÂíåsumÈô§‰ª•ÂèÇÊï∞ÁöÑ‰∏™Êï∞ÔºàÂΩìÁÑ∂‰∏çÂåÖÊã¨ÁªàÊ≠¢Á¨¶‚àí1Ôºâ„ÄÇÊåâÁÖßËøôÁßçÁÆóÊ≥ïËÆ°ÁÆóÂá∫Êù•ÁöÑÂïÜÂ∞±ÊòØÂêÑÂèÇÊï∞ÁöÑÁÆóÊúØÂπ≥ÂùáÂÄº„ÄÇ</p>
</li>
<li>
<p>==Êç¢Âè•ËØùËØ¥ÔºåÂú®Ë∞ÉÁî®ÂèòÈïøÂèÇÊï∞ÂáΩÊï∞Êó∂ÔºåË∞ÉÁî®ÊñπÂáΩÊï∞ÂÖàÊää‰∏çÁ°ÆÂÆöÈïøÂ∫¶ÁöÑÂèÇÊï∞Â†ÜÁßØ‰∏∫Êï∞ÁªÑÔºåÂÜçÈÄöËøáÊ†àÊääËøô‰∏™Êï∞ÁªÑ‰º†ÈÄíÁªôÂèòÈïøÂáΩÊï∞ÂèÇÊï∞„ÄÇËøôÂ∞±Ëß£Èáä‰∫Ü‰∏∫‰ªÄ‰πàcdeclË∞ÉÁî®ËßÑËåÉ‰ºöË¶ÅÊ±ÇÂ∞ÜÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊúÄÂêé‰∏Ä‰∏™Êé®ÈÄÅÂÖ•Ê†à‰∫Ü„ÄÇ==Âõ†‰∏∫Â¶ÇÊûú‰∏çËøôÊ†∑ÁöÑËØùÔºåË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞‰ºöÊâæ‰∏çÂà∞Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÔºåËøô‰ºöÂØºËá¥printf()ËøôÊ†∑ÁöÑÂáΩÊï∞Âõ†‰∏∫Êâæ‰∏çÂà∞Ê†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÁöÑÂú∞ÂùÄËÄåÊó†Ê≥ïËøêË°å„ÄÇ</p>
</li>
</ul>
<hr />
<p><code>Âü∫‰∫éÂØÑÂ≠òÂô®ÁöÑË∞ÉÁî®ËßÑËåÉ</code></p>
<p><code>msvs x64</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG3013 DB      <span class="token string">'%d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

v<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
arith_mean PROC
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>     <span class="token comment">; 1st argument</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">rdx</span>    <span class="token comment">; 2nd argument</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>, <span class="token register variable">r8</span>     <span class="token comment">; 3rd argument</span>
         mov    <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>                   <span class="token comment">; sum = 1st argument</span>
         lea    <span class="token register variable">rcx</span>, QWORD PTR v<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>   <span class="token comment">; pointer to the 2nd argument</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>, <span class="token register variable">r9</span>     <span class="token comment">; 4th argument</span>
         mov    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>       <span class="token comment">; load 2nd argument</span>
         mov    <span class="token register variable">r8d</span>, <span class="token number">1</span>                     <span class="token comment">; count=1</span>
         cmp    <span class="token register variable">edx</span>, <span class="token operator">-</span><span class="token number">1</span>                    <span class="token comment">; 2nd argument is -1?</span>
         je     SHORT <span class="token operator">$</span>LN8@arith_mean      <span class="token comment">; exit if so</span>
<span class="token label function">$LL3@arith_mean:</span>
         add    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>                   <span class="token comment">; sum = sum + loaded argument</span>
         mov    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>     <span class="token comment">; load next argument</span>
         lea    <span class="token register variable">rcx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>     <span class="token comment">; shift pointer to point to the argument after next</span>
         inc    <span class="token register variable">r8d</span>                        <span class="token comment">; count++</span>
         cmp    <span class="token register variable">edx</span>, <span class="token operator">-</span><span class="token number">1</span>                    <span class="token comment">; is loaded argument -1?</span>
         jne    SHORT <span class="token operator">$</span>LL3@arith_mean      <span class="token comment">; go to loop begin if its not'</span>
<span class="token label function">$LN8@arith_mean:</span>
<span class="token comment">; calculate quotient</span>
         cdq
         idiv   <span class="token register variable">r8d</span>
         ret    <span class="token number">0</span>
arith_mean ENDP

main     PROC
         sub    <span class="token register variable">rsp</span>, <span class="token number">56</span>
         mov    <span class="token register variable">edx</span>, <span class="token number">2</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">40</span><span class="token operator">]</span>, <span class="token operator">-</span><span class="token number">1</span>
         mov    DWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>, <span class="token number">15</span>
         lea    <span class="token register variable">r9d</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
         lea    <span class="token register variable">r8d</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">]</span>
         lea    <span class="token register variable">ecx</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">]</span>
         call   arith_mean
         lea    <span class="token register variable">rcx</span>, OFFSET FLAT:<span class="token operator">$</span>SG3013
         mov    <span class="token register variable">edx</span>, <span class="token register variable">eax</span>
         call   printf
         xor    <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
         add    <span class="token register variable">rsp</span>, <span class="token number">56</span>
         ret    <span class="token number">0</span>
main     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Âú®Ëøô‰∏™Á®ãÂ∫è‰∏≠ÔºåÂØÑÂ≠òÂô®Ë¥üË¥£‰º†ÈÄíÂáΩÊï∞ÁöÑÂâç4‰∏™ÂèÇÊï∞ÔºåÊ†àÁî®Êù•‰º†ÈÄíÂÖ∂‰ΩôÁöÑ2‰∏™ÂèÇÊï∞„ÄÇÂáΩÊï∞<code>arith_mean()</code>È¶ñÂÖàÂ∞ÜÂØÑÂ≠òÂô®‰º†ÈÄíÁöÑ4‰∏™ÂèÇÊï∞Â≠òÊîæÂú®Èò¥ÂΩ±Á©∫Èó¥ÈáåÔºåÊääÈò¥ÂΩ±Á©∫Èó¥Âíå‰º†ÈÄíÂèÇÊï∞ÁöÑÊ†à<code>ÂêàÂπ∂Êàê‰∫ÜÁªü‰∏ÄËÄåËøûÁª≠ÁöÑÂèÇÊï∞Êï∞ÁªÑ</code></li>
</ul>
<h4 id="vprintf"><a class="markdownIt-Anchor" href="#vprintf"></a> vprintf()</h4>
<p>Âú®ÁºñÂÜôÊó•Âøó(logging)ÂáΩÊï∞ÁöÑÊó∂ÂÄôÔºåÂ§öÊï∞‰∫∫ÈÉΩ‰ºöËá™Â∑±ÊûÑÈÄ†‰∏ÄÁßç<code>‰∏éprintfÁ±ª‰ººÁöÑ„ÄÅÂ§ÑÁêÜ‚ÄúÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤Ôºã‰∏ÄÁ≥ªÂàóÔºà‰ΩÜÊòØÊï∞ÈáèÂèØÂèòÔºâÁöÑÂÜÖÂÆπÂèÇÊï∞‚ÄùÁöÑÂèòÈïøÂèÇÊï∞ÂáΩÊï∞„ÄÇ</code></p>
<p>Âè¶Â§ñ‰∏ÄÁßçÂ∏∏ËßÅÁöÑÂèòÈïøÂèÇÊï∞ÂáΩÊï∞Â∞±ÊòØ‰∏ãÊñáÁöÑËøôÁßçdie()ÂáΩÊï∞„ÄÇËøôÊòØ‰∏ÄÁßçÂú®ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ‰πãÂêéÈöèÂç≥ÈÄÄÂá∫Êï¥‰∏™Á®ãÂ∫èÁöÑÂºÇÂ∏∏Â§ÑÁêÜÂáΩÊï∞„ÄÇÂÆÉÈúÄË¶ÅÊää‰∏çÁ°ÆÂÆöÊï∞ÈáèÁöÑËæìÂÖ•ÂèÇÊï∞ÊâìÂåÖ„ÄÅÂ∞ÅË£ÖÂπ∂‰º†ÈÄíÁªôprintf()ÂáΩÊï∞„ÄÇÂ¶Ç‰ΩïÂÆûÁé∞Âë¢Ôºü<code>Ëøô‰∫õÂáΩÊï∞ÂêçÁß∞ÂâçÈù¢Êúâ‰∏Ä‰∏™Â≠óÊØçvÁöÑÔºåËøôÊòØÂõ†‰∏∫ÂÆÉÂ∫îÂΩìËÉΩÂ§üÂ§ÑÁêÜ‰∏çÁ°ÆÂÆöÊï∞ÈáèÔºàvariable.ÂèØÂèòÁöÑÔºâÁöÑÂèÇÊï∞„ÄÇ</code>‰ª•die()ÂáΩÊï∞Ë∞ÉÁî®ÁöÑvprintf()ÂáΩÊï∞‰∏∫‰æãÔºåÂÆÉÁöÑËæìÂÖ•ÂèòÈáèÂ∞±ÂèØÂàÜ‰∏∫‰∏§ÈÉ®ÂàÜÔºö‰∏ÄÈÉ®ÂàÜÊòØÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÔºåÂè¶‰∏ÄÈÉ®ÂàÜÊòØÂ∏¶ÊúâÂ§öÁßçÁ±ªÂûãÊï∞ÊçÆÂèòÈáèÂàóË°®<code>va_list</code>ÁöÑÊåáÈíà„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h></span></span>

<span class="token keyword">void</span> <span class="token function">die</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         va_list va<span class="token punctuation">;</span>
         <span class="token function">va_start</span> <span class="token punctuation">(</span>va<span class="token punctuation">,</span> fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token function">vprintf</span> <span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> va<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>va_list</code>ÊòØ‰∏Ä‰∏™ÊåáÂêëÊï∞ÁªÑÁöÑÊåáÈíà„ÄÇ</p>
<p><code>x64 msvs</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_fmt<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
_die     PROC
         <span class="token comment">; load 1st argument (format-string)</span>
         mov    <span class="token register variable">ecx</span>, DWORD PTR _fmt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
         <span class="token comment">; get pointer to the 2nd argument</span>
         lea    <span class="token register variable">eax</span>, DWORD PTR _fmt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
         push   <span class="token register variable">eax</span>          <span class="token comment">; pass pointer</span>
         push   <span class="token register variable">ecx</span>
         call   _vprintf
         add    <span class="token register variable">esp</span>, <span class="token number">8</span>
         push   <span class="token number">0</span>
         call   _exit
<span class="token label function">$LN3@die:</span>
         int    <span class="token number">3</span>
_die     ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>die()</code>ÂáΩÊï∞ÂÆûÁé∞ÁöÑÂäüËÉΩÂ∞±ÊòØÔºö<mark>Âèñ‰∏Ä‰∏™ÊåáÂêëÂèÇÊï∞ÁöÑÊåáÈíàÔºåÂÜçÂ∞ÜÂÖ∂‰º†ÈÄÅÁªôvprintf()ÂáΩÊï∞„ÄÇÂèòÈïøÂèÇÊï∞ÔºàÂ∫èÂàóÔºâÂÉèÊï∞ÁªÑÈÇ£Ê†∑Ë¢´Êù•Âõû‰º†ÈÄí„ÄÇ</mark></p>
<hr />
<p><code>x64 gcc</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">fmt<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">48</span>
die      PROC
         <span class="token comment">; save first 4 arguments in Shadow Space</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">rcx</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">rdx</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>, <span class="token register variable">r8</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>, <span class="token register variable">r9</span>
         sub    <span class="token register variable">rsp</span>, <span class="token number">40</span>
         lea    <span class="token register variable">rdx</span>, QWORD PTR fmt<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span> <span class="token comment">; pass pointer to the 1st argument</span>
         <span class="token comment">; RCX here is still points to the 1st argument (format-string) of die()</span>
         <span class="token comment">; so vprintf() will take it right from RCX</span>
         call   vprintf
         xor    <span class="token register variable">ecx</span>, <span class="token register variable">ecx</span>
         call   exit
         int    <span class="token number">3</span>
die      ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏éÂâç‰æãÁ±ª‰ººÔºå<code>rcx</code>ÊåáÂêëÈò¥ÂΩ±Á©∫Èó¥ÔºåÂàöÂ•ΩÊòØ<code>va_list</code>ÁöÑÊåáÈíà</p>
<h3 id="chap47-Â≠óÁ¨¶‰∏≤Ââ™Âàá"><a class="markdownIt-Anchor" href="#chap47-Â≠óÁ¨¶‰∏≤Ââ™Âàá"></a> Chap47 Â≠óÁ¨¶‰∏≤Ââ™Âàá</h3>
<p><em>ÂΩìÊàë‰ª¨ÈúÄË¶ÅÂéªÈô§Â≠óÁ¨¶‰∏≤ÁöÑÂºÄÂßãÁ¨¶Âè∑ÊàñËÄÖÁªìÊùüÁ¨¶Âè∑</em></p>
<p>Êú¨Á´†‰ªãÁªçÁöÑÁ®ãÂ∫èÔºå‰∏ìÈó®Áî®‰∫éÂéªÈô§Â≠óÁ¨¶‰∏≤ÁöÑÁªìÂ∞æÈÉ®ÂàÜÁöÑÂõûËΩ¶ÂíåÊç¢Ë°åÂ≠óÁ¨¶<code>CR/LF</code></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">char</span> c<span class="token punctuation">;</span>
         <span class="token class-name">size_t</span> str_len<span class="token punctuation">;</span>

         <span class="token comment">// work as long as \r or \n is at the end of string</span>
         <span class="token comment">// stop if some other character there or its an empty string'</span>
         <span class="token comment">// (at start or due to our operation)</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span>str_len<span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> str_len<span class="token operator">></span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c<span class="token operator">=</span>s<span class="token punctuation">[</span>str_len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str_len<span class="token operator">--</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
                   <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token operator">==</span><span class="token char">'\r'</span> <span class="token operator">||</span> c<span class="token operator">==</span><span class="token char">'\n'</span><span class="token punctuation">)</span>
                             s<span class="token punctuation">[</span>str_len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                   <span class="token keyword">else</span>
                             <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token comment">// test</span>

         <span class="token comment">// strdup() is used to copy text string into data segment,</span>
         <span class="token comment">// because it will crash on Linux otherwise,</span>
         <span class="token comment">// where text strings are allocated in constant data segment,</span>
         <span class="token comment">// and not modifiable.</span>

         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"test1\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"test2\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"test3\n\r\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"test4\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"test5\r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"[%s]\n"</span><span class="token punctuation">,</span> <span class="token function">str_trim</span> <span class="token punctuation">(</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token string">"test6\r\r\r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs x64 optimizing</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">s<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
str_trim PROC

<span class="token comment">; RCX is the first function argument and it always holds pointer to the string</span>

<span class="token comment">; this is strlen() function inlined right here:</span>
<span class="token comment">; set RAX to 0xFFFFFFFFFFFFFFFF (-1)</span>
         or     <span class="token register variable">rax</span>, <span class="token operator">-</span><span class="token number">1</span>
<span class="token label function">$LL14@str_trim:</span>
         inc    <span class="token register variable">rax</span><span class="token comment">;rax++,rax:0</span>
         cmp    BYTE PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">]</span>, <span class="token number">0</span><span class="token comment">;rcx:s</span>
         jne    SHORT <span class="token operator">$</span>LL14@str_trim<span class="token comment">;Ê£ÄÊµãÂΩìÂâçÂ≠óÁ¨¶ÊòØÂê¶‰∏∫Á©∫Â≠óÁ¨¶‰∏≤</span>
<span class="token comment">; is string length zero? exit then</span>
         test   <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
<span class="token label function">$LN18@str_trim:</span>
         je     SHORT <span class="token operator">$</span>LN15@str_trim<span class="token comment">;eax=0Âàôexit</span>
<span class="token comment">; RAX holds string length</span>
<span class="token comment">; here is probably disassembler (or assembler printing routine) error,</span>
<span class="token comment">; LEA RDX... should be here instead of LEA EDX...</span>
         lea    <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">]</span>
<span class="token comment">; idle instruction: EAX will be reset at the next instructions execution'</span>
         mov    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
<span class="token comment">; load character at address s[str_len-1]</span>
         movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token register variable">rcx</span><span class="token operator">]</span>
<span class="token comment">; save also pointer to the last character to R8</span>
         lea    <span class="token register variable">r8</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rdx</span><span class="token operator">+</span><span class="token register variable">rcx</span><span class="token operator">]</span>
         cmp    <span class="token register variable">al</span>, <span class="token number">13</span> <span class="token comment">; is it '\r'?</span>
         je     SHORT <span class="token operator">$</span>LN2@str_trim
         cmp    <span class="token register variable">al</span>, <span class="token number">10</span> <span class="token comment">; is it '\n'?</span>
         jne    SHORT <span class="token operator">$</span>LN15@str_trim
<span class="token label function">$LN2@str_trim:</span><span class="token comment">;Â∞ÜÊç¢Ë°åÁ≠âÂ≠óÁ¨¶ÊõøÊç¢‰∏∫0</span>
<span class="token comment">; store 0 to that place</span>
         mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">r8</span><span class="token operator">]</span>, <span class="token number">0</span>
         mov    <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
<span class="token comment">; check character for 0, but conditional jump is above...</span>
         test   <span class="token register variable">edx</span>, <span class="token register variable">edx</span>
         jmp    SHORT <span class="token operator">$</span>LN18@str_trim
<span class="token label function">$LN15@str_trim:</span>
<span class="token comment">; return "s"</span>
         mov    <span class="token register variable">rax</span>, <span class="token register variable">rcx</span>
         ret    <span class="token number">0</span>
str_trim ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>È¶ñÂÖàËøôÊÆµÊ±áÁºñÁöÑÁ¨¨‰∏Ä‰∏™ÁâπÂæÅÂ∞±ÊòØ<code>MSVSÁºñËØëÂô®</code>ÂØπÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶ÂáΩÊï∞<code>strlen()</code>ËøõË°å‰∫ÜÂÜÖËÅîÁöÑÂ±ïÂºÄÂíåÂµåÂÖ•Â§ÑÁêÜ„ÄÇÁºñËØëÂô®ËÆ§‰∏∫ÔºåÂÜÖËÅîÂ§ÑÁêÜÂêéÁöÑÊâßË°åÊïàÁéá‰ºöÊØîÂ∏∏ËßÑÁöÑÂáΩÊï∞Ë∞ÉÁî®Êõ¥Â•Ω</li>
<li>ÂÜÖÂµåÂ§ÑÁêÜ‰πãÂêéÔºå<code>strlen()</code>ÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™Êåá‰ª§ÊòØÔºö<code>OR RAX,0xffffffffffffffff</code>„ÄÇÊàë‰ª¨‰∏çÊ∏ÖÊ•ö‰∏∫‰ΩïMSVCÈááÁî®ORÔºàÊàñÔºâÊåá‰ª§ÔºåËÄåÊ≤°ÊúâÈááÁî®<code>MOV RAX, 0xffffffffffffffff</code>Êåá‰ª§Áõ¥Êé•ËµãÂÄº„ÄÇÂΩìÁÑ∂ÔºåËøô‰∏§Êù°Êåá‰ª§ÊâßË°åÁöÑÊòØÁõ∏ÂêåÊìç‰ΩúÔºöÂ∞ÜÊâÄÊúâ‰ΩçËÆæÁΩÆ‰∏∫1„ÄÇÂõ†Ê≠§Ëøô‰∏™Êï∞ÂÄºÂ∞±ÊòØËµãÂÄº‰∏∫‚àí1„ÄÇ(ÂéüÂõ†ÊòØÂõ†‰∏∫ÂàùÂßãÂÄº‰∏∫-1ÔºåÁîüÊàêÁöÑÊ±áÁºñ‰ª£Á†Å‰ºöÊõ¥Áü≠)</li>
</ul>
<hr />
<p><code>GCC X64 Non-Optimizing </code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">str_trim:</span>
         push   <span class="token register variable">rbp</span>
         mov    <span class="token register variable">rbp</span>, <span class="token register variable">rsp</span>
         sub    <span class="token register variable">rsp</span>, <span class="token number">32</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">24</span><span class="token operator">]</span>, <span class="token register variable">rdi</span>
<span class="token comment">; for() first part begins here</span>
         mov    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">24</span><span class="token operator">]</span><span class="token comment">;rax=rdi:s</span>
         mov    <span class="token register variable">rdi</span>, <span class="token register variable">rax</span><span class="token comment">;rdi=s</span>
         call   strlen<span class="token comment">;rax:s->len(s)</span>
         mov    QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">rax</span>      <span class="token comment">; str_len</span>
<span class="token comment">; for() first part ends here;[rbp-8]=len</span>
         jmp    .L2
<span class="token comment">; for() body begins here</span>
<span class="token label function">.L5:</span>
         cmp    BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">9</span><span class="token operator">]</span>, <span class="token number">13</span>        <span class="token comment">; c=='\r'?</span>
         je     .L3
         cmp    BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">9</span><span class="token operator">]</span>, <span class="token number">10</span>        <span class="token comment">; c=='\n'?</span>
         jne    .L4
<span class="token label function">.L3:</span><span class="token comment">;Â§ÑÁêÜÊç¢Ë°å</span>
         mov    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>      <span class="token comment">; str_len</span>
         lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">]</span>                <span class="token comment">; EDX=str_len-1</span>
         mov    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">24</span><span class="token operator">]</span>     <span class="token comment">; s</span>
         add    <span class="token register variable">rax</span>, <span class="token register variable">rdx</span>                    <span class="token comment">; RAX=s+str_len-1</span>
         mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">]</span>, <span class="token number">0</span>           <span class="token comment">; s[str_len-1]=0</span>
<span class="token comment">; for() body ends here</span>
<span class="token comment">; for() third part begins here</span>
         sub    QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token number">1</span>        <span class="token comment">; str_len--</span>
<span class="token comment">; for() third part ends here</span>
<span class="token label function">.L2:</span>
<span class="token comment">; for() second part begins here</span>
         cmp    QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token number">0</span>        <span class="token comment">; str_len==0?</span>
         je     .L4                         <span class="token comment">; exit then</span>
<span class="token comment">; check second clause, and load "c"</span>
         mov    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">]</span>      <span class="token comment">; RAX=str_len</span>
         lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">]</span>                <span class="token comment">; RDX=str_len-1</span>
         mov    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">24</span><span class="token operator">]</span>     <span class="token comment">; RAX=s</span>
         add    <span class="token register variable">rax</span>, <span class="token register variable">rdx</span>                    <span class="token comment">; RAX=s+str_len-1</span>
         movzx  <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">]</span>         <span class="token comment">; AL=s[str_len-1]</span>
         mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">9</span><span class="token operator">]</span>, <span class="token register variable">al</span>        <span class="token comment">; store loaded char into "c"</span>
         cmp    BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">9</span><span class="token operator">]</span>, <span class="token number">0</span>         <span class="token comment">; is it zero?</span>
         jne    .L5                         <span class="token comment">; yes? exit then</span>
<span class="token comment">; for() second part ends here</span>
<span class="token label function">.L4:</span>
<span class="token comment">; return "s"</span>
         mov    <span class="token register variable">rax</span>, QWORD PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">24</span><span class="token operator">]</span>
         leave
         ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊâßË°åÂÆåÈïøÂ∫¶ËÆ°ÁÆóÂáΩÊï∞strlen()ÂêéÔºåÊéßÂà∂ÊùÉÂ∞Ü‰º†ÈÄíÁªôÊ†áÂè∑‰∏∫L2ÁöÑËØ≠Âè•„ÄÇÊé•ÁùÄÊ≥®ÊÑèÊ£ÄÊü•‰∏§‰∏™Êù°‰ª∂Ë°®ËææÂºè„ÄÇÂ¶ÇÊûúÁ¨¨‰∏ÄÂà§Êñ≠Êù°‰ª∂Ë°®ËææÂºè‰∏∫ÁúüÔºå‰πüÂ∞±ÊòØËØ¥Â¶ÇÊûúÈïøÂ∫¶‰∏∫0Ôºàstr_lenÁöÑÂÄº‰∏∫0ÔºâÔºåÈÇ£‰πàËÆ°ÁÆóÊú∫Â∞Ü‰∏çÂÜçÊ£ÄÊµãÁ¨¨‰∫å‰∏™Êù°‰ª∂Âà§Êñ≠Ë°®ËææÂºè„ÄÇËøôÁßçÁâπÊÄßÂèàÁß∞‰∏∫‚ÄúÈÄªËæëÁü≠Ë∑Ø‚Äù<br />
Ê¶ÇÊã¨Âú∞ËØ¥ÔºåËøô‰∏™ÂáΩÊï∞ÁöÑÊâßË°åÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ËøêË°åfor()ËØ≠Âè•ÁöÑÁ¨¨‰∏ÄÈÉ®ÂàÜÔºå‰πüÂ∞±ÊòØË∞ÉÁî®strlen()ÂáΩÊï∞ÁöÑÂæ™ÁéØÂàùÂßãÂåñÊåá‰ª§„ÄÇ</li>
<li>Ë∑≥ËΩ¨Âà∞Ê†áÂè∑L2ÔºõÊ£ÄÊµãÂæ™ÁéØÊù°‰ª∂ÊòØÂê¶ÊàêÁ´ã„ÄÇ</li>
<li>Ë∑≥ËΩ¨Âà∞Ê†áÂè∑L5ÔºåËøõÂÖ•Âæ™ÁéØ‰ΩìÔºõ</li>
<li>ÂÜçÊâßË°åfor()ËØ≠Âè•ÔºåÂ¶ÇÊûúÊù°‰ª∂‰∏çÊàêÁ´ãÔºåÂàôÁõ¥Êé•ÈÄÄÂá∫„ÄÇ</li>
<li>ÊâßË°åfor()ËØ≠Âè•ÁöÑÁ¨¨‰∏âÈÉ®ÂàÜÔºåÂ∞ÜÂèòÈáèstr_lenÈÄíÂáè„ÄÇ</li>
<li>ÂÜçÊ¨°Ë∑≥ËΩ¨Âà∞Ê†áÂè∑L2ÔºåÊ£ÄÊµãÂæ™ÁéØÊù°‰ª∂ÊòØÂê¶ÊàêÁ´ã„ÄÅËøõÂÖ•Âæ™ÁéØ‚Ä¶‚Ä¶Âë®ËÄåÂ§çÂßãÔºåÁõ¥Âà∞Âæ™ÁéØÊù°‰ª∂‰∏çÊàêÁ´ã„ÄÇ</li>
<li>Ë∑≥ËΩ¨Âà∞L4Ê†áÂè∑ÔºåÂáÜÂ§áÈÄÄÂá∫„ÄÇ</li>
<li>Âà∂Â§áËøîÂõûÂÄºÔºåÂç≥ÂèòÈáès„ÄÇ</li>
</ul>
<p><code>x64 gcc optimizing</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">str_trim:</span>
         push   <span class="token register variable">rbx</span>
         mov    <span class="token register variable">rbx</span>, <span class="token register variable">rdi</span>
<span class="token comment">; RBX will always be "s"</span>
         call   strlen
<span class="token comment">; check for str_len==0 and exit if its so'</span>
         test   <span class="token register variable">rax</span>, <span class="token register variable">rax</span>
         je     .L9
         lea    <span class="token register variable">rdx</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">]</span>
<span class="token comment">; RDX will always contain str_len-1 value, not str_len</span>
<span class="token comment">; so RDX is more like buffer index variable</span>
         lea    <span class="token register variable">rsi</span>, <span class="token operator">[</span><span class="token register variable">rbx</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">]</span>       <span class="token comment">; RSI=s+str_len-1</span>
         movzx  <span class="token register variable">ecx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">]</span>  <span class="token comment">; load character</span>
         test   <span class="token register variable">cl</span>, <span class="token register variable">cl</span>
         je     .L9                  <span class="token comment">; exit if its zero'</span>
         cmp    <span class="token register variable">cl</span>, <span class="token number">10</span>
         je     .L4
         cmp    <span class="token register variable">cl</span>, <span class="token number">13</span>               <span class="token comment">; exit if its not' '\n' and not '\r'</span>
         jne    .L9
<span class="token label function">.L4:</span>
<span class="token comment">; this is weird instruction. we need RSI=s-1 here.</span>
<span class="token comment">; its possible to get it by' MOV RSI, EBX / DEC RSI</span>
<span class="token comment">; but this is two instructions instead of one</span>
         sub    <span class="token register variable">rsi</span>, <span class="token register variable">rax</span>
<span class="token comment">; RSI = s+str_len-1-str_len = s-1</span>
<span class="token comment">; main loop begin</span>
<span class="token label function">.L12:</span>
         test   <span class="token register variable">rdx</span>, <span class="token register variable">rdx</span>
<span class="token comment">; store zero at address s-1+str_len-1+1 = s-1+str_len = s+str_len-1</span>
         mov    BYTE PTR <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">]</span>, <span class="token number">0</span>
<span class="token comment">; check for str_len-1==0. exit if so.</span>
         je     .L9
         sub    <span class="token register variable">rdx</span>, <span class="token number">1</span>               <span class="token comment">; equivalent to str_len--</span>
<span class="token comment">; load next character at address s+str_len-1</span>
         movzx  <span class="token register variable">ecx</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rbx</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">]</span>
         test   <span class="token register variable">cl</span>, <span class="token register variable">cl</span>               <span class="token comment">; is it zero? exit then</span>
         je     .L9
         cmp    <span class="token register variable">cl</span>, <span class="token number">10</span>               <span class="token comment">; is it '\n'?</span>
         je     .L12
         cmp    <span class="token register variable">cl</span>, <span class="token number">13</span>               <span class="token comment">; is it '\r'?</span>
         je     .L12
<span class="token label function">.L9:</span>
<span class="token comment">; return "s"</span>
         mov    <span class="token register variable">rax</span>, <span class="token register variable">rbx</span>
         pop    <span class="token register variable">rbx</span>
         ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>GCCÁöÑÂÆûÁé∞ÊñπÂºèÊõ¥‰∏∫Â§çÊùÇ„ÄÇÂú®Âæ™ÁéØ‰ΩìÊâßË°åÂâçÁöÑ‰ª£Á†ÅÂè™ÊâßË°å‰∏ÄÊ¨°ÔºåËÄå‰∏îÂÆÉËøò‰ºöÊ£ÄÊü•ÁªìÊùüÁ¨¶ÊòØ‰∏çÊòØÂõûËΩ¶ÂíåÊç¢Ë°åCR/LF„ÄÇËøôÈöæÈÅì‰∏çÊòØÂ§öÊ≠§‰∏Ä‰∏æÂêóÔºü</p>
<p>‰∏ÄËà¨Êù•ËØ¥ÔºåÂÆûÁé∞‰∏ªÂæ™ÁéØ‰ΩìÁöÑÊµÅÁ®ãÊòØËøôÊ†∑ÁöÑÔºö</p>
<p>‚ë† Âæ™ÁéØÂºÄÂßãÔºåÊ£ÄÊü•CR/LFÁªìÊùüÁ¨¶ÔºåËøõË°åÂà§Êñ≠„ÄÇ</p>
<p>‚ë° ‰øùÂ≠òÈõ∂Â≠óÁ¨¶„ÄÇ</p>
<p>‰ΩÜÊòØÔºå<code>GCCÁºñËØëÂô®‰ºöÂ∞ÜËøô‰∏§Ê≠•ÈÄÜÂ∫èÊâßË°å</code>„ÄÇÂõ†Ê≠§ÔºåÁ¨¨‰∏ÄÊ≠•ËÇØÂÆö‰∏ç‰ºöÊòØ‰øùÂ≠òÈõ∂Â≠óÁ¨¶ÔºåËÄåÊòØËøõË°å‰∏ãËø∞Âà§Êñ≠Ôºö</p>
<p>‚ë† ÁúãÁúãÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶ÊòØ‰∏çÊòØCR/LF,Â¶ÇÊûú‰∏çÊòØÁöÑËØùÔºåÂ∞±‰ºöÈÄÄÂá∫„ÄÇ</p>
<p>‚ë° Âæ™ÁéØÂºÄÂßãÔºå‰øùÂ≠òÈõ∂Â≠óÁ¨¶„ÄÇ</p>
<p>‚ë¢ Ê†πÊçÆÊ£ÄÊü•Â≠óÁ¨¶ÊòØ‰∏çÊòØCR/LFÊù•ÂÜ≥ÂÆöÁ®ãÂ∫èÁöÑÊâßË°å„ÄÇ</p>
<p>ËøôÊ†∑Â§ÑÁêÜ‰πãÂêéÔºå‰∏ªÂæ™ÁéØ‰ΩìÂ∞±Â∞è‰∫ÜÂæàÂ§öÔºåÊõ¥ÈÄÇÁî®‰∫éÁõÆÂâçÁöÑCPU‰∫Ü„ÄÇËøôÁßç‰ª£Á†ÅÁöÑ‰∏≠Èó¥ÂèòÈáè‰∏çÊòØstr_lenÔºåËÄåÊòØstr_len-1„ÄÇÊàñËÆ∏ÊòØÂõ†‰∏∫ÂêéËÄÖÊõ¥ÈÄÇÁî®‰∫éÁî®‰ΩúÁºìÂÜ≤Âå∫ÂûãÊï∞ÊçÆÁöÑÁ¥¢ÂºïÊ†áÂè∑ÔºàÊï∞ÁªÑ‰∏ãÊ†áÔºâ„ÄÇÂæàÊòéÊòæÔºåGCCÊ≥®ÊÑèÂà∞‰∫ÜÔºåstr_len-1‰ΩøÁî®‰∫Ü‰∏§Ê¨°„ÄÇÂõ†Ê≠§ÊúÄÂ•ΩÁöÑÂäûÊ≥ïÊòØÂàÜÈÖç‰∏Ä‰∏™ÂèòÈáèÔºåÂÖ∂ÂÄºÊÄªÊòØÊØîÁõÆÂâçÁöÑÂ≠óÁ¨¶‰∏≤ÁöÑÈïøÂ∫¶Â∞è1ÔºåÁÑ∂ÂêéÂÜçÂ∞ÜÂÖ∂ÈÄíÂáèÔºàÊåâÁÖßÂèòÈáèstr_lenÁöÑÈÄíÂáèÊñπÂºèÈÄíÂáèÔºâ„ÄÇ</p>
<h3 id="chap48-toupper"><a class="markdownIt-Anchor" href="#chap48-toupper"></a> Chap48 toupper()</h3>
<p>Êú¨Á´†‰ªãÁªçÂ∞ÜÂ∞èÂÜôÂ≠óÊØçËΩ¨‰∏∫Â§ßÂÜôÂ≠óÊØçÁöÑÂáΩÊï∞</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token function">toupper</span> <span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">>=</span><span class="token char">'a'</span> <span class="token operator">&amp;&amp;</span> c<span class="token operator">&lt;=</span><span class="token char">'z'</span><span class="token punctuation">)</span>
                  <span class="token keyword">return</span> c<span class="token operator">-</span><span class="token char">'a'</span><span class="token operator">+</span><span class="token char">'A'</span><span class="token punctuation">;</span>
         <span class="token keyword">else</span>
                  <span class="token keyword">return</span> c<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>x64 msvs non-optimizing</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"> <span class="token number">1</span>  c<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>
 <span class="token number">2</span>  toupper PROC
 <span class="token number">3</span>          mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">cl</span><span class="token comment">;rsp+8:c</span>
 <span class="token number">4</span>          movsx   <span class="token register variable">eax</span>, BYTE PTR c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span><span class="token comment">;eax:c</span>
 <span class="token number">5</span>          cmp     <span class="token register variable">eax</span>, <span class="token number">97</span><span class="token comment">;c=97?</span>
 <span class="token number">6</span>          jl      SHORT <span class="token operator">$</span>LN2@toupper <span class="token operator">&lt;</span>Âàôexit
 <span class="token number">7</span>          movsx   <span class="token register variable">eax</span>, BYTE PTR c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span><span class="token comment">;Â§ö‰ΩôÁöÑ</span>
 <span class="token number">8</span>          cmp     <span class="token register variable">eax</span>, <span class="token number">122</span><span class="token comment">;c=122?</span>
 <span class="token number">9</span>          jg      SHORT <span class="token operator">$</span>LN2@toupper,<span class="token operator">></span>Âàôexit
<span class="token number">10</span>          movsx   <span class="token register variable">eax</span>, BYTE PTR c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span>
<span class="token number">11</span>          sub     <span class="token register variable">eax</span>, <span class="token number">32</span><span class="token comment">;Â∞Üc-32</span>
<span class="token number">12</span>          jmp     SHORT <span class="token operator">$</span>LN3@toupper
<span class="token number">13</span>          jmp     SHORT <span class="token operator">$</span>LN1@toupper <span class="token comment">; compiler artefact</span>
<span class="token number">14</span>  <span class="token operator">$</span>LN2@toupper:
<span class="token number">15</span>          movzx   <span class="token register variable">eax</span>, BYTE PTR c<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">]</span> <span class="token comment">; unnecessary casting</span>
<span class="token number">16</span>  <span class="token operator">$</span>LN1@toupper:
<span class="token number">17</span>  <span class="token operator">$</span>LN3@toupper: <span class="token comment">; compiler artefact</span>
<span class="token number">18</span>          ret     <span class="token number">0</span>
<span class="token number">19</span>  toupper ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºöÁ®ãÂ∫èÁ¨¨3Ë°åÊääËæìÂÖ•ÁöÑÂ≠óËäÇË£ÖËΩΩÂà∞64‰ΩçÊ†àÁöÑÈÇ£Êù°Êåá‰ª§„ÄÇËæìÂÖ•ÂÄºÊòæÁÑ∂ÊòØÂç†ÊçÆ‰∫Ü64‰ΩçÁöÑ‰Ωé8‰ΩçÔºåËÄåÂÖ∂È´ò‰ΩçÔºà‰ªéÁ¨¨8‰ΩçÂà∞Á¨¨63‰ΩçÔºâÂàô‰øùÊåÅ‰∏çÂèò„ÄÇÊàë‰ª¨ÂèØ‰ª•Âú®Ë∞ÉËØïÂô®debuggerÈáåÁúãÂà∞ËøôÈ´ò56‰ΩçÊòØÈöèÊú∫ÁöÑÂô™Èü≥Êï∞ÊçÆÔºà‰πüÂ∞±ÊòØÈöèÊú∫Êï∞Ôºâ„ÄÇÂõ†‰∏∫ÊâÄÊúâÊåá‰ª§ÈÉΩÊòØ‰ª•Â≠óËäÇ‰∏∫Êìç‰ΩúÂØπË±°ÔºåÂõ†Ê≠§ËøôÁßçÂ≠òÂÇ®ÊñπÊ°à‰∏ç‰ºöÂºïÂèëÈóÆÈ¢ò„ÄÇÁ¨¨15Ë°åÁöÑÊúÄÂêé‰∏Ä‰∏™MOVZXÊåá‰ª§‰ªéÊú¨Âú∞Ê†àÈáåÂèñÂá∫‰∏Ä‰∏™Â≠óËäÇÔºåÊääÂÆÉÊó†Á¨¶Âè∑Êâ©Â±ï‰∏∫32‰ΩçÊï∞ÊçÆ‰∏≠ÔºåÂõ†Ê≠§ËøôÈ´ò56‰ΩçÁöÑÂô™Èü≥Êï∞ÊçÆÈÉΩ‰ºöË¢´Â°´ÂÖÖ‰∏∫Èõ∂</p>
<p><code>non optimizing gcc</code>Ë≤å‰ººÊõ¥Â•ΩÔºåÊ≤°Êúâ‰∫ÜÂ§ö‰ΩôÁöÑÊåá‰ª§</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">toupper:</span>
         push    <span class="token register variable">rbp</span>
         mov     <span class="token register variable">rbp</span>, <span class="token register variable">rsp</span>
         mov     <span class="token register variable">eax</span>, <span class="token register variable">edi</span>
         mov     BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">al</span>
         cmp     BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">96</span>
         jle     .L2
         cmp     BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">122</span>
         jg      .L2
         movzx   <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
         sub     <span class="token register variable">eax</span>, <span class="token number">32</span>
         jmp     .L3
<span class="token label function">.L2:</span>
         movzx   <span class="token register variable">eax</span>, BYTE PTR <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token label function">.L3:</span>
         pop     <span class="token register variable">rbp</span>
         ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>optimizing msvs</code></p>
<p>ËøôÈáå‰ºòÂåñÂ∞Ü‰∏§‰∏™ÊØîËæÉÂàÜÈÖç‰∏∫‰∏Ä‰∏™ÊØîËæÉ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">toupper PROC
        lea     <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">-</span><span class="token number">97</span><span class="token operator">]</span>
        cmp     <span class="token register variable">al</span>, <span class="token number">25</span>
        ja      SHORT <span class="token operator">$</span>LN2@toupper
        movsx   <span class="token register variable">eax</span>, <span class="token register variable">cl</span>
        sub     <span class="token register variable">eax</span>, <span class="token number">32</span>
        ret     <span class="token number">0</span>
<span class="token label function">$LN2@toupper:</span>
        movzx   <span class="token register variable">eax</span>, <span class="token register variable">cl</span>
        ret     <span class="token number">0</span>
toupper ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>optimizing gcc</code></p>
<p>‰∏çÁî®Ë∑≥ËΩ¨Êåá‰ª§<code>JUMP</code>ËÄåÊòØÈááÁî®‰∫Ü<code>CMOVcc</code>Êåá‰ª§</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">1</span>  toupper:
<span class="token number">2</span>          lea      <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">-</span><span class="token number">97</span><span class="token operator">]</span> <span class="token comment">; 0x61</span>
<span class="token number">3</span>          lea      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">-</span><span class="token number">32</span><span class="token operator">]</span> <span class="token comment">; 0x20</span>
<span class="token number">4</span>          cmp      <span class="token register variable">dl</span>, <span class="token number">25</span>
<span class="token number">5</span>          cmova    <span class="token register variable">eax</span>, <span class="token register variable">edi</span>
<span class="token number">6</span>          ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><strong>Êåá‰ª§Ê†ºÂºè</strong>Ôºö<code>cmova src, dst</code></p>
<p><strong>ÂäüËÉΩ</strong>ÔºöÂ¶ÇÊûúÂΩìÂâçÁöÑËøêÁÆóÁªìÊûúË°®ÊòéÊó†Á¨¶Âè∑Êï∞ÁöÑÊØîËæÉ‰∏≠ÔºåÊ∫êÊìç‰ΩúÊï∞Ôºà<code>src</code>ÔºâÂ§ß‰∫éÊàñÁ≠â‰∫éÁõÆÊ†áÊìç‰ΩúÊï∞Ôºà‰Ωç‰∫é<code>dst</code>ÔºâÔºåÈÇ£‰πàËøôÊù°Êåá‰ª§‰ºöÂ∞Ü<code>src</code>ÁöÑÂÜÖÂÆπÊó†Êù°‰ª∂Âú∞ÁßªÂä®Âà∞<code>dst</code>‰∏≠„ÄÇËøôÈáåÁöÑ‚ÄúÂ§ß‰∫éÊàñÁ≠â‰∫é‚ÄùÊù°‰ª∂ÊòØÂü∫‰∫éEFLAGSÂØÑÂ≠òÂô®‰∏≠ÁöÑÈõ∂Ê†áÂøóÔºàZFÔºâÂíåÁ¨¶Âè∑Ê†áÂøóÔºàSFÔºâ‰ª•ÂèäÊ∫¢Âá∫Ê†áÂøóÔºàOFÔºâÁöÑÁä∂ÊÄÅÊù•ÂÜ≥ÂÆöÁöÑÔºåÁ°Æ‰øù‰∫ÜÊòØÈíàÂØπÊó†Á¨¶Âè∑Êï¥Êï∞ÁöÑÊØîËæÉ„ÄÇ</p>
</li>
<li>
<p>‰πüÂ∞±ÊòØÂ¶ÇÊûú<code>dl</code>ÁöÑÂÄºÂ§ß‰∫é25ÔºåÂç≥‰∏∫Ë¥üÊï∞ÁöÑÊÉÖÂÜµÔºåËøîÂõûÂéüÂÄº</p>
</li>
<li>
<p>Âê¶ÂàôËΩ¨‰∏∫Â§ßÂÜô</p>
</li>
</ul>
<h3 id="chap49-‰∏çÊ≠£Á°ÆÁöÑÂèçÊ±áÁºñ‰ª£Á†Å"><a class="markdownIt-Anchor" href="#chap49-‰∏çÊ≠£Á°ÆÁöÑÂèçÊ±áÁºñ‰ª£Á†Å"></a> Chap49 ‰∏çÊ≠£Á°ÆÁöÑÂèçÊ±áÁºñ‰ª£Á†Å</h3>
<h4 id="x86ÁéØÂ¢É‰∏ãÁöÑ‰ªé‰∏ÄÂºÄÂßãÂ∞±ÈîôËØØÁöÑÂèçÊ±áÁºñ"><a class="markdownIt-Anchor" href="#x86ÁéØÂ¢É‰∏ãÁöÑ‰ªé‰∏ÄÂºÄÂßãÂ∞±ÈîôËØØÁöÑÂèçÊ±áÁºñ"></a> x86ÁéØÂ¢É‰∏ãÁöÑ‰ªé‰∏ÄÂºÄÂßãÂ∞±ÈîôËØØÁöÑÂèçÊ±áÁºñ</h4>
<p>Âõ†‰∏∫‰∏é<code>opcode</code>Á≠âÈïøÁöÑÊúâ<code>ARM</code>‰ª•Âèä<code>MIPS</code>Êåá‰ª§ÈõÜ(ÊØè‰∏™Êåá‰ª§ÁöÑ<code>opcode</code>Ë¶Å‰πàÊòØ2Â≠óËäÇË¶Å‰πàÊòØ4Â≠óËäÇ)ÔºåËÄå<code>x86</code>Êû∂ÊûÑ‰∏ãÁöÑ<code>opcode</code>ÈïøÂ∫¶‰∏çÂêåÔºåÂ¶ÇÊûú<code>x86</code>Á®ãÂ∫è‰ªé‰∏≠Èó¥Â∞±ÂºÄÂßãËß£ÊûêÊåá‰ª§ÔºåÊó†ËÆ∫‰ªÄ‰πàÂ∑•ÂÖ∑ÈÉΩ‰ºöÂàÜÊûêÂá∫ÈîôËØØÁöÑÁªìÊûú</p>
<p>‰æãÂ¶Ç</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">add      <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">31F7Bh</span><span class="token operator">]</span>, <span class="token register variable">cl</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">-</span><span class="token number">3277Bh</span><span class="token operator">]</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">2CF7Bh</span><span class="token operator">]</span>
inc      dword ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">-</span><span class="token number">7A76F33Ch</span><span class="token operator">]</span>
fdiv     st(<span class="token number">4</span>), st
db <span class="token number">0FFh</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">-</span><span class="token number">21F7Bh</span><span class="token operator">]</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">-</span><span class="token number">22373h</span><span class="token operator">]</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">-</span><span class="token number">2276Bh</span><span class="token operator">]</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">-</span><span class="token number">22B63h</span><span class="token operator">]</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">-</span><span class="token number">22F4Bh</span><span class="token operator">]</span>
dec      dword ptr <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">-</span><span class="token number">23343h</span><span class="token operator">]</span>
jmp      dword ptr <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">-</span><span class="token number">74h</span><span class="token operator">]</span>
xchg     <span class="token register variable">eax</span>, <span class="token register variable">ebp</span>
clc
std
db <span class="token number">0FFh</span>
db <span class="token number">0FFh</span><span class="token comment">;Âú®Ê≠§‰πãÂâçÁöÑÂèçÊ±áÁºñÁªìÊûúÈÉΩÊòØÈîôËØØÁöÑ</span>
mov      word ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">214h</span><span class="token operator">]</span>, <span class="token register variable">cs</span> <span class="token comment">; &lt;- disassembler finally found right track here</span>
mov      word ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">238h</span><span class="token operator">]</span>, <span class="token register variable">ds</span>
mov      word ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">23Ch</span><span class="token operator">]</span>, <span class="token register variable">es</span>
mov      word ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">240h</span><span class="token operator">]</span>, <span class="token register variable">fs</span>
mov      word ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">244h</span><span class="token operator">]</span>, <span class="token register variable">gs</span>
pushf
pop      dword ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">210h</span><span class="token operator">]</span>
mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
mov      <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">218h</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
lea      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
mov      <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">20Ch</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
mov      dword ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">2D0h</span><span class="token operator">]</span>, <span class="token number">10001h</span>
mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
mov      <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">21Ch</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">0Ch</span><span class="token operator">]</span>
mov      <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">320h</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">10h</span><span class="token operator">]</span>
mov      <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">31Ch</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
mov      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
mov      <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">314h</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
call     <span class="token register variable">ds</span>:IsDebuggerPresent
mov      <span class="token register variable">edi</span>, <span class="token register variable">eax</span>
lea      <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">328h</span><span class="token operator">]</span>
push     <span class="token register variable">eax</span>
call     sub_407663
pop      <span class="token register variable">ecx</span>
test     <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
jnz      short loc_402D7B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><mark>Êàë‰ª¨ËØ•Â¶ÇÊûúÂàÜËæ®Âá∫Âì™‰∫õÊòØ‰∏çÊ≠£Á°ÆÁöÑÂèçÊ±áÁºñ‰ª£Á†ÅÂë¢?</mark></p>
<ul>
<li>‰∏çÂØªÂ∏∏ÁöÑÊåá‰ª§ÈõÜÂêàÔºåx86Â∏∏ËßÅÁöÑÊåá‰ª§ÊòØ<code>PUSH,MOV,CALL</code>ÔºåÂ¶ÇÊûúÈÅáÂà∞‰∫ÜÂ§ßÊùÇÁÉ©ÁöÑÁ®ÄÊúâÊåá‰ª§ÊãºÁõòÂπ∂‰∏î‰∏çÁü•ÊâÄ‰∫ëÁöÑÂ∞±ËÇØÂÆöÊòØÈîôÁöÑ(FPUÊåá‰ª§ÔºåËæìÂÖ•ËæìÂá∫IN/OUTÁ≠âÁ≠â)</li>
<li>ÂèàÂ§ßÂèàÂÉèÊòØÈöèÊú∫Êï∞ÁöÑÊï∞ÂÄº„ÄÅÂÅèÁßªÈáè‰ª•ÂèäÁ´ãÂç≥Êï∞„ÄÇ</li>
<li>ËΩ¨ÁßªÊåá‰ª§ÁöÑÂÅèÁßªÈáè‰∏çÂêàÈÄªËæëÔºåÁªèÂ∏∏Ë∑≥ËΩ¨Âà∞ÂÖ∂‰ªñÊåá‰ª§ÂùóÁöÑ‰∏≠Èó¥„ÄÇ</li>
</ul>
<p>‰∏Ä‰∫õ‰æãÂ≠ê</p>
<p><code>x86</code>ÁöÑÈöèÊú∫Êï∞Âô™Â£∞</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">  	 mov    <span class="token register variable">bl</span>, <span class="token number">0Ch</span>
     mov    <span class="token register variable">ecx</span>, <span class="token number">0D38558Dh</span>
     mov    <span class="token register variable">eax</span>, <span class="token register variable">ds</span>:<span class="token number">2C869A86h</span>
     db     <span class="token number">67h</span>
     mov    <span class="token register variable">dl</span>, <span class="token number">0CCh</span>
     insb
     movsb
     push   <span class="token register variable">eax</span>
     xor    <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">-</span><span class="token number">53h</span><span class="token operator">]</span>, <span class="token register variable">ah</span>
     fcom   qword ptr <span class="token operator">[</span><span class="token register variable">edi</span><span class="token operator">-</span><span class="token number">45A0EF72h</span><span class="token operator">]</span>
     pop    <span class="token register variable">esp</span>
     pop    <span class="token register variable">ss</span>
     in     <span class="token register variable">eax</span>, <span class="token register variable">dx</span>
     dec    <span class="token register variable">ebx</span>
     push   <span class="token register variable">esp</span>
     lds    <span class="token register variable">esp</span>, <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">-</span><span class="token number">41h</span><span class="token operator">]</span>
     retf
     rcl    dword ptr <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">cl</span>
     mov    <span class="token register variable">cl</span>, <span class="token number">9Ch</span>
     mov    <span class="token register variable">ch</span>, <span class="token number">0DFh</span>
     push   <span class="token register variable">cs</span>
     insb
     mov    <span class="token register variable">esi</span>, <span class="token number">0D9C65E4Dh</span>
     imul   <span class="token register variable">ebp</span>, <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>, <span class="token number">66h</span>
     pushf
     sal    dword ptr <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">64h</span><span class="token operator">]</span>, <span class="token register variable">cl</span>
     sub    <span class="token register variable">eax</span>, <span class="token number">0AC433D64h</span>
     out    <span class="token number">8Ch</span>, <span class="token register variable">eax</span>
     pop    <span class="token register variable">ss</span>
     sbb    <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>
     aas
     xchg   <span class="token register variable">cl</span>, <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token register variable">ebx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">14B31Eh</span><span class="token operator">]</span>
     jecxz  short near ptr loc_58<span class="token operator">+</span><span class="token number">1</span>
     xor    <span class="token register variable">al</span>, <span class="token number">0C6h</span>
     inc    <span class="token register variable">edx</span>
     db     <span class="token number">36h</span>
     pusha
     stosb
     test   <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">]</span>, <span class="token register variable">ebx</span>
     sub    <span class="token register variable">al</span>, <span class="token number">0D3h</span> <span class="token comment">; 'L'</span>
     pop    <span class="token register variable">eax</span>
     stosb

<span class="token label function">loc_58:</span> <span class="token comment">; CODE XREF: seg000:0000004A</span>
     test   <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     inc    <span class="token register variable">ebp</span>
     das
     db     <span class="token number">64h</span>
     pop    <span class="token register variable">ecx</span>
     das
     hlt

     pop    <span class="token register variable">edx</span>
     out    <span class="token number">0B0h</span>, <span class="token register variable">al</span>
     lodsb
     push   <span class="token register variable">ebx</span>
     cdq
     out    <span class="token register variable">dx</span>, <span class="token register variable">al</span>
     sub    <span class="token register variable">al</span>, <span class="token number">0Ah</span>
     sti
     outsd
     add    dword ptr <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">]</span>, <span class="token number">96FCBE4Bh</span>
     and    <span class="token register variable">eax</span>, <span class="token number">0E537EE4Fh</span>
     inc    <span class="token register variable">esp</span>
     stosd
     cdq
     push   <span class="token register variable">ecx</span>
     in     <span class="token register variable">al</span>, <span class="token number">0CBh</span>
     mov    <span class="token register variable">ds</span>:<span class="token number">0D114C45Ch</span>, <span class="token register variable">al</span>
     mov    <span class="token register variable">esi</span>, <span class="token number">659D1985h</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>x86-64</code>ÁöÑÈöèÊú∫Êï∞Âô™Â£∞</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">     lea    <span class="token register variable">esi</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">43558D29h</span><span class="token operator">]</span>

<span class="token label function">loc_AF3:</span> <span class="token comment">; CODE XREF: seg000:0000000000000B46</span>
     rcl    byte ptr <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">+</span><span class="token register variable">rax</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">29BB423Ah</span><span class="token operator">]</span>, <span class="token number">1</span>
     lea    <span class="token register variable">ecx</span>, <span class="token register variable">cs</span>:<span class="token number">0FFFFFFFFB2A6780Fh</span>
     mov    <span class="token register variable">al</span>, <span class="token number">96h</span>
     mov    <span class="token register variable">ah</span>, <span class="token number">0CEh</span>
     push   <span class="token register variable">rsp</span>
     lods   byte ptr <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">]</span>

     db <span class="token number">2Fh</span> <span class="token comment">; /</span>

     pop    <span class="token register variable">rsp</span>
     db     <span class="token number">64h</span>
     retf   <span class="token number">0E993h</span>

     cmp    <span class="token register variable">ah</span>, <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token number">4Ah</span><span class="token operator">]</span>
     movzx  <span class="token register variable">rsi</span>, dword ptr <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">-</span><span class="token number">25h</span><span class="token operator">]</span>
     push   <span class="token number">4Ah</span>
     movzx  <span class="token register variable">rdi</span>, dword ptr <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token register variable">rdx</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">]</span>

     db <span class="token number">9Ah</span>

     rcr    byte ptr <span class="token operator">[</span><span class="token register variable">rax</span><span class="token operator">+</span><span class="token number">1Dh</span><span class="token operator">]</span>, <span class="token register variable">cl</span>
     lodsd
     xor    <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">+</span><span class="token number">6CF20173h</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     xor    <span class="token operator">[</span><span class="token register variable">rbp</span><span class="token operator">+</span><span class="token number">66F8B593h</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     push   <span class="token register variable">rbx</span>
     sbb    <span class="token register variable">ch</span>, <span class="token operator">[</span><span class="token register variable">rbx</span><span class="token operator">-</span><span class="token number">0Fh</span><span class="token operator">]</span>
     stosd
     int    <span class="token number">87h</span>
     db     <span class="token number">46h</span>, <span class="token number">4Ch</span>
     out    <span class="token number">33h</span>, <span class="token register variable">rax</span>
     xchg   <span class="token register variable">eax</span>, <span class="token register variable">ebp</span>
     test   <span class="token register variable">ecx</span>, <span class="token register variable">ebp</span>
     movsd
     leave
     push   <span class="token register variable">rsp</span>

     db <span class="token number">16h</span>

     xchg   <span class="token register variable">eax</span>, <span class="token register variable">esi</span>
     pop    <span class="token register variable">rdi</span>

<span class="token label function">loc_B3D:</span> <span class="token comment">; CODE XREF: seg000:0000000000000B5F</span>
     mov    <span class="token register variable">ds</span>:<span class="token number">93CA685DF98A90F9h</span>, <span class="token register variable">eax</span>
     jnz    short near ptr loc_AF3<span class="token operator">+</span><span class="token number">6</span>
     out    <span class="token register variable">dx</span>, <span class="token register variable">eax</span>
     cwde
     mov    <span class="token register variable">bh</span>, <span class="token number">5Dh</span> <span class="token comment">; ']'</span>
     movsb
     pop    <span class="token register variable">rbp</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="chap50-Ê∑∑Ê∑ÜÊäÄÊúØ"><a class="markdownIt-Anchor" href="#chap50-Ê∑∑Ê∑ÜÊäÄÊúØ"></a> Chap50 Ê∑∑Ê∑ÜÊäÄÊúØ</h3>
<p><em>‰ª£Á†ÅÊ∑∑Ê∑ÜÊäÄÊúØÊòØ‰∏ÄÁßçÁî®‰∫éÈòªÁ¢çÈÄÜÂêëÂ∑•Á®ãÂàÜÊûê‰∫∫ÂëòËß£ÊûêÁ®ãÂ∫è‰ª£Á†ÅÔºàÊàñÂäüËÉΩÔºâÁöÑÊåá‰ª§Â§ÑÁêÜÊäÄÊúØ„ÄÇ</em></p>
<h4 id="Â≠óÁ¨¶‰∏≤ÂèòÊç¢"><a class="markdownIt-Anchor" href="#Â≠óÁ¨¶‰∏≤ÂèòÊç¢"></a> Â≠óÁ¨¶‰∏≤ÂèòÊç¢</h4>
<p><em>Âú®ÈÄÜÂêëÂ∑•Á®ãÁöÑËøáÁ®ã‰∏≠Â≠óÁ¨¶‰∏≤ÁªèÂ∏∏Ëµ∑Âà∞Ë∑ØÊ†áÁöÑ‰ΩúÁî®„ÄÇÊ≥®ÊÑèÂà∞Ëøô‰∏™ÈóÆÈ¢òÁöÑÁºñÁ®ã‰∫∫ÂëòÂ∞±‰ºöÁùÄÊâãËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò„ÄÇ‰ªñ‰ª¨‰ºöÈááÁî®‰∏Ä‰∫õÂèòÊç¢ÁöÑÊâãÊ≥ïÔºåËÆ©‰ªñ‰∫∫‰∏çËÉΩÁõ¥Êé•ÈÄöËøáIDAÊàñËÄÖ16ËøõÂà∂ÁºñËæëÂô®Áõ¥Êé•ÊêúÁ¥¢Âà∞Â≠óÁ¨¶‰∏≤ÂéüÊñá„ÄÇ</em></p>
<ul>
<li>
<p>ÂèØ‰ª•ÊûÑÈÄ†‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">Mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">]</span>, <span class="token string">'h'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>, <span class="token string">'e'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span>, <span class="token string">'l'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">]</span>, <span class="token string">'l'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token string">'o'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">]</span>, <span class="token string">' '</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span>, <span class="token string">'w'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">7</span><span class="token operator">]</span>, <span class="token string">'o'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token string">'r'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">9</span><span class="token operator">]</span>, <span class="token string">'l'</span>
mov     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">]</span>, <span class="token string">'d'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êõ¥Â§çÊùÇÁöÑÊûÑÈÄ†ÊñπÊ≥ï</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">mov     <span class="token register variable">ebx</span>, offset username
cmp     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">]</span>, <span class="token string">'j'</span>
jnz     fail
cmp     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">]</span>, <span class="token string">'o'</span>
jnz     fail
cmp     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">]</span>, <span class="token string">'h'</span>
jnz     fail
cmp     byte ptr <span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">]</span>, <span class="token string">'n'</span>
jnz     fail
jz      it_is_john<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Êàë‰ª¨Áî®ÂçÅÂÖ≠ËøõÂà∂ÁöÑÊñáÊú¨ÁºñËØëÂô®ÈÉΩ‰∏çËÉΩÁõ¥Êé•ÊêúÁ¥¢Âà∞Â≠óÁ¨¶‰∏≤ÂéüÊñá„ÄÇ</p>
<p>ÂÆûÈôÖ‰∏äËøô‰∏§ÁßçÊñπÊ≥ïÈÄÇÁî®‰∫éÈÇ£‰∫õÊó†Ê≥ïÂà©Áî®Êï∞ÊçÆÊÆµÊûÑÈÄ†Êï∞ÊçÆÁöÑÊÉÖÊôØ„ÄÇÂõ†‰∏∫ÂÆÉ‰ª¨ÂèØ‰ª•Âú®ÊñáÊú¨ÊÆµÁõ¥Êé•ÊûÑÈÄ†Êï∞ÊçÆÔºåÊâÄ‰ª•‰πüÂ∏∏ËßÅ‰∫éÂêÑÁßçPICÂíåshellcode„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"%s%c%s%c%s"</span><span class="token punctuation">,</span> <span class="token string">"hel"</span><span class="token punctuation">,</span><span class="token char">'l'</span><span class="token punctuation">,</span><span class="token string">"o w"</span><span class="token punctuation">,</span><span class="token char">'o'</span><span class="token punctuation">,</span><span class="token string">"rld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><mark>Âä†ÂØÜÂ≠òÂÇ®Â≠óÁ¨¶‰∏≤ÊòØÂè¶‰∏ÄÁßçÂ∏∏ËßÅÁöÑÂ§ÑÁêÜÊñπÊ≥ï„ÄÇÂè™ÊòØËøôÊ†∑‰∏ÄÊù•ÔºåÂ∞±Ë¶ÅÂú®ÊØèÊ¨°‰ΩøÁî®ÂâçÂØπÂ≠óÁ¨¶‰∏≤Ëß£ÂØÜ„ÄÇËøô‰∏™ÂÖ∂ÂÆûÊòØ‰∏ªÊµÅÁöÑÂ§ÑÁêÜÊñπÊ≥ï</mark></p>
</li>
</ul>
<h4 id="ÂèØÊâßË°å‰ª£Á†Å"><a class="markdownIt-Anchor" href="#ÂèØÊâßË°å‰ª£Á†Å"></a> ÂèØÊâßË°å‰ª£Á†Å</h4>
<h5 id="ÊèíÂÖ•ÂûÉÂúæ‰ª£Á†Å"><a class="markdownIt-Anchor" href="#ÊèíÂÖ•ÂûÉÂúæ‰ª£Á†Å"></a> ÊèíÂÖ•ÂûÉÂúæ‰ª£Á†Å</h5>
<p>Âú®Ê≠£Â∏∏ÊâßË°åÊåá‰ª§Â∫èÂàó‰∏≠ÊèíÂÖ•‰∏Ä‰∫õËôΩÁÑ∂ÂèØË¢´ÊâßË°å‰ΩÜÊòØÊ≤°Êúâ‰ªª‰Ωï‰ΩúÁî®ÁöÑÊåá‰ª§ÔºåÊú¨Ë∫´Â∞±ÊòØ‰∏ÄÁßç‰ª£Á†ÅÊ∑∑Ê∑ÜÊäÄÊúØ„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">add     <span class="token register variable">eax</span>, <span class="token register variable">ebx</span>
mul     <span class="token register variable">ecx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ÈááÁî®Ê∑∑Ê∑ÜÊäÄÊúØÂêéÁöÑ‰ª£Á†Å</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">xor     <span class="token register variable">esi</span>, <span class="token number">011223344h</span> <span class="token comment">; garbage/?</span>
add     <span class="token register variable">esi</span>, <span class="token register variable">eax</span>        <span class="token comment">; garbage/?</span>
add     <span class="token register variable">eax</span>, <span class="token register variable">ebx</span>
mov     <span class="token register variable">edx</span>, <span class="token register variable">eax</span>        <span class="token comment">; garbage</span>
shl     <span class="token register variable">edx</span>, <span class="token number">4</span>          <span class="token comment">; garbage</span>
mul     <span class="token register variable">ecx</span>
xor     <span class="token register variable">esi</span>, <span class="token register variable">ecx</span>        <span class="token comment">; garbage</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®Á®ãÂ∫è‰ª£Á†Å‰∏≠ÊèíÂÖ•ÁöÑÊ∑∑Ê∑ÜÊåá‰ª§ÔºåË∞ÉÁî®‰∫ÜÊ∫êÁ®ãÂ∫è‰∏ç‰ºö‰ΩøÁî®ÁöÑESIÂíåEDXÂØÑÂ≠òÂô®„ÄÇÊ∑∑Ê∑Ü‰ª£Á†ÅÂà©Áî®‰∫ÜÊ∫êÁ®ãÂ∫èÁöÑ‰∏≠Èó¥‰πãÂêéÔºåÂ§ßÂπÖÂ∫¶Âú∞Â¢ûÂä†‰∫ÜÂèçÁºñËØëÁöÑÈöæÂ∫¶Ôºå‰Ωï‰πê‰∏ç‰∏∫Âë¢Ôºü(‰ºöÂØºËá¥Á®ãÂ∫èËøêË°åÊïàÁéá‰∏ãÈôçÔºå‰πüÊòØÊúâ‰ª£‰ª∑ÁöÑ )</p>
<h5 id="Áî®Â§ö‰∏™Êåá‰ª§ÁªÑÂêà‰ª£ÊõøÂéüÊù•ÁöÑ‰∏Ä‰∏™Êåá‰ª§"><a class="markdownIt-Anchor" href="#Áî®Â§ö‰∏™Êåá‰ª§ÁªÑÂêà‰ª£ÊõøÂéüÊù•ÁöÑ‰∏Ä‰∏™Êåá‰ª§"></a> Áî®Â§ö‰∏™Êåá‰ª§ÁªÑÂêà‰ª£ÊõøÂéüÊù•ÁöÑ‰∏Ä‰∏™Êåá‰ª§</h5>
<ul>
<li>
<p><code>MOV op1,op2</code>Ëøô‰∏™Êåá‰ª§ÔºåÂèØ‰ª•‰ΩøÁî®ÁªÑÂêàÊåá‰ª§‰ª£Êõø<code>PUSH op2,POP op1</code></p>
</li>
<li>
<p><code>JMP label</code>Êåá‰ª§ÂèØ‰ª•Áî®<code>PUSH LABEL,RET</code>‰ª£Êõø</p>
</li>
<li>
<p><code>CALL label</code>ÂèØ‰ª•Áî®‰∏â‰∏™Êåá‰ª§‰ª£Êõø:<code>PUSH (call Êåá‰ª§ÂêéÈù¢ÁöÑÈÇ£‰∏™label),PUSH labelÂíåRETÊåá‰ª§</code></p>
</li>
<li>
<p><code>PUSH op</code>ÂèØ‰ª•Áî®‰∏Ä‰∏ãÁöÑÊåá‰ª§‰ª£Êõø„ÄÇ<code>SUB ESP,4Êàñ8;MOV [ESP],Êìç‰ΩúÁ¨¶</code></p>
</li>
</ul>
<h5 id="ÂßãÁªàÊâßË°åÊàñ‰ªéÊù•‰∏ç‰ºöÊâßË°åÁöÑ‰ª£Á†Å"><a class="markdownIt-Anchor" href="#ÂßãÁªàÊâßË°åÊàñ‰ªéÊù•‰∏ç‰ºöÊâßË°åÁöÑ‰ª£Á†Å"></a> ÂßãÁªàÊâßË°åÊàñ‰ªéÊù•‰∏ç‰ºöÊâßË°åÁöÑ‰ª£Á†Å</h5>
<p>Âú®‰∏ãÈù¢ÁöÑ‰ª£Á†Å‰∏≠ÔºåÂÅáÂÆöÊ≠§Â§ÑESIÁöÑÂÄºËÇØÂÆöÊòØ0ÔºåÈÇ£‰πàÊàë‰ª¨ÂèØ‰ª•Âú®fake luggageÂ§ÑÊèíÂÖ•‰ªªÊÑèÈïøÂ∫¶ÂíåÂ§çÊùÇÂ∫¶ÁöÑÊåá‰ª§Ôºå‰ª•ËææÂà∞Ê∑∑Ê∑ÜÁöÑÁõÆÁöÑ„ÄÇËøôÁßçÊ∑∑Ê∑ÜÊäÄÊúØÁß∞‰∏∫‰∏çÈÄèÊòéË∞ìËØçÔºàopaque predicateÔºâ„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">mov     <span class="token register variable">esi</span>, <span class="token number">1</span>
...     <span class="token comment">; some code not touching ESI</span>
dec     <span class="token register variable">esi</span>
...     <span class="token comment">; some code not touching ESI</span>
cmp     <span class="token register variable">esi</span>, <span class="token number">0</span>
jz      real_code
<span class="token comment">; fake luggage</span>
<span class="token label function">real_code:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Êàë‰ª¨ËøòÂèØ‰ª•ÁúãÁúãÂÖ∂‰ªñÁöÑ‰æãÂ≠ê,(Êàë‰ª¨ÂÅáÂÆöESIÂßãÁªà‰ºöÊòØ0)</li>
</ul>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">dd     <span class="token register variable">eax</span>, <span class="token register variable">ebx</span>     <span class="token comment">; real code</span>
mul     <span class="token register variable">ecx</span>          <span class="token comment">; real code</span>
add     <span class="token register variable">eax</span>, <span class="token register variable">esi</span>     <span class="token comment">; opaque predicate. XOR, AND or SHL, etc, can be here instead of ADD.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h5 id="Êâì‰π±Êåá‰ª§Â∫èÂàó"><a class="markdownIt-Anchor" href="#Êâì‰π±Êåá‰ª§Â∫èÂàó"></a> Êâì‰π±Êåá‰ª§Â∫èÂàó</h5>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">instruction <span class="token number">1</span>
instruction <span class="token number">2</span>
instruction <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>‰∏äËø∞‰∏âË°åÊ≠£Â∏∏ÊâßË°åÁöÑÊåá‰ª§Â∫èÂàóÂèØ‰ª•Áî®Â¶Ç‰∏ãÊâÄÁ§∫ÁöÑÂ§çÊùÇÁªìÊûÑ‰ª£Êõø:</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">begin:</span>          jmp      ins1_label

<span class="token label function">ins2_label:</span>     instruction <span class="token number">2</span>
                jmp      ins3_label

<span class="token label function">ins3_label:</span>     instruction <span class="token number">3</span>
                jmp      exit:

<span class="token label function">ins1_label:</span>     instruction <span class="token number">1</span>
                jmp      ins2_label
<span class="token label function">exit:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="‰ΩøÁî®Èó¥Êé•ÊåáÈíà"><a class="markdownIt-Anchor" href="#‰ΩøÁî®Èó¥Êé•ÊåáÈíà"></a> ‰ΩøÁî®Èó¥Êé•ÊåáÈíà</h5>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">dummy_data1     db       <span class="token number">100h</span> dup (<span class="token number">0</span>)
message1        db       <span class="token string">'hello world'</span>,<span class="token number">0</span>

dummy_data2     db       <span class="token number">200h</span> dup (<span class="token number">0</span>)
message2        db       <span class="token string">'another message'</span>,<span class="token number">0</span>

func            proc
                ...
                mov      <span class="token register variable">eax</span>, offset dummy_data1 <span class="token comment">; PE or ELF reloc here</span>
                add      <span class="token register variable">eax</span>, <span class="token number">100h</span>
                push     <span class="token register variable">eax</span>
                call     dump_string
                ...
                mov      <span class="token register variable">eax</span>, offset dummy_data2 <span class="token comment">; PE or ELF reloc here</span>
                add      <span class="token register variable">eax</span>, <span class="token number">200h</span>
                push     <span class="token register variable">eax</span>
                call     dump_string
                ...
func            endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÊ†∑Êàë‰ª¨Âè™ËÉΩÂú®<code>IDA</code>ÁºñËØëÂ∑•ÂÖ∑‰∏≠ÁúãÂà∞<code>dummy_data1</code>Âíå<code>dummy_data2</code>ÁöÑ<code>reference(Ë∞ÉÁî®‰ø°ÊÅØ)</code>„ÄÇÂÆÉ‰∏çËÉΩÊ≠£Â∏∏ÊòæÁ§∫Ë∞ÉÁî®ÁöÑÁúüÂÆûÂ≠óÁ¨¶‰∏≤</p>
<p>ÂÖ®Â±ÄÂèòÈáèÊàñËÄÖÂáΩÊï∞‰πüÂèØ‰ª•ËøôÊ†∑Ê∑∑Ê∑Ü„ÄÇ</p>
<h4 id="ËôöÊãüÊú∫‰ª•Âèä‰º™‰ª£Á†Å"><a class="markdownIt-Anchor" href="#ËôöÊãüÊú∫‰ª•Âèä‰º™‰ª£Á†Å"></a> ËôöÊãüÊú∫‰ª•Âèä‰º™‰ª£Á†Å</h4>
<p>ÁºñÁ®ã‰∫∫ÂëòÂèØ‰ª•ÊûÑÂª∫ÂÖ∂Ëá™Ë∫´ÁöÑPLÊàñËÄÖISAËß£ÈáäÂô®ÔºàÁ±ª‰ººVB.NETÊàñËÄÖJavaÔºâ„ÄÇËøôÊ†∑ÁöÑËØùÔºåÂèçÁºñËØëËÄÖÂ∞±ÂæóËä±ÂæàÂ§öÊó∂Èó¥Êù•ÁêÜËß£Ëøô‰∫õËß£ÈáäÂô®Êåá‰ª§ÁöÑÊÑè‰πâ‰ª•ÂèäÁªÜËäÇ„ÄÇÂΩìÁÑ∂Ôºå‰ªñ‰ª¨Âü∫Êú¨‰∏äÂøÖÈ°ªÂºÄÂèë‰∏ÄÁßç‰∏ìÁî®ÁöÑÂèçÊ±áÁºñÊàñËÄÖÂèçÁºñËØëÂ∑•ÂÖ∑‰∫Ü„ÄÇ</p>
<h3 id="chap51-c"><a class="markdownIt-Anchor" href="#chap51-c"></a> Chap51* C++</h3>
<h4 id="Á±ª"><a class="markdownIt-Anchor" href="#Á±ª"></a> Á±ª</h4>
<h5 id="‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê"><a class="markdownIt-Anchor" href="#‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê"></a> ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê</h5>
<p><mark>‰ªéÊ±áÁºñÂ±ÇÈù¢ÁúãÔºåC++Á±ªÔºàclassÔºâÁöÑÁªÑÁªáÊñπÂºèÂíåÁªìÊûÑ‰ΩìÊï∞ÊçÆÂÆåÂÖ®‰∏ÄËá¥„ÄÇ</mark></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">class</span> <span class="token class-name">c</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
     <span class="token keyword">int</span> v1<span class="token punctuation">;</span>
     <span class="token keyword">int</span> v2<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
     <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// default ctor</span>
     <span class="token punctuation">&#123;</span>
          v1<span class="token operator">=</span><span class="token number">667</span><span class="token punctuation">;</span>
          v2<span class="token operator">=</span><span class="token number">999</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

     <span class="token function">c</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token comment">// ctor</span>
     <span class="token punctuation">&#123;</span>
          v1<span class="token operator">=</span>a<span class="token punctuation">;</span>
          v2<span class="token operator">=</span>b<span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

     <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#123;</span>
          <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d; %d\n"</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
     <span class="token keyword">class</span> <span class="token class-name">c</span> c1<span class="token punctuation">;</span>
     <span class="token keyword">class</span> <span class="token class-name">c</span> <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     c1<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     c2<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p><code>msvs x86</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_c2<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">16</span> <span class="token comment">; size = 8</span>
_c1<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span> <span class="token comment">; size = 8</span>
_main PROC
     push  <span class="token register variable">ebp</span>
     mov   <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
     sub   <span class="token register variable">esp</span>, <span class="token number">16</span>
     lea   <span class="token register variable">ecx</span>, DWORD PTR _c1<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     call  ??0c@@QAE@XZ <span class="token comment">; c::c</span>
     push  <span class="token number">6</span>
     push  <span class="token number">5</span>
     lea   <span class="token register variable">ecx</span>, DWORD PTR _c2<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     call  ??0c@@QAE@HH@Z <span class="token comment">; c::c</span>
     lea   <span class="token register variable">ecx</span>, DWORD PTR _c1<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     call  ?dump@c@@QAEXXZ <span class="token comment">; c::dump</span>
     lea   <span class="token register variable">ecx</span>, DWORD PTR _c2<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     call  ?dump@c@@QAEXXZ <span class="token comment">; c::dump</span>
     xor   <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
     mov   <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
     pop   <span class="token register variable">ebp</span>
     ret   <span class="token number">0</span>
_main ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>È¶ñÂÖàÔºåÁ®ãÂ∫è‰∏∫ÊØè‰∏™ÂØπË±°ÂàÜÈÖç‰∫Ü8‰∏™Â≠óËäÇÂÜÖÂ≠òÔºåÊ≠£Â•ΩËÉΩÂ≠òÂÇ®2‰∏™ÂèòÈáè</li>
<li>Âú®ÂàùÂßãÂåñc1Êó∂ÔºåÁºñËØëÂô®Ë∞ÉÁî®‰∫ÜÊó†ÂèÇÊûÑÈÄ†ÂáΩÊï∞<code>??0c@@QAE@XZ</code></li>
<li>Âú®ÂàùÂßãÂåñc2Êó∂ÔºåÁºñËØëÂô®Ë∞ÉÁî®‰∫ÜÊó†ÂèÇÊûÑÈÄ†ÂáΩÊï∞<code>??0c@@QAE@HH@Z</code>,Âπ∂‰∏î‰º†ÈÄí‰∫Ü2‰∏™ÂèÇÊï∞</li>
<li>Âú®‰º†ÈÄíÊï¥‰∏™Á±ªÂØπË±°ÁöÑÊåáÈíàÊó∂Ôºå<code>this</code>ÊåáÈíàÈÄöËøá<code>ecx</code>ÂØÑÂ≠òÂô®‰º†ÈÄíÁªôË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞„ÄÇËøôÁßçË∞ÉÁî®ËßÑËåÉÂ∫îÂΩìÁ¨¶Âêà<code>thiscall</code>ËßÑËåÉ</li>
<li><code>MSVS</code>ÈÄöËøá<code>ECX</code>ÂØÑÂ≠òÂô®‰º†ÈÄí<code>this</code>ÊåáÈíà„ÄÇ‰∏çËøáÔºåËøôÁßçË∞ÉÁî®Á∫¶ÂÆöÂπ∂Ê≤°ÊúâÁªü‰∏ÄÁöÑÊäÄÊúØËßÑËåÉ„ÄÇGCCÁºñËØëÂô®‰ª•‰º†ÈÄíÁ¨¨‰∏Ä‰∏™ÂáΩÊï∞ÁöÑÂèÇÊï∞ÁöÑÊñπÂºè‰º†ÈÄíthisÊåáÈíàÔºåÂÖ∂‰ªñÁöÑÁºñËØëÂô®Â§öÊï∞ÈÉΩÈÅµÂæ™‰∫ÜGCCÁöÑ<code>thiscall</code>ËßÑËåÉ„ÄÇ</li>
<li>Ëøô‰∫õÂáΩÊï∞‰∏∫‰ªÄ‰πàÊúâÂæàÂ•áÊÄ™ÁöÑÂêçÂ≠óÔºåËøôÂÆûÈôÖ‰∏äÊòØÁºñËØëÂô®ÂØπÂáΩÊï∞ÂêçÁß∞ËøõË°åÁöÑÂêçÁß∞ÊîπÂèò</li>
<li>C++ÁöÑÁ±ªÂèØËÉΩÂåÖÂê´ÂêåÂêçÁöÑ‰ΩÜÊòØÂèÇÊï∞‰∏çÂêåÁöÑÊñπÊ≥ï(Á±ªÊàêÂëòÂáΩÊï∞)„ÄÇËøôÂ∞±ÊòØÊâÄË∞ìÁöÑÂ§öÊÄÅÊÄß„ÄÇÂΩìÁÑ∂‰∏çÂêåÁöÑÁ±ªÂèØ‰ª•ÊúâÈáçÂêçÂç¥‰∏çÂêåÁöÑÊñπÊ≥ï</li>
<li>ÂêçÁß∞ÊîπÁºñÊòØ‰∏ÄÁßçÂú®ÁºñËØëËøáÁ®ã‰∏≠ÔºåÁî®<code>ASCII</code>Â≠óÁ¨¶‰∏≤Â∞ÜÂáΩÊï∞ÔºåÂèòÈáèÁöÑÂêçÁß∞ÈáçÊñ∞ÊîπÁºñÁöÑÊú∫Âà∂„ÄÇÊîπÁºñÂêéÁöÑÊñπÊ≥ïÔºàÁ±ªÊàêÂëòÂáΩÊï∞ÔºâÂêçÁß∞Â∞±Ë¢´Áî®‰ΩúËØ•Á®ãÂ∫èÂÜÖÈÉ®ÁöÑÂáΩÊï∞Âêç„ÄÇËøôÂÆåÂÖ®ÊòØÂõ†‰∏∫ÁºñËØëÂô®ÁöÑLinkerÂíåÂä†ËΩΩDLLÁöÑOSË£ÖËΩΩÂô®Âùá‰∏çËÉΩËØÜÂà´C++ÊàñOOPÔºàÈù¢ÂêëÂØπË±°ÁöÑÁºñÁ®ãËØ≠Ë®ÄÔºâÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇ</li>
<li>ÂáΩÊï∞dump()Ë∞ÉÁî®‰∫Ü‰∏§Ê¨°„ÄÇÊàë‰ª¨ÂÜçÊù•ÁúãÁúãÊûÑÈÄ†ÂáΩÊï∞ÁöÑÊåá‰ª§‰ª£Á†Å„ÄÇ</li>
</ul>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_this<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>       <span class="token comment">; size = 4</span>
??0c@@QAE@XZ PROC <span class="token comment">; c::c, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
     push <span class="token register variable">ebp</span>
     mov  <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
     push <span class="token register variable">ecx</span>
     mov  DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token number">667</span>
     mov  <span class="token register variable">ecx</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">999</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
     pop  <span class="token register variable">ebp</span>
     ret  <span class="token number">0</span>
??0c@@QAE@XZ ENDP <span class="token comment">; c::c</span>

_this<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span> <span class="token comment">; size = 4</span>
_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>     <span class="token comment">; size = 4</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>    <span class="token comment">; size = 4</span>
??0c@@QAE@HH@Z PROC <span class="token comment">; c::c, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
     push <span class="token register variable">ebp</span>
     mov  <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
     push <span class="token register variable">ecx</span>
     mov  DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
     mov  <span class="token register variable">edx</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
     pop  <span class="token register variable">ebp</span>
     ret  <span class="token number">8</span>
??0c@@QAE@HH@Z ENDP <span class="token comment">; c::c</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ÊûÑÈÄ†ÂáΩÊï∞Êú¨Ë∫´Â∞±ÊòØ‰∏ÄÁßçÂáΩÊï∞Ôºå‰ªñ‰ª¨‰ΩøÁî®<code>ECX</code>Â≠òÂÇ®ÁªìÊûÑ‰ΩìÊåáÈíà,ÁÑ∂ÂêéÂ∞ÜÊåáÈíàËµãÂÄºÂà∞ÂÖ∂Ëá™Â∑±ÁöÑÂ±ÄÈÉ®ÂèòÈáèÈáåÔºåÁ¨¨‰∫åÊ≠•Âπ∂‰∏çÊòØÂøÖÈ°ªÁöÑ</li>
<li>ÊûÑÈÄ†ÂáΩÊï∞‰∏çÂøÖËøîÂõûËøîÂõûÂÄº„ÄÇ‰∫ãÂÆû‰∏äÔºå‰ªéÊåá‰ª§Â±ÇÈù¢Êù•Êù•ÁúãÔºåÊûÑÈÄ†ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÊòØ‰∏Ä‰∏™Êñ∞Âª∫Á´ãÁöÑÂØπË±°ÁöÑÊåáÈíàÔºåÂç≥thisÊåáÈíà„ÄÇ</li>
</ul>
<hr />
<p>ÂÜçÁúãÁúã<code>dump()</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_this<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span>           <span class="token comment">; size = 4</span>
?dump@c@@QAEXXZ PROC  <span class="token comment">; c::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
     push <span class="token register variable">ebp</span>
     mov  <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
     push <span class="token register variable">ecx</span>
     mov  DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
     push <span class="token register variable">ecx</span>
     mov  <span class="token register variable">edx</span>, DWORD PTR _this<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">]</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">edx</span><span class="token operator">]</span>
     push <span class="token register variable">eax</span>
     push OFFSET ??_C@_07NJBDCIEC@?<span class="token operator">$</span>CFd?<span class="token operator">$</span><span class="token register variable">DL</span>?<span class="token number">5</span>?<span class="token operator">$</span>CFd?<span class="token number">6</span>?<span class="token operator">$</span>AA@
     call _printf
     add  <span class="token register variable">esp</span>, <span class="token number">12</span>
     mov  <span class="token register variable">esp</span>, <span class="token register variable">ebp</span>
     pop  <span class="token register variable">ebp</span>
     ret  <span class="token number">0</span>
?dump@c@@QAEXXZ ENDP <span class="token comment">; c::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>dump()</code>ÂáΩÊï∞‰ªé<code>ECX</code>ÂØÑÂ≠òÂô®ËØªÂèñ‰∏Ä‰∏™ÊåáÂêëÊï∞ÊçÆÁªìÊûÑ(Ëøô‰∏™ÁªìÊûÑ‰ΩìÂê´Êúâ2‰∏™intÂûãÊï∞ÊçÆ)ÁöÑÊåáÈíàÔºåÁÑ∂ÂêéÂÜçÊääËøô‰∏§‰∏™Êï¥ÂûãÊï∞ÊçÆ‰º†ÈÄíÁªôprintf()ÂáΩÊï∞„ÄÇ</p>
<hr />
<p><code>MSVS optimizing</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">??0c@@QAE@XZ PROC <span class="token comment">; c::c, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
     mov  <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token number">667</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">999</span>
     ret  <span class="token number">0</span>
??0c@@QAE@XZ ENDP <span class="token comment">; c::c</span>

_a<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>  <span class="token comment">; size = 4</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span> <span class="token comment">; size = 4</span>
??0c@@QAE@HH@Z PROC <span class="token comment">; c::c, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
     mov  <span class="token register variable">edx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
     mov  <span class="token register variable">eax</span>, <span class="token register variable">ecx</span>
     mov  <span class="token register variable">ecx</span>, DWORD PTR _a<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
     mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
     ret  <span class="token number">8</span>
??0c@@QAE@HH@Z ENDP <span class="token comment">; c::c</span>

?dump@c@@QAEXXZ PROC <span class="token comment">; c::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
     mov  <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
     mov  <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
     push <span class="token register variable">eax</span>
     push <span class="token register variable">ecx</span>
     push OFFSET ??_C@_07NJBDCIEC@?<span class="token operator">$</span>CFd?<span class="token operator">$</span><span class="token register variable">DL</span>?<span class="token number">5</span>?<span class="token operator">$</span>CFd?<span class="token number">6</span>?<span class="token operator">$</span>AA@
     call _printf
     add  <span class="token register variable">esp</span>, <span class="token number">12</span>
     ret  <span class="token number">0</span>
?dump@c@@QAEXXZ ENDP <span class="token comment">; c::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>Âú®‰ΩøÁî®ÊûÑÈÄ†ÂáΩÊï∞‰πãÂêéÔºåÊ†àÊåáÈíà‰∏çÊòØÈÄöËøá<code>add espÔºåx</code>Êåá‰ª§Âà∞ÊÅ¢Â§çÂÖ∂ÂàùÂßãÁä∂ÊÄÅÁöÑ„ÄÇÂè¶‰∏ÄÊñπÈù¢ÔºåÊûÑÈÄ†ÂáΩÊï∞ÁöÑÊúÄÂêé‰∏ÄÊù°Êåá‰ª§ÊòØÊåá‰ª§<code>ret 8</code>ËÄå‰∏çÊòØ<code>ret</code>,</p>
<p><code>ret 8</code>Áõ∏ÂΩì‰∫é<code>add espÔºå8‰∏éret</code>ÁªÑÂêà</p>
</li>
<li>
<p>Ê≠§Â§Ñ‰∏ç‰ªÖÈÅµÂæ™‰∫ÜthiscallË∞ÉÁî®ËßÑËåÉÔºàÂèÇËßÅ51.1.1ËäÇÔºâÔºåËÄå‰∏îËøòÂêåÊó∂ÈÅµÂæ™stdcallË∞ÉÁî®ËßÑËåÉÔºà64.2ËäÇÔºâ„ÄÇStdcallËßÑËåÉÁ∫¶ÂÆöÔºöÂ∫îÂΩìÁî±Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÔºàËÄå‰∏çÊòØÁî±Ë∞ÉÁî®ÊñπÂáΩÊï∞ÔºâÊÅ¢Â§çÂèÇÊï∞Ê†àÁöÑÂàùÂßãÁä∂ÊÄÅ„ÄÇÊûÑÈÄ†ÂáΩÊï∞Ôºà‰πüÊòØÊú¨‰æã‰∏≠ÁöÑË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞Ôºâ‰ΩøÁî®‚Äúadd ESPÔºåx‚ÄùÁöÑÊåá‰ª§ÊääÊú¨Âú∞Ê†àÈáäÊîæxÂ≠óËäÇÔºåÁÑ∂ÂêéÊääÁ®ãÂ∫èÊéßÂà∂ÊùÉ‰º†ÈÄíÁªôË∞ÉÁî®ÊñπÂáΩÊï∞„ÄÇ</p>
</li>
</ul>
<hr />
<p><code>x86-64</code></p>
<p>Âú®<code>x86-64</code>ÁéØÂ¢ÉÈáåÁöÑ64‰ΩçÂ∫îÁî®Á®ãÂ∫è‰ΩøÁî®<code>RCX</code>Ôºå<code>RDX</code>,<code>R8</code>‰ª•Âèä<code>R9</code>Ëøô4‰∏™ÂØÑÂ≠òÂô®‰º†ÈÄíÂáΩÊï∞ÁöÑÂâç4ÊÉ≥ÂèÇÊï∞ÔºåÂÖ∂‰ªñÂèÇÊï∞Áî®Ê†àÂ§ÑÁêÜ„ÄÇ</p>
<p>Ë∞ÉÁî®ÈÇ£‰∫õÊ∂âÂèäÁ±ªÊàêÂëòÂáΩÊï∞ÁöÑÊó∂ÂÄôÔºå==ÁºñËØëÂô®‰ºöÈÄöËøáRCXÂØÑÂ≠òÂô®‰º†ÈÄíÁ±ªÂØπË±°ÁöÑthisÊåáÈíàÔºåÁî®RDXÂØÑÂ≠òÂô®‰º†ÈÄíÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞Ôºå‰æùÊ≠§Á±ªÊé®„ÄÇ==Êàë‰ª¨ÂèØ‰ª•Âú®Á±ªÊàêÂëòÂáΩÊï∞c(int a,int b)‰∏≠ÁúãÂà∞Ëøô‰∏ÄÁÇπ„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; void dump()</span>

?dump@c@@QEAAXXZ PROC <span class="token comment">; c::dump</span>
     mov   <span class="token register variable">r8d</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
     mov   <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>
     lea   <span class="token register variable">rcx</span>, OFFSET FLAT:??_C@_07NJBDCIEC@?<span class="token operator">$</span>CFd?<span class="token operator">$</span><span class="token register variable">DL</span>?<span class="token number">5</span>?<span class="token operator">$</span>CFd?<span class="token number">6</span>?<span class="token operator">$</span>AA@ <span class="token comment">; '%d; %d'</span>
     jmp   printf
?dump@c@@QEAAXXZ ENDP <span class="token comment">; c::dump</span>

<span class="token comment">; c(int a, int b)</span>

??0c@@QEAA@HH@Z PROC <span class="token comment">; c::c</span>
     mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token register variable">edx</span> <span class="token comment">; 1st argument: a</span>
     mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">r8d</span> <span class="token comment">; 2nd argument: b</span>
     mov   <span class="token register variable">rax</span>, <span class="token register variable">rcx</span>
     ret   <span class="token number">0</span>
??0c@@QEAA@HH@Z ENDP <span class="token comment">; c::c</span>

<span class="token comment">; default ctor</span>

??0c@@QEAA@XZ PROC <span class="token comment">; c::c</span>
     mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">]</span>, <span class="token number">667</span>
     mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">999</span>
     mov   <span class="token register variable">rax</span>, <span class="token register variable">rcx</span>
     ret   <span class="token number">0</span>
??0c@@QEAA@XZ ENDP <span class="token comment">; c::c</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Âú®x86-64ÁéØÂ¢É‰∏ãÁöÑ<code>int</code>Êï∞ÊçÆ‰ªçÁÑ∂ÊòØ32‰ΩçÊï∞ÊçÆ„ÄÇÂõ†Ê≠§Ôºå‰∏äËø∞Á®ãÂ∫è‰ªçÁÑ∂‰ΩøÁî®<code>32‰ΩçÂØÑÂ≠òÂô®</code>‰º†ÈÄíÊï¥ÂûãÊï∞ÊçÆ</li>
<li>Á±ªÊàêÂëòÂáΩÊï∞dump()Ëøò‰ΩøÁî®‰∫ÜJMP printfÊåá‰ª§Âèñ‰ª£‰∫ÜCALLÂíåRETÊåá‰ª§„ÄÇ</li>
</ul>
<hr />
<p><code>gcc x86</code></p>
<p>gcc4.4.1ÁöÑÁºñËØëÊñπÂºèÂíåMSVS2012ÁöÑÁºñËØëÊâãÊÆµÂ∑Æ‰∏çÂ§ö</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">     public main
main proc near

var_20 <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">20h</span>
var_1C <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">1Ch</span>
var_18 <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">18h</span>
var_10 <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">10h</span>
var_8  <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">8</span>

    push <span class="token register variable">ebp</span>
    mov  <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
    and  <span class="token register variable">esp</span>, <span class="token number">0FFFFFFF0h</span>
    sub  <span class="token register variable">esp</span>, <span class="token number">20h</span>
    lea  <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_8<span class="token operator">]</span>
    mov  <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_20<span class="token operator">]</span>, <span class="token register variable">eax</span>
    call _ZN1cC1Ev
    mov  <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_18<span class="token operator">]</span>, <span class="token number">6</span>
    mov  <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_1C<span class="token operator">]</span>, <span class="token number">5</span>
    lea  <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>
    mov  <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_20<span class="token operator">]</span>, <span class="token register variable">eax</span>
    call _ZN1cC1Eii
    lea  <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_8<span class="token operator">]</span>
    mov  <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_20<span class="token operator">]</span>, <span class="token register variable">eax</span>
    call _ZN1c4dumpEv
    lea  <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>
    mov  <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">20h</span><span class="token operator">+</span>var_20<span class="token operator">]</span>, <span class="token register variable">eax</span>
    call _ZN1c4dumpEv
    mov  <span class="token register variable">eax</span>, <span class="token number">0</span>
    leave
    retn
main endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÔºåÁ±ªÊàêÂëòÂáΩÊï∞ÁöÑÂêçÁß∞ÊòØÂè¶‰∏ÄÁßçÈ£éÊ†ºÁöÑÊîπÂèò,Ë¢´Áß∞‰∏∫<code>GNU</code>‰∏ìÁî®È£éÊ†º</li>
<li><code>Á±ªÂØπË±°ÁöÑthisÊåáÈíà</code>ÊòØ‰ª•ÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÁöÑÊñπÂºè‰º†ÈÄíÁöÑ</li>
</ul>
<hr />
<p>È¶ñÂÖàÊü•ÁúãÁ¨¨‰∏Ä‰∏™ÊûÑÈÄ†ÂáΩÊï∞</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">                public _ZN1cC1Ev <span class="token comment">; weak</span>
_ZN1cC1Ev       proc near                   <span class="token comment">; CODE XREF: main+10</span>

arg_0           <span class="token operator">=</span> dword ptr <span class="token number">8</span>

                push    <span class="token register variable">ebp</span>
                mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>
                mov     dword ptr <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token number">667</span>
                mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>
                mov     dword ptr <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">999</span>
                pop     <span class="token register variable">ebp</span>
                retn
_ZN1cC1Ev       endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåÈÄöËøáÂ§ñÈÉ®‰º†Êù•ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÔºåÂç≥<code>eax</code>ÁöÑÂÄºËé∑Âæó‰∫ÜÁªìÊûÑÊåáÈíàÔºåÁÑ∂ÂêéÂú®Áõ∏Â∫îÂú∞ÂùÄ‰øÆÊîπ‰∫Ü2‰∏™Êï∞ÂÄº</p>
<hr />
<p>Á¨¨‰∫å‰∏™ÊûÑÈÄ†ÂáΩÊï∞</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">               public _ZN1cC1Eii
_ZN1cC1Eii      proc near

arg_0           <span class="token operator">=</span> dword ptr <span class="token number">8</span>
arg_4           <span class="token operator">=</span> dword ptr <span class="token number">0Ch</span>
arg_8           <span class="token operator">=</span> dword ptr <span class="token number">10h</span>

                push    <span class="token register variable">ebp</span>
                mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>
                mov     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_4<span class="token operator">]</span>
                mov     <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
                mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>
                mov     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_8<span class="token operator">]</span>
                mov     <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
                pop     <span class="token register variable">ebp</span>
                retn
_ZN1cC1Eii      endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‰∏éÁ¨¨‰∏Ä‰∏™ÊûÑÈÄ†ÂáΩÊï∞Á±ª‰ººÔºåÂå∫Âà´Âú®‰∫éÔºåËµãÂÄºÊòØ‰º†ÈÄíÁªôËøô‰∏™ÂáΩÊï∞ÁöÑÂèÇÊï∞</p>
<hr />
<p>ÂÜçÊù•ÁúãÁúã<code>dump()</code>ÂáΩÊï∞</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">                public _ZN1c4dumpEv
_ZN1c4dumpEv    proc near

var_18          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">18h</span>
var_14          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">14h</span>
var_10          <span class="token operator">=</span> dword ptr <span class="token operator">-</span><span class="token number">10h</span>
arg_0           <span class="token operator">=</span> dword ptr <span class="token number">8</span>

                push    <span class="token register variable">ebp</span>
                mov     <span class="token register variable">ebp</span>, <span class="token register variable">esp</span>
                sub     <span class="token register variable">esp</span>, <span class="token number">18h</span>
                mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span><span class="token comment">;eax=this</span>
                mov     <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;edx=this+1</span>
                mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>arg_0<span class="token operator">]</span>
                mov     <span class="token register variable">eax</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">18h</span><span class="token operator">+</span>var_10<span class="token operator">]</span>, <span class="token register variable">edx</span>
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">18h</span><span class="token operator">+</span>var_14<span class="token operator">]</span>, <span class="token register variable">eax</span>
                mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">18h</span><span class="token operator">+</span>var_18<span class="token operator">]</span>, offset aDD <span class="token comment">; "%d; %d\n"</span>
                call    _printf
                leave
                retn
_ZN1c4dumpEv    endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Ê≤°Êúâ‰ΩøÁî®Ê†àÂ∞±Â∞ÜÂèÇÊï∞Áõ¥Êé•‰º†ÈÄíÁªô‰∫Ü<code>printf</code>ÂáΩÊï∞</li>
</ul>
<p><mark>ÁªºÂêàÊú¨ËäÇÁöÑÂêÑ‰æãÂèØÁü•ÔºåMSVCÂíåGCCÁöÑÂå∫Âà´Âú®‰∫éÂáΩÊï∞ÂêçÁöÑÂêçÁß∞ÁºñÁ†ÅÈ£éÊ†º‰ª•Âèä‰º†ÈÄíthisÊåáÈíàÁöÑÂÖ∑‰ΩìÊñπÂºè ÔºàMSVCÈÄöËøáECX‰º†ÈÄíÔºåËÄåGCC‰ª•ÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÁöÑÊñπÂºè‰º†ÈÄíÔºâ„ÄÇ</mark></p>
<hr />
<p><code>gcc-x86-64</code></p>
<p><mark>Âú®ÁºñËØë64‰ΩçÂ∫îÁî®Á®ãÂ∫èÁöÑÊó∂ÂÄôÔºåGCCÈÄöËøáRDI„ÄÅRSI„ÄÅRDX„ÄÅRCX„ÄÅR8‰ª•ÂèäR9ËøôÂá†‰∏™ÂØÑÂ≠òÂô®‰º†ÈÄíÂáΩÊï∞ÁöÑÂâç6‰∏™ÂèÇÊï∞„ÄÇÂÆÉÈÄöËøáRDIÂØÑÂ≠òÂô®Ôºå‰ª•Á¨¨‰∏Ä‰∏™ÂáΩÊï∞ÂèÇÊï∞ÁöÑÂΩ¢Âºè‰º†ÈÄíthisÊåáÈíà„ÄÇÂè¶Â§ñÔºåÊï¥Êï∞ÂûãintÊï∞ÊçÆ‰æùÁÑ∂ÊòØ32‰ΩçÊï∞ÊçÆ„ÄÇÂÆÉËøò‰ºö‰∏çÊó∂‰ΩøÁî®ËΩ¨ÁßªÊåá‰ª§JMPÊõø‰ª£RETÊåá‰ª§„ÄÇ</mark></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; default ctor</span>

<span class="token label function">_ZN1cC2Ev:</span>
    mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>, <span class="token number">667</span>
    mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token number">999</span>
    ret

<span class="token comment">; c(int a, int b)</span>

<span class="token label function">_ZN1cC2Eii:</span>
    mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>, <span class="token register variable">esi</span>
    mov  DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
    ret

<span class="token comment">; dump()</span>

<span class="token label function">_ZN1c4dumpEv:</span>
    mov  <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
    mov  <span class="token register variable">esi</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">rdi</span><span class="token operator">]</span>
    xor  <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    mov  <span class="token register variable">edi</span>, OFFSET FLAT:.LC0 <span class="token comment">; "%d; %d\n"</span>
    jmp  printf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="Á±ªÁªßÊâø"><a class="markdownIt-Anchor" href="#Á±ªÁªßÊâø"></a> Á±ªÁªßÊâø</h5>
<p>ÁªßÊâøËÄåÊù•ÁöÑÁ±ª‰∏éÂâçÊñáÁöÑÁÆÄÂçïÁªìÊûÑ‰ΩìÁ±ª‰ººÔºå‰ΩÜÊòØÂèØ‰ª•ÂØπÁà∂Á±ªËøõË°åÊãìÂ±ï</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">class</span> <span class="token class-name">object</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">int</span> color<span class="token punctuation">;</span>
        <span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token function">object</span> <span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token operator">-></span>color<span class="token operator">=</span>color<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">print_color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"color=%d\n"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">box</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">object</span></span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth<span class="token punctuation">;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">box</span><span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>color<span class="token operator">=</span>color<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>width<span class="token operator">=</span>width<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>height<span class="token operator">=</span>height<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>depth<span class="token operator">=</span>depth<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is box. color=%d, width=%d, height=%d, depth=%d\n"</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> width<span class="token punctuation">,</span> ‚Üô
    ‚Üò height<span class="token punctuation">,</span> depth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">sphere</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">object</span></span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> radius<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">sphere</span><span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> radius<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token operator">-></span>color<span class="token operator">=</span>color<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-></span>radius<span class="token operator">=</span>radius<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is sphere. color=%d, radius=%d\n"</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    box <span class="token function">b</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sphere <span class="token function">s</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    b<span class="token punctuation">.</span><span class="token function">print_color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">print_color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    b<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Êàë‰ª¨ÂÖ±ÂêåÂÖ≥Ê≥®<code>dump()</code>ÂáΩÊï∞‰ª•Âèä<code>object::print_color()</code>ÁöÑÊåá‰ª§‰ª£Á†ÅÔºåÈáçÁÇπÂàÜÊûê32‰ΩçÁéØÂ¢É‰∏ãÊúâÂÖ≥Êï∞ÊçÆÁ±ªÂûãÁöÑÂÜÖÂ≠òÂ≠òÂÇ®Ê†ºÂ±Ä</li>
</ul>
<hr />
<p><code>msvs 2008 /Ob0</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">??_C@_09GCEDOLPA@color?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">6</span>?<span class="token operator">$</span>AA@ DB <span class="token string">'color=%d'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span> <span class="token comment">; `string'</span>
?print_color@object@@QAEXXZ PROC <span class="token comment">; object::print_color, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
    push  <span class="token register variable">eax</span>

<span class="token comment">; 'color=%d', 0aH, 00H</span>
    push OFFSET ??_C@_09GCEDOLPA@color?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">6</span>?<span class="token operator">$</span>AA@
    call _printf
    add  <span class="token register variable">esp</span>, <span class="token number">8</span>
    ret  <span class="token number">0</span>
?print_color@object@@QAEXXZ ENDP <span class="token comment">; object::print_color</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">?dump@box@@QAEXXZ PROC <span class="token comment">; box::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
    mov   <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
    push  <span class="token register variable">eax</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
    mov   <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
    push  <span class="token register variable">edx</span>
    push  <span class="token register variable">eax</span>
    push  <span class="token register variable">ecx</span>

<span class="token comment">; 'this is box. color=%d, width=%d, height=%d, depth=%d', 0aH, 00H ; `string'</span>
    push OFFSET ??_C@_0DG@NCNGAADL@this?5is?5box?<span class="token number">4</span>?5color?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">0</span>?5width?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">0</span>@
    call _printf
    add  <span class="token register variable">esp</span>, <span class="token number">20</span>
    ret  <span class="token number">0</span>
?dump@box@@QAEXXZ ENDP <span class="token comment">; box::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">?dump@sphere@@QAEXXZ PROC <span class="token comment">; sphere::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
    mov   <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
    push  <span class="token register variable">eax</span>
    push  <span class="token register variable">ecx</span>

<span class="token comment">; 'this is sphere. color=%d, radius=%d', 0aH, 00H</span>
    push OFFSET ??_C@_0CF@EFEDJLDC@this?5is?5sphere?<span class="token number">4</span>?5color?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">0</span>?5radius@
    call _printf
    add  <span class="token register variable">esp</span>, <span class="token number">12</span>
    ret  <span class="token number">0</span>
?dump@sphere@@QAEXXZ ENDP <span class="token comment">; sphere::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Êàë‰ª¨‰ªé‰∏äËø∞Ê±áÁºñÂèØ‰ª•ÁúãÂá∫ÂÜÖÂ≠òÁöÑÂü∫Êú¨ÊéíÂàó</li>
</ul>
<p>‚ë† Áà∂Á±ªobjectÂØπË±°ÁöÑÂ≠òÂÇ®Ê†ºÂ±ÄÂ¶Ç‰∏ãÊâÄÁ§∫„ÄÇ</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x0</td>
<td>int color</td>
</tr>
</tbody>
</table>
<p>‚ë° ÁªßÊâøÁ±ªÂØπË±°ÔºöboxÂíåsphereÔºàÂàÜÂà´‰∏∫ÁõíÂ≠êÂíåÁêÉ‰ΩìÔºâÁöÑÂ≠òÂÇ®Ê†ºÂ±ÄÂàÜÂà´Â¶Ç‰∏ãÈù¢‰∏§Âº†Ë°®ÊâÄÁ§∫„ÄÇ</p>
<p>box</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x0</td>
<td>int color</td>
</tr>
<tr>
<td>+0x4</td>
<td>int width</td>
</tr>
<tr>
<td>+0x8</td>
<td>int height</td>
</tr>
<tr>
<td>+0xC</td>
<td>int depth</td>
</tr>
</tbody>
</table>
<p>sphere</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x0</td>
<td>int color</td>
</tr>
<tr>
<td>+0x4</td>
<td>int radius</td>
</tr>
</tbody>
</table>
<hr />
<p>ÂÜçÊù•ÁúãÁúã<code>main</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">PUBLIC _main
_TEXT SEGMENT
_s<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">24</span> <span class="token comment">; size = 8</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">16</span> <span class="token comment">; size = 16</span>
_main PROC
    sub   <span class="token register variable">esp</span>, <span class="token number">24</span>
    <span class="token comment">;box b(1,10,20,30)</span>
    push  <span class="token number">30</span>
    push  <span class="token number">20</span>
    push  <span class="token number">10</span>
    push  <span class="token number">1</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">40</span><span class="token operator">]</span>
    call  ??0box@@QAE@HHHH@Z <span class="token comment">; box::box</span>
    <span class="token comment">;sphere s(2,40)</span>
    push  <span class="token number">40</span>
    push  <span class="token number">2</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>
    call  ??0sphere@@QAE@HH@Z <span class="token comment">; sphere::sphere;ÊûÑÈÄ†ÂáΩÊï∞</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>
    call  ?print_color@object@@QAEXXZ <span class="token comment">; object::print_color</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>
    call  ?print_color@object@@QAEXXZ <span class="token comment">; object::print_color</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>
    call  ?dump@box@@QAEXXZ <span class="token comment">; box::dump</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">]</span>
    call  ?dump@sphere@@QAEXXZ <span class="token comment">; sphere::dump</span>
    xor   <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    add   <span class="token register variable">esp</span>, <span class="token number">24</span>
    ret   <span class="token number">0</span>
_main ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><mark>ÁªßÊâøÁ±ªÂøÖÈ°ªÂú®ÂÖ∂Âü∫ÔºàÁà∂ÔºâÁ±ªÂ≠óÊÆµÁöÑÂêéÈù¢Âä†ÂÖ•Ëá™Â∑±ÁöÑÂ≠óÊÆµÔºåÂõ†Ê≠§Âü∫Á±ªÂíåÁªßÊâøÁ±ªÁöÑÁ±ªÊàêÂëòÂáΩÊï∞ÂèØ‰ª•ÂÖ±Â≠ò„ÄÇ</mark></li>
<li>ÂΩìÁ®ãÂ∫èË∞ÉÁî®Á±ªÊàêÂëòÂØπË±°<code>object::print_color()</code>Êó∂ÔºåÊåáÂêëÂØπË±°<code>box</code>Âíå<code>sphere</code>ÁöÑÊåáÈíàÊòØÈÄöËøá<code>this</code>ÊåáÈíà‰º†ÈÄíÁöÑ„ÄÇÁî±‰∫éÂú®ÊâÄÊúâÁªßÊâøÁ±ªÂíåÂü∫Á±ª‰∏≠colorÂ≠óÊÆµÁöÑÂÅèÁßªÈáèÂõ∫ÂÆö‰∏∫0(offset+0x0)ÔºåÊâÄÊúâÁ±ªÂØπË±°ÁöÑÁ±ªÊàêÂëòÂáΩÊï∞<code>object::print_color</code>ÈÉΩÂèØ‰ª•Ê≠£Â∏∏ËøêË°å</li>
<li>Âõ†Ê≠§ÔºåÊó†ËÆ∫ÊòØÂü∫Á±ªËøòÊòØÁªßÊâøÁ±ªË∞ÉÁî®object::print_color()ÔºåÂè™Ë¶ÅËØ•ÊñπÊ≥ïÊâÄÂºïÁî®ÁöÑÂ≠óÊÆµÁöÑÁõ∏ÂØπÂú∞ÂùÄÂõ∫ÂÆö‰∏çÂèòÔºåÈÇ£‰πàËØ•ÊñπÊ≥ïÂ∞±ÂèØ‰ª•Ê≠£Â∏∏ËøêË°å„ÄÇ</li>
<li>ÂÅáÂ¶ÇÂü∫‰∫éboxÁ±ªÂàõÂª∫‰∏Ä‰∏™ÁªßÊâøÁ±ªÔºåÈÇ£‰πàÁºñËØëÂô®Â∞±‰ºöÂú®<code>ÂèòÈáèdepthÁöÑÂêéÈù¢ËøΩÂä†ÊÇ®ÊâÄÊ∑ªÂä†Êñ∞ÁöÑÂèòÈáè</code>Ôºå‰ª•Á°Æ‰øùÂü∫Á±ªboxÁöÑÂêÑÂ≠óÊÆµÁöÑÁõ∏ÂØπÂú∞ÂùÄÂú®ÂÖ∂ÁªßÊâøÁ±ª‰∏≠Âõ∫ÂÆö‰∏çÂèò„ÄÇ</li>
<li>ÂΩìÁà∂Á±ª‰∏∫boxÁ±ªÁöÑÂêÑÁªßÊâøÁ±ªÂú®Ë∞ÉÁî®ÂêÑËá™ÁöÑÊñπÊ≥ïbox::dump()Êó∂ÔºåÂÆÉ‰ª¨ÈÉΩËÉΩÊ£ÄÁ¥¢Âà∞color„ÄÅwidth„ÄÅheight‰ª•ÂèädepthsÂ≠óÊÆµÁöÑÊ≠£Á°ÆÂú∞ÂùÄ„ÄÇÂõ†‰∏∫ÂêÑÂ≠óÊÆµÁöÑÁõ∏ÂØπÂú∞ÂùÄ‰∏ç‰ºöÂèëÁîüÂèòÂåñ„ÄÇ</li>
</ul>
<hr />
<p>gccÁîüÊàêÁöÑ‰ª£Á†Å‰∏émsvsÁ±ª‰ººÔºåÂå∫Âà´‰ªçÁÑ∂ÊòØ<code>gcc</code>‰∏ç‰ºö‰ΩøÁî®<code>ecx</code>ÂØÑÂ≠òÂô®‰º†ÈÄí<code>this</code>ÊåáÈíàÔºåËÄåÊòØÁî®ÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÁöÑ‰º†ÈÄíÊñπÂºè‰º†ÈÄí<code>this</code>ÊåáÈíà</p>
<h5 id="Â∞ÅË£Ö"><a class="markdownIt-Anchor" href="#Â∞ÅË£Ö"></a> Â∞ÅË£Ö</h5>
<p><mark>Â∞ÅË£ÖÔºàencapsulationÔºâÁöÑ‰ΩúÁî®ÊòØÔºöÊääÊó¢ÂÆöÁöÑÊï∞ÊçÆÂíåÊñπÊ≥ïÈôêÂÆö‰∏∫Á±ªÁöÑÁßÅÊúâ‰ø°ÊÅØÔºå‰ΩøÂæóÂÖ∂‰ªñË∞ÉÁî®ÊñπÂè™ËÉΩËÆøÈóÆÁ±ªÊâÄÂÆö‰πâÁöÑÂÖ¨ÂÖ±ÊñπÊ≥ïÂíåÂÖ¨ÂÖ±Êï∞ÊçÆ„ÄÅ‰∏çËÉΩÁõ¥Êé•ËÆøÈóÆË¢´Â∞ÅË£ÖËµ∑Êù•ÁöÑÁßÅÊúâÂØπË±°„ÄÇ</mark></p>
<p>ÁÑ∂ËÄåÂú®Êåá‰ª§Â±ÇÈù¢ÔºåÂà∞Â∫ïÊúâÊ≤°ÊúâÂàíÂàÜÁßÅÊúâÂØπË±°ÂíåÂÖ¨ÂºÄÂØπË±°ÁöÑÁïåÈôêÂë¢Ôºü</p>
<p>ÂÖ∂ÂÆûÂÆåÂÖ®Ê≤°Êúâ„ÄÇ</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">class</span> <span class="token class-name">box</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">int</span> color<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth<span class="token punctuation">;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">box</span><span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>color<span class="token operator">=</span>color<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>width<span class="token operator">=</span>width<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>height<span class="token operator">=</span>height<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>depth<span class="token operator">=</span>depth<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is box. color=%d, width=%d, height=%d, depth=%d\n"</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> width<span class="token punctuation">,</span>height<span class="token punctuation">,</span> depth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ÂêØÁî®MSVC 2008ÁöÑ‰ºòÂåñÈÄâÈ°π/OxÂíå/Ob0ÁºñËØë‰∏äËø∞Á®ãÂ∫èÔºåÂÜçÊü•ÁúãÁ±ªÂáΩÊï∞box::dump()ÁöÑ‰ª£Á†Å„ÄÇ</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">?dump@box@@QAEXXZ PROC <span class="token comment">; box::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
    mov   <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
    push  <span class="token register variable">eax</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
    mov   <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
    push  <span class="token register variable">edx</span>
    push  <span class="token register variable">eax</span>
    push  <span class="token register variable">ecx</span>
<span class="token comment">; 'this is box. color=%d, width=%d, height=%d, depth=%d', 0aH, 00H</span>
    push OFFSET ??_C@_0DG@NCNGAADL@this?5is?5box?<span class="token number">4</span>?5color?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">0</span>?5width?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">0</span>@
    call _printf
    add  <span class="token register variable">esp</span>, <span class="token number">20</span>
    ret  <span class="token number">0</span>
?dump@box@@QAEXXZ ENDP <span class="token comment">; box::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ÊòæÁÑ∂ÂÜÖÂ≠òÂàÜÂ∏É‰∏éÂÖàÂâçÊòØÁõ∏ÂêåÁöÑ</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x0</td>
<td>int color</td>
</tr>
<tr>
<td>+0x4</td>
<td>int width</td>
</tr>
<tr>
<td>+0x8</td>
<td>int height</td>
</tr>
<tr>
<td>+0xC</td>
<td>int depth</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>ÊâÄÊúâÂ≠óÊÆµÈÉΩÊòØÊó†Ê≥ïË¢´ÂÖ∂‰ªñÂáΩÊï∞Áõ¥Êé•ËÆøÈóÆÁöÑÁßÅÊúâÂèòÈáèÔºå‰ΩÜÊòØÊó¢ÁÑ∂Êàë‰ª¨Áü•ÈÅì‰∫ÜËøô‰∏™ÂØπË±°ÁöÑÂÜÖÂ≠òÂ≠òÂÇ®Ê†ºÂ±ÄÔºåÊàë‰ª¨ÂÖ∂ÂÆûÂèØ‰ª•ÂÜô‰∏Ä‰∏™‰øÆÊîπËøô‰∫õÂèòÈáèÁöÑÁ®ãÂ∫è</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">hack_oop_encapsulation</span><span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">box</span> <span class="token operator">*</span> o<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    o<span class="token operator">-></span>width<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// that code cant be compiled':</span>
                <span class="token comment">// "error C2248: 'box::width' : cannot access private member declared in class 'box'"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ËøôÊ†∑ÂÜôÊó†Ê≥ïË¢´ÊàêÂäüÁºñËØëÔºå‰ΩÜ‰∫ãÂÆû‰∏äÔºåÊàë‰ª¨ÂèØ‰ª•Â∞Ü<code>Box</code>Êï∞ÊçÆÁ±ªÂûãËΩ¨Êç¢‰∏∫Êï¥ÂûãÊï∞ÁªÑÔºåËøõËÄåÁºñËØëÂπ∂‰∏îÁõ¥Êé•‰øÆÊîπÁõ∏Â∫îÂ≠óÊÆµ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">hack_oop_encapsulation</span><span class="token punctuation">(</span>class box <span class="token operator">*</span> o<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>ptr_to_object<span class="token operator">=</span>reinterpret_cast<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ptr_to_object<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊúÄÁªà</p>
<pre class="line-numbers language-none"><code class="language-none">this is box. color&#x3D;1, width&#x3D;10, height&#x3D;20, depth&#x3D;30
this is box. color&#x3D;1, width&#x3D;123, height&#x3D;20, depth&#x3D;30<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>
<p><mark>Â∞ÅË£ÖÂè™ËÉΩÂ§üÂú®ÁºñËØëÈò∂ÊÆµ‰øùÊä§Á±ªÁöÑÁßÅÊúâÂØπË±°„ÄÇËôΩÁÑ∂C++ÁºñËØëÂô®Á¶ÅÊ≠¢Â§ñÈÉ®‰ª£Á†ÅÁõ¥Êé•ËÆøÈóÆÈÇ£‰∫õË¢´ÊòéÁ°ÆÂ±èËîΩÁöÑÂÜÖÈÉ®ÂØπË±°Ôºå‰ΩÜÊòØÈÄöËøáÈÄÇÂΩìÁöÑhackÊäÄÊúØÔºåÊàë‰ª¨Á°ÆÂÆûËÉΩÂ§üÁ™ÅÁ†¥ÁºñËØëÂô®ÁöÑÈôêÂà∂Á≠ñÁï•„ÄÇ</mark></p>
</li>
</ul>
<h5 id="Â§öÈáçÁªßÊâø"><a class="markdownIt-Anchor" href="#Â§öÈáçÁªßÊâø"></a> Â§öÈáçÁªßÊâø</h5>
<p><mark>Â§öÁ±ªÁªßÊâø-ÊåáÁöÑÊòØ‰∏Ä‰∏™Á±ªÂèØ‰ª•ÂêåÊó∂ÁªßÊâøÂ§ö‰∏™Áà∂Á±ªÁöÑÂ≠óÊÆµÂíåÊñπÊ≥ï</mark></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">class</span> <span class="token class-name">box</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth<span class="token punctuation">;</span>
        <span class="token function">box</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token function">box</span><span class="token punctuation">(</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>width<span class="token operator">=</span>width<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>height<span class="token operator">=</span>height<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>depth<span class="token operator">=</span>depth<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is box. width=%d, height=%d, depth=%d\n"</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token function">get_volume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> width <span class="token operator">*</span> height <span class="token operator">*</span> depth<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">solid_object</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">int</span> density<span class="token punctuation">;</span>
        <span class="token function">solid_object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token function">solid_object</span><span class="token punctuation">(</span><span class="token keyword">int</span> density<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>density<span class="token operator">=</span>density<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token function">get_density</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> density<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is solid_object. density=%d\n"</span><span class="token punctuation">,</span> density<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">solid_box</span><span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">box</span><span class="token punctuation">,</span> <span class="token class-name">solid_object</span></span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">solid_box</span> <span class="token punctuation">(</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">,</span> <span class="token keyword">int</span> density<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>width<span class="token operator">=</span>width<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>height<span class="token operator">=</span>height<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>depth<span class="token operator">=</span>depth<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>density<span class="token operator">=</span>density<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is solid_box. width=%d, height=%d, depth=%d, density=%d\n"</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span>‚Üô
‚Üò height<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> density<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token function">get_weight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">get_volume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">get_density</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    box <span class="token function">b</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    solid_object <span class="token function">so</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    solid_box <span class="token function">sb</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    b<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    so<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sb<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> sb<span class="token punctuation">.</span><span class="token function">get_weight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>box::dump(),solid_object::dump()‰ª•Âèäsolid_box::dump()Ëøô3‰∏™Á±ªÊàêÂëòÂáΩÊï∞„ÄÇ</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">?dump@box@@QAEXXZ PROC <span class="token comment">; box::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
    mov   <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
    push  <span class="token register variable">eax</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
    push  <span class="token register variable">edx</span>
    push  <span class="token register variable">eax</span>
<span class="token comment">; 'this is box. width=%d, height=%d, depth=%d', 0aH, 00H</span>
    push  OFFSET ??_C@_0CM@DIKPHDFI@this?5is?5box?<span class="token number">4</span>?5width?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">0</span>?5height?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd@
    call  _printf
    add   <span class="token register variable">esp</span>, <span class="token number">16</span>
    ret   <span class="token number">0</span>
?dump@box@@QAEXXZ ENDP <span class="token comment">; box::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">?dump@solid_object@@QAEXXZ PROC <span class="token comment">; solid_object::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
    push  <span class="token register variable">eax</span>
<span class="token comment">; 'this is solid_object. density=%d', 0aH</span>
    push  OFFSET ??_C@_0CC@KICFJINL@this?5is?5solid_object?<span class="token number">4</span>?5density?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd@
    call  _printf
    add   <span class="token register variable">esp</span>, <span class="token number">8</span>
    ret   <span class="token number">0</span>
?dump@solid_object@@QAEXXZ ENDP <span class="token comment">; solid_object::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">?dump@solid_box@@QAEXXZ PROC <span class="token comment">; solid_box::dump, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
    mov   <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>
    push  <span class="token register variable">eax</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>
    mov   <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>
    push  <span class="token register variable">edx</span>
    push  <span class="token register variable">eax</span>
    push  <span class="token register variable">ecx</span>
<span class="token comment">; 'this is solid_box. width=%d, height=%d, depth=%d, density=%d', 0aH</span>
    push  OFFSET ??_C@_0DO@HNCNIHNN@this?5is?5solid_box?<span class="token number">4</span>?5width?<span class="token operator">$</span>DN?<span class="token operator">$</span>CFd?<span class="token number">0</span>?5hei@
    call  _printf
    add   <span class="token register variable">esp</span>, <span class="token number">20</span>
    ret   <span class="token number">0</span>
?dump@solid_box@@QAEXXZ ENDP <span class="token comment">; solid_box::dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>‚ë† Á±ªbox„ÄÇÂ¶Ç‰∏ãË°®ÊâÄÁ§∫„ÄÇ</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x0</td>
<td>width</td>
</tr>
<tr>
<td>+0x4</td>
<td>height</td>
</tr>
<tr>
<td>+0x8</td>
<td>depth</td>
</tr>
</tbody>
</table>
<p>‚ë° Á±ªsolid_object„ÄÇÂ¶Ç‰∏ãË°®ÊâÄÁ§∫„ÄÇ</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x0</td>
<td>density</td>
</tr>
</tbody>
</table>
<p>‚ë¢ Á±ªsolid_boxÔºåÂèØ‰ª•ÁúãÊàêÊòØ‰ª•‰∏ä‰∏§‰∏™Á±ªÁöÑËÅîÂêà‰Ωì„ÄÇÂ¶Ç‰∏ãË°®ÊâÄÁ§∫„ÄÇ</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x0</td>
<td>width</td>
</tr>
<tr>
<td>+0x4</td>
<td>height</td>
</tr>
<tr>
<td>+0x8</td>
<td>depth</td>
</tr>
<tr>
<td>+0xC</td>
<td>density</td>
</tr>
</tbody>
</table>
<p>‰ª•‰∏äÂõæË°®ÈááÁî®‰∫ÜÂÅèÁßªÈáè‰∏éÂØπÂ∫îÂèòÈáèÁöÑÊñπÂºèÂ±ïÁé∞3‰∏™Á±ªÂØπË±°ÁöÑÂÜÖÂ≠òÂ≠òÂÇ®ÁªìÊûÑ„ÄÇÂõæ‰∏≠‰∏ÄÂÖ±Âá∫Áé∞‰∫Ü4‰∏™ÂèòÈáèÔºåÂç≥Èïøwidth„ÄÅÈ´òheight„ÄÅÂÆΩdepth‰ª•ÂèäÂØÜÂ∫¶density„ÄÇ</p>
<p><code>‰ΩìÁßØÂáΩÊï∞</code>Âíå<code>ÂØÜÂ∫¶ÂáΩÊï∞</code>‰∏çÈúÄË¶ÅÂàÜÊûêÔºå‰∏éÂâç‰æãÊòØ‰∏ÄÊ†∑ÁöÑ</p>
<p>ÂÖ≥ÈîÆÂ§öÈáçÁªßÊâøÁöÑ<code>solod_box</code>ÁöÑ<code>get_weight</code>ÂáΩÊï∞</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">?get_weight@solid_box@@QAEHXZ PROC <span class="token comment">; solid_box::get_weight, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    push  <span class="token register variable">esi</span>
    mov   <span class="token register variable">esi</span>, <span class="token register variable">ecx</span>
    push  <span class="token register variable">edi</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>
    call  ?get_density@solid_object@@QAEHXZ <span class="token comment">; solid_object::get_density</span>
    mov   <span class="token register variable">ecx</span>, <span class="token register variable">esi</span>
    mov   <span class="token register variable">edi</span>, <span class="token register variable">eax</span>
    call  ?get_volume@box@@QAEHXZ <span class="token comment">; box::get_volume</span>
    imul  <span class="token register variable">eax</span>, <span class="token register variable">edi</span>
    pop   <span class="token register variable">edi</span>
    pop   <span class="token register variable">esi</span>
    ret   <span class="token number">0</span>
?get_weight@solid_box@@QAEHXZ ENDP <span class="token comment">; solid_box::get_weight</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>get_weight</code>Ë∞ÉÁî®‰∫ÜÁà∂Á±ªÁöÑ‰∏§‰∏™ÊñπÊ≥ï</li>
<li>Âú®Ë∞ÉÁî®<code>get_volume</code>ËÆ°ÁÆó‰ΩìÁßØÁöÑÊó∂ÂÄô‰º†ÈÄíÁöÑÊòØ<code>this</code>ÊåáÈíà</li>
<li>ËÄåÂú®Ë∞ÉÁî®<code>get_density</code>ËÆ°ÁÆóÂØÜÂ∫¶ÂáΩÊï∞Ôºå‰º†ÈÄíÁöÑÂèÇÊï∞Âú∞ÂùÄÊòØ<code>this+12</code>Ôºå(<em>Ëøô‰∏™Â∞±Áõ∏ÂΩì‰∫éÊòØsolid_objectÁ±ªÁöÑthisÊåáÈíà</em>)Ëøô‰∏™Âú∞ÂùÄÂØπÂ∫îÁöÑÊòØ<code>solid_box</code>Á±ªÁöÑ<code>solid_object</code>Â≠óÊÆµ</li>
<li><code>solid_object::get_density()</code>ËÆ§‰∏∫ÔºåÂÆÉÂ§ÑÁêÜÁöÑÊòØÂ∏∏ËßÑÁöÑsolid_objectÁ±ªÔºåËÄåbox::get_volume()ÂàôÂèØ‰ª•Ê≠£Â∏∏ËÆøÈóÆÂéüÊúâÊï∞ÊçÆÁ±ªÂûãÁöÑ3‰∏™ÂèòÈáèÔºåÂ¶ÇÂêåÁõ¥Êé•Êìç‰ΩúboxÁ±ª‰∏ÄÊ†∑„ÄÇ</li>
<li><mark>ÁªßÊâø‰∫ÜÂÖ∂‰ªñÁöÑ„ÄÅÂ§ö‰∏™Á±ªËÄåÁîüÊàêÁöÑÁ±ªÂØπË±°ÔºåÂú®ÂÜÖÂ≠ò‰πã‰∏≠Â∞±ÊòØ‰∏ÄÁßçËÅîÂêà‰ΩìÂûãÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇÂÆÉÁªßÊâø‰∫ÜÂéüÊúâÁà∂Á±ªÁöÑÂÖ®ÈÉ®Â≠óÊÆµÂíåÊñπÊ≥ï„ÄÇÂú®ËøôÁßçÁªßÊâøÁ±ªÂØπË±°Ë∞ÉÁî®Êüê‰∏™ÂÖ∑‰ΩìÊñπÊ≥ïÊó∂ÔºåÂÆÉ‰º†ÈÄíÁöÑÊòØ‰∏éËØ•ÊñπÊ≥ïÂéüÊúâÂü∫Á±ªÁõ∏ÂØπÂú∞ÂùÄÁõ∏Â∫îÁöÑthisÊåáÈíà„ÄÇ</mark></li>
</ul>
<h5 id="ËôöÊãüÊñπÊ≥ï"><a class="markdownIt-Anchor" href="#ËôöÊãüÊñπÊ≥ï"></a> ËôöÊãüÊñπÊ≥ï</h5>
<p>ÂÆÉÂÖÅËÆ∏Âú®Ê¥æÁîüÁ±ª‰∏≠ÈáçÂÜôÂü∫Á±ªÁöÑÊñπÊ≥ï„ÄÇ‰ΩøÁî®ËôöÊãüÂáΩÊï∞ÔºåÂèØ‰ª•‰ΩøÂæó<code>Âü∫Á±ªÁöÑÊåáÈíàÊàñÂºïÁî®Âú®ÊåáÂêëÊ¥æÁîüÁ±ªÂØπË±°Êó∂ÔºåË∞ÉÁî®Ê¥æÁîüÁ±ª‰∏≠ÈáçÂÜôÁöÑÂáΩÊï∞ÁâàÊú¨ÔºåËÄå‰∏çÊòØÂü∫Á±ª‰∏≠ÁöÑÂáΩÊï∞ÁâàÊú¨„ÄÇ</code>ËøôÊ†∑Â∞±Â¢ûÂº∫‰∫Ü‰ª£Á†ÅÁöÑÁÅµÊ¥ªÊÄßÂíåÂèØÊâ©Â±ïÊÄß„ÄÇ</p>
<ul>
<li>Â£∞Êòé:Âú®Âü∫Á±ª‰∏≠ÔºåÈÄöËøáÂú®ÂáΩÊï∞Â£∞ÊòéÂâçÂä†‰∏ä<code>virtual</code>ÂÖ≥ÈîÆÂ≠óÊù•Â£∞Êòé‰∏Ä‰∏™ÂáΩÊï∞‰∏∫ËôöÊãüÂáΩÊï∞</li>
<li>ÈáçÂÜô:Âú®Ê¥æÁîüÁ±ª,ÈÄöËøá‰ΩøÁî®Áõ∏ÂêåÂáΩÊï∞ÂêçÔºåËøîÂõûÁ±ªÂûãÂíåÂèÇÊï∞ÂàóË°®Êù•ÈáçÂÜô(Override)Âü∫Á±ªÁöÑËôöÊãüÂáΩÊï∞„ÄÇÊ¥æÁîüÁ±ª<code>‰∏çÈúÄË¶ÅÂÜçÊ¨°‰ΩøÁî®virtualÂÖ≥ÈîÆÂ≠ó</code>Ôºå‰ΩÜÂèØ‰ª•‰ΩøÁî®<code>override</code>Êù•ÊòéÁ°ÆË°®Á§∫ËØ•ÂáΩÊï∞ÊòØÈáçÂÜôÂü∫Á±ªÁöÑËôöÊãüÂáΩÊï∞,ÊúâÂä©‰∫éÁºñËØëÂô®Ê£ÄÊü•</li>
<li>ËôöÂáΩÊï∞Ë°®:ÁºñËØëÂô®‰ºö<code>‰∏∫ÂåÖÂê´Ëá≥Â∞ë‰∏Ä‰∏™ËôöÊãüÂáΩÊï∞ÁöÑÁ±ªÁîüÊàê‰∏Ä‰∏™ËôöÂáΩÊï∞Ë°®ÔºàvtableÔºâ</code>ÔºåÂÖ∂‰∏≠Â≠òÂÇ®‰∫ÜËØ•Á±ªÊâÄÊúâËôöÊãüÂáΩÊï∞ÁöÑÂú∞ÂùÄ„ÄÇÊØè‰∏™ÂÖ∑ÊúâËôöÊãüÂáΩÊï∞ÁöÑÁ±ªÂÆû‰æãÈÉΩ‰ºöÊúâ‰∏Ä‰∏™ÊåáÂêëÁõ∏Â∫îËôöÂáΩÊï∞Ë°®ÁöÑÊåáÈíàÔºàÈÄöÂ∏∏‰Ωú‰∏∫ÂØπË±°ÁöÑÁ¨¨‰∏Ä‰∏™ÊàêÂëòÔºâ„ÄÇ</li>
<li>Âä®ÊÄÅÁªëÂÆöÔºöÂΩìÈÄöËøáÂü∫Á±ªÊåáÈíàÊàñÂºïÁî®Êù•Ë∞ÉÁî®‰∏Ä‰∏™ËôöÊãüÂáΩÊï∞Êó∂ÔºåÂÆûÈôÖË∞ÉÁî®Âì™‰∏™ÁâàÊú¨ÁöÑÂáΩÊï∞ÊòØÂú®ËøêË°åÊó∂ÂÜ≥ÂÆöÁöÑÔºå‰æùÊçÆÊòØÊåáÈíàÊàñÂºïÁî®ÊâÄÊåáÂêëÁöÑÂØπË±°ÁöÑÂÆûÈôÖÁ±ªÂûã„ÄÇ</li>
</ul>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">class</span> <span class="token class-name">object</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">int</span> color<span class="token punctuation">;</span>
        <span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token function">object</span> <span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token operator">-></span>color<span class="token operator">=</span>color<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"color=%d\n"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">box</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">object</span></span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth<span class="token punctuation">;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">box</span><span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>color<span class="token operator">=</span>color<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>width<span class="token operator">=</span>width<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>height<span class="token operator">=</span>height<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>depth<span class="token operator">=</span>depth<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is box. color=%d, width=%d, height=%d, depth=%d\n"</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">sphere</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">object</span></span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">int</span> radius<span class="token punctuation">;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">sphere</span><span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> radius<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>color<span class="token operator">=</span>color<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-></span>radius<span class="token operator">=</span>radius<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"this is sphere. color=%d, radius=%d\n"</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    box <span class="token function">b</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sphere <span class="token function">s</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    object <span class="token operator">*</span>o1<span class="token operator">=</span><span class="token operator">&amp;</span>b<span class="token punctuation">;</span>
    object <span class="token operator">*</span>o2<span class="token operator">=</span><span class="token operator">&amp;</span>s<span class="token punctuation">;</span>

    o1<span class="token operator">-></span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    o2<span class="token operator">-></span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Âú®Ëøô‰∏™‰æãÂ≠ê‰∏≠,Á±ª<code>object</code>ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ËôöÊãüÂáΩÊï∞<code>dump()</code>ÔºåÂÆÉË¢´ÁªßÊâøÁ±ªboxÂíåsphere‰∏≠ÁöÑÂêåÂêçÂáΩÊï∞Ë¶ÜÁõñ‰∫Ü</li>
<li>Âú®Ë∞ÉÁî®ËôöÊãüÂáΩÊï∞Êó∂Ôºå<code>ÁºñËØëÂô®Èò∂ÊÆµÂèØËÉΩÊó†Ê≥ïÁ°ÆÂÆöÂØπË±°ÁöÑÁ±ªÂûãÊÉÖÂÜµ</code>„ÄÇÂΩìÁ±ª‰∏≠Âê´ÊúâËôöÂáΩÊï∞Êó∂ÔºåÂÖ∂Âü∫Á±ªÁöÑÊåáÈíàÂ∞±ÂèØ‰ª•ÊåáÂêë‰ªª‰ΩïÊ¥æÁîüÁ±ªÁöÑÂØπË±°ÔºåËøôÊó∂Â∞±ÊúâÂèØËÉΩ‰∏çÁü•ÈÅìÂü∫Á±ªÊåáÈíàÂà∞Â∫ïÊåáÂêëÁöÑÊòØÂì™‰∏™ÂØπË±°ÁöÑÊÉÖÂÜµ„ÄÇËøôÊó∂Â∞±Ë¶ÅÊ†πÊçÆÂÆûÊó∂Á±ªÂûã‰ø°ÊÅØÔºåÁ°ÆÂÆöÂ∫îÂΩìË∞ÉÁî®ÁöÑÁõ∏Â∫îÂáΩÊï∞„ÄÇ</li>
</ul>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_s<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">32</span> <span class="token comment">; size = 12</span>
_b<span class="token operator">$</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">20</span> <span class="token comment">; size = 20</span>
_main PROC
    sub   <span class="token register variable">esp</span>, <span class="token number">32</span>
    push  <span class="token number">30</span>
    push  <span class="token number">20</span>
    push  <span class="token number">10</span>
    push  <span class="token number">1</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">48</span><span class="token operator">]</span>
    call  ??0box@@QAE@HHHH@Z <span class="token comment">; box::box</span>
    push  <span class="token number">40</span>
    push  <span class="token number">2</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">40</span><span class="token operator">]</span>
    call  ??0sphere@@QAE@HH@Z <span class="token comment">; sphere::sphere</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>
    mov   <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _b<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>
    call  <span class="token register variable">edx</span><span class="token comment">;o1->dump</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>
    mov   <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">]</span>
    lea   <span class="token register variable">ecx</span>, DWORD PTR _s<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">]</span>
    call  <span class="token register variable">edx</span><span class="token comment">;o2->dump</span>
    xor   <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    add   <span class="token register variable">esp</span>, <span class="token number">32</span>
    ret   <span class="token number">0</span>
_main ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ÊåáÂêë<code>dump</code>ÂáΩÊï∞ÁöÑÂáΩÊï∞ÊåáÈíàÂ∫îÂΩì‰Ωç‰∫éÁ±ªÂØπË±°<code>object</code>‰∏≠ÁöÑÊüê‰∏™Âú∞Êñπ„ÄÇÊàë‰ª¨Âú®Âì™ÈáåÂéªÊâæÊñ∞ÊñπÊ≥ïÁöÑÂáΩÊï∞Âú∞ÂùÄÂë¢ÔºüÂÆÉÂøÖÂÆöÁî±ÊûÑÈÄ†ÂáΩÊï∞ÂÆö‰πâÔºö main()ÂáΩÊï∞Ê≤°Ë∞ÉÁî®ÂÖ∂‰ªñÂáΩÊï∞ÔºåÂõ†Ê≠§Ëøô‰∏™ÊåáÈíàËÇØÂÆöÁî±<code>ÊûÑÈÄ†ÂáΩÊï∞</code>ÂÆö‰πâ„ÄÇÂõ†Ê≠§Êàë‰ª¨ÂÖ∑‰ΩìÁúãÁúãÂêÑ‰∏™Á±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞ÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ</li>
</ul>
<p><code>boxÁ±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">??_R0?AVbox@@@<span class="token number">8</span> DD FLAT:??_7type_info@@6B@ <span class="token comment">; box 'RTTI Type Descriptor'</span>
    DD     <span class="token number">00H</span>
    DB     <span class="token string">'.?AVbox@@'</span>, <span class="token number">00H</span>

??_R1A@?0A@EA@box@@<span class="token number">8</span> DD FLAT:??_R0?AVbox@@@<span class="token number">8</span> <span class="token comment">; box::'RTTI Base Class Descriptor at (0,-1,0,64)'</span>
    DD     <span class="token number">01H</span>
    DD     <span class="token number">00H</span>
    DD     <span class="token number">0ffffffffH</span>
    DD     <span class="token number">00H</span>
    DD     <span class="token number">040H</span>
    DD     FLAT:??_R3box@@<span class="token number">8</span>

??_R2box@@<span class="token number">8</span> DD     FLAT:??_R1A@?0A@EA@box@@<span class="token number">8</span> <span class="token comment">; box::'RTTI Base Class Array'</span>
    DD     FLAT:??_R1A@?0A@EA@object@@<span class="token number">8</span>

??_R3box@@<span class="token number">8</span> DD     <span class="token number">00H</span> <span class="token comment">; box::'RTTI Class Hierarchy Descriptor'</span>
    DD     <span class="token number">00H</span>
    DD     <span class="token number">02H</span>
    DD     FLAT:??_R2box@@<span class="token number">8</span>

??_R4box@@6B@ DD <span class="token number">00H</span> <span class="token comment">; box::'RTTI Complete Object Locator'</span>
    DD     <span class="token number">00H</span>
    DD     <span class="token number">00H</span>
    DD     FLAT:??_R0?AVbox@@@<span class="token number">8</span>
    DD     FLAT:??_R3box@@<span class="token number">8</span>

??_7box@@6B@ DD     FLAT:??_R4box@@6B@ <span class="token comment">; box::`vftable'</span>
    DD     FLAT:?dump@box@@UAEXXZ

_color<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>    <span class="token comment">; size = 4</span>
_width<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>   <span class="token comment">; size = 4</span>
_height<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>  <span class="token comment">; size = 4</span>
_depth<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">20</span>   <span class="token comment">; size = 4</span>
??0box@@QAE@HHHH@Z PROC <span class="token comment">; box::box, COMDAT</span>
<span class="token comment">; _this$ = ecx</span>
    push  <span class="token register variable">esi</span>
    mov   <span class="token register variable">esi</span>, <span class="token register variable">ecx</span>
    call  ??0object@@QAE@XZ <span class="token comment">; object::object</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR _color<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
    mov   <span class="token register variable">ecx</span>, DWORD PTR _width<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
    mov   <span class="token register variable">edx</span>, DWORD PTR _height<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
    mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
    mov   <span class="token register variable">eax</span>, DWORD PTR _depth<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span>
    mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">]</span>, <span class="token register variable">eax</span>
    mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">]</span>, OFFSET ??_7box@@6B@
    mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>, <span class="token register variable">ecx</span>
    mov   DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">]</span>, <span class="token register variable">edx</span>
    mov   <span class="token register variable">eax</span>, <span class="token register variable">esi</span>
    pop   <span class="token register variable">esi</span>
    ret   <span class="token number">16</span>
??0box@@QAE@HHHH@Z ENDP <span class="token comment">; box::box</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>??_R0?AVbox@@@8 DD FLAT:??_7type_info@@6B@</code>: Ëøô‰∏ÄË°åÂÆö‰πâ‰∫ÜÁ±ª<code>box</code>ÁöÑRTTI Type DescriptorÔºåÊòØËøêË°åÊó∂ËØÜÂà´ÂØπË±°Á±ªÂûãÁöÑÂÖÉÊï∞ÊçÆÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇÂÆÉÊåáÂêë‰∏Ä‰∏™ÈÄöÁî®ÁöÑ<code>type_info</code>ÁªìÊûÑ„ÄÇ</li>
<li><code>??_R1A@?0A@EA@box@@8 DD ...</code>: Ëøô‰∏ÄÈÉ®ÂàÜÂÆö‰πâ‰∫ÜRTTI Base Class DescriptorÔºåÊèèËø∞‰∫ÜÁ±ª<code>box</code>ÁöÑÂü∫Á±ªÂÖ≥Á≥ª„ÄÇËøôÈáåÊòæÁ§∫<code>box</code>Êúâ‰∏Ä‰∏™Âü∫Á±ªÔºåÂπ∂Êèê‰æõ‰∫ÜÂÖ≥‰∫éËøô‰∏™Âü∫Á±ªÁöÑÂÅèÁßªÈáè„ÄÅËôöÂáΩÊï∞Ë°®ÊåáÈíàÁ≠â‰ø°ÊÅØ„ÄÇ</li>
<li><code>??_R2box@@8 DD ...</code>: RTTI Base Class ArrayÔºåÂàóÂá∫‰∫Ü<code>box</code>Á±ªÁöÑÊâÄÊúâÂü∫Á±ªÁöÑRTTI Base Class DescriptorÁöÑÂú∞ÂùÄ„ÄÇ</li>
<li><code>??_R3box@@8 DD ...</code>: RTTI Class Hierarchy DescriptorÔºåÊèèËø∞‰∫ÜÁ±ªÂ±ÇÊ¨°ÁªìÊûÑÁöÑ‰ø°ÊÅØÔºåÂåÖÊã¨Á±ªÁöÑËôöÂáΩÊï∞Ë°®Êï∞ÈáèÂíåÂü∫Á±ªÊï∞ÁªÑÁöÑÂú∞ÂùÄ„ÄÇ</li>
<li><code>??_R4box@@6B@ DD ...</code>: RTTI Complete Object LocatorÔºåÊèê‰æõ‰∫ÜÂÆö‰ΩçÂÆåÊï¥ÂØπË±°ÊâÄÈúÄÁöÑ‰ø°ÊÅØÔºåÂåÖÊã¨Á±ªÂûãÊèèËø∞Á¨¶„ÄÅËôöÂáΩÊï∞Ë°®Á≠âÁöÑÂú∞ÂùÄ„ÄÇ</li>
<li><code>??_7box@@6B@ DD FLAT:??_R4box@@6B@</code>: ËøôÊòØÁ±ª<code>box</code>ÁöÑËôöÂáΩÊï∞Ë°®(vtable)ÁöÑÂºÄÂßãÔºåÂÆÉÊåáÂêë‰∫ÜRTTI Complete Object Locator„ÄÇ</li>
<li><code>DD FLAT:?dump@box@@UAEXXZ</code>: Ëøô‰∏ÄË°åÂú®ËôöÂáΩÊï∞Ë°®‰∏≠Ê∑ªÂä†‰∫Ü‰∏Ä‰∏™Êù°ÁõÆÔºåÊåáÂêë<code>box</code>Á±ªÁöÑ‰∏Ä‰∏™ËôöÂáΩÊï∞ÔºàÂú®Ëøô‰∏™‰æãÂ≠ê‰∏≠‰ºº‰πéÊòØ<code>dump</code>ÂáΩÊï∞Ôºâ„ÄÇ</li>
</ul>
<p>ÂàÜÊûêËøô‰∏™ÊûÑÈÄ†ÂáΩÊï∞ÁöÑÂÜÖÂ≠òÂàÜÂ∏É</p>
<ul>
<li>
<p>Á¨¨‰∏Ä‰∏™Â≠óÊÆµÊòØÊüê‰∏™<code>box::vftable</code>ÁöÑÊåáÈíà</p>
</li>
<li>
<p>Âú®Ëøô‰∏™Ë°®‰∏≠ÔºåÊàë‰ª¨ÁúãÂà∞<code>‰∏Ä‰∏™ÊåáÂêëÊï∞ÊçÆË°®box::RTTI Complete Object LocatorÁöÑÈìæÊé•</code>Âíå<code>‰∏Ä‰∏™ÊåáÂêëÁ±ªÊàêÂëòÂáΩÊï∞box::dump()ÁöÑÈìæÊé•</code>„ÄÇÂÆÉ‰ª¨ÁöÑÊ≠£ËßÑÂêçÁß∞ÂàÜÂà´ÊòØËôöÊãüÊñπÊ≥ïË°®ÂíåRTTI„ÄÇ<code>ËôöÊãüÊñπÊ≥ïË°®Â≠òÂÇ®ÁùÄÂêÑÊñπÊ≥ïÁöÑÂú∞ÂùÄ</code>Ôºå<code>RTTIË°®Â≠òÂÇ®ÁùÄÁ±ªÂûãÁöÑ‰ø°ÊÅØ</code>„ÄÇÂè¶Â§ñÔºå<code>RTTIË°®‰∏∫C++Á®ãÂ∫èÊèê‰æõ‰∫Ü‚ÄúÂº∫Âà∂ËΩ¨Êç¢ËøêÁÆóÁ¨¶‚Äùdynamic_cast ÔºàÂ∞ÜÂü∫Á±ªÁ±ªÂûãÁöÑÊåáÈíàÊàñÂºïÁî®ÂÆâÂÖ®Âú∞ËΩ¨Êç¢‰∏∫Ê¥æÁîüÁ±ªÂûãÁöÑÊåáÈíàÊàñÂºïÁî®ÔºâÂíå‚ÄúÁ±ªÂûãÊü•ËØ¢Êìç‰ΩúÁ¨¶‚Äùtypeid</code>„ÄÇÂú®‰∏äËø∞Êåá‰ª§Ë∞ÉÁî®Á±ªÊàêÂëòÂáΩÊï∞Êó∂ÔºåÂÆÉÊâÄ‰ΩøÁî®ÁöÑ<code>Á±ªÂêçÁß∞‰ªçÁÑ∂ÊòØÊñáÊú¨ÂûãÂ≠óÁ¨¶‰∏≤</code>„ÄÇÂü∫‰∫é‰ª£Á†Å‰∏≠dump()ÂáΩÊï∞ÁöÑÂÆû‰æãÊÉÖÂÜµÂèØÁü•ÔºåÂú®ÈÄöËøáË∞ÉÁî®ÊåáÂêëÂü∫Á±ªÁöÑÊåáÈíàÔºàÊàñÂºïÁî®ÔºâË∞ÉÁî®ÂÖ∂ËôöÊãüÂáΩÊï∞ÔºàÁ±ªÂÆû‰æãÔºöÔºöËôöÊñπÊ≥ïÔºâÊó∂ÔºåÊåáÈíàÊúÄÁªà‰ºöÊåáÂêëÊ¥æÁîüÁ±ªÂÆû‰æãÁöÑÂêåÂêçËôöÊãüÊñπÊ≥ï‚Äî‚ÄîÊûÑÈÄ†ÂáΩÊï∞‰ºöÊääÊåáÈíàÂÆûÈôÖÊåáÂêëÁöÑÂØπË±°ÂÆû‰æãÁöÑÁ±ªÂûã‰ø°ÊÅØÂ≠òÂÇ®Âú®Êï∞ÊçÆÁªìÊûÑ‰πã‰∏≠„ÄÇ</p>
</li>
<li>
<p>Âú®ÂÜÖÂ≠òÊï∞ÊçÆË°®ÈáåÊ£ÄÁ¥¢ËôöÊãüÊñπÊ≥ïÁöÑÂÜÖÂ≠òÂú∞ÂùÄÂøÖÂÆöË¶ÅÊ∂àËÄóÈ¢ùÂ§ñÁöÑCPUÊó∂Èó¥„ÄÇÂõ†Ê≠§ËôöÊãüÊñπÊ≥ïÁöÑËøêË°åÈÄüÂ∫¶ÊØî‰∏ÄËà¨ÁöÑÊñπÊ≥ïË¶ÅÊÖ¢‰∏Ä‰∫õ„ÄÇ</p>
</li>
</ul>
<p><strong>ÊÄªÁªì</strong></p>
<ol>
<li><strong>ÁºñËØëÈò∂ÊÆµ</strong>Ôºö
<ul>
<li><strong>ÁîüÊàêËôöÂáΩÊï∞Ë°®ÔºàVTableÔºâ</strong>ÔºöÂΩìÁºñËØëÂô®ÈÅáÂà∞Âê´ÊúâËôöÂáΩÊï∞ÁöÑÁ±ªÊó∂ÔºåÂÆÉ‰ºö‰∏∫ËØ•Á±ªÁîüÊàê‰∏Ä‰∏™ËôöÂáΩÊï∞Ë°®ÔºàVTableÔºâ„ÄÇËøô‰∏™Ë°®ÊòØ‰∏Ä‰∏™ÂÜÖÂ≠òÂå∫ÂüüÔºåÂÖ∂‰∏≠Â≠òÂÇ®‰∫ÜÁ±ª‰∏≠ÊâÄÊúâËôöÂáΩÊï∞ÁöÑÂú∞ÂùÄ„ÄÇ</li>
<li><strong>ÊèíÂÖ•ËôöÂáΩÊï∞Ë°®ÊåáÈíàÔºàVPtrÔºâ</strong>ÔºöÂØπ‰∫éÊØè‰∏™‰ªéÂê´ÊúâËôöÂáΩÊï∞ÁöÑÁ±ªÊ¥æÁîüÂá∫Êù•ÁöÑÂØπË±°ÔºåÁºñËØëÂô®‰ºöÂú®ÂØπË±°ÂÜÖÂ≠òÂ∏ÉÂ±ÄÁöÑÂºÄÂßã‰ΩçÁΩÆÔºàÈÄöÂ∏∏ÊòØÁ¨¨‰∏Ä‰∏™ÊàêÂëòÔºå‰ΩÜËøô‰πüÂèñÂÜ≥‰∫éÁºñËØëÂô®ÂíåÂπ≥Âè∞ÔºàÂ¶ÇÊûúÊúâÊûÑÈÄ†ÂáΩÊï∞Â∞±ÊòØÂú®ÊûÑÈÄ†ÂáΩÊï∞ÈáåÔºâÊèíÂÖ•‰∏Ä‰∏™ÊåáÂêëËØ•Á±ªËôöÂáΩÊï∞Ë°®ÁöÑÊåáÈíàÔºàVPtrÔºâ„ÄÇ</li>
</ul>
</li>
<li><strong>ÈìæÊé•Èò∂ÊÆµ</strong>Ôºö
<ul>
<li><strong>Âú∞ÂùÄÂàÜÈÖç</strong>ÔºöÈìæÊé•Âô®‰ºö‰∏∫ÊØè‰∏™ÂáΩÊï∞ÂàÜÈÖçÊúÄÁªàÁöÑÂÜÖÂ≠òÂú∞ÂùÄÔºåÂåÖÊã¨ËôöÂáΩÊï∞„ÄÇËøô‰∏ÄÊ≠•È™§Á°Æ‰øù‰∫ÜËôöÂáΩÊï∞Ë°®‰∏≠Â≠òÂÇ®ÁöÑÂú∞ÂùÄÊòØÊ≠£Á°ÆÁöÑ„ÄÇ</li>
</ul>
</li>
<li><strong>ËøêË°åÊó∂</strong>Ôºö
<ul>
<li>ËôöÂáΩÊï∞Ë∞ÉÁî®ÔºöÂΩìÈÄöËøáÂü∫Á±ªÊåáÈíàÊàñÂºïÁî®Êù•Ë∞ÉÁî®ËôöÂáΩÊï∞Êó∂ÔºåÂÆûÈôÖÊâßË°åÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö
<ul>
<li>È¶ñÂÖàÔºåÁ®ãÂ∫èÈÄöËøáÂØπË±°ÁöÑVPtrÊâæÂà∞ÂÖ∂ÂØπÂ∫îÁöÑËôöÂáΩÊï∞Ë°®„ÄÇ</li>
<li>ÁÑ∂ÂêéÔºåÊ†πÊçÆÂáΩÊï∞Ë∞ÉÁî®Âú®‰ª£Á†Å‰∏≠ÁöÑÂÅèÁßªÈáèÔºàÂç≥ËôöÂáΩÊï∞Âú®VTable‰∏≠ÁöÑ‰ΩçÁΩÆÔºâÔºå‰ªéËôöÂáΩÊï∞Ë°®‰∏≠ÂèñÂá∫ÂÆûÈôÖË¶ÅË∞ÉÁî®ÁöÑÂáΩÊï∞Âú∞ÂùÄ„ÄÇ</li>
<li>ÊúÄÂêéÔºåÈÄöËøáËøô‰∏™Âú∞ÂùÄË∑≥ËΩ¨Âà∞Âπ∂ÊâßË°åÂÆûÈôÖÁöÑËôöÂáΩÊï∞‰ª£Á†Å„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>ÊÄªÁªìÊù•ËØ¥ÔºåËôöÂáΩÊï∞ÁöÑÂú∞ÂùÄÊòØÂú®ÁºñËØëÊó∂Áî±ÁºñËØëÂô®Á°ÆÂÆöÂπ∂Â°´ÂÖÖÂà∞ËôöÂáΩÊï∞Ë°®‰∏≠ÔºåËÄåÂÖ∑‰ΩìË∞ÉÁî®Âì™‰∏™ËôöÂáΩÊï∞ÂàôÊòØÂú®ËøêË°åÊó∂ÈÄöËøáÂØπË±°ÁöÑVPtrÂíåËôöÂáΩÊï∞Ë°®Êù•Âä®ÊÄÅÂÜ≥ÂÆöÁöÑ„ÄÇËøôÁßçÊú∫Âà∂ÂÆûÁé∞‰∫ÜC++‰∏≠ÁöÑÂ§öÊÄÅÊÄßÔºåÂç≥ÂÖÅËÆ∏Ê¥æÁîüÁ±ªÂØπË±°ÈÄöËøáÂü∫Á±ªÊåáÈíàÊàñÂºïÁî®Êù•Ë°®Áé∞Âá∫‰∏çÂêåÁöÑË°å‰∏∫„ÄÇ</p>
<h4 id="ostreamËæìÂá∫ÊµÅ"><a class="markdownIt-Anchor" href="#ostreamËæìÂá∫ÊµÅ"></a> ostreamËæìÂá∫ÊµÅ</h4>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"Hello,world!\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><mark>ËøêÁÆóÈáçËΩΩÁ¨¶‚Äú&lt;&lt;‚ÄùÁöÑ‰ΩúÁî®ÊòØ‚ÄúÈáçËΩΩ‚ÄùÂÖ∂‰ªñÁ±ªÂûãÁöÑÊï∞ÊçÆÔºå‰∏ªË¶ÅÁî®‰∫éÂØπË±°‰πãÈó¥ÁöÑËøêÁÆó„ÄÇ</mark></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token operator">$</span>SG37112 DB <span class="token string">'Hello, world!'</span>, <span class="token number">0aH</span>, <span class="token number">00H</span>

_main PROC
    push OFFSET <span class="token operator">$</span>SG37112
    push OFFSET ?cout@std@@3V?<span class="token operator">$</span>basic_ostream@DU?<span class="token operator">$</span>char_traits@D@std@@@<span class="token number">1</span>@A <span class="token comment">; std::cout</span>
    call ??<span class="token operator">$</span>?6U?<span class="token operator">$</span>char_traits@D@std@@@std@@YAAAV?<span class="token operator">$</span>basic_ostream@DU? ‚Üô
    ‚Üò <span class="token operator">$</span>char_traits@D@std@@@<span class="token number">0</span>@AAV10@PBD@Z <span class="token comment">; std::operator&lt;&lt;&lt;std::char_traits&lt;char> ></span>
    add   <span class="token register variable">esp</span>, <span class="token number">8</span>
    xor   <span class="token register variable">eax</span>, <span class="token register variable">eax</span>
    ret   <span class="token number">0</span>
_main ENDP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>std::cout &lt;&lt; &quot;Hello, &quot; &lt;&lt; &quot;world!\n&quot;;</code></p>
<p>Áõ∏ÂΩì‰∫é<code>f(f(std::cout, &quot;Hello, &quot;), &quot;world!&quot;);</code></p>
<h4 id="ÂºïÁî®"><a class="markdownIt-Anchor" href="#ÂºïÁî®"></a> ÂºïÁî®</h4>
<p><a target="_blank" rel="noopener" href="https://csguide.cn/cpp/memory/difference_of_pointers_and_ref.html#%E6%B1%87%E7%BC%96%E6%8F%AD%E5%BC%80%E5%BC%95%E7%94%A8%E9%9D%A2%E7%BA%B1">C++ ‰∏≠ÊåáÈíàÂíåÂºïÁî®ÁöÑÂå∫Âà´ | ÁºñÁ®ãÊåáÂåó (csguide.cn)</a></p>
<p><em>ÂºïÁî®ÂèØ‰ª•ÁúãÂÅöÊòØ‰∏Ä‰∏™Â∏∏ÈáèÊåáÈíà</em></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">f2</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span> sum<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span> product<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        sum<span class="token operator">=</span>x<span class="token operator">+</span>y<span class="token punctuation">;</span>
        product<span class="token operator">=</span>x<span class="token operator">*</span>y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">_x<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">8</span>                                              <span class="token comment">; size = 4</span>
_y<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">12</span>                                             <span class="token comment">; size = 4</span>
_sum<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">16</span>                                           <span class="token comment">; size = 4</span>
_product<span class="token operator">$</span> <span class="token operator">=</span> <span class="token number">20</span>                                       <span class="token comment">; size = 4</span>
?f2@@YAXHHAAH0@Z PROC                                <span class="token comment">; f2</span>
        mov     <span class="token register variable">ecx</span>, DWORD PTR _y<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        mov     <span class="token register variable">eax</span>, DWORD PTR _x<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
        lea     <span class="token register variable">edx</span>, DWORD PTR <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token register variable">ecx</span><span class="token operator">]</span><span class="token comment">;edx:sum=x+y</span>
        imul <span class="token register variable">eax</span>, <span class="token register variable">ecx</span><span class="token comment">;eax:x*y</span>
        mov <span class="token register variable">ecx</span>, DWORD PTR _product<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span><span class="token comment">;ecx=ptr(product)</span>
        push <span class="token register variable">esi</span>
        mov     <span class="token register variable">esi</span>, DWORD PTR _sum<span class="token operator">$</span><span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">]</span><span class="token comment">;esi=ptr(sum)</span>
        mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">esi</span><span class="token operator">]</span>, <span class="token register variable">edx</span><span class="token comment">;sum=x+y</span>
        mov     DWORD PTR <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">]</span>, <span class="token register variable">eax</span><span class="token comment">;product=x*y</span>
        pop     <span class="token register variable">esi</span>
        ret     <span class="token number">0</span>
?f2@@YAXHHAAH0@Z ENDP                                <span class="token comment">; f2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="stlstandard-template-library"><a class="markdownIt-Anchor" href="#stlstandard-template-library"></a> *stl(standard template library)</h4>
<h5 id="stdstringÂ≠óÁ¨¶‰∏≤"><a class="markdownIt-Anchor" href="#stdstringÂ≠óÁ¨¶‰∏≤"></a> std::string(Â≠óÁ¨¶‰∏≤)</h5>
<p>std::stringÂÆö‰πâ‰∏∫‰ª•‰∏ãÂá†‰∏™ÁªÑ‰ª∂ÔºöÁºìÂÜ≤Âå∫ÊåáÈíà„ÄÅÂ≠óÁ¨¶‰∏≤ÁºìÂÜ≤Âå∫„ÄÅÂΩìÂâçÂ≠óÁ¨¶‰∏≤ÁöÑÈïøÂ∫¶Ôºà‰æø‰∫éÂáΩÊï∞Êìç‰ΩúÔºõËØ∑ÂèÇÈòÖÔºªYur13ÔºΩÁöÑ2.2.1ËäÇÔºâ‰ª•ÂèäÂΩìÂâçÁºìÂÜ≤Âå∫ÁöÑÂÆπÈáè„ÄÇÂú®ÁºìÂÜ≤Âå∫ÈáåÔºåÂ≠óÁ¨¶‰∏≤ÈÄöÂ∏∏Áî®0‰ΩúÂ≠óÁ¨¶‰∏≤ÁªìÊùüÁ¨¶Ôºå‰ª•ÂÖºÂÆπÂ∏∏ËßÑÁöÑCËØ≠Ë®ÄASCIIZÂ≠óÁ¨¶‰∏≤Ê†ºÂºè„ÄÇ</p>
<p>Âú®<code>C++</code>ÁöÑÊ†áÂáÜÊï∞ÊçÆÁªìÊûÑ‰∏≠Ôºå<mark>Â≠óÁ¨¶‰∏≤‰∏çÊòØÁ±ªÂØπË±°</mark>„ÄÇÂÆÉÊääÂ≠óÁ¨¶‰∏≤ÂÆö‰πâ‰∏∫Ê®°ÁâàÂûãÊï∞ÊçÆ„ÄÇËøôÊòØ‰∏∫‰∫ÜÂÖºÂÆπÂêÑ‰∏™Á±ªÂûãÁöÑÂ≠óÁ¨¶ÂÖÉÁ¥†„ÄÇÁé∞Âú®ÔºåÂÆÉËá≥Â∞ëÊîØÊåÅ<code>char(Ê†áÂáÜÂ≠óÁ¨¶‰∏≤)</code>‰ª•Âèä<code>wchar_t</code></p>
<p><code>std::stringÊòØ‰ª•8‰ΩçÂ≠óÁ¨¶char‰∏∫Âü∫Êú¨Á±ªÂûãÁöÑÁ±ªÔºåËÄåstd::wstringÂàôÊòØ‰ª•16/32‰ΩçÂÆΩÂ≠óÁ¨¶wchar_t‰∏∫Âü∫Êú¨Á±ªÂûãÁöÑ</code></p>
<hr />
<p><code>msvs</code></p>
<ul>
<li>ÂΩìÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶Âú®16Â≠óÁ¨¶‰ª•ÂÜÖÊó∂ÔºåmsvsÂ∞ÜÂ≠óÁ¨¶‰∏≤Êï∞ÊçÆÁõ¥Êé•Â≠òÂÇ®Âú®ÁºìÂÜ≤Âå∫Ôºå‰∏çÂÜç‰ΩøÁî®<code>ÊåáÈíà+ÁºìÂÜ≤Âå∫</code>ÁöÑÂ§çÊùÇÁªìÊûÑ</li>
<li>Âú®<code>32</code>‰ΩçÁ≥ªÁªüÈáåÔºåÂ≠óÁ¨¶‰∏≤ÊúÄÂ∞ë‰ºöÂç†Áî®24‰∏™Â≠óËäÇ</li>
<li>Âú®<code>64</code>Ëá≥Â∞ëÂç†Áî®(16+8+8)32‰∏™Â≠óËäÇ</li>
</ul>
<p>ÂêéÈù¢ÁöÑÁúã‰∏çÂ§™ÊáÇ</p>
<p>Á≠âÁúãÂÆå‰∫Ü<code>C++Primer</code>Â≠¶ÂÆåÂÜçÁúã</p>
<h3 id="chap52-Êï∞ÁªÑ‰∏éË¥üÊï∞Á¥¢Âºï"><a class="markdownIt-Anchor" href="#chap52-Êï∞ÁªÑ‰∏éË¥üÊï∞Á¥¢Âºï"></a> Chap52 Êï∞ÁªÑ‰∏éË¥üÊï∞Á¥¢Âºï</h3>
<ul>
<li>
<p><code>array[-1]</code>ÂÆûÈôÖ‰∏äË°®Á§∫Êï∞ÁªÑarrayËµ∑ÂßãÂú∞ÂùÄ‰πãÂâçÁöÑÂ≠òÂÇ®Á©∫Èó¥</p>
</li>
<li>
<p>x86Âπ≥Âè∞ÁöÑÂ∞èÁ´ØÂ≠óËäÇÂ∫è„ÄÇ</p>
</li>
</ul>
<h3 id="chap53-16‰ΩçwindowsÁ®ãÂ∫è"><a class="markdownIt-Anchor" href="#chap53-16‰ΩçwindowsÁ®ãÂ∫è"></a> Chap53 16‰ΩçwindowsÁ®ãÂ∫è</h3>
<p><em>ËôΩÁÑ∂16‰ΩçÁöÑWindowsÁ®ãÂ∫èÂ∑≤ÁªèËøë‰πéÁªùËøπÔºå‰ΩÜÊòØÊúâÂÖ≥Â§çÂè§Á®ãÂ∫è‰ª•ÂèäÁ†îÁ©∂Âä†ÂØÜÁãóÁöÑÁ†îÁ©∂ÔºåÂæÄÂæÄ‰ºöÊ∂âÂèäËøôÈÉ®ÂàÜÁü•ËØÜ„ÄÇ</em></p>
<ul>
<li>
<p>16‰ΩçÂ∫îÁî®Á®ãÂ∫èÁöÑ‰ª£Á†ÅÁªìÊûÑ‰∏é<code>MSDOS</code>ÁöÑÁ®ãÂ∫èÂçÅÂàÜÁ±ª‰ºº‚Äô,<code>ËøôÁßçÁ±ªÂûãÁöÑÂèØÊâßË°åÊñá‰ª∂ÈááÁî®‰∫Ü‰∏ÄÁßçÂêç‰∏∫‚ÄúNew Executable (NE)‚ÄùÁöÑÂèØÊâßË°åÁ®ãÂ∫èÊ†ºÂºè„ÄÇ</code>‚Äô</p>
</li>
<li>
<p>Âü∫‰∫éPascalËØ≠Ë®ÄÁöÑË∞ÉÁî®Á∫¶ÂÆöË¶ÅÊ±ÇÔºöÂèÇÊï∞‰ªéÂ∑¶Ëá≥Âè≥ÂÖ•Ê†àÔºà‰∏écdeclÁõ∏ÂèçÔºâ„ÄÇ</p>
</li>
<li>
<p>16‰ΩçÂ∫îÁî®Á®ãÂ∫èÁöÑÊåáÈíàÊòØ‰∏ÄÂØπÊï∞ÊçÆÔºöÂáΩÊï∞È¶ñÂÖà‰º†ÈÄíÁöÑÊòØÊï∞ÊçÆÊÆµÁöÑÂú∞ÂùÄÔºåÁÑ∂ÂêéÂÜç‰º†ÈÄíÊÆµÂÜÖÁöÑÊåáÈíàÂú∞ÂùÄ„ÄÇ</p>
</li>
<li>
<p>ÂΩì16‰ΩçÁ≥ªÁªüÔºàMSDOSÂíåWin16Ôºâ‰º†ÈÄílongÂûã32‰Ωç‚ÄúÈïø‚ÄùÊï∞ÊçÆÊó∂ÔºàËøôÁßçÂπ≥Âè∞‰∏äÁöÑintÂûãÊï∞ÊçÆÊòØ16‰ΩçÊï∞ÊçÆÔºâÔºåÂÆÉ‰ºöÂ∞Ü32‰ΩçÊï∞ÊçÆÊãÜÊàê2‰∏™16‰ΩçÊï∞ÊçÆ„ÄÅÊàêÂØπ‰º†ÈÄí„ÄÇ</p>
</li>
<li>
<p>Âú®ËøîÂõûÂáΩÊï∞ÂÄºÁöÑÊó∂ÂÄôÔºå32‰ΩçÁöÑËøîÂõûÂÄºÈÄöËøáDXÔºöAXÂØÑÂ≠òÂô®ÂØπÂõû‰º†„ÄÇ</p>
</li>
<li>
<p>‚Äúnear‚ÄùÊåáÈíàÁöÑÂØªÂùÄÁ©∫Èó¥ÊòØÂΩìÂâçÊï∞ÊçÆÊÆµÔºàDSÔºâÂÜÖÁöÑÊâÄÊúâÂú∞ÂùÄ„ÄÇ</p>
</li>
<li>
<p>‚Äúfar‚ÄùÊåáÈíàÁöÑÂØªÂùÄÁ©∫Èó¥‰∏çÈôê‰∫éÂΩìÂâçÊï∞ÊçÆÊÆµÔºåÂÆÉÂèØ‰ª•ÊòØÂÖ∂‰ªñDSÊÆµÁöÑÂÜÖÂ≠òÂú∞ÂùÄ„ÄÇÁî±‰∫éÈúÄË¶ÅÊåáÂÆöÂü∫ÔºàÊÆµÔºâÂú∞ÂùÄÔºåÊâÄ‰ª•2‰∏™16‰ΩçÊï∞ÊçÆÊâçËÉΩË°®Á§∫1‰∏™farÂûãÊåáÈíà„ÄÇ</p>
</li>
</ul>
<h3 id="chap54-java"><a class="markdownIt-Anchor" href="#chap54-java"></a> Chap54* Java</h3>
<p>ÂÖàÁï•</p>
<h2 id="part5-Âú®‰ª£Á†Å‰∏≠ÂèëÁé∞ÊúâË∂£ÁöÑÂÜÖÂÆπ"><a class="markdownIt-Anchor" href="#part5-Âú®‰ª£Á†Å‰∏≠ÂèëÁé∞ÊúâË∂£ÁöÑÂÜÖÂÆπ"></a> Part.5 Âú®‰ª£Á†Å‰∏≠ÂèëÁé∞ÊúâË∂£ÁöÑÂÜÖÂÆπ</h2>
<h3 id="chap55ÁºñËØëÂô®‰∫ßÁîüÁöÑÊñá‰ª∂ÁâπÂæÅ"><a class="markdownIt-Anchor" href="#chap55ÁºñËØëÂô®‰∫ßÁîüÁöÑÊñá‰ª∂ÁâπÂæÅ"></a> Chap55ÁºñËØëÂô®‰∫ßÁîüÁöÑÊñá‰ª∂ÁâπÂæÅ</h3>
<h4 id="microsoft-visual-c"><a class="markdownIt-Anchor" href="#microsoft-visual-c"></a> Microsoft Visual C++</h4>
<p>msvcp*.dllÂê´ÊúâC<ins>Áõ∏ÂÖ≥ÂáΩÊï∞ÔºåÂõ†Ê≠§ÂØºÂÖ•Ëøô‰∫õDLLÊñá‰ª∂ÁöÑÂèØÊâßË°åÁ®ãÂ∫èÂæàÂèØËÉΩÊòØC</ins>Á®ãÂ∫è„ÄÇ</p>
<p>ÂëΩÂêçËßÑÂàô</p>
<p>msvsÂêçÂ≠óÈÄöÂ∏∏ÈÉΩÊòØ‰ª•‚Äú?‚ÄùÂºÄÂßãÁöÑ„ÄÇ</p>
<h4 id="gcc-2"><a class="markdownIt-Anchor" href="#gcc-2"></a> gcc</h4>
<p>gccÂëΩÂêçÈÄöÂ∏∏‰ª•Á¨¶Âè∑‚Äú_Z‚ÄùÂºÄÂßã„ÄÇ</p>
<p>GCCÂú®CygwinÁéØÂ¢É‰∏ãÁºñËØëÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÈÄöÂ∏∏‰ºöÂØºÂÖ•cygwin1.dllÊñá‰ª∂„ÄÇ</p>
<p>GCCÂú®mingwÁéØÂ¢É‰∏ãÁºñËØëÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÂèØËÉΩ‰ºöÂØºÂÖ•msvcrt.dllÊñá‰ª∂„ÄÇ</p>
<h4 id="intel-fortran"><a class="markdownIt-Anchor" href="#intel-fortran"></a> intel fortran</h4>
<p>Áî±Intel FortranÁºñËØëÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÂèØËÉΩ‰ºöÂØºÂÖ•‰ª•‰∏ã3‰∏™Êñá‰ª∂Ôºö</p>
<p>‚ë† Libifcoremd.dll„ÄÇ</p>
<p>‚ë° Libifportmd.dll„ÄÇ</p>
<p>‚ë¢ Libiomp5.dllÔºàÊîØÊåÅOpenMPÔºâ„ÄÇ</p>
<p>Â∫ìÊñá‰ª∂libifcoremd.dllÂÆö‰πâ‰∫ÜÂæàÂ§ö‰ª•Â≠óÁ¨¶‰∏≤‚Äúfor_‚ÄùÂºÄÂ§¥ÁöÑÂáΩÊï∞„ÄÇÂÆÉÂ∞±ÊòØFORTRANÁöÑ‰ª£Ë°®ÊÄßÂâçÁºÄ„ÄÇ</p>
<h4 id="watcomÂíåopenwatcom"><a class="markdownIt-Anchor" href="#watcomÂíåopenwatcom"></a> watcomÂíåopenwatcom</h4>
<p>Áî±WatcomÁºñËØëÂá∫Êù•ÁöÑÁ®ãÂ∫èÔºåÂÖ∂Á¨¶Âè∑ÂêçÁß∞ÈÄöÂ∏∏‰ª•‚ÄúW‚ÄùÂ≠óÊØçÂºÄÂ§¥„ÄÇ</p>
<p>‰ª•W?method<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>c</mi></msub><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">_class</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span></span></span></span>n__v‰∏∫‰æãÔºöÂ§ßÂÜôÂ≠óÊØçWÂºÄÂ§¥‰ª£Ë°®ÂÆÉÊòØWatcomÁºñËØëÂá∫Êù•ÁöÑÁ®ãÂ∫èÔºåÊñπÊ≥ïÁöÑÂêçÁß∞‰∏∫methodÔºåÁ±ªÁöÑÂêçÁß∞‰∏∫classÔºåÊ≤°ÊúâÂèÇÊï∞‰∏îÊó†ËøîÂõûÂÄºÁöÑvoidÊñπÊ≥ï‰ºöÂëΩÂêç‰∏∫Ôºö</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">W<span class="token operator">?</span>method$_class$n__v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="borland"><a class="markdownIt-Anchor" href="#borland"></a> borland</h4>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">@TApplication@IdleAction$qv
@TApplication@ProcessMDIAccels$qp6tagMSG
@TModule@$bctr$qpcpvt1
@TModule@$bdtr$qv
@TModule@ValidWindow$qp14TWindowsObject
@TrueColorTo8BitN$qpviiiiiit1iiiiii
@TrueColorTo16BitN$qpviiiiiit1iiiiii
@DIB24BitTo8BitBitmap$qpviiiiiit1iiiii
@TrueBitmap@$bctr$qpcl
@TrueBitmap@$bctr$qpvl
@TrueBitmap@$bctr$qiilll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Á¨¶Âè∑ÂêçÁß∞ÂøÖÂÆö‰ª•Â≠óÁ¨¶‚Äú@‚ÄùÂºÄÂ§¥</li>
<li>ÂêéÈù¢Âá†‰∏™Â≠óÊØçÂàÜÂà´‰ª£Ë°®ÔºöÁ±ªÂêçÁß∞„ÄÅÊñπÊ≥ïÂêçÁß∞‰ª•ÂèäÊñπÊ≥ïÁöÑÂèÇÊï∞Á±ªÂûã„ÄÇ</li>
<li>VCLÁöÑÂÖ®Áß∞ÊòØBorland Visual Component LibrariesÔºåÊÑèÊÄùÊòØBorlandÁöÑÂèØËßÜÂåñÁªÑ‰ª∂Â∫ì„ÄÇÂÆÉ‰ª¨‰øùÂ≠òÂú®bplÊñá‰ª∂‰∏≠ÔºåËÄå‰∏çÊòØ‰øùÂ≠òÂú®dllÊñá‰ª∂‰∏≠„ÄÇÊØîÂ¶ÇËØ¥Êñá‰ª∂vcl50.dllÂíårtl60.dll„ÄÇ</li>
</ul>
<h4 id="delphi"><a class="markdownIt-Anchor" href="#delphi"></a> delphi</h4>
<p>Êï∞ÊçÆÊÆµÔºàDATAÔºâÁöÑÂ§¥Âõõ‰∏™Â≠óËäÇÈÄöÂ∏∏ÊòØ‰ª•‰∏ã‰∏â‰∏™ÁªÑÂêà‰∏≠ÁöÑ‰∏Ä‰∏™‰ªªÊÑè‰∏Ä‰∏™Ôºö00 00 00 00„ÄÅ32 13 8B C0ÊàñËÄÖFF FF FF FF„ÄÇÂú®Â§ÑÁêÜË¢´ÂéãÁº©ÊàñËÄÖË¢´Âä†ÂØÜÁöÑDephiÂèØÊâßË°åÊñá‰ª∂Êó∂ÔºåËøôÁªÑÂ∏∏Êï∞Â∞±‰ºöÂÖ∑ÊúâÊåáÊ†áÊÄßÊÑè‰πâ„ÄÇ</p>
<h4 id="ÂÖ∂‰ªñÁöÑdll"><a class="markdownIt-Anchor" href="#ÂÖ∂‰ªñÁöÑdll"></a> ÂÖ∂‰ªñÁöÑdll</h4>
<ul>
<li>Vcomp*.dll„ÄÇÂæÆËΩØÁî®Êù•ÂÆûÁé∞OpenMPÁöÑÊñá‰ª∂„ÄÇ</li>
</ul>
<h3 id="chap56win32ÁéØÂ¢É‰∏éÂ§ñÈÉ®ÈÄö‰ø°"><a class="markdownIt-Anchor" href="#chap56win32ÁéØÂ¢É‰∏éÂ§ñÈÉ®ÈÄö‰ø°"></a> Chap56Win32ÁéØÂ¢É‰∏éÂ§ñÈÉ®ÈÄö‰ø°</h3>
<ul>
<li>
<p>Âú®‰∫ÜËß£ÂáΩÊï∞ÁöÑËæìÂÖ•ËæìÂá∫ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•Êé®ÁêÜÂá∫ÂáΩÊï∞ÁöÑÂÖ∑‰ΩìÂäüËÉΩÔºåËøôÊòØ‰∏ÄÁßçÊúâÊïàÁöÑÂàÜÊûêÊñπÊ≥ï</p>
</li>
<li>
<p>ÂÖ≥Ê≥®Êñá‰ª∂ÂíåÊ≥®ÂÜåË°®Â±ÇÈù¢ÁöÑË°å‰∏∫ÔºåÂèØ‰ª•‰ΩøÁî®<code>Process Monitor</code></p>
</li>
<li>
<p>Êü•ÁúãÁΩëÁªúÂ±ÇÈù¢ÁöÑÈÄö‰ø°Êï∞ÊçÆÔºåÂèØ‰ª•‰ΩøÁî®<code>WireShark</code></p>
</li>
<li>
<p>Ëøõ‰∏ÄÊ≠•ÂàÜÊûêË°å‰∏∫Á∫ßÊï∞ÊçÆÔºåÂ∞±Ë¶ÅÊ∑±ÂÖ•Á®ãÂ∫èÂÜÖÈÉ®ÊåñÊéòÊåá‰ª§Â±ÇÈù¢ÁöÑ‰ø°ÊÅØ</p>
<ol>
<li>
<p>È¶ñÂÖàË∞ÉÊü•ËØ•Á®ãÂ∫èË∞ÉÁî®ÁöÑÊìç‰ΩúÁ≥ªÁªüAPIÂíåÊ†áÂáÜÂ∫ìÂáΩÊï∞</p>
</li>
<li>
<p>Â¶ÇÊûúÁõÆÊ†áÁ®ãÂ∫èÁî±ÂèØÊâßË°åÊñá‰ª∂ÂíåÂ§ö‰∏™DLLÊñá‰ª∂ÊûÑÊàê</p>
<p>ÈÇ£‰πàÁî±Ëøô‰∫õDLLÊñá‰ª∂ÊâÄÊèê‰æõÁöÑÔºåÂèØË∞ÉÁî®ÁöÑÂáΩÊï∞ÂêçÁß∞Â∞±ÂèØ‰ª•Êèê‰æõÂæàÂ§ßÂ∏ÆÂä©</p>
</li>
<li>
<p>Â¶ÇÊûúÂè™ÂÖ≥ÂøÉË∞ÉÁî®<code>MessageBox()</code>ÊòæÁ§∫ÁâπÂÆöÊñáÂ≠óÁöÑÊåá‰ª§</p>
</li>
<li>
<p>ÂèØ‰ª•Âú®Á®ãÂ∫èÁöÑÊï∞ÊçÆÊÆµÊ£ÄÁ¥¢ÊñáÂ≠óÂ≠óÁ¨¶ÔºåÁÑ∂Âêé‰∫§ÂèâÂºïÁî®ÔºåÂà∞ËææÂÖ≥ÈîÆ‰ª£Á†ÅÊÆµ</p>
</li>
</ol>
</li>
<li>
<p>ÂàÜÊûêÁîµËÑëÊ∏∏ÊàèÊó∂ÔºåÂ¶ÇÊûúÂèØ‰ª•Á°ÆÂÆöÁâπÂÆöÂÖ≥Âç°ÈáåÂá∫Áé∞ÁöÑ‰Ωé‰∫∫ÊÄªÊï∞ÊòØÈöèÊú∫Êï∞ÔºåÊàë‰ª¨ÂèØ‰ª•Êü•Êâæ<code>rand()</code>‰ª•ÂèäÁ±ª‰ººÁöÑÈöèÊú∫Êï∞ÁîüÊàêÂáΩÊï∞ÔºåÁÑ∂Âêé‰∫§ÂèâÂºïÁî®ÊâæÂà∞‰ΩøÁî®ÈöèÊú∫Êï∞ÁöÑÊåá‰ª§</p>
</li>
<li>
<p>ÁîµËÑëÊ∏∏Êàè‰ª•Â§ñÔºåÂ¶ÇÊûú‰ΩøÁî®‰∫Ü<code>rand()</code>ÂèØËÉΩÊòØ Âä†ÂØÜÁÆóÊ≥ï</p>
</li>
</ul>
<h4 id="Â∏∏Áî®windowsapi"><a class="markdownIt-Anchor" href="#Â∏∏Áî®windowsapi"></a> Â∏∏Áî®WindowsAPI</h4>
<ul>
<li>
<p>Ê≥®ÂÜåË°®ÁöÑÊìç‰ΩúÂèØ‰ª•ÈÄöËøáÂ∫ìÊñá‰ª∂advspi32.dllÁöÑÂ¶Ç‰∏ãÂäüËÉΩÂÆûÁé∞ÔºöRegEnumKeyEx„ÄÅRegEnumValue„ÄÅRegGetValue„ÄÅRegOpenKeyExÂíåRegQueryValueEx„ÄÇ</p>
</li>
<li>
<p>ÂØπÁ±ª‰ººiniÁöÑÊñáÊú¨Êñá‰ª∂ÂèØ‰ª•ÈÄöËøáÂ∫ìÊñá‰ª∂user32.dllÁöÑÂ¶Ç‰∏ãÂáΩÊï∞ÂÆûÁé∞ÔºöGetPrivateProfileString„ÄÇ</p>
</li>
<li>
<p>ÂØπËØùÁ™óÁöÑÊìç‰ΩúÈÄöËøáÂ∫ìÊñá‰ª∂user32.dllÁöÑÂ¶Ç‰∏ãÂáΩÊï∞ÂÆûÁé∞ÔºöMessageBoxEx„ÄÅSetDlgItemTextÂèäGetDlgItemText„ÄÇ</p>
</li>
<li>
<p>ÂØπËµÑÊ∫êÁöÑÊìç‰ΩúÔºàÂèØ‰ª•ÂèÇËÄÉÊú¨‰π¶ÁöÑ68.2.8ËäÇÔºâÈÄöËøáÂ∫ìÊñá‰ª∂user32.dllÁöÑÂáΩÊï∞LoadMenuÂÆûÁé∞„ÄÇ</p>
</li>
<li>
<p>ÂØπTCP/IPÁΩëÁªúÁöÑÊìç‰ΩúÊòØÈÄöËøáÂ∫ìÊñá‰ª∂ws2_32.dllÁöÑÂ¶Ç‰∏ãÂáΩÊï∞ÂÆûÁé∞ÔºöWSARecvÂíåWSASend„ÄÇ</p>
</li>
<li>
<p>ÂØπÊñá‰ª∂ÁöÑÊìç‰ΩúÊòØÈÄöËøáÂ∫ìÊñá‰ª∂kernel32.dllÁöÑÂ¶Ç‰∏ãÂáΩÊï∞ÂÆûÁé∞Áõ∏Â∫îÁöÑÊìç‰ΩúÔºöCreateFile„ÄÅReadFile„ÄÅReadFileEx„ÄÅWriteFileÂèäWriteFileExÁ≠â„ÄÇ</p>
</li>
<li>
<p>ËÆøÈóÆInternetÊòØÈÄöËøáÂ∫ìÊñá‰ª∂wininet.dllÁöÑWinHttpOpenÁ≠âÂáΩÊï∞Êù•ÂÆûÁé∞Áõ∏ÂÖ≥ÂäüËÉΩÁöÑ„ÄÇ</p>
</li>
<li>
<p>Ê£ÄÊü•‰∏Ä‰∏™ÂèØÊâßË°åÊñá‰ª∂ÊòØÂê¶Âê´ÊúâÊï∞Â≠óÁ≠æÂêçÂàôÊòØÈÄöËøáÂ∫ìÊñá‰ª∂wintrust.dllÁöÑÂáΩÊï∞WinVerifyTrustÁ≠âÊù•ÂÆûÁé∞ÁöÑ„ÄÇ</p>
</li>
<li>
<p>Â¶ÇÊûúÊòØÂä®ÊÄÅÈìæÊé•ÁöÑËØùÔºåÊ†áÂáÜÁöÑMSVCÂ∫ìÊñá‰ª∂msvcr*.dllÊòØÈÄöËøá‰ª•‰∏ãÂáΩÊï∞ÂÆûÁé∞Áõ∏ÂÖ≥Êìç‰ΩúÁöÑÔºöassert„ÄÅitoa„ÄÅltoa„ÄÅopen„ÄÅprintf„ÄÅread„ÄÅstrcmp„ÄÅatol„ÄÅatoi„ÄÅfopen„ÄÅfread„ÄÅfwrite„ÄÅmemcmp„ÄÅrand„ÄÅstrlen„ÄÅstrstr‰ª•Âèästrchr„ÄÇ</p>
</li>
</ul>
<h3 id="chap57Â≠óÁ¨¶‰∏≤"><a class="markdownIt-Anchor" href="#chap57Â≠óÁ¨¶‰∏≤"></a> Chap57Â≠óÁ¨¶‰∏≤</h3>
<p>UTF-16LE</p>
<p>ÂæàÂ§öWindowsÁ≥ªÁªü‰∏ãÁöÑwin32ÂáΩÊï∞Êúâ-AÂíå-WÂêéÁºÄ„ÄÇÂâçÈù¢ËøôÁßçÂáΩÊï∞Áî®‰∫éÂ§ÑÁêÜÂ∏∏ËßÑÂ≠óÁ¨¶‰∏≤ÔºåËÄåÂêéÈù¢ËøôÁßçÂ∏¶Êúâ-wÁöÑÂáΩÊï∞ÂàôÊòØUTF-16LEÂ≠óÁ¨¶‰∏≤ÁöÑ‰∏ìÁî®ÂáΩÊï∞Ôºàw‰ª£Ë°®wideÔºâ„ÄÇ</p>
<h3 id="chap58-assert"><a class="markdownIt-Anchor" href="#chap58-assert"></a> Chap58 assert()</h3>
<p>‰∏ÄËà¨Êù•ËÆ≤Ôºåassert()ÂÆèÂú®ÂèØÊâßË°åÊñá‰ª∂‰∏≠‰øùÁïô‰∫ÜÊ∫ê‰ª£Á†ÅÁöÑÊñá‰ª∂Âêç„ÄÅË°åÊï∞‰ª•ÂèäÊâßË°åÊù°‰ª∂„ÄÇ</p>
<p>ÊúÄÊúâ‰ª∑ÂÄºÁöÑ‰ø°ÊÅØÊòØassert()ÂÆèÁöÑÊâßË°åÊù°‰ª∂„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂÆÉ‰ª¨Êù•Êé®Êñ≠Âá∫ÂèòÈáèÂêçÊàñËÄÖÁªìÊûÑ‰ΩìÁöÑÂ≠óÊÆµÂêçÁß∞„ÄÇÂè¶Â§ñ‰∏Ä‰∏™ÊúâÁî®ÁöÑ‰ø°ÊÅØÊòØÊñá‰ª∂ÂêçÔºåÈÄöËøáÂÆÉÊàë‰ª¨ÂèØ‰ª•Êé®Êñ≠Âá∫Ê∫ê‰ª£Á†ÅÊòØÈááÁî®‰ªÄ‰πàËØ≠Ë®ÄÁºñÂÜôÁöÑ„ÄÇÂêåÊó∂Êàë‰ª¨ËøòÂèØËÉΩÈÄöËøáÊñá‰ª∂ÂêçÊù•ËØÜÂà´Âá∫ÂÖ∂ÊòØÂê¶ÈááÁî®‰∫ÜÁü•ÂêçÁöÑÂºÄÊîæÊ∫ê‰ª£Á†ÅÂ∫ì„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">.text:</span>107D4B29   mov    <span class="token register variable">dx</span>, <span class="token operator">[</span><span class="token register variable">ecx</span><span class="token operator">+</span><span class="token number">42h</span><span class="token operator">]</span>
<span class="token label function">.text:</span>107D4B2D   cmp    <span class="token register variable">edx</span>, <span class="token number">1</span>
<span class="token label function">.text:</span>107D4B30   jz     short loc_107D4B4A
<span class="token label function">.text:</span>107D4B32   push   <span class="token number">1ECh</span>
<span class="token label function">.text:</span>107D4B37   push   offset aWrite_c <span class="token comment">; "write.c"</span>
<span class="token label function">.text:</span>107D4B3C   push   offset aTdTd_planarcon <span class="token comment">; "td->td_planarconfig == PLANARCONFIG_CON"...</span>
<span class="token label function">.text:</span>107D4B41   call   <span class="token register variable">ds</span>:_assert

...

<span class="token label function">.text:</span>107D52CA   mov    <span class="token register variable">edx</span>, <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">]</span>
<span class="token label function">.text:</span>107D52CD   and    <span class="token register variable">edx</span>, <span class="token number">3</span>
<span class="token label function">.text:</span>107D52D0   test   <span class="token register variable">edx</span>, <span class="token register variable">edx</span>
<span class="token label function">.text:</span>107D52D2   jz     short loc_107D52E9
<span class="token label function">.text:</span>107D52D4   push   <span class="token number">58h</span>
<span class="token label function">.text:</span>107D52D6   push   offset aDumpmode_c <span class="token comment">; "dumpmode.c"</span>
<span class="token label function">.text:</span>107D52DB   push   offset aN30    <span class="token comment">; "(n &amp; 3) == 0"</span>
<span class="token label function">.text:</span>107D52E0   call   <span class="token register variable">ds</span>:_assert

...

<span class="token label function">.text:</span>107D6759   mov    <span class="token register variable">cx</span>, <span class="token operator">[</span><span class="token register variable">eax</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">]</span>
<span class="token label function">.text:</span>107D675D   cmp    <span class="token register variable">ecx</span>, <span class="token number">0Ch</span>
<span class="token label function">.text:</span>107D6760   jle    short loc_107D677A
<span class="token label function">.text:</span>107D6762   push   <span class="token number">2D8h</span>
<span class="token label function">.text:</span>107D6767   push   offset aLzw_c    <span class="token comment">; "lzw.c"</span>
<span class="token label function">.text:</span>107D676C   push   offset aSpLzw_nbitsBit <span class="token comment">; "sp->lzw_nbits &lt;= BITS_MAX"</span>
<span class="token label function">.text:</span>107D6771   call   <span class="token register variable">ds</span>:_assert<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊúÄÁÆÄÂçïÁöÑÂàÜÊûêÊñπÊ≥ïÂ∞±ÊòØÁî®googleÊù•ÊêúÁ¥¢Êù°‰ª∂ÂíåÊñá‰ª∂Âêç„ÄÇÊêúÁ¥¢ÁªìÊûúÊòæÁ§∫Ëøô‰∏éÂºÄÊ∫êÁöÑÂ∫ìÊñá‰ª∂ÊúâÂÖ≥„ÄÇÊØîÂ¶ÇËØ¥ÔºåÊêúÁ¥¢Â≠óÁ¨¶‰∏≤‚Äúsp-&gt;lzw_nbits &lt;= BITS_MAX‚ÄùÔºåÊàë‰ª¨Â∞±ÂÆÉ‰∏éÂéãÁº©ÁÆóÊ≥ïLZWÁöÑÂºÄÊ∫ê‰ª£Á†ÅÁõ∏ÂÖ≥„ÄÇ</p>
<h3 id="chap59-Â∏∏Êï∞"><a class="markdownIt-Anchor" href="#chap59-Â∏∏Êï∞"></a> Chap59 Â∏∏Êï∞</h3>
<p>‰ªé‰∫åËøõÂà∂Â±ÇÈù¢Êù•ÁúãÔºåÊõ¥‰∏∫Â∏∏Áî®ÁöÑÊï¥Êï∞ÂàôÊòØ0xAAAAAAAAÔºà1010101010101010ÔºâÂíå0x55555555 Ôºà0101010101010101ÔºâËøôÁ±ªÁâπÂæÅÊòéÊòæÁöÑÂ∏∏Èáè„ÄÇ‰ª•Â∏∏Êï∞0x55AA‰∏∫‰æãÔºöÂºïÂØºÊâáÂå∫„ÄÅ‰∏ªÂºïÂØºÊâáÂå∫MBR‰ª•ÂèäIBMÂÖºÂÆπÊâ©Â±ïÂç°ÁöÑROMÔºàÂè™ËØªÂ≠òÂÇ®ÂçïÂÖÉÔºâÁ≠âÂÖ≥ÈîÆÊï∞ÊçÆÈÉΩ‰ºö‰ΩøÁî®Ëøô‰∏™Â∏∏Èáè„ÄÇ</p>
<p>‰∏Ä‰∫õÁÆóÊ≥ïÔºåÁâπÂà´ÊòØÊüê‰∫õÂä†ÂØÜÁÆóÊ≥ïÔºåÂ∏∏Â∏∏‰ΩøÁî®Êüê‰∫õÁâπÊÆäÁöÑÂ∏∏Êï∞ÔºåÂ¶ÇÊûúÊàë‰ª¨‰ΩøÁî®Ë∞ÉËØïÂ∑•ÂÖ∑IDAÂ∞±ËÉΩÂæàÂÆπÊòìÂèëÁé∞Ëøô‰∏ÄÁÇπ„ÄÇ</p>
<p>‰ª•MD5ÁÆóÊ≥ï‰∏∫‰æãÔºåÂÖ∂ÂÜÖÈÉ®ÂèòÈáèÂàùÂßãÂÄºÂàÜÂà´ÊòØÔºö</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">var <span class="token keyword">int</span> h0 <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0x67452301</span>
var <span class="token keyword">int</span> h1 <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0xEFCDAB89</span>
var <span class="token keyword">int</span> h2 <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0x98BADCFE</span>
var <span class="token keyword">int</span> h3 <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">0x10325476</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âè¶Â§ñÁöÑ‰æãÂ≠êÂàôÊòØCRC16/32ÁöÑÁÆóÊ≥ïÔºåÂÖ∂È¢ÑÁΩÆÁöÑÂ∏∏Êï∞Ë°®ÁªèÂ∏∏Â¶Ç‰∏ãÊâÄÁ§∫„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/** CRC table for the CRC-16. The poly is 0x8005 (x^16 + x^15 + x^2 + 1) */</span>
u16 <span class="token keyword">const</span> crc16_table<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0x0000</span><span class="token punctuation">,</span> <span class="token number">0xC0C1</span><span class="token punctuation">,</span> <span class="token number">0xC181</span><span class="token punctuation">,</span> <span class="token number">0x0140</span><span class="token punctuation">,</span> <span class="token number">0xC301</span><span class="token punctuation">,</span> <span class="token number">0x03C0</span><span class="token punctuation">,</span> <span class="token number">0x0280</span><span class="token punctuation">,</span> <span class="token number">0xC241</span><span class="token punctuation">,</span>
        <span class="token number">0xC601</span><span class="token punctuation">,</span> <span class="token number">0x06C0</span><span class="token punctuation">,</span> <span class="token number">0x0780</span><span class="token punctuation">,</span> <span class="token number">0xC741</span><span class="token punctuation">,</span> <span class="token number">0x0500</span><span class="token punctuation">,</span> <span class="token number">0xC5C1</span><span class="token punctuation">,</span> <span class="token number">0xC481</span><span class="token punctuation">,</span> <span class="token number">0x0440</span><span class="token punctuation">,</span>
        <span class="token number">0xCC01</span><span class="token punctuation">,</span> <span class="token number">0x0CC0</span><span class="token punctuation">,</span> <span class="token number">0x0D80</span><span class="token punctuation">,</span> <span class="token number">0xCD41</span><span class="token punctuation">,</span> <span class="token number">0x0F00</span><span class="token punctuation">,</span> <span class="token number">0xCFC1</span><span class="token punctuation">,</span> <span class="token number">0xCE81</span><span class="token punctuation">,</span> <span class="token number">0x0E40</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>ÂæàÂ§öÊñá‰ª∂Âú®Êñá‰ª∂Â§¥‰ΩøÁî®ÁâπÂÆöÁöÑÈ≠îÊï∞Êù•Ë°®Á§∫ÂÖ∂Êñá‰ª∂Ê†ºÂºèÔºåËøô‰∫õ<code>magicNumber</code>ÂèØ‰ª•ÊòØ‰∏Ä‰∏™ÊàñËÄÖÂ§ö‰∏™Â≠óËäÇÁöÑÁªÑÂêà</p>
</li>
<li>
<p>Ê†áÂáÜÁöÑMIDIÊñá‰ª∂ÂàôÂøÖÈ°ª‰ª•‚ÄúMThd‚ÄùËøô4‰∏™Â≠óÁ¨¶ÂºÄÂ§¥„ÄÇ</p>
</li>
<li>
<p>ÂΩìÁÑ∂ÔºåÊï∞ÊçÆÊØîËæÉÂáΩÊï∞ÂêåÊ†∑ÂèØ‰ª•Áî®Êù•È™åËØÅÊñá‰ª∂Â§¥‰∏≠ÁöÑÈ≠îÊï∞„ÄÇÂ∏∏Áî®ÁöÑÂáΩÊï∞ÊúâÔºöÊØîËæÉÂÜÖÂ≠òÂùóÁöÑmemcmp()ÂáΩÊï∞ÔºåÊàñËÄÖCMPSB‰∏ÄÁ±ªÁöÑÊØîËæÉÊåá‰ª§ÔºàÂèØ‰ª•ÂèÇËÄÉÊú¨‰π¶ÈôÑÂΩïA.6.3Ôºâ</p>
<p><code>‰∏ÄÊó¶ÂèëÁé∞Êüê‰∏™Á®ãÂ∫èÂºÄÂßãÊ£ÄÊµãÂÖ∂‰ªñÊñá‰ª∂ÁöÑÈ≠îÊï∞Ê†áËØÜÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•Á°Æ‰ø°ÂÆÉÂ∑≤ÁªèÂä†ËΩΩ‰∫ÜÊüêÁßçÁ±ªÂûãÁöÑÁõÆÊ†áÊñá‰ª∂„ÄÇ</code>‰∏çÊ≠¢Â¶ÇÊ≠§ÔºåÊàë‰ª¨ËøòÂèØ‰ª•Ëß£ËØªÂá∫Êñá‰ª∂Êìç‰ΩúÁöÑÁºìÂÜ≤Âå∫‰ª•ÂèäÂÆÉ‰ΩøÁî®ÁºìÂÜ≤Âå∫ÁöÑÊñπÂºèÊñπÊ≥ïÁ≠â‰ø°ÊÅØ„ÄÇ</p>
</li>
<li>
<p>ÁΩëÁªúÂçèËÆÆÂêåÊ†∑‰ΩøÁî®‰∫ÜÈ≠îÊúØ„ÄÇÊØîÂ¶ÇÔºåDHCPÂçèËÆÆÁöÑÁΩëÁªúÊï∞ÊçÆÂ∞±‰ºöÁî®Âà∞È≠îÊï∞0x63538263‚ÄîËøô‰∏™È≠îÊï∞Âè´ÂÅömagic cookie„ÄÇÊâÄÊúâÁ¨¶ÂêàDHCPÂçèËÆÆÁöÑÊï∞ÊçÆÂåÖÈÉΩÂøÖÈ°ª‰ΩøÁî®Ëøô‰∏™È≠îÊï∞„ÄÇ</p>
<p>Êàë‰ª¨‰ª•Windows 7Êìç‰ΩúÁ≥ªÁªüÔºà64‰ΩçÊìç‰ΩúÁ≥ªÁªüÔºâ‰∏≠ÁöÑÊñá‰ª∂dhcpcore.dllÊñá‰ª∂‰∏∫‰æãÔºåÊàë‰ª¨ÂèØ‰ª•Âú®Ëøô‰∏™Êñá‰ª∂‰∏≠ÊêúÁ¥¢Ëøô‰∏™È≠îÊï∞„ÄÇÁªìÊûúÂèëÁé∞‰∫Ü2Ê¨°ÔºåÂá∫Áé∞Âú®‰∏§‰∏™ÂáΩÊï∞‰∏≠ÔºåÂÖ∂ÂêçÁß∞ÂàÜÂà´ÊòØDhcpExtractOptionsForValidation()Âíåand DhcpExtractFullOptions()„ÄÇ</p>
</li>
</ul>
<p>Âú®Âçï‰∏™Êñá‰ª∂ÈáåÊêúÁ¥¢Â∏∏Êï∞Êó∂ÔºåÂèØ‰ª•‰ΩøÁî®IDAÁöÑÊêúÁ¥¢ÂäüËÉΩ„ÄÇÂÖ∂Âø´Êç∑ÈîÆÊòØALT-BÊàñALT-I„ÄÇ</p>
<h3 id="chap60Ê£ÄÁ¥¢ÂÖ≥ÈîÆÊåá‰ª§"><a class="markdownIt-Anchor" href="#chap60Ê£ÄÁ¥¢ÂÖ≥ÈîÆÊåá‰ª§"></a> Chap60Ê£ÄÁ¥¢ÂÖ≥ÈîÆÊåá‰ª§</h3>
<p>Â¶ÇÊûú‰∏Ä‰∏™Á®ãÂ∫è‰ΩøÁî®‰∫Ü‰∏∫Êï∞‰∏çÂ§öÁöÑFPUÔºàFloat Point UnitÔºåÊµÆÁÇπËøêÁÆóÂçïÂÖÉÔºâÊåá‰ª§ÔºåÈÇ£‰πàÊàë‰ª¨ÂèØ‰ª•ÈááÁî®‰∫∫Â∑•ÊéíÊü•ÁöÑÊñπÂºèÊääÂÆÉ‰ª¨ÈÄê‰∏ÄÁ≠õÈÄâÂá∫Êù•„ÄÇ</p>
<p>È¶ñÂÖàË¶ÅÁî®IDAÂä†ËΩΩOffice 2010ÈáåÁöÑexcel.exeÔºàÊú¨Á´†‰ª•ÁâàÊú¨Âè∑‰∏∫14.0.4756.1000ÁöÑexcel‰∏∫‰æãÔºâÔºåÁÑ∂ÂêéÁîüÊàêÂÆåÊï¥ÁöÑÊåá‰ª§Ê∏ÖÂçïÂπ∂Â∞ÜÂÖ∂‰øùÂ≠ò‰∏∫ÂêéÁºÄÂêç‰∏∫.lstÁöÑÊñáÊú¨Êñá‰ª∂„ÄÇÊé•‰∏ãÊù•ÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•Áî®ÁªàÁ´ØÊåá‰ª§Ê£ÄÁ¥¢Êåá‰ª§Ê∏ÖÂçï‰∏≠ÁöÑÂÖ®ÈÉ®FDIVÊåá‰ª§ÔºàFloationg Point DivideÔºåÊµÆÁÇπÊï∞Èô§Ê≥ïÔºâ„ÄÇ‰∏•Ê†ºËØ¥Êù•Ôºå‰ΩøÁî®grep‰∏çËÉΩÊ£ÄÁ¥¢Âá∫ÂÖ®ÈÉ®ÁöÑÊµÆÁÇπÊï∞Èô§Ê≥ïËøêÁÆóÊåá‰ª§„ÄÇÂ¶ÇÊûúÈô§Êï∞ÊòØÂ∏∏ÈáèÔºåÈÇ£‰πàÁºñËØëÂô®Â∞±‰∏çÂ§™ÂèØËÉΩÂàÜÈÖçFDIVÊåá‰ª§„ÄÇÂΩìÁÑ∂ËøôÁßçÁâπ‰æã‰∏çÂú®Êàë‰ª¨ÁöÑÁ†îÁ©∂ËåÉÂõ¥‰πãÂÜÖ„ÄÇ</p>
<pre class="line-numbers language-none"><code class="language-none">cat EXCEL.lst | grep fdiv | grep -v dbl_ &gt; EXCEL.fdiv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ÁÑ∂ÂêéÔºåÊàë‰ª¨Âú®ExcelÈáåËæìÂÖ•ËÆ°ÁÆóÂÖ¨Âºè‚Äú=(1/3)‚ÄùÔºåÂπ∂Ê£ÄÊü•ÊØè‰∏™Êåá‰ª§ÁöÑËøêË°åÁªìÊûú„ÄÇ</p>
<p>Âú®Ë∞ÉËØïÂô®ÔºàÊàñtracerÔºâÈáåÈÄê‰∏ÄÊéíÊü•Èô§Ê≥ïËøêÁÆóÊåá‰ª§‰ª•ÂêéÔºåÊàë‰ª¨Âπ∏ËøêÂú∞ÂèëÁé∞Âú®Á¨¨14‰∏™FDIVÊåá‰ª§Â∞±ÊòØÊàë‰ª¨Ë¶ÅÊâæÁöÑÊåá‰ª§Ôºö</p>
<h3 id="chap61ÂèØÁñë‰ª£Á†ÅÊ®°Âûã"><a class="markdownIt-Anchor" href="#chap61ÂèØÁñë‰ª£Á†ÅÊ®°Âûã"></a> Chap61ÂèØÁñë‰ª£Á†ÅÊ®°Âûã</h3>
<ul>
<li>
<p>XOR op,opÊàñXOR EAX,EAX ÈÄöÂ∏∏Áî®Êù•Â∞ÜÊüê‰∏™ÂØÑÂ≠òÂô®Ê∏ÖÈõ∂</p>
<p>ÂΩì‰∏§‰∏™Êìç‰ΩúÊï∞‰∏çÂêåÊâçÂΩìÂÅöÂºÇÊàñ„ÄÇÂæÄÂæÄÂú®Âä†ÂØÜÁÆóÊ≥ï‰∏≠ÊØîËæÉÂ∏∏ËßÅ</p>
</li>
<li>
<p>ÊâãÂÜôÊ±áÁºñ</p>
<p>ÂΩìÂâçÁöÑÁºñËØëÂô®ÈÉΩ‰∏ç‰ºöÂàÜÈÖçÂæ™ÁéØÊåá‰ª§LOOPÂíå‰ΩçÁßªÂæ™ÁéØÊåá‰ª§RCL„ÄÇ</p>
<p>ÊâãÂÜôÁöÑÊ±áÁºñÁ®ãÂ∫èÂæàÂ∞ë‰ºöÂÖ∑Â§áÂÆåÊï¥ÁöÑÂáΩÊï∞ÂºÄÂ§¥ÂíåÂáΩÊï∞ÁªìÂ∞æ„ÄÇ</p>
<p>ÈÄöÂ∏∏Êù•ËØ¥Ôºå‰∫∫Â∑•ÊâãÂÜôÁöÑÁ®ãÂ∫èÊ≤°ÊúâÂõ∫ÂÆöÁöÑÂèÇÊï∞‰º†ÈÄíÊñπÊ≥ï„ÄÇ</p>
</li>
</ul>
<h3 id="chap62-È≠îÊï∞Â≠ó‰∏éÁ®ãÂ∫èË∞ÉËØï"><a class="markdownIt-Anchor" href="#chap62-È≠îÊï∞Â≠ó‰∏éÁ®ãÂ∫èË∞ÉËØï"></a> Chap62 È≠îÊï∞Â≠ó‰∏éÁ®ãÂ∫èË∞ÉËØï</h3>
<p><mark>ÂêëÂ∑•Á®ãÁöÑ‰∏ªË¶ÅÁõÆÊ†áÁêÜËß£Á®ãÂ∫èÂ§ÑÁêÜÊï∞ÊçÆÁöÑÂÖ∑‰ΩìÊñπÊ≥ï</mark></p>
<p>ÊâãÂ∑•Ë∑üË∏™‰∏Ä‰∏™ÂÄºÂæÄÂæÄÊòØ‰∏ÄÈ°πÈùûÂ∏∏Âä≥Á•ûË¥πÂäõÁöÑ‰∫ãÊÉÖ„ÄÇ‰∏∫‰∫ÜÂÆåÊàêËøô‰∏™‰ªªÂä°Ôºå‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑÊñπÊ≥ïÊòØ‰ΩøÁî®Ëá™Â∑±ÁöÑÁâπÊúâÈ≠îÊï∞ÔºåËôΩÁÑ∂Ëøô‰∏™ÂäûÊ≥ï‰∏çÊòØÁôæÂàÜ‰πãÁôæÂèØÈù†„ÄÇ</p>
<p>È≠îÊï∞Ë¶ÅÂ∞ΩÈáè‚ÄúÊâìÁúº‚Äù(ÂÆπÊòìËßÇÂØüÂà∞)„ÄÇÂú®ËßÇÊµã32‰ΩçÊï∞ÊçÆÊó∂ÔºåÊàë‰ª¨ÂèØ‰ª•Â∞ÜÈ≠îÊï∞ËÆæÁΩÆ‰∏∫0x0BADF00DÔºàBADFOODÔºâ</p>
<p>Êé•ÁùÄÔºåÊàë‰ª¨ÂèØ‰ª•Âà©Áî®tracerÁöÑ‰ª£Á†ÅË¶ÜÁõñÁéáÊ®°ÂºèÔºàcode coverage/ccÊ®°ÂºèÔºâË∑üË∏™Á®ãÂ∫èÔºåÂÜçÂà©Áî®grepÊàñËÄÖÁõ¥Êé•ÊêúÁ¥¢ÊñáÊú¨Êñá‰ª∂ÔºàË∑üË∏™ÁªìÊûúÁöÑÊñáÊú¨Êñá‰ª∂ÔºâÔºåÊàë‰ª¨Â∞±ËÉΩÂ§üÂæàÂÆπÊòìÂú∞ÂèëÁé∞Ëøô‰∫õÂÄºÁöÑË∞ÉÁî®ÁÇπÂèäÂ§ÑÁêÜÊñπÊ≥ï„ÄÇ</p>
<p>‰πüËÆ∏0xdeadbeef  ‰∏çÈîô</p>
<h3 id="chap63-otherthing"><a class="markdownIt-Anchor" href="#chap63-otherthing"></a> Chap63 Otherthing</h3>
<ul>
<li>
<p>ÈÄÜÂêëÂ∑•Á®ã‰∫∫ÂëòÂ∫îÂΩìÂ∞ΩÂèØËÉΩÂú∞‰ª•ÁºñÁ®ã‰∫∫ÂëòÁöÑËßíÂ∫¶Êù•ÂàÜÊûêÈóÆÈ¢ò„ÄÇË¶ÅÁêÜËß£‰ªñ‰ª¨ÁöÑËßÇÁÇπ„ÄÅÂπ∂‰∏îÊó∂Â∏∏Êâ™ÂøÉËá™ÈóÆÔºöÂ¶ÇÊûúËá™Â∑±ÊòØÁºñÁ®ã‰∫∫ÂëòÁöÑËØùÔºåËá™Â∑±‰ºöÂ¶Ç‰ΩïËÆæËÆ°Á®ãÂ∫è„ÄÇ</p>
</li>
<li>
<p>Âú®ÂàÜÊûêC++ÁöÑclassÊó∂ÔºåÊú¨‰π¶51.1.5ËäÇ‰∏≠ËÆ≤Âà∞ÁöÑRTTIÊï∞ÊçÆÂèØËÉΩÂ∞±ÊòØÂàÜÊûêÁöÑÈáçÁÇπ„ÄÇ</p>
</li>
<li>
<p>Âú®ÂçÅÂÖ≠ËøõÂà∂ÁöÑÁºñËæëÂô®ÈáåÔºå16‰Ωç/32‰Ωç/64‰ΩçÊï∞ÊçÆÊï∞ÁªÑÁöÑÁâπÂæÅÂçÅÂàÜÊòéÊòæ„ÄÇÊú¨ËäÇ‰ª•‰∏Ä‰∏™ÂæàÁÆÄÂçïÁöÑMIPSÁ®ãÂ∫è‰∏∫‰æã„ÄÇÂâçÊñá‰ªãÁªçËøáÔºöÊØè‰∏™MIPSÊåá‰ª§ÈÉΩÊòØÊï¥ÈΩêÁöÑ32‰ΩçÔºàÂç≥4Â≠óËäÇÔºâÊåá‰ª§„ÄÇÂΩìÁÑ∂ARMÊ®°ÂºèÊàñËÄÖARM64Ê®°ÂºèÁöÑÁ®ãÂ∫è‰πüÊúâËøô‰∏™ÁâπÁÇπ„ÄÇÂõ†Ê≠§ÔºåÂú®ÂΩ¢Âºè‰∏äËøô‰∫õÁ®ãÂ∫èÁöÑÊåá‰ª§ÈÉΩÊûÑÊàê‰∫ÜÊüêÁßç32‰ΩçÊï∞ÁªÑ„ÄÇ</p>
</li>
<li>
<p>ÂÜÖÂ≠ò‚ÄúÂø´ÁÖß‚ÄùÁöÑÂØπÊØîÊäÄÊúØÂèØ‰ª•Âá∏ÊòæÂá∫ÂÜÖÂ≠ò‰∏≠ÂèòÂåñÁöÑÊï∞ÊçÆ</p>
<p>ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®<code>CheatEngine</code></p>
</li>
<li>
<p>Âú®ÂÆâË£Ö‰∏Ä‰∏™Á®ãÂ∫è‰ª•ÂêéÔºåÊàë‰ª¨Â∞±ËÉΩÊØîÂØπÂÆâË£ÖÂâçÂêéWindowsÁöÑÊ≥®ÂÜåË°®„ÄÇËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏ÊµÅË°åÁöÑÊñπÊ≥ïÔºåÂèØ‰ª•Áî®Êù•Á°ÆËÆ§ÁâπÂÆöÁ®ãÂ∫è‰ΩøÁî®‰∫ÜÂì™‰∫õÊ≥®ÂÜåË°®ÈîÆÂÄº„ÄÇËøô‰πüËÆ∏Â∞±ÊòØ‚ÄúWindowsÊ≥®ÂÜåË°®Ê∏ÖÁêÜ‚ÄùÁ®ãÂ∫èÈ¢á‰∏∫ÊµÅË°åÁöÑÂéüÂõ†„ÄÇ</p>
</li>
</ul>
<h2 id="part6-Êìç‰ΩúÁ≥ªÁªüÁõ∏ÂÖ≥"><a class="markdownIt-Anchor" href="#part6-Êìç‰ΩúÁ≥ªÁªüÁõ∏ÂÖ≥"></a> Part.6 Êìç‰ΩúÁ≥ªÁªüÁõ∏ÂÖ≥</h2>
<h3 id="chap64ÂèÇÊï∞ÁöÑ‰º†ÈÄíÊñπÊ≥ï"><a class="markdownIt-Anchor" href="#chap64ÂèÇÊï∞ÁöÑ‰º†ÈÄíÊñπÊ≥ï"></a> Chap64.ÂèÇÊï∞ÁöÑ‰º†ÈÄíÊñπÊ≥ï</h3>
<h4 id="cdecl"><a class="markdownIt-Anchor" href="#cdecl"></a> cdecl</h4>
<ul>
<li>
<p>C/C++ÊúÄÂ∏∏‰ΩøÁî®ÁöÑÂèÇÊï∞‰º†ÈÄíÊñπÊ≥ï</p>
</li>
<li>
<p>ÂèÇÊï∞‰ªéÂè≥ÂæÄÂ∑¶‰º†ÈÄí</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push arg3
push arg2
push arg1
call function
add <span class="token register variable">esp</span>.<span class="token number">12</span><span class="token comment">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h4 id="stdcall"><a class="markdownIt-Anchor" href="#stdcall"></a> stdcall</h4>
<p>‰∏é<code>cdecl</code>ËßÑËåÉÁ±ª‰ºº</p>
<p>‰∏çËøáË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞Âú®ËøîÂõû‰πãÂâç‰ºöÊåáÂêë<code>ret x</code>Êù•ËøòÂéüÂèÇÊï∞Ê†à</p>
<p>‰∏çÈúÄË¶ÅÂú®‰ΩøÁî®ÂáΩÊï∞Âêé<code>add esp,x</code></p>
<p>ËøôÈáåÁöÑ<code>x=ÂèÇÊï∞‰∏™Êï∞*ÊåáÈíàÂ§ßÂ∞è</code></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push arg3
push arg2
push arg1
call function
<span class="token label function">function:</span>
...do something...
ret <span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Ê≠§Á±ªÁ∫¶ÂÆöÂú®Win32ÁöÑÊ†áÂáÜÂ∫ìÊñá‰ª∂‰∏≠ÂçÅÂàÜÂ∏∏ËßÅ„ÄÇÁÑ∂ËÄåÂõ†‰∏∫Win64Á≥ªÁªüÈÅµÂæ™Ë∞ÉÁî®Á∫¶ÂÆöÁöÑÊòØWin64ËßÑËåÉÔºåÊâÄ‰ª•Win64ÁöÑÂ∫ìÊñá‰ª∂Èáå‰∏ç‰ºöÂá∫Áé∞stdcallÁöÑÊ†áÂøóÊÄßÊìç‰ΩúÊåá‰ª§„ÄÇ</p>
<hr />
<p>Â¶ÇÊûúprintf()ÂáΩÊï∞ÂΩìÁúüÈááÂèñ‰∫ÜstdcallËßÑËåÉ„ÄÅÊ†πÊçÆÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÁªüËÆ°ÂèòÂèÇÁöÑÊï∞ÈáèÂπ∂‰∏îÂú®ÂáΩÊï∞Â∞æÂ£∞ÊÅ¢Â§çÊ†àÊåáÈíàÔºåÈÇ£‰πàËøôÁßçÂ±ÄÈù¢Â∞±ÂçÅÂàÜÂç±Èô©‰∫ÜÔºö‰∏á‰∏ÄÁ®ãÂ∫èÂëòÊâìÈîô‰∫ÜÂá†‰∏™Â≠óÊØçÔºåÁ®ãÂ∫èÂ∞±‰ºöÂ¥©Ê∫É„ÄÇÁî±Ê≠§ÂèØÁü•ÔºåÂØπ‰∫éÈÇ£‰∫õÂ∏¶ÊúâÂèØÂèòÂèÇÊï∞ÁöÑÂáΩÊï∞ËÄåË®ÄÔºåcdeclËßÑËåÉË¶ÅÊØîstdcallËßÑËåÉÊõ¥Â•Ω‰∏Ä‰∫õ„ÄÇ</p>
<h4 id="fastcall"><a class="markdownIt-Anchor" href="#fastcall"></a> fastcall</h4>
<p>Ëøô‰∏™Ë∞ÉÁî®Á∫¶ÂÆö‰ºòÂÖà‰ΩøÁî®ÂØÑÂ≠òÂô®‰º†ÈÄíÂèÇÊï∞ÔºåÊó†Ê≥ïÈÄöËøáÂØÑÂ≠òÂô®‰º†ÈÄíÁöÑÂèÇÊï∞ÂàôÈÄöËøáÊ†à‰º†ÈÄíÁªôË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞„ÄÇÂõ†‰∏∫fastcallÁ∫¶ÂÆöÂú®ÂÜÖÂ≠òÊ†àÊñπÈù¢ÁöÑËÆøÈóÆÂéãÂäõÊØîËæÉÂ∞èÔºåÊâÄ‰ª•Âú®Êó©ÊúüÁöÑCPUÂπ≥Âè∞‰∏äÈÅµÂæ™fastcallËßÑËåÉÁöÑÁ®ãÂ∫è‰ºöÊØîÈÅµÂæ™stdcallÂíåcdeclËßÑËåÉÁöÑÁ®ãÂ∫èÊÄßËÉΩÊõ¥È´ò„ÄÇ‰ΩÜÊòØÂú®Áé∞Âú®ÁöÑ„ÄÅÊõ¥‰∏∫Â§çÊùÇÁöÑCPUÂπ≥Âè∞‰∏äÔºåfastcallËßÑËåÉÁöÑÊÄßËÉΩ‰ºòÂäøÂ∞±‰∏çÈÇ£‰πàÊòéÊòæ‰∫Ü„ÄÇ</p>
<p>‰∏çÁÆ°ÊòØMSVCËøòÊòØGCCÈÉΩ‰ΩøÁî®ECXÂíåEDX‰º†ÈÄíÁ¨¨‰∏Ä‰∏™ÂíåÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÔºåÁî®Ê†à‰º†ÈÄíÂÖ∂‰ΩôÁöÑÂèÇÊï∞„ÄÇÊ≠§Â§ñÔºåÂ∫îÁî±Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞Ë∞ÉÊï¥Ê†àÊåáÈíà„ÄÅÊääÂèÇÊï∞Ê†àÊÅ¢Â§çÂà∞Ë∞ÉÁî®‰πãÂâçÁöÑÂàùÂßãÁä∂ÊÄÅÔºàËøô‰∏ÄÁÇπ‰∏éstdcallÁ±ª‰ººÔºâ„ÄÇ</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">push arg3
mov <span class="token register variable">edx</span>, arg2
mov <span class="token register variable">ecx</span>, arg1
call function

<span class="token label function">function:</span>
.. do something ..
ret <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="thiscall"><a class="markdownIt-Anchor" href="#thiscall"></a> thiscall</h4>
<p>ËøôÊòØ‰∏ÄÁßçÊñπ‰æøC++Á±ªÊàêÂëòË∞ÉÁî®thisÊåáÈíàËÄåÁâπÂà´ËÆæÂÆöÁöÑË∞ÉÁî®ËßÑËåÉ„ÄÇ</p>
<p>MSVC‰ΩøÁî®ECXÂØÑÂ≠òÂô®‰º†ÈÄíthisÊåáÈíà„ÄÇ</p>
<p>ËÄåGCCÂàôÊääthisÊåáÈíà‰Ωú‰∏∫Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰º†ÈÄí„ÄÇÂú®Ê±áÁºñÂ±ÇÈù¢ÔºåËøô‰∏™ÊåáÈíàÊòæËÄåÊòìËßÅÔºöÊâÄÊúâÁöÑÁ±ªÂáΩÊï∞ÈÉΩÊØîÊ∫ê‰ª£Á†ÅÂ§öÂá∫Êù•‰∏Ä‰∏™ÂèÇÊï∞„ÄÇ</p>
<h4 id="64‰Ωç‰∏ãÁöÑx86"><a class="markdownIt-Anchor" href="#64‰Ωç‰∏ãÁöÑx86"></a> 64‰Ωç‰∏ãÁöÑx86</h4>
<p>64‰ΩçÁéØÂ¢É‰∏ãÁöÑÂèÇÊï∞‰º†ÈÄíÊñπÊ≥ïÂú®ÊüêÁßçÁ®ãÂ∫¶‰∏ä‰∏éfastcallÂáΩÊï∞ÊØîËæÉÁ±ª‰ººÔºöÂ§¥Âõõ‰∏™ÂèÇÊï∞Áî±ÂØÑÂ≠òÂô®<strong>RCX„ÄÅRDX„ÄÅR8ÂíåR9</strong>‰º†ÈÄíÔºåËÄå<strong>ÂÖ∂‰ΩôÁöÑÂèÇÊï∞ÈÉΩÈÄöËøáÊ†àÊù•‰º†ÈÄí</strong>„ÄÇË∞ÉÁî®ÊñπÂáΩÊï∞ÂøÖÈ°ªÈ¢ÑÁïô32‰∏™Â≠óËäÇÊàñËÄÖ4‰∏™64‰ΩçÁöÑÂ≠òÂÇ®Á©∫Èó¥Ôºå‰ª•‰æøË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞‰øùÂ≠òÂ§¥Âõõ‰∏™ÂèÇÊï∞„ÄÇÂ∞èÂûãÂáΩÊï∞ÂèØ‰ª•‰ªÖÂá≠ÂØÑÂ≠òÂô®Â∞±Ëé∑ÂèñÊâÄÊúâÂèÇÊï∞ÔºåËÄåÂ§ßÂûãÂáΩÊï∞Â∞±ÂèØËÉΩÈúÄË¶Å‰øùÂ≠òËøô‰∫õ‰º†ÈÄíÂèÇÊï∞ÁöÑÂØÑÂ≠òÂô®ÔºåÊääÂÆÉ‰ª¨ËÖæÊå™Âá∫Êù•‰æõÂêéÁª≠Êåá‰ª§Ë∞ÉÁî®„ÄÇ</p>
<p>Ë∞ÉÁî®ÊñπÂáΩÊï∞Ë¥üË¥£Ë∞ÉÊï¥Ê†àÊåáÈíàÂà∞ÂÖ∂ÂàùÂßãÁä∂ÊÄÅ„ÄÇ</p>
<p>Ê≠§Â§ñÔºåWindows x86-64Á≥ªÁªüÁöÑDLLÊñá‰ª∂‰πüÈááÁî®‰∫ÜËøôÁßçË∞ÉÁî®ËßÑËåÉ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåËôΩÁÑ∂Win32Á≥ªÁªüAPIÈÅµÂæ™ÁöÑÊòØstdcallËßÑËåÉÔºå‰ΩÜÊòØWin64Á≥ªÁªüÈÅµÂæ™ÁöÑÊòØWin64ËßÑËåÉ„ÄÅ‰∏çÂÜç‰ΩøÁî®stdcallËßÑËåÉ„ÄÇ</p>
<h4 id="64‰Ωç‰∏ãlinux"><a class="markdownIt-Anchor" href="#64‰Ωç‰∏ãlinux"></a> 64‰Ωç‰∏ãLinux</h4>
<p>64‰ΩçLinuxÁ®ãÂ∫è‰º†ÈÄíÂèÇÊï∞ÁöÑÊñπÊ≥ïÂíå64‰ΩçWindowsÁ®ãÂ∫èÁöÑ‰º†ÈÄíÊñπÊ≥ïÂá†‰πéÁõ∏Âêå„ÄÇÂå∫Âà´Âú®‰∫éÔºå<strong>64‰ΩçLinuxÁ®ãÂ∫è‰ΩøÁî®6‰∏™ÂØÑÂ≠òÂô®ÔºàRDI„ÄÅRSI„ÄÅRDX„ÄÅRCX„ÄÅR8„ÄÅR9Ôºâ‰º†ÈÄíÂâçÂá†È°πÂèÇÊï∞ÔºåËÄå64‰ΩçWindowsÂàôÂè™Âà©Áî®4‰∏™ÂØÑÂ≠òÂô®‰º†ÈÄíÂèÇÊï∞</strong>„ÄÇÂè¶Â§ñÔºå64‰ΩçLinuxÁ®ãÂ∫èÊ≤°Êúâ‰∏äÈù¢ÊèêÂà∞ÁöÑ‚ÄúÈõ∂Êï£Á©∫Èó¥‚ÄùËøôÁßçÊ¶ÇÂøµ„ÄÇÂ¶ÇÊûúË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÁöÑÂØÑÂ≠òÂô®Êï∞ÈáèÁ¥ßÂº†ÔºåÂÆÉÂ∞±ÂèØ‰ª•Áî®<strong>Ê†àÂ≠òÂÇ®Â§ñÊù•ÂèÇ</strong>Êï∞ÔºåÊääÁõ∏ÂÖ≥ÂØÑÂ≠òÂô®ËÖæÂá∫Êù•‰ΩøÁî®„ÄÇ</p>
<p>Êìç‰ΩúEAXÂØÑÂ≠òÂô®ÁöÑÊó∂ÂÄôÔºåÂÆÉÂè™ÊääÊï∞ÊçÆÂÜôÂà∞‰∫ÜRAXÂØÑÂ≠òÂô®ÁöÑ‰Ωé32‰ΩçÔºàÂç≥EAXÔºâËÄåÊ≤°ÊúâÁõ¥Êé•Êìç‰ΩúÊï¥‰∏™64‰ΩçRAXÂØÑÂ≠òÂô®„ÄÇËøôÊòØÂõ†‰∏∫ÔºöÂú®Êìç‰ΩúÂØÑÂ≠òÂô®ÁöÑ‰Ωé32‰ΩçÁöÑÊó∂ÂÄôÔºåËØ•ÂØÑÂ≠òÂô®ÁöÑÈ´ò32‰Ωç‰ºöË¢´Ëá™Âä®Ê∏ÖÈõ∂„ÄÇ</p>
<h4 id="ÂçïÂèåÁ≤æÂ∫¶ÂûãËøîÂõûÂÄº"><a class="markdownIt-Anchor" href="#ÂçïÂèåÁ≤æÂ∫¶ÂûãËøîÂõûÂÄº"></a> ÂçïÂèåÁ≤æÂ∫¶ÂûãËøîÂõûÂÄº</h4>
<p>Èô§‰∫ÜWin64ËßÑËåÉ‰ª•Â§ñÁöÑÊâÄÊúâÁöÑË∞ÉÁî®ËßÑËåÉÈÉΩËßÑÂÆöÔºöÂΩìËøîÂõûÂÄº‰∏∫Âçï/ÂèåÁ≤æÂ∫¶ÊµÆÁÇπÂûãÊï∞ÊçÆÊó∂ÔºåË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞Â∫îÂΩìÈÄöËøá<strong>FPUÂØÑÂ≠òÂô®ST(0)‰º†ÈÄíËøîÂõûÂÄº</strong>„ÄÇËÄåWin64ËßÑËåÉËßÑÂÆöÔºöË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞Â∫îÂΩì**ÈÄöËøáXMM0ÂØÑÂ≠òÂô®ÁöÑ‰Ωé32‰ΩçÔºàfloatÔºâÊàñ‰Ωé64‰ΩçÂØÑÂ≠òÂô®ÔºàdoubleÔºâ**ËøîÂõûÂçï/ÂèåÁ≤æÂ∫¶ÊµÆÁÇπÂûãÊï∞ÊçÆ„ÄÇ</p>
<h4 id="‰øÆÊîπÂèÇÊï∞"><a class="markdownIt-Anchor" href="#‰øÆÊîπÂèÇÊï∞"></a> ‰øÆÊîπÂèÇÊï∞</h4>
<p>Â¶ÇÊûúË¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞‰øÆÊîπ‰∫ÜÂ§ñÊù•ÂèÇÊï∞ÁöÑÂÄºÔºåÂ∞Ü‰ºöÂèëÁîü‰ªÄ‰πàÊÉÖÂÜµÔºüÁ≠îÊ°àÂçÅÂàÜÁÆÄÂçïÔºö<strong>Â§ñÊù•ÂèÇÊï∞ÈÉΩÊòØÈÄöËøáÊ†à‰º†ÈÄíÁöÑ</strong>ÔºåÂõ†Ê≠§<strong>Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞‰øÆÊîπÁöÑÊòØÊ†àÈáåÁöÑÊï∞ÊçÆ</strong>„ÄÇÂú®Ë¢´Ë∞ÉÁî®ÊñπÂáΩÊï∞ÈÄÄÂá∫‰ª•ÂêéÔºåË∞ÉÁî®ÊñπÂáΩÊï∞‰∏ç‰ºöÂÜçËÆøÈóÆËá™Â∑±‰º†ÈÄíÁªôÂà´‰∫∫ÁöÑÂèÇÊï∞„ÄÇ</p>
<h4 id="ÊåáÈíàÂûãÂáΩÊï∞ÂèÇÊï∞"><a class="markdownIt-Anchor" href="#ÊåáÈíàÂûãÂáΩÊï∞ÂèÇÊï∞"></a> ÊåáÈíàÂûãÂáΩÊï∞ÂèÇÊï∞</h4>
<p>ÂèòÈáèaÁöÑÂú∞ÂùÄÈÄöËøáÊ†à‰º†ÈÄíÁªô‰∫Ü‰∏Ä‰∏™ÂáΩÊï∞ÔºåÁÑ∂ÂêéËøô‰∏™Âú∞ÂùÄÂèàË¢´‰º†ÈÄíÁªô‰∫ÜÂè¶Â§ñ‰∏Ä‰∏™ÂáΩÊï∞„ÄÇÁ¨¨‰∏Ä‰∏™ÂáΩÊï∞‰øÆÊîπ‰∫ÜÂèòÈáèaÁöÑÂÄºÔºåËÄåÂêéprintf()ÂáΩÊï∞Ëé∑ÂèñÂà∞‰∫ÜËøô‰∏™‰øÆÊîπÂêéÁöÑÂèòÈáèÂÄº„ÄÇ</p>
<h3 id="chap65-Á∫øÁ®ãÊú¨Âú∞Â≠òÂÇ®tls"><a class="markdownIt-Anchor" href="#chap65-Á∫øÁ®ãÊú¨Âú∞Â≠òÂÇ®tls"></a> Chap65 Á∫øÁ®ãÊú¨Âú∞Â≠òÂÇ®TLS</h3>
<p><strong>Á∫øÁ®ãÊú¨Âú∞Â≠òÂÇ®ÔºàThread Local StorageÔºåTLSÔºâÊòØ‰∏ÄÁßçÂú®Á∫øÁ®ãÂÜÖÈÉ®ÂÖ±‰∫´Êï∞ÊçÆÁöÑÊï∞ÊçÆ‰∫§Êç¢Âå∫Âüü</strong>„ÄÇÊØè‰∏™Á∫øÁ®ãÈÉΩÂèØ‰ª•Âú®Ëøô‰∏™Âå∫Âüü‰øùÂ≠òÂÆÉ‰ª¨Ë¶ÅÂú®ÂÜÖÈÉ®ÂÖ±‰∫´ÁöÑÊï∞ÊçÆ„ÄÇ‰∏Ä‰∏™ÊØîËæÉÁü•ÂêçÁöÑ‰æãÂ≠êÊòØCËØ≠Ë®ÄÁöÑÂÖ®Â±ÄÂèòÈáèerrno„ÄÇÂØπ‰∫éerrnoËøôÁ±ªÁöÑÂÖ®Â±ÄÂèòÈáèÊù•ËØ¥ÔºåÂ¶ÇÊûúÂ§öÁ∫øÁ®ãËøõÁ®ãÁöÑÊüê‰∏Ä‰∏™Á∫øÁ®ãÂØπÂÖ∂ËøõË°å‰∫Ü‰øÆÊîπÔºåÈÇ£‰πàËøô‰∏™ÂèòÈáèÂ∞±‰ºöÂΩ±ÂìçÂà∞ÂÖ∂‰ªñÊâÄÊúâÁöÑÁ∫øÁ®ã„ÄÇËøôÊòæÁÑ∂ÂíåÂÆûÈôÖÈúÄÊ±ÇÁõ∏ÊÇñÔºåÂõ†Ê≠§ÂÖ®Â±ÄÂèòÈáèerrnoÂøÖÈ°ª‰øùÂ≠òÂú®TLS‰∏≠„ÄÇ</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread></span></span>

<span class="token keyword">thread_local</span> <span class="token keyword">int</span> tmp<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> tmp <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Âú®ÂàÜÊûêÂèØÊâßË°åÊñá‰ª∂ÁöÑPEÂ§¥‰πãÂêéÂ∞±‰ºöÂèëÁé∞ÔºåÂèòÈáètmpË¢´ÂàÜÈÖçÂà∞TLS‰∏ìÁî®ÁöÑÊï∞ÊçÆ‰øùÂ≠òÂå∫Âüü‰∫Ü</p>
<h4 id="tlsÂõûË∞É"><a class="markdownIt-Anchor" href="#tlsÂõûË∞É"></a> TLSÂõûË∞É</h4>
<p>ÈöèÊú∫Êï∞ÂèëÁîüÂô®Âè™ÊúâÂú®Ê≠£Á°ÆÂàùÂßãÂåñ‰πãÂêéÊâç‰ºöÁîüÊàêÁúüÂÆûÊÑè‰πâ‰∏äÁöÑÈöèÊú∫Êï∞ÔºåËÄå‰∏çÊòØ1234ËøôÊ†∑ÁöÑÂõ∫ÂÆöÂÄº„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•ÈááÁî®TLSÂõûË∞É„ÄÇ</p>
<p>ÂÆÉÂè™ÊòØÊûÑÈÄ†‰∏Ä‰∏™Âú®<strong>ËøõÁ®ã/Á∫øÁ®ãÂêØÂä®ÂâçÂ∞±Ë¢´Á≥ªÁªüË∞ÉÁî®</strong>ÁöÑÂõûË∞ÉÂáΩÊï∞Ôºàtls_callback()Ôºâ</p>
<h3 id="chap66Á≥ªÁªüË∞ÉÁî®"><a class="markdownIt-Anchor" href="#chap66Á≥ªÁªüË∞ÉÁî®"></a> Chap66Á≥ªÁªüË∞ÉÁî®</h3>
<p>ÊâÄÊúâÂú®Êìç‰ΩúÁ≥ªÁªü‰∏≠ËøêË°åÁöÑËøõÁ®ãÂèØ‰ª•ÂàÜÊàê‰∏§Á±ªÔºö‰∏ÄÁ±ªËøõÁ®ãÂØπÂÖ∑ÊúâÁ°¨‰ª∂ÁöÑÂÖ®ÈÉ®ËÆøÈóÆÊùÉÈôêÔºåËøêË°å‰∫éÂÜÖÊ†∏Á©∫Èó¥Ôºàkernel spaceÔºâÔºõÂè¶‰∏ÄÁ±ªËøõÁ®ã‰∏çËÉΩÁõ¥Êé•ËÆøÈóÆÁ°¨‰ª∂Âú∞ÂùÄÔºåËøêË°å‰∫éÁî®Êà∑Á©∫Èó¥Ôºàuser spaceÔºâ„ÄÇ</p>
<p>Áî±Êìç‰ΩúÁ≥ªÁªüÊèê‰æõÁöÑÁ≥ªÁªüË∞ÉÁî®ÔºàsyscallÔºâÊûÑÊàê‰∫Üring0Âíåring 3‰πãÈó¥ÁöÑËÆøÈóÆÊú∫Âà∂„ÄÇÂèØ‰ª•ËØ¥ÔºåÁ≥ªÁªüË∞ÉÁî®Â∞±ÊòØÊìç‰ΩúÁ≥ªÁªü‰∏∫Â∫îÁî®Á®ãÂ∫èÊèê‰æõÁöÑÂ∫îÁî®ÁºñÁ®ãÊé•Âè£API„ÄÇ</p>
<p><strong>ËÆ°ÁÆóÊú∫ÁóÖÊØí‰ª•ÂèäshellcodeÂ§ßÂ§öÈÉΩ‰ºöÂà©Áî®Á≥ªÁªüË∞ÉÁî®„ÄÇËøôÊòØÂõ†‰∏∫Á≥ªÁªüÂ∫ìÂáΩÊï∞ÁöÑÂØªÂùÄËøáÁ®ãÂçÅÂàÜÈ∫ªÁÉ¶ÔºåËÄåÁõ¥Êé•Ë∞ÉÁî®Á≥ªÁªüË∞ÉÁî®Âç¥Áõ∏ÂØπÁÆÄÂçï</strong>„ÄÇËôΩÁÑ∂Á≥ªÁªüË∞ÉÁî®ÁöÑËÆøÈóÆËøáÁ®ãÂπ∂‰∏çÈ∫ªÁÉ¶Ôºå‰ΩÜÊòØÁî±‰∫é<strong>Á≥ªÁªüË∞ÉÁî®Êú¨Ë∫´Â±û‰∫éÂ∫ïÂ±ÇAPI</strong>ÔºåÂõ†Ê≠§Áõ¥Êé•‰ΩøÁî®Á≥ªÁªüË∞ÉÁî®ÁöÑÁ®ãÂ∫è‰πü‰∏çÂ•ΩÂÜô„ÄÇÂè¶Â§ñÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºöÁ≥ªÁªüË∞ÉÁî®ÁöÑÊÄªÊï∞Áî±Êìç‰ΩúÁ≥ªÁªüÂíåÁ≥ªÁªüÁâàÊú¨‰∏§‰∏™Âõ†Á¥†ÂÖ±ÂêåÂÜ≥ÂÆöÁöÑ„ÄÇ</p>
<h4 id="linux"><a class="markdownIt-Anchor" href="#linux"></a> linux</h4>
<p>LinuxÁ®ãÂ∫èÈÄöÂ∏∏ÈÄöËøá<strong>80Âè∑‰∏≠Êñ≠/INT 80Ë∞ÉÁî®Á≥ªÁªüË∞ÉÁî®</strong>„ÄÇÂú®Ë∞ÉÁî®Á≥ªÁªüË∞ÉÁî®Êó∂ÔºåÁ®ãÂ∫èÂ∫îÂΩìÈÄöËøá<strong>EAXÂØÑÂ≠òÂô®ÊåáÂÆöË¢´Ë∞ÉÁî®ÂáΩÊï∞ÁöÑÁºñÂè∑</strong>ÔºåÂÜç‰Ωø<strong>Áî®ÂÖ∂‰ªñÂØÑÂ≠òÂô®Â£∞ÊòéÁ≥ªÁªüË∞ÉÁî®ÁöÑÂèÇÊï∞„ÄÇ</strong></p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token keyword">section .text</span>
<span class="token keyword">global _start</span>

<span class="token label function">_start:</span>
        mov     <span class="token register variable">edx</span>,len <span class="token comment">; buffer len</span>
        mov     <span class="token register variable">ecx</span>,msg <span class="token comment">; buffer</span>
        mov     <span class="token register variable">ebx</span>,<span class="token number">1</span>   <span class="token comment">; file descriptor. 1 is for stdout</span>
        mov     <span class="token register variable">eax</span>,<span class="token number">4</span>   <span class="token comment">; syscall number. 4 is for sys_write</span>
        int     <span class="token number">0x80</span>

        mov     <span class="token register variable">eax</span>,<span class="token number">1</span>   <span class="token comment">; syscall number. 4 is for sys_exit</span>
        int     <span class="token number">0x80</span>

<span class="token keyword">section .data</span>

msg     db  <span class="token string">'Hello, world!'</span>,<span class="token number">0xa</span>
len     equ <span class="token operator">$</span> <span class="token operator">-</span> msg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tcctw/p/11450449.html">LinuxÁ≥ªÁªüË∞ÉÁî®Ë°®Ôºàx86_64Ôºâ - ‰∏ÄÂ∑ùofficial - ÂçöÂÆ¢Âõ≠ (cnblogs.com)</a></p>
<h4 id="windows"><a class="markdownIt-Anchor" href="#windows"></a> windows</h4>
<p>WindowsÁ®ãÂ∫èÂèØÈÄöËøá0x2eÂè∑‰∏≠Êñ≠/int 0x2e„ÄÅÊàñx86‰∏ìÁî®Êåá‰ª§SYSENTERËÆøÈóÆÁ≥ªÁªüË∞ÉÁî®„ÄÇ</p>
<p>ËøôÈáå‰ΩøÁî®ÁöÑ‰∏≠Êñ≠Êï∞ÊòØ0x2eÔºåÊàñËÄÖÈááÁî®x86‰∏ãÁöÑÁâπÊÆäÊåá‰ª§SYSENTER„ÄÇ</p>
<p><a target="_blank" rel="noopener" href="https://www.bytezonex.com/archives/wg1rxeFZ.html">Ê∑±ÂÖ•ÊµÖÂá∫Ôºö64 ‰Ωç Windows ‰∏≠Ê±áÁºñÁ≥ªÁªüË∞ÉÁî®ÁöÑÂ••Áßò - ByteZoneXÁ§æÂå∫</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/j00ru/windows-syscalls">j00ru/windows-syscalls: Windows System Call Tables (NT/2000/XP/2003/Vista/7/8/10/11) (github.com)</a></p>
<h3 id="chap67-linux"><a class="markdownIt-Anchor" href="#chap67-linux"></a> Chap67 Linux</h3>
<h4 id="‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑ‰ª£Á†Å"><a class="markdownIt-Anchor" href="#‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑ‰ª£Á†Å"></a> ‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑ‰ª£Á†Å</h4>
<p>Âú®ÂàÜÊûêLinuxÂÖ±‰∫´Â∫ìÊñá‰ª∂ÔºàÊâ©Â±ïÂêçÊòØsoÔºâÊó∂ÔºåÊàë‰ª¨ÁªèÂ∏∏‰ºöÈÅáÂà∞ÂÖ∑Êúâ‰∏ãËø∞ÁâπÂæÅÁöÑÊåá‰ª§‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token label function">.text:</span>0012D5E3 __x86_get_pc_thunk_bx proc near            <span class="token comment">; CODE XREF: sub_17350+3</span>
<span class="token label function">.text:</span>0012D5E3                                            <span class="token comment">; sub_173CC+4 ...</span>
<span class="token label function">.text:</span>0012D5E3                 mov    <span class="token register variable">ebx</span>, <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">]</span>
<span class="token label function">.text:</span>0012D5E6                 retn
<span class="token label function">.text:</span>0012D5E6 __x86_get_pc_thunk_bx endp

...

<span class="token label function">.text:</span>000576C0 sub_576C0       proc near                  <span class="token comment">; CODE XREF: tmpfile+73</span>

...

<span class="token label function">.text:</span>000576C0                 push    <span class="token register variable">ebp</span>
<span class="token label function">.text:</span>000576C1                 mov     <span class="token register variable">ecx</span>, large <span class="token register variable">gs</span>:<span class="token number">0</span>
<span class="token label function">.text:</span>000576C8                 push    <span class="token register variable">edi</span>
<span class="token label function">.text:</span>000576C9                 push    <span class="token register variable">esi</span>
<span class="token label function">.text:</span>000576CA                 push    <span class="token register variable">ebx</span>
<span class="token label function">.text:</span>000576CB                 call    __x86_get_pc_thunk_bx
<span class="token label function">.text:</span>000576D0                 add     <span class="token register variable">ebx</span>, <span class="token number">157930h</span>
<span class="token label function">.text:</span>000576D6                 sub     <span class="token register variable">esp</span>, <span class="token number">9Ch</span>

...

<span class="token label function">.text:</span>000579F0                 lea     <span class="token register variable">eax</span>, (a__gen_tempname <span class="token operator">-</span> <span class="token number">1AF000h</span>)<span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">]</span> <span class="token comment">; "__gen_tempname"</span>
<span class="token label function">.text:</span>000579F6                 mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">0ACh</span><span class="token operator">+</span>var_A0<span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token label function">.text:</span>000579FA                 lea     <span class="token register variable">eax</span>, (a__SysdepsPosix <span class="token operator">-</span> <span class="token number">1AF000h</span>)<span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">]</span> <span class="token comment">; "../sysdeps/posix/tempname.c"</span>
<span class="token label function">.text:</span>00057A00                 mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">0ACh</span><span class="token operator">+</span>var_A8<span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token label function">.text:</span>00057A04                 lea     <span class="token register variable">eax</span>, (aInvalidKindIn_ <span class="token operator">-</span> <span class="token number">1AF000h</span>)<span class="token operator">[</span><span class="token register variable">ebx</span><span class="token operator">]</span> <span class="token comment">; "! \"invalid ‚Üô</span>
    ‚Üò KIND in __gen_tempname\<span class="token string">""</span>
<span class="token label function">.text:</span>00057A0A                 mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">0ACh</span><span class="token operator">+</span>var_A4<span class="token operator">]</span>, <span class="token number">14Ah</span>
<span class="token label function">.text:</span>00057A12                 mov     <span class="token operator">[</span><span class="token register variable">esp</span><span class="token operator">+</span><span class="token number">0ACh</span><span class="token operator">+</span>var_AC<span class="token operator">]</span>, <span class="token register variable">eax</span>
<span class="token label function">.text:</span>00057A15                 call    __assert_fail<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊâÄÊúâÂ≠óÁ¨¶‰∏≤ÊåáÈíàÈÉΩË¢´‰∏Ä‰∫õÂ∏∏Êï∞‰øÆÊ≠£ËøáÔºåÂπ∂‰∏îÁõ∏ÂÖ≥ÂáΩÊï∞ÈÉΩÂú®ÂºÄÂßãÁöÑÂá†Êù°Êåá‰ª§ÈáåÈáçÊñ∞Ë∞ÉÊï¥EBX‰∏≠ÁöÑÂÄº„ÄÇ</p>
<p>ËøôÁ±ªÊåá‰ª§Áß∞‰Ωú‚Äú‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑ‰ª£Á†ÅPICÔºàPosition Independent CodeÔºâ‚Äù</p>
<p>Âõ†‰∏∫ËøõÁ®ãÊàñÂØπË±°‰ºöË¢´Êìç‰ΩúÁ≥ªÁªüÁöÑÈìæÊé•Âô®Âä†ËΩΩÂà∞‰ªªÊÑèÂÜÖÂ≠òÂú∞ÂùÄÔºåÊâÄ‰ª•‰ª£Á†ÅÈáåÁöÑÊåá‰ª§Êó†Ê≥ïÁõ¥Êé•Á°ÆÂÆöÔºàhardcodedÔºâÁªùÂØπÂÜÖÂ≠òÂú∞ÂùÄ„ÄÇ</p>
<p><strong>WindowsÁöÑDLLÂä†ËΩΩÊú∫Âà∂‰∏çÊòØPICÊú∫Âà∂„ÄÇÂ¶ÇÊûúWindowsÂä†ËΩΩÂô®Ë¶ÅÊääDLLÂä†ËΩΩÂà∞Âè¶Â§ñ‰∏Ä‰∏™Âü∫Âú∞ÂùÄÔºåÂÆÉÂ∞±‰ºöÂÜÖÂ≠ò‰∏≠ÂØπDLLËøõË°å‚Äú‰øÆË°•‚ÄùÂ§ÑÁêÜÔºàÈáçÂÆö‰ΩçÊäÄÊúØÔºâÔºå‰ªéËÄåÂèØ‰ª•Ê≠£Á°ÆÂú∞Â§ÑÁêÜÊâÄÊúâÁ¨¶Âè∑Âú∞ÂùÄ„ÄÇËøôÂ∞±ÊÑèÂë≥ÁùÄÂ§ö‰∏™WindowsËøõÁ®ãÊó†Ê≥ïÂú®‰∏çÂêåËøõÁ®ãÂÜÖÂ≠òÂùóÁöÑ‰∏çÂêåÂú∞ÂùÄÂÖ±‰∫´‰∏Ä‰ªΩDLLÔºåÂõ†‰∏∫ÊØè‰∏™Ë¢´Âä†ËΩΩÂú®ÂÜÖÂ≠òÈáåÁöÑÂÆû‰æãÂè™ËÉΩËÆøÈóÆËá™Â∑±ÁöÑÂú∞ÂùÄÁ©∫Èó¥„ÄÇ</strong></p>
<h4 id="ld_preload"><a class="markdownIt-Anchor" href="#ld_preload"></a> LD_PRELOAD</h4>
<p>LinuxÁ®ãÂ∫èÂèØ‰ª•Âä†ËΩΩÂÖ∂‰ªñÂä®ÊÄÅÂ∫ì‰πãÂâç„ÄÅÁîöËá≥Âú®Âä†ËΩΩÁ≥ªÁªüÂ∫ìÔºà‰æãÂ¶Çlibc.so.6Ôºâ‰πãÂâçÂä†ËΩΩËá™Â∑±ÁöÑÂä®ÊÄÅÂ∫ì„ÄÇ</p>
<p>ÂÄüÂä©ËøôÈ°πÂäüËÉΩÔºåÊàë‰ª¨ËÉΩÂ§üÁºñÂÜôËá™ÂÆö‰πâÁöÑÂáΩÊï∞‚ÄúÊõøÊç¢‚ÄùÁ≥ªÁªüÂ∫ì‰∏≠ÁöÑÂêåÂêçÂáΩÊï∞„ÄÇËøõ‰∏ÄÊ≠•ËØ¥ÔºåÂä´ÊåÅtime()„ÄÅread()„ÄÅwrite()Á≠âÁ≥ªÁªüÂáΩÊï∞Âπ∂ÈùûÈöæ‰∫ã„ÄÇ</p>
<h3 id="chap68-windowsnt"><a class="markdownIt-Anchor" href="#chap68-windowsnt"></a> chap68 WindowsNT</h3>
<h4 id="crt"><a class="markdownIt-Anchor" href="#crt"></a> CRT</h4>
<p>Âà∞ÂéüÂßãÂÖ•Âè£OEPÔºàOriginal Entry PointÔºâÊÄªÊòØÊåáÂêëÂÖ∂‰ªñÁöÑ‰∏ÄÊÆµ‰ª£Á†Å„ÄÇËøô‰∫õ‰ª£Á†Å‰ºöÂú®ÂêØÂä®Á®ãÂ∫è‰πãÂâçËøõË°å‰∏Ä‰∫õÁª¥Êä§ÂíåÂáÜÂ§áÂ∑•‰Ωú„ÄÇËøôÂ∞±ÊòØÊâÄË∞ìÁöÑÂêØÂä®‰ª£Á†Å/startup-codeÂç≥CRT‰ª£Á†ÅÔºàC RunTimeÔºâ„ÄÇ</p>
<p>main()ÂáΩÊï∞ÈÄöËøáÂ§ñÊù•Êï∞ÁªÑËé∑ÂèñÂêØÂä®ÂèÇÊï∞ÂèäÁ≥ªÁªüÁöÑÁéØÂ¢ÉÂèòÈáè„ÄÇÁÑ∂ËÄåÔºåÂÆûÈôÖ‰º†ÈÄíÁªôÁ®ãÂ∫èÁöÑ‰∏çÊòØÊï∞ÁªÑËÄåÊòØÂèÇÊï∞Â≠óÁ¨¶‰∏≤„ÄÇCRT‰ª£Á†Å‰ºöÊ†πÊçÆÁ©∫Ê†ºÂØπÂ≠óÁ¨¶‰∏≤ËøõË°åÂàáÂâ≤„ÄÇÂè¶Â§ñÔºåCRT‰ª£Á†ÅËøò‰ºöÈÄöËøáenvpÊï∞ÁªÑÂêëmain()ÂáΩÊï∞‰º†ÈÄíÁ≥ªÁªüÁöÑÁéØÂ¢ÉÂèòÈáè„ÄÇÂú®Win32ÁöÑGUIÁ®ãÂ∫èÈáåÔºå‰∏ªÂáΩÊï∞Âèò‰∏∫‰∫ÜWinMain()ÔºåÂπ∂‰∏îÊã•ÊúâËá™Â∑±ÁöÑÂèÇÊï∞‰º†ÈÄíËßÑÊ†º</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> CALLBACK <span class="token function">WinMain</span><span class="token punctuation">(</span>
 _In_ HINSTANCE hInstance<span class="token punctuation">,</span>
 _In_ HINSTANCE hPrevInstance<span class="token punctuation">,</span>
 _In_ LPSTR lpCmdLine<span class="token punctuation">,</span>
 _In_ <span class="token keyword">int</span> nCmdShow
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Â†ÜÁöÑÂàùÂßãÂåñÊìç‰ΩúÊòØÁî±CRT‰ª£Á†ÅÂÆåÊàêÁöÑ„ÄÇËã•Âú®Ê≤°ÊúâCRT‰ª£Á†ÅÁöÑÊÉÖÂÜµ‰∏ãË∞ÉÁî®ÂÜÖÂ≠òÂàÜÈÖçÂáΩÊï∞malloc()ÔºåÂ∞±‰ºöÂºïÂèëÂºÇÂ∏∏ÈÄÄÂá∫ÔºåÂπ∂Â∞ÜÁúãÂà∞‰∏ãËø∞ÈîôËØØ‰ª£Á†ÅÔºö</p>
<p>Âú®C++Á®ãÂ∫è‰∏≠ÔºåCRT‰ª£Á†ÅËøòË¶ÅÂú®ÂêØÂä®‰∏ªÂáΩÊï∞main()‰πãÂâçÂàùÂßãÂåñÂÖ®ÈÉ®ÂÖ®Â±ÄÂØπË±°„ÄÇ</p>
<h4 id="pe"><a class="markdownIt-Anchor" href="#pe"></a> PE</h4>
<p>PEÔºàPortable ExecutableÔºâÊ†ºÂºèÔºåÊòØÂæÆËΩØWindowsÁéØÂ¢ÉÂèØÁßªÊ§çÂèØÊâßË°åÊñá‰ª∂ÔºàÂ¶Çexe„ÄÅdll„ÄÅvxd„ÄÅsysÂíåvdmÁ≠âÔºâÁöÑÊ†áÂáÜÊñá‰ª∂Ê†ºÂºè„ÄÇ</p>
<p>‰∏éÂÖ∂‰ªñÊ†ºÂºèÁöÑPEÊñá‰ª∂‰∏çÂêåÁöÑÊòØÔºåexeÂíåsysÊñá‰ª∂ÈÄöÂ∏∏Âè™ÊúâÂØºÂÖ•Ë°®ËÄåÊ≤°ÊúâÂØºÂá∫Ë°®„ÄÇ</p>
<p>ÂíåÂÖ∂‰ªñÁöÑPEÊñá‰ª∂‰∏ÄÊ†∑ÔºåDLLÊñá‰ª∂‰πüÊúâ‰∏Ä‰∏™ÂéüÂßã‰ª£Á†ÅÂÖ•Âè£ÁÇπOEPÔºàÂ∞±ÊòØDllMain()ÂáΩÊï∞ÁöÑÂú∞ÂùÄÔºâ„ÄÇ‰ΩÜÊòØDLLÁöÑËøô‰∏™ÂáΩÊï∞ÈÄöÂ∏∏Êù•ËÆ≤‰ªÄ‰πà‰πü‰∏ç‰ºöÂÅö„ÄÇ</p>
<p>sysÊñá‰ª∂ÈÄöÂ∏∏Êù•ËØ¥ÊòØ‰∏Ä‰∏™Á≥ªÁªüÈ©±Âä®Á®ãÂ∫è„ÄÇËØ¥Âà∞È©±Âä®Á®ãÂ∫èÔºåWindowsÊìç‰ΩúÁ≥ªÁªüÈúÄË¶ÅÂú®PEÊñá‰ª∂Èáå‰øùÂ≠òÂÖ∂Ê†°È™åÂíåÔºå‰ª•È™åËØÅËØ•Êñá‰ª∂ÁöÑÊ≠£Á°ÆÊÄßÔºàHiewÂ∞±ÂèØ‰ª•È™åËØÅËøô‰∏™Ê†°È™åÂíåÔºâ„ÄÇ</p>
<h5 id="ÊúØËØ≠"><a class="markdownIt-Anchor" href="#ÊúØËØ≠"></a> ÊúØËØ≠</h5>
<ul>
<li>Ê®°ÂùóModuleÔºöÂÆÉÊòØÊåá‰∏Ä‰∏™ÂçïÁã¨ÁöÑexeÊàñËÄÖdllÊñá‰ª∂„ÄÇ</li>
<li>ËøõÁ®ãProcessÔºöÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠Âπ∂Ê≠£Âú®ËøêË°åÁöÑÁ®ãÂ∫èÔºåÈÄöÂ∏∏Áî±‰∏Ä‰∏™exeÊñá‰ª∂ÂíåÂ§ö‰∏™dllÊñá‰ª∂ÁªÑÊàê„ÄÇ</li>
<li>ËøõÁ®ãÂÜÖÂ≠òProcess memoryÔºöÊØè‰∏™ËøõÁ®ãÈÉΩÊúâÂÆåÂÖ®Â±û‰∫éËá™Â∑±ÁöÑÔºåËøõÁ®ãÈó¥Áã¨Á´ãÁöÑÔºå‰∏çË¢´Âπ≤Êâ∞ÁöÑÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ ÈÄöÂ∏∏ÊòØÊ®°Âùó„ÄÅÂ†Ü„ÄÅÊ†àÁ≠âÊï∞ÊçÆÊûÑÊàê„ÄÇ</li>
<li>ËôöÊãüÂú∞ÂùÄVAÔºàVirtual AddressÔºâÔºöÁ®ãÂ∫èËÆøÈóÆÂ≠òÂÇ®Âô®ÊâÄ‰ΩøÁî®ÁöÑÈÄªËæëÂú∞ÂùÄ„ÄÇ</li>
<li>Âü∫Âú∞ÂùÄBase AddressÔºöËøõÁ®ãÂÜÖÂ≠ò‰∏≠Âä†ËΩΩÊ®°ÂùóÁöÑÈ¶ñÂú∞ÂùÄ„ÄÇ</li>
<li>Áõ∏ÂØπËôöÊãüÂú∞ÂùÄRVAÔºàRelative Virtual AddressÔºâÔºöËôöÊãüÂú∞ÂùÄVA‰∏éÂü∫Âú∞ÂùÄBase AddressÁöÑÂ∑ÆÂ∞±ÊòØÁõ∏ÂØπËôöÊãüÂú∞ÂùÄRVA„ÄÇÂú®PEÊñá‰ª∂Ë°®‰∏≠ÁöÑÂæàÂ§öÂú∞ÂùÄÈÉΩÊòØÁõ∏ÂØπËôöÊãüÂú∞ÂùÄRVA„ÄÇ</li>
<li>ÂØºÂÖ•Âú∞ÂùÄË°®IATÔºàImport Address TableÔºâÔºöÂØºÂÖ•Á¨¶Âè∑ÁöÑÂú∞ÂùÄÊï∞ÁªÑ„ÄÇPEÂ§¥ÈáåÁöÑIMAGE_DIRECTORY_ ENTRY_IATÊåáÂêëÁ¨¨‰∏Ä‰∏™ÂØºÂÖ•Âú∞ÂùÄË°®IATÁöÑÂºÄÂßã‰ΩçÁΩÆ„ÄÇÂÄºÂæóËØ¥ÊòéÁöÑÊòØÔºåÂèçÁºñËØëÂ∑•ÂÖ∑IDAÂèØËÉΩ‰ºöÁªôIATËôöÊûÑ‰∏Ä‰∏™‰º™ÊÆµ‚Äì.idataÊÆµÔºåÂç≥‰ΩøIATÊòØÂÖ∂‰ªñÂú∞ÂùÄÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ</li>
<li>ÂØºÂÖ•Á¨¶Âè∑ÂêçÁß∞Ë°®INTÔºàImport Name TableÔºâÔºöÂ≠òÂÇ®ÁùÄÊâÄÈúÄÁ¨¶Âè∑ÂêçÁß∞ÁöÑÊï∞ÁªÑ„ÄÇ</li>
</ul>
<h5 id="Âü∫Âú∞ÂùÄ"><a class="markdownIt-Anchor" href="#Âü∫Âú∞ÂùÄ"></a> Âü∫Âú∞ÂùÄ</h5>
<p>Âú®ÂºÄÂèëÂêÑËá™ÁöÑDLLÂä®ÊÄÅÈìæÊé•Â∫ìÊñá‰ª∂Êó∂ÔºåÂ§öÊï∞ÂºÄÂèëÂõ¢ÈòüÈÉΩÊúâÊÑèËÆ©ÂÖ∂‰ªñ‰∫∫Áõ¥Êé•Ë∞ÉÁî®Ëá™Â∑±ÁöÑÂä®ÊÄÅÈìæÊé•Â∫ì„ÄÇ</p>
<p>Âõ†Ê≠§Ôºå**ÂΩìÂêå‰∏Ä‰∏™ËøõÁ®ãÁöÑ‰∏§‰∏™DLLÂ∫ìÂÖ∑ÊúâÁõ∏ÂêåÁöÑÂü∫Âú∞ÂùÄÊó∂ÔºåÂè™‰ºöÊúâ‰∏Ä‰∏™DLLË¢´ÁúüÊ≠£Âä†ËΩΩÂà∞Âü∫Âú∞ÂùÄ‰∏ä„ÄÇËÄåÂè¶Â§ñ‰∏Ä‰∏™DLLÂàô‰ºöÂàÜÈÖçÂà∞ËøõÁ®ãÂÜÖÂ≠òÁöÑÊüêÊÆµÁ©∫Èó≤Á©∫Èó¥Èáå„ÄÇ**<strong>Âú®Ë∞ÉÁî®ÂêéËÄÖÊó∂ÔºåÊØè‰∏™ËôöÊãüÂú∞ÂùÄÈÉΩ‰ºöË¢´ÈáçÊñ∞Ê†°ÂØπ„ÄÇ</strong></p>
<p>ÈÄöÂ∏∏Êù•ËØ¥ÔºåMSVCÁºñËØëÊàêÁöÑÂèØÊâßË°åÁ®ãÂ∫èÁöÑÂü∫Âú∞ÂùÄÈÉΩÊòØ0x400000ÔºåËÄå‰ª£Á†ÅÊÆµÂàô‰ªé0x401000ÂºÄÂßã„ÄÇÁî±Ê≠§ÂèØÁü•ÔºåËøôÁßçÁ®ãÂ∫è‰ª£Á†ÅÊÆµÁöÑÁõ∏ÂØπËôöÊãüÂú∞ÂùÄRVAÁöÑÈ¶ñÂú∞ÂùÄÈÉΩÊòØ0x1000„ÄÇËÄåMSVCÈÄöÂ∏∏ÊääDLLÁöÑÂü∫Âú∞ÂùÄËÆæÂÆö‰∏∫0x10000000„ÄÇ</p>
<p>ÊìçÁ∫µÁ≥ªÁªüÂèØËÉΩ‰ºöÊääÊ®°ÂùóÂä†ËΩΩÂà∞‰∏çÂêåÁöÑÂü∫Âú∞ÂùÄ‰∏≠ÔºåËøòÂèØËÉΩÊòØÂõ†‰∏∫Á®ãÂ∫èËá™Ë∫´ÁöÑË¶ÅÊ±Ç„ÄÇÂΩìÁ®ãÂ∫è‚ÄúÁÇπÂêç‚Äù<strong>ÂêØÁî®Âú∞ÂùÄÁ©∫Èó¥ÂàÜÂ∏ÉÁöÑÈöèÊú∫ÂåñÔºàAddress Space Layout RandomizationÔºåASLRÔºâÊäÄÊúØÁöÑÊó∂ÂÄôÔºåÊìç‰ΩúÁ≥ªÁªü‰ºöÊääÂÖ∂ÂêÑ‰∏™Ê®°ÂùóÂä†ËΩΩÂà∞ÈöèÊú∫ÁöÑÂü∫Âú∞ÂùÄ‰∏ä„ÄÇ</strong></p>
<h5 id="Â≠êÁ≥ªÁªü"><a class="markdownIt-Anchor" href="#Â≠êÁ≥ªÁªü"></a> Â≠êÁ≥ªÁªü</h5>
<p>PEÊñá‰ª∂Êúâ‰∏Ä‰∏™Â≠êÁ≥ªÁªüÂ≠óÊÆµ„ÄÇËøô‰∏™Â≠óÊÆµÁöÑÂÄºÈÄöÂ∏∏ÊòØ‰∏ãÂàó‰πã‰∏ÄÔºö</p>
<ul>
<li>NATIVEÔºàÁ≥ªÁªüÈ©±Âä®Á®ãÂ∫èÔºâ„ÄÇ</li>
<li>consoleÊéßÂà∂Âè∞Á®ãÂ∫è„ÄÇ</li>
<li>GUIÔºàÈùûÊéßÂà∂Âè∞Á®ãÂ∫èÔºå‰πüÂ∞±ÊòØÊúÄÂ∏∏ËßÅÁöÑÂõæÊñáÁïåÈù¢Á®ãÂ∫èÔºâ„ÄÇ</li>
</ul>
<h5 id="ÊÆµ"><a class="markdownIt-Anchor" href="#ÊÆµ"></a> ÊÆµ</h5>
<p>ÊâÄÊúâÁöÑÂèØÊâßË°åÊñá‰ª∂ÈÉΩÂèØÂàÜËß£‰∏∫Ëã•Âπ≤ÊÆµÔºàsectionsÔºâ„ÄÇÊÆµÊòØ‰ª£Á†ÅÂíåÊï∞ÊçÆ„ÄÅ‰ª•ÂèäÂ∏∏ÈáèÂíåÂÖ∂‰ªñÊï∞ÊçÆÁöÑÁªÑÁªáÂΩ¢Âºè„ÄÇ</p>
<ul>
<li>Â∏¶ÊúâIMAGE_SCN_CNT_CODEÊàñIMAGE_SCN_MEM_EXECUTEÊ†áËØÜÁöÑÊÆµÔºåÂ∞ÅË£ÖÁöÑÊòØÂèØÊâßË°å‰ª£Á†Å„ÄÇ</li>
<li>Êï∞ÊçÆÊÆµÁöÑÊ†áËØÜ‰∏∫IMAGE_SCN_CNT_INITIALIZED_DATA„ÄÅIMAGE_SCN_MEM_READÊàñIMAGE_ SCN_MEM_WRITEÊ†áËÆ∞„ÄÇ</li>
<li>Êú™ÂàùÂßãÂåñÁöÑÊï∞ÊçÆÁöÑÁ©∫ÊÆµÁöÑÊ†áËØÜ‰∏∫IMAGE_SCN_CNT_UNINITIALIZED_DATA„ÄÅIMAGE_SCN_ MEM_READÊàñIMAGE_SCN_MEM_WRITE„ÄÇ</li>
<li>Â∏∏Êï∞Êï∞ÊçÆÊÆµÔºàÂÖ∂‰∏≠ÁöÑÊï∞ÊçÆ‰∏çÂèØË¢´ÈáçÊñ∞ËµãÂÄºÔºâÁöÑÊ†áËØÜÊòØIMAGE_SCN_CNT_ INITIALIZED_ DATA‰ª•ÂèäIMAGE_SCN_MEM_READÔºå‰ΩÜÊòØ‰∏çÂåÖÊã¨Ê†áËØÜIMAGE_SCN_MEM_WRITE„ÄÇÂ¶ÇÊûúËøõÁ®ãËØïÂõæÂæÄËøô‰∏™Êï∞ÊçÆÊÆµÂÜôÂÖ•Êï∞ÊçÆÔºåÈÇ£‰πàÊï¥‰∏™ËøõÁ®ãÂ∞±‰ºöÂ¥©Ê∫É„ÄÇ</li>
</ul>
<p>PEÂèØÊâßË°åÊñá‰ª∂ÁöÑÊØè‰∏™ÊÆµÈÉΩÂèØ‰ª•Êã•Êúâ‰∏Ä‰∏™ÊÆµÂêçÁß∞„ÄÇÁÑ∂ËÄåÔºåÂêçÁß∞‰∏çÊòØÊÆµÁöÑÈáçË¶ÅÁâπÂæÅ„ÄÇÈÄöÂ∏∏Êù•ËØ¥Ôºå‰ª£Á†ÅÊÆµÁöÑÊÆµÂêçÁß∞ÊòØ.textÔºåÊï∞ÊçÆÊÆµÁöÑÊÆµÂêçÁß∞ÊòØ.dataÔºåÂ∏∏Êï∞ÊÆµÁöÑÊÆµÂêçÁß∞.rdataÔºàÂè™ËØªÊï∞ÊçÆÔºâ„ÄÇÂÖ∂‰ªñÁ±ªÂûãÁöÑÂ∏∏ËßÅÊÆµÂêçÁß∞ËøòÊúâÔºö</p>
<ul>
<li>.idataÔºöÂØºÂÖ•ÊÆµ„ÄÇIDAÂèØËÉΩ‰ºöÁªôËøô‰∏™ÊÆµÂàÜÈÖç‰∏Ä‰∏™‰º™ÂêçÁß∞ÔºõËØ¶ÊÉÖËØ∑ÂèÇËÄÉÊú¨‰π¶68.2.1ËäÇ„ÄÇ</li>
<li>.edataÔºöÂØºÂá∫ÊÆµ„ÄÇËøô‰∏™ÊÆµÂçÅÂàÜÁΩïËßÅ„ÄÇ</li>
<li>.pdataÔºöËøô‰∏™ÊÆµÂ≠òÂÇ®ÁöÑÊòØÁî®‰∫éÂºÇÂ∏∏Â§ÑÁêÜÁöÑÂáΩÊï∞Ë°®È°π„ÄÇÂÆÉÂåÖÂê´‰∫ÜWindors NT For MIPS„ÄÅIA64‰ª•Âèäx64ÊâÄÈúÄÁöÑÂÖ®ÈÉ®ÂºÇÂ∏∏Â§ÑÁêÜ‰ø°ÊÅØ„ÄÇËØ¶ÊÉÖËØ∑ÂèÇËÄÉÊú¨‰π¶ÁöÑ68.3.3ËäÇ„ÄÇ</li>
<li>.relocÔºöÔºàÂä†ËΩΩÔºâÈáçÂÆöÂêëÊÆµ„ÄÇ</li>
<li>.bssÔºöÊú™ÂàùÂßãÂåñÁöÑÊï∞ÊçÆÊÆµÔºàBSSÔºâ„ÄÇ</li>
<li>.tlsÔºöÁ∫øÁ®ãÊú¨Âú∞Â≠òÂÇ®ÊÆµÔºàTLSÔºâ„ÄÇ</li>
<li>.rsrcÔºöËµÑÊ∫ê„ÄÇ</li>
<li>.CRTÔºöÂú®Êó©ÊúüÁâàÊú¨ÁöÑMSVCÁºñËØëÂá∫ÁöÑÂèØÊâßË°åÊñá‰ª∂ÈáåÔºåÂèØËÉΩÂá∫Áé∞Ëøô‰∏™Ëøô‰∏™ÊÆµ„ÄÇ</li>
</ul>
<p>ÁªèËøáÂä†ÂØÜÊàñËÄÖÂéãÁº©Â§ÑÁêÜ‰πãÂêéÔºåPEÊñá‰ª∂sectionÊÆµÁöÑÊÆµÂêçÁß∞ÈÄöÂ∏∏‰ºöË¢´ÊõøÊç¢ÊàñÊ∑∑Ê∑Ü„ÄÇ</p>
<p>ÈÉ®ÂàÜÁºñËØëÂô®Ôºà‰æãÂ¶ÇMinGWÔºâÂíåÈìæÊé•Âô®ÂèØ‰ª•Âú®ÁîüÊàêÁöÑÂèØÊâßË°åÊñá‰ª∂‰∏≠Âä†ÂÖ•Â∏¶ÊúâË∞ÉËØïÁ¨¶Âè∑„ÄÅÊàñËÄÖÂÖ∂‰ªñÁöÑË∞ÉËØï‰ø°ÊÅØÁöÑÁã¨Á´ãÊÆµ„ÄÇÁÑ∂ËÄåÊñ∞ËøëÁâàÊú¨ÁöÑMSVC‰∏çÂÜçÊîØÊåÅËøôÈ°πÂäüËÉΩ„ÄÇ‰∏∫‰∫Ü‰æø‰∫é‰∏ì‰∏ö‰∫∫ÂëòÂàÜÊûêÂíåË∞ÉËØïÂ∫îÁî®Á®ãÂ∫èÔºåMSVCÊé®Âá∫‰∫ÜÂÖ®Áß∞‰∏∫‚ÄúÁ®ãÂ∫èÊï∞ÊçÆÂ∫ì‚ÄùÁöÑPDBÊñá‰ª∂Ê†ºÂºè„ÄÇ</p>
<p>PEÊ†ºÂºèÁöÑsectionÊÆµÁöÑÊï∞ÊçÆÁªìÊûÑÂ§ß‰ΩìÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IMAGE_SECTION_HEADER</span> <span class="token punctuation">&#123;</span>
  BYTE Name<span class="token punctuation">[</span>IMAGE_SIZEOF_SHORT_NAME<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">union</span> <span class="token punctuation">&#123;</span>
    DWORD PhysicalAddress<span class="token punctuation">;</span>
    DWORD VirtualSize<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> Misc<span class="token punctuation">;</span>
  DWORD VirtualAddress<span class="token punctuation">;</span>
  DWORD SizeOfRawData<span class="token punctuation">;</span>
  DWORD PointerToRawData<span class="token punctuation">;</span>
  DWORD PointerToRelocations<span class="token punctuation">;</span>
  DWORD PointerToLinenumbers<span class="token punctuation">;</span>
  WORD NumberOfRelocations<span class="token punctuation">;</span>
  WORD NumberOfLinenumbers<span class="token punctuation">;</span>
  DWORD Characteristics<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> IMAGE_SECTION_HEADER<span class="token punctuation">,</span> <span class="token operator">*</span>PIMAGE_SECTION_HEADER<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ÊÑüËßâËÆ≤ÁöÑ‰∏çÊÄé‰πàË°å</p>
<p>Ë∑≥‰∫Ü</p>
<h5 id="tls"><a class="markdownIt-Anchor" href="#tls"></a> TLS</h5>
<p>Ëøô‰∏™ÊÆµÈáåÂ≠òÂÇ®‰∫ÜTLSÊï∞ÊçÆÔºàÁ¨¨65Á´†ÔºâÁöÑÂàùÂßãÂåñÊï∞ÊçÆÔºàÂ¶ÇÊûúÈúÄË¶ÅÁöÑËØùÔºâ„ÄÇÂΩìÂêØÂä®‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ãÊó∂ÔºåTLSÁöÑÊï∞ÊçÆÂ∞±ÊòØÈÄöËøáÊú¨ÊÆµÁöÑÊï∞ÊçÆÊù•ÂàùÂßãÂåñÁöÑ„ÄÇ</p>
<p>Èô§Ê≠§‰πãÂ§ñÔºåPEÊñá‰ª∂ËßÑËåÉËøòÁ∫¶ÂÆö‰∫Ü‚ÄúTLSÔºÅ‚ÄùÁöÑÂàùÂßãÂåñËßÑËåÉÔºåÂç≥TLS callbacks/TLSÂõûË∞ÉÂáΩÊï∞„ÄÇ<strong>Â¶ÇÊûúÁ®ãÂ∫èÂ£∞Êòé‰∫ÜTLSÂõûË∞ÉÂáΩÊï∞ÔºåÈÇ£‰πàTLSÂõûË∞ÉÂáΩÊï∞‰ºöÂÖà‰∫éOEPÊâßË°å„ÄÇ</strong></p>
<h4 id="seh"><a class="markdownIt-Anchor" href="#seh"></a> SEH</h4>
<p>ÊØè‰∏™ËøêË°åÁöÑËøõÁ®ãÈÉΩÊúâ‰∏ÄÊù°SEHÂè•ÊüÑÈìæÔºåÁ∫øÁ®ã‰ø°ÊÅØÂùóÔºàThread Information BlockÔºåTIBÔºâÊúâSHEÁöÑÊúÄÂêé‰∏Ä‰∏™Âè•ÊüÑ„ÄÇÂΩìÂá∫Áé∞ÂºÇÂ§ñÊó∂ÔºàÊØîÂ¶ÇÂá∫Áé∞‰∫ÜË¢´Èõ∂Èô§„ÄÅÂú∞ÂùÄËÆøÈóÆ‰∏çÊ≠£Á°ÆÊàñËÄÖÁ®ãÂ∫è‰∏ªÂä®Ë∞ÉÁî®RaiseException()ÂáΩÊï∞Á≠âÊÉÖÂÜµÔºâÔºåÊìç‰ΩúÁ≥ªÁªü‰ºöÂú®Á∫øÁ®ã‰ø°ÊÅØÂùóTIBÈáåÂØªÊâæSEHÁöÑÊúÄÂêé‰∏Ä‰∏™Âè•ÊüÑ„ÄÇÂπ∂‰∏îÊääÂá∫Áé∞ÂºÇÂ∏∏ÊÉÖÂÜµÊó∂‰∏éCPUÊúâÂÖ≥ÁöÑÊâÄÊúâÁä∂ÊÄÅÔºàÂåÖÊã¨ÂØÑÂ≠òÂô®ÁöÑÂÄºÁ≠âÊï∞ÊçÆÔºâ‰º†ÈÄíÁªôÈÇ£‰∏™SEHÂè•ÊüÑ„ÄÇÊ≠§Êó∂ÂºÇÂ∏∏Â§ÑÁêÜÂáΩÊï∞ÂºÄÂßãÂà§Êñ≠Ëá™Â∑±ËÉΩÂê¶Â∫îÂØπËøôÁßçÂºÇÂ∏∏ÊÉÖÂÜµ„ÄÇÂ¶ÇÊûúÁ≠îÊ°àÊòØËÇØÂÆöÁöÑÔºåÈÇ£‰πàÂºÇÂ∏∏Â§ÑÁêÜÂáΩÊï∞Â∞±‰ºöÁùÄÊâãÊé•ÁÆ°„ÄÇÂ¶ÇÊûúÂºÇÂ∏∏Â§ÑÁêÜÂáΩÊï∞Êó†Ê≥ïÂ§ÑÁêÜËøôÁßçÊÉÖÂÜµÔºåÂÆÉÂ∞±‰ºöÈÄöÁü•Êìç‰ΩúÁ≥ªÁªüÊó†Ê≥ïÂ§ÑÁêÜÂÆÉÔºåÊ≠§ÂêéÊìç‰ΩúÁ≥ªÁªü‰ºöÈÄê‰∏ÄÂ∞ùËØïÂºÇÂ∏∏Â§ÑÁêÜÈìæ‰∏≠ÁöÑÂÖ∂‰ªñÂ§ÑÁêÜÁ®ãÂ∫èÔºåÁõ¥Âà∞ÊâæÂà∞ËÉΩÂ§üÂ∫îÂØπËøôÁßçÊÉÖÂÜµÁöÑÂºÇÂ∏∏Â§ÑÁêÜÁ®ãÂ∫è‰∏∫Ê≠¢„ÄÇ</p>
</div></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2024/05/27/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="Êï∞ÊçÆÁªìÊûÑÂ§ç‰π†Á¨îËÆ∞"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">Êï∞ÊçÆÁªìÊûÑÂ§ç‰π†Á¨îËÆ∞</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/05/09/PwnCollege1-ProgramMiuse/" rel="next" title="pwnCollege1-ProgramMiuse"><span class="post-nav-text">pwnCollege1-ProgramMiuse</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>ÊÇ®ÈúÄË¶ÅÁßëÂ≠¶‰∏äÁΩëÔºåÊâçÂèØ‰ΩøÁî®ËØÑËÆ∫Âå∫ÂäüËÉΩ„ÄÇ</span><br></div><div id="waline"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><script>window.CONFIG.waline.config.path = "/2024/05/23/re4b%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"</script><div class="js-Pjax"><script src="/js/comments/waline.js" type="module" defer></script></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank"></a></div><div class="copyright"><span>&copy; 2023 ‚Äì 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Npc</span></div><div class="footer-custom-text">=w=</div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>